(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";var NEW_LINE="\n";module.exports=function(textareaValue){if(textareaValue[textareaValue.length-1]===NEW_LINE){textareaValue+=NEW_LINE}return textareaValue}},{}],2:[function(require,module,exports){"use strict";module.exports=function(textarea,fontFamily){var textareaComputedStyle=window.getComputedStyle(textarea);var fontWeight=textareaComputedStyle.getPropertyValue("font-weight")||"normal";var fontSize=textareaComputedStyle.getPropertyValue("font-size")||"16px";return"".concat(fontWeight," ").concat(fontSize," ").concat(fontFamily)}},{}],3:[function(require,module,exports){"use strict";var documentScrollTopPosition=require("./documentScrollLeftPosition");var documentScrollLeftPosition=require("./documentScrollLeftPosition");var documentClientTopPosition=require("./documentClientTopPosition");var documentClientLeftPosition=require("./documentClientLeftPosition");module.exports=function(element){var rect=element.getBoundingClientRect();var clientTop=documentClientTopPosition();var clientLeft=documentClientLeftPosition();var scrollTop=documentScrollTopPosition();var scrollLeft=documentScrollLeftPosition();var top=Math.round(rect.top-clientTop+scrollTop);var left=Math.round(rect.left-clientLeft+scrollLeft);var bottom=Math.round(rect.bottom-clientTop+scrollTop);var right=Math.round(rect.right-clientLeft+scrollLeft);return{top:top,left:left,bottom:bottom,right:right}}},{"./documentClientLeftPosition":10,"./documentClientTopPosition":11,"./documentScrollLeftPosition":12}],4:[function(require,module,exports){"use strict";var createdElementWithStylesAndAttributes=require("./createdElementWithStylesAndAttributes");module.exports=function(textarea){var autocompleteListView=createdElementWithStylesAndAttributes("div",{display:"none",position:"absolute"},{class:"autocomplete-list-view"});textarea.parentNode.appendChild(autocompleteListView);return autocompleteListView}},{"./createdElementWithStylesAndAttributes":6}],5:[function(require,module,exports){"use strict";var createdElementWithStylesAndAttributes=require("./createdElementWithStylesAndAttributes");var insertElementBeforeSpecifiedOne=require("./insertElementBeforeSpecifiedOne");module.exports=function(textarea,fontFamily){var createdDiv=createdElementWithStylesAndAttributes("div",{},{class:"div-underneath-unitextarea","data-no-ehtml":"true"});var textContainer=createdElementWithStylesAndAttributes("div",{},{id:"div-underneath-unitextarea-text-container",class:"div-underneath-unitextarea-text-container","data-no-ehtml":"true"});createdDiv.appendChild(textContainer);createdDiv.textContainer=textContainer;insertElementBeforeSpecifiedOne(createdDiv,textarea);return createdDiv}},{"./createdElementWithStylesAndAttributes":6,"./insertElementBeforeSpecifiedOne":18}],6:[function(require,module,exports){"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}module.exports=function(tagName,styles,attributes){var element=document.createElement(tagName);if(styles){for(var _i=0,_Object$entries=Object.entries(styles);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),styleKey=_Object$entries$_i[0],styleValue=_Object$entries$_i[1];element.style[styleKey]=styleValue}}if(attributes){for(var _i2=0,_Object$entries2=Object.entries(attributes);_i2<_Object$entries2.length;_i2++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i2],2),attributeKey=_Object$entries2$_i[0],attributeValue=_Object$entries2$_i[1];element.setAttribute(attributeKey,attributeValue)}}return element}},{}],7:[function(require,module,exports){"use strict";var createdElementWithStylesAndAttributes=require("./createdElementWithStylesAndAttributes");var insertElementBeforeSpecifiedOne=require("./insertElementBeforeSpecifiedOne");module.exports=function(divUnderneathTextarea,fontFamily){var createdLineNumbersColumn=createdElementWithStylesAndAttributes("div",{},{class:"line-numbers-column"});insertElementBeforeSpecifiedOne(createdLineNumbersColumn,divUnderneathTextarea);return createdLineNumbersColumn}},{"./createdElementWithStylesAndAttributes":6,"./insertElementBeforeSpecifiedOne":18}],8:[function(require,module,exports){"use strict";module.exports=function(refElementInSVGPlaceholder,svgElement,className,id){var refElementLeft=refElementInSVGPlaceholder.getAttribute("data-left")*1;var refElementRight=refElementInSVGPlaceholder.getAttribute("data-right")*1;var refElementTop=refElementInSVGPlaceholder.getAttribute("data-top")*1;var refElementBottom=refElementInSVGPlaceholder.getAttribute("data-bottom")*1;var refRectHoveringRefElement=document.createElementNS("http://www.w3.org/2000/svg","rect");var refRectHoveringRefElementWidth=refElementRight-refElementLeft;var refRectHoveringRefElementHeight=refElementBottom-refElementTop;var pageElement=svgElement.querySelector('[data-name="page"]');var intervalBetweenStaveLines=pageElement.getAttribute("data-interval-between-stave-lines");var refRectPadding=1*intervalBetweenStaveLines;var refRectStrokeWidth=.08*intervalBetweenStaveLines;var refRectStrokeColor=pageElement.getAttribute("data-font-color");refRectHoveringRefElement.setAttribute("class",className);if(id){refRectHoveringRefElement.setAttribute("id",id)}refRectHoveringRefElement.setAttribute("width",refRectHoveringRefElementWidth+2*refRectPadding);refRectHoveringRefElement.setAttribute("height",refRectHoveringRefElementHeight+2*refRectPadding);refRectHoveringRefElement.setAttribute("transform","translate(".concat(refElementLeft-refRectPadding,", ").concat(refElementTop-refRectPadding,")"));refRectHoveringRefElement.setAttribute("fill","rgb(245, 205, 121)");refRectHoveringRefElement.setAttribute("stroke",refRectStrokeColor);refRectHoveringRefElement.setAttribute("stroke-width",refRectStrokeWidth);refRectHoveringRefElement.setAttribute("stroke-linejoin","round");refRectHoveringRefElement.setAttribute("stroke-linecap","round");return refRectHoveringRefElement}},{}],9:[function(require,module,exports){"use strict";var isPrintableKeycode=require("./isPrintableKeycode");module.exports=function(textarea){window.weAreTypingInTextarea=false;var delayedTypingAction;textarea.addEventListener("keydown",function(event){if(delayedTypingAction){window.clearTimeout(delayedTypingAction)}if(isPrintableKeycode(event.keyCode)){window.weAreTypingInTextarea=true}delayedTypingAction=window.setTimeout(function(){window.weAreTypingInTextarea=false},500)})}},{"./isPrintableKeycode":19}],10:[function(require,module,exports){"use strict";module.exports=function(){return document.documentElement.clientLeft||document.body.clientLeft||0}},{}],11:[function(require,module,exports){"use strict";module.exports=function(){return document.documentElement.clientTop||document.body.clientTop||0}},{}],12:[function(require,module,exports){"use strict";module.exports=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft}},{}],13:[function(require,module,exports){"use strict";module.exports=function(lineNumbersColumn,textarea,divUnderneathTextarea){var numberOfLines=textarea.value.split("\n").length;var numbersForEachLine=new Array(numberOfLines).fill().map(function(undefinedNumber,numberIndex){return'<span class="line-number-block" id="line-number-'.concat(numberIndex+1,'">').concat(numberIndex+1,"</span>")}).join("\n");lineNumbersColumn.innerHTML=numbersForEachLine;var computedStyleOfLineNumbersColumn=window.getComputedStyle(lineNumbersColumn);var computedStyleOfTexareaParent=window.getComputedStyle(textarea.initialParentElement);var lineNumbersColumnWidth=computedStyleOfLineNumbersColumn.getPropertyValue("width").split("px")[0]*1;var lineNumbersColumnLeft=computedStyleOfLineNumbersColumn.getPropertyValue("left").split("px")[0]*1;var textareaParentWidth=computedStyleOfTexareaParent.getPropertyValue("width").split("px")[0]*1;var additionalSpace=12;var lineNumbersColumnAdjustment=lineNumbersColumnWidth+lineNumbersColumnLeft+additionalSpace;textarea.style.left="".concat(lineNumbersColumnAdjustment,"px");divUnderneathTextarea.style.left=textarea.style.left;textarea.style.width="".concat(textareaParentWidth-lineNumbersColumnAdjustment-additionalSpace,"px");divUnderneathTextarea.style.width=textarea.style.width}},{}],14:[function(require,module,exports){"use strict";var fillLineNumbersColumn=require("./fillLineNumbersColumn");module.exports=function(lineNumbersColumn,textarea,divUnderneathTextarea){textarea.addEventListener("input",function(){fillLineNumbersColumn(lineNumbersColumn,textarea,divUnderneathTextarea)})}},{"./fillLineNumbersColumn":13}],15:[function(require,module,exports){"use strict";module.exports=function(shadowRoot,textarea,lineNumbersColumn){var selectionStartInTextarea=textarea.selectionStart;var currentLineNumberWhereCaretIsOn=textarea.value.substr(0,selectionStartInTextarea).split("\n").length;if(lineNumbersColumn.currentHighlightedNumber&&lineNumbersColumn.currentHighlightedNumber!==currentLineNumberWhereCaretIsOn){var lineNumberBlock=shadowRoot.getElementById("line-number-".concat(lineNumbersColumn.currentHighlightedNumber));if(lineNumberBlock){lineNumberBlock.classList.remove("line-highlighted-number")}}shadowRoot.getElementById("line-number-".concat(currentLineNumberWhereCaretIsOn)).classList.add("line-highlighted-number");lineNumbersColumn.currentHighlightedNumber=currentLineNumberWhereCaretIsOn}},{}],16:[function(require,module,exports){"use strict";var highlightLineNumber=require("./highlightLineNumber");module.exports=function(shadowRoot,textarea,lineNumbersColumn){document.addEventListener("selectionchange",function(){if(shadowRoot.activeElement===textarea){highlightLineNumber(shadowRoot,textarea,lineNumbersColumn)}});textarea.addEventListener("input",function(){highlightLineNumber(shadowRoot,textarea,lineNumbersColumn)});textarea.addEventListener("blur",function(){var lineNumberBlock=shadowRoot.getElementById("line-number-".concat(lineNumbersColumn.currentHighlightedNumber));if(lineNumberBlock){lineNumberBlock.classList.remove("line-highlighted-number")}});textarea.addEventListener("focus",function(){highlightLineNumber(shadowRoot,textarea,lineNumbersColumn)})}},{"./highlightLineNumber":15}],17:[function(require,module,exports){"use strict";var adjustTextareaValueToKeepScrollingAlignedWhenItsValueEndsWithNewline=require("./adjustTextareaValueToKeepScrollingAlignedWhenItsValueEndsWithNewline");var parsedUnilang=require("./parser/parsedUnilang");var refreshDivUnderneathTextareaWithNewHtml=require("./refreshDivUnderneathTextareaWithNewHtml");var NEW_LINE="\n";var EMPTY_STRING="";var COMMAND_IS_NOT_RECOGNIZABLE="command is not recognizable";var SPAN="span";var extendedLastLineIndexToParse=function extendedLastLineIndexToParse(inititalLastLineIndexToParse,numberOfCharsInEachLineInTextarea,currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios){var linesBelowInitialLastLineToParse=numberOfCharsInEachLineInTextarea.slice(inititalLastLineIndexToParse+1);var numberOfCharsBetweenLastCharInInitialLastLineToParseAndLastCharInLastLineInGeneral=linesBelowInitialLastLineToParse.reduce(function(numberOfCharsInLines,numberOfCharsInCurrentLine){return numberOfCharsInLines+numberOfCharsInCurrentLine},0);var charIndexFromWhichWeCanCaptureProgressionsAfterInitialLastLineIndexToParse=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios.length-numberOfCharsBetweenLastCharInInitialLastLineToParseAndLastCharInLastLineInGeneral;var lastLineIndexToParseAsResult=inititalLastLineIndexToParse;var weDontNeedToExploreFurtherLinesBelow=false;var previousLineDoesNotContainNotRecognizableCommands=true;var informationOnWhetherPreviousLinesReachedProgressionOfMoreThanOneCommand=[];for(var lineIndex=inititalLastLineIndexToParse+1;lineIndex<numberOfCharsInEachLineInTextarea.length;lineIndex++){if(lastLineIndexToParseAsResult===numberOfCharsInEachLineInTextarea.length-1){return lastLineIndexToParseAsResult}var currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios.slice(charIndexFromWhichWeCanCaptureProgressionsAfterInitialLastLineIndexToParse,charIndexFromWhichWeCanCaptureProgressionsAfterInitialLastLineIndexToParse+numberOfCharsInEachLineInTextarea[lineIndex]);for(var valueIndex=0;valueIndex<currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine.length;valueIndex++){if(currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine[valueIndex].indexOf(COMMAND_IS_NOT_RECOGNIZABLE)!==-1){if(lastLineIndexToParseAsResult===numberOfCharsInEachLineInTextarea.length-1){return lastLineIndexToParseAsResult}lastLineIndexToParseAsResult+=1;charIndexFromWhichWeCanCaptureProgressionsAfterInitialLastLineIndexToParse+=numberOfCharsInEachLineInTextarea[lineIndex];previousLineDoesNotContainNotRecognizableCommands=false;break}else{previousLineDoesNotContainNotRecognizableCommands=true}}if(!previousLineDoesNotContainNotRecognizableCommands){continue}for(var _valueIndex=0;_valueIndex<currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine.length;_valueIndex++){if(lastLineIndexToParseAsResult===numberOfCharsInEachLineInTextarea.length-1){return lastLineIndexToParseAsResult}if(currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine[_valueIndex].length<=1&&informationOnWhetherPreviousLinesReachedProgressionOfMoreThanOneCommand[lineIndex-1]&&previousLineDoesNotContainNotRecognizableCommands){weDontNeedToExploreFurtherLinesBelow=true;break}if(currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosInCurrentLine[_valueIndex].length>1){informationOnWhetherPreviousLinesReachedProgressionOfMoreThanOneCommand[lineIndex]=true}else{informationOnWhetherPreviousLinesReachedProgressionOfMoreThanOneCommand[lineIndex]=false}}if(weDontNeedToExploreFurtherLinesBelow){break}if(lastLineIndexToParseAsResult===numberOfCharsInEachLineInTextarea.length-1){return lastLineIndexToParseAsResult}lastLineIndexToParseAsResult+=1;charIndexFromWhichWeCanCaptureProgressionsAfterInitialLastLineIndexToParse+=numberOfCharsInEachLineInTextarea[lineIndex]}return lastLineIndexToParseAsResult};var spanRootOfSpanNode=function spanRootOfSpanNode(spanNode){while(spanNode.parentNode){if(spanNode.nodeName.toLowerCase()===SPAN&&spanNode.parentNode.nodeName.toLowerCase()!==SPAN){return spanNode}spanNode=spanNode.parentNode}return spanNode};var nodesSplittedInLines=function nodesSplittedInLines(node){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[[]];if(node.nodeType===Node.TEXT_NODE&&!node.isAlreadyPushedToItsLine){if(node.parentNode.nodeName.toLowerCase()===SPAN){var spanRootOfSpanNodeParent=spanRootOfSpanNode(node.parentNode);if(!spanRootOfSpanNodeParent.isAlreadyPushedToItsLine){result[result.length-1].push(spanRootOfSpanNodeParent);spanRootOfSpanNodeParent.isAlreadyPushedToItsLine=true}}else{if(node.nodeValue===EMPTY_STRING){result[result.length-1].push(node)}else{var nextNodeOnNewLine;for(var charIndex=0;charIndex<node.nodeValue.length;charIndex++){if(node.nodeValue[charIndex]===NEW_LINE){if(charIndex!==node.nodeValue.length-1){nextNodeOnNewLine=node.splitText(charIndex+1)}result[result.length-1].push(node);node.isAlreadyPushedToItsLine=true;result.push([]);break}else if(charIndex===node.nodeValue.length-1){result[result.length-1].push(node);node.isAlreadyPushedToItsLine=true}}if(nextNodeOnNewLine!==undefined){nodesSplittedInLines(nextNodeOnNewLine,result)}}}}else{for(var childIndex=0;childIndex<node.childNodes.length;childIndex++){nodesSplittedInLines(node.childNodes[childIndex],result)}}return result};var parentOfNodeClosestToDivUnderneathTextareaTextContainerOrDivUnderneathTextareaTextContainerItSelf=function parentOfNodeClosestToDivUnderneathTextareaTextContainerOrDivUnderneathTextareaTextContainerItSelf(divUnderneathTextareaTextContainer,node){while(node.parentNode){if(node.parentNode.isSameNode(divUnderneathTextareaTextContainer)){return node.parentNode}node=node.parentNode}return divUnderneathTextareaTextContainer};var updateHtmlHighlightsOnCertainLines=function updateHtmlHighlightsOnCertainLines(textarea,divUnderneathTextarea,nodesSplittedInLines,firstLineIndex,secondLineIndex,parsedLinesWithHighlights){var wrapperTemplateReplacement=document.createElement("template");wrapperTemplateReplacement.innerHTML=parsedLinesWithHighlights;var wrapperTemplateReplacementContentNode=document.importNode(wrapperTemplateReplacement.content,true);var firstNodeOnFirstLine=nodesSplittedInLines[firstLineIndex]?nodesSplittedInLines[firstLineIndex][0]:null;if(firstNodeOnFirstLine){parentOfNodeClosestToDivUnderneathTextareaTextContainerOrDivUnderneathTextareaTextContainerItSelf(divUnderneathTextarea.textContainer,firstNodeOnFirstLine).insertBefore(wrapperTemplateReplacementContentNode,firstNodeOnFirstLine)}else{divUnderneathTextarea.textContainer.appendChild(wrapperTemplateReplacementContentNode)}for(var lineIndex=firstLineIndex;lineIndex<=secondLineIndex;lineIndex++){for(var nodeIndex=0;nodeIndex<nodesSplittedInLines[lineIndex].length;nodeIndex++){var node=nodesSplittedInLines[lineIndex][nodeIndex];if(node.nodeType===Node.TEXT_NODE){node.remove()}else{node.parentNode.removeChild(node)}}}for(var _lineIndex=0;_lineIndex<firstLineIndex;_lineIndex++){for(var _nodeIndex=0;_nodeIndex<nodesSplittedInLines[_lineIndex].length;_nodeIndex++){var _node=nodesSplittedInLines[_lineIndex][_nodeIndex];_node.isAlreadyPushedToItsLine=false}}for(var _lineIndex2=secondLineIndex+1;_lineIndex2<nodesSplittedInLines.length;_lineIndex2++){for(var _nodeIndex2=0;_nodeIndex2<nodesSplittedInLines[_lineIndex2].length;_nodeIndex2++){var _node2=nodesSplittedInLines[_lineIndex2][_nodeIndex2];_node2.isAlreadyPushedToItsLine=false}}divUnderneathTextarea.scrollTop=textarea.scrollTop};module.exports=function(divUnderneathTextarea,textarea,parseWholeTextInTextarea){var textareaValue=adjustTextareaValueToKeepScrollingAlignedWhenItsValueEndsWithNewline(textarea.value);if(parseWholeTextInTextarea){var _textareaValueSplittedInLines=textareaValue.split(NEW_LINE);var _totalNumberOfLines=_textareaValueSplittedInLines.length;window.numberOfLinesInTextarea=_totalNumberOfLines;var parsedTextareaValueAsUnilang=parsedUnilang(textareaValue);window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios=parsedTextareaValueAsUnilang.mapOfCharIndexesWithProgressionOfCommandsFromScenarios;var textareaValueWithHighlights=parsedTextareaValueAsUnilang.highlightsHtmlBuffer.join("");refreshDivUnderneathTextareaWithNewHtml(divUnderneathTextarea,textareaValueWithHighlights);return}var textareaValueSplittedInLines=textareaValue.split(NEW_LINE).map(function(line,index,lines){if(lines[index+1]!==undefined){return"".concat(line).concat(NEW_LINE)}return line});var totalNumberOfLines=textareaValueSplittedInLines.length;var numberOfLinesInTextareaAddedOrRemoved=totalNumberOfLines-window.numberOfLinesInTextarea;var numberOfCharsInEachLineInTextarea=textareaValueSplittedInLines.map(function(line){return line.length});var selectionStartInTextarea=textarea.selectionStart;var linesBeforeSelectionStartIncludingTheLineWhereSelecetionStartsAt=textarea.value.substr(0,selectionStartInTextarea).split(NEW_LINE);var linesBeforeSelectionStart=linesBeforeSelectionStartIncludingTheLineWhereSelecetionStartsAt.slice(0,linesBeforeSelectionStartIncludingTheLineWhereSelecetionStartsAt.length-1);var totalNumberOfLinesBeforeSelectionStart=linesBeforeSelectionStart.length;var lineIndexWhereCaretIsOn=totalNumberOfLinesBeforeSelectionStart;var currentMapOfCharIndexesWithProgressionOfCommandsFromScenarios=window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios;var currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios=Object.values(currentMapOfCharIndexesWithProgressionOfCommandsFromScenarios);var firstLineIndexToParse=lineIndexWhereCaretIsOn;var caretOnLineAtTheStart=linesBeforeSelectionStartIncludingTheLineWhereSelecetionStartsAt[linesBeforeSelectionStartIncludingTheLineWhereSelecetionStartsAt.length-1]===EMPTY_STRING;if(firstLineIndexToParse!==0&&caretOnLineAtTheStart){firstLineIndexToParse-=1}var firstCharIndexInParsedLines=numberOfCharsInEachLineInTextarea.slice(0,firstLineIndexToParse).reduce(function(numberOfCharsInLines,numberOfCharsInCurrentLine){return numberOfCharsInLines+numberOfCharsInCurrentLine},0)-1;var lastLineIndexToParse=extendedLastLineIndexToParse(lineIndexWhereCaretIsOn,numberOfCharsInEachLineInTextarea,currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios);var currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosBeforeFirstCharIndexInParsedLines=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios.slice(0,firstCharIndexInParsedLines+1);var currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosAfterLastCharIndexInParsedLines=[];if(textareaValueSplittedInLines[lastLineIndexToParse+1]!==undefined){var linesBelowLastLineToParse=numberOfCharsInEachLineInTextarea.slice(lastLineIndexToParse+1);var numberOfCharsBetweenLastCharInLastLineToParseAndLastCharInLastLineInGeneral=linesBelowLastLineToParse.reduce(function(numberOfCharsInLines,numberOfCharsInCurrentLine){return numberOfCharsInLines+numberOfCharsInCurrentLine},0);var charIndexFromWhichWeCanCaptureProgressionsAfterLastLineIndexToParse=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios.length-numberOfCharsBetweenLastCharInLastLineToParseAndLastCharInLastLineInGeneral;currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosAfterLastCharIndexInParsedLines=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenarios.slice(charIndexFromWhichWeCanCaptureProgressionsAfterLastLineIndexToParse)}var linesToParse=textareaValueSplittedInLines.slice(firstLineIndexToParse,lastLineIndexToParse+1);var joinedLinesToParse=linesToParse.join("");var progressionRightBeforeLinesToParse=(currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosBeforeFirstCharIndexInParsedLines[currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosBeforeFirstCharIndexInParsedLines.length-1]||[]).slice();var parsedLinesAsUnilang=parsedUnilang(joinedLinesToParse,progressionRightBeforeLinesToParse);var mapOfCharIndexesWithProgressionOfCommandsFromScenariosFromParsedLines=parsedLinesAsUnilang.mapOfCharIndexesWithProgressionOfCommandsFromScenarios;var mapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosFromParsedLines=Object.values(mapOfCharIndexesWithProgressionOfCommandsFromScenariosFromParsedLines);var updatedMapOfCharIndexesWithProgressionOfCommandsFromScenarios={};var valueIndex=0;for(var index=0;index<currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosBeforeFirstCharIndexInParsedLines.length;index++,valueIndex++){updatedMapOfCharIndexesWithProgressionOfCommandsFromScenarios[valueIndex]=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosBeforeFirstCharIndexInParsedLines[index]}for(var _index=0;_index<mapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosFromParsedLines.length;_index++,valueIndex++){updatedMapOfCharIndexesWithProgressionOfCommandsFromScenarios[valueIndex]=mapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosFromParsedLines[_index]}for(var _index2=0;_index2<currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosAfterLastCharIndexInParsedLines.length;_index2++,valueIndex++){updatedMapOfCharIndexesWithProgressionOfCommandsFromScenarios[valueIndex]=currentMapValuesOfCharIndexesWithProgressionOfCommandsFromScenariosAfterLastCharIndexInParsedLines[_index2]}window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios=updatedMapOfCharIndexesWithProgressionOfCommandsFromScenarios;var parsedLinesWithHighlights=parsedLinesAsUnilang.highlightsHtmlBuffer.join("");var nodesSplittedInLinesValue=nodesSplittedInLines(divUnderneathTextarea.textContainer);updateHtmlHighlightsOnCertainLines(textarea,divUnderneathTextarea,nodesSplittedInLinesValue,firstLineIndexToParse,lastLineIndexToParse-numberOfLinesInTextareaAddedOrRemoved,parsedLinesWithHighlights);window.numberOfLinesInTextarea=totalNumberOfLines}},{"./adjustTextareaValueToKeepScrollingAlignedWhenItsValueEndsWithNewline":1,"./parser/parsedUnilang":28,"./refreshDivUnderneathTextareaWithNewHtml":167}],18:[function(require,module,exports){"use strict";module.exports=function(newElement,specifiedElement){specifiedElement.parentNode.insertBefore(newElement,specifiedElement)}},{}],19:[function(require,module,exports){"use strict";module.exports=function(keyCode){return keyCode>=48&&keyCode<=57||keyCode>=65&&keyCode<=90||keyCode>=96&&keyCode<=111||keyCode>=186&&keyCode<=222||keyCode===32||keyCode===8||keyCode===46||keyCode===13}},{}],20:[function(require,module,exports){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var configurableStyleNames=require("./parser/scenarios/static-objects/configurableStyleNames");var pageMetaNames=require("./parser/scenarios/static-objects/pageMetaNames");var openingBarLineNames=require("./parser/scenarios/static-objects/openingBarLineNames");var closingBarLineNames=require("./parser/scenarios/static-objects/closingBarLineNames");var keySignatureNames=require("./parser/scenarios/static-objects/keySignatureNames");var cssColors=require("./parser/scenarios/static-objects/cssColors");var splittedKeySignatureNames=keySignatureNames.join("|").split("|");var mainTimeSignatureValues=["c","crossed c","3:4","4:4","2:4","3:8","9:4","6:8","12:8"];var mainRepetitionNotes=['repetition note "D.C. al Fine"','repetition note "D.C. al Coda"','repetition note "D.S. al Fine"','repetition note "D.S. al Coda"','repetition note "Fine"','repetition note "Coda"'];var clefNames=require("./parser/scenarios/static-objects/clefNames");var positionCoordinates=["unit ","chord ","note ","stave ","voice ","measure ","line "];var mainTupletValues=["3","3:2","2","2:3","5","5:4","6","6:4","7","7:4","9","9:8","12","12:8"];var noteKeyNames=require("./parser/scenarios/static-objects/noteKeyNames");var mainNoteKeyNames=["sharp","flat","natural","double sharp","double flat","demisharp","demiflat","sesquisharp","sesquiflat"];var articulationNames=require("./parser/scenarios/static-objects/articulationNames");var ornamentKeyNames=require("./parser/scenarios/static-objects/ornamentKeyNames");var musicFonts=require("./parser/scenarios/static-objects/musicFonts");var textFonts=require("./parser/scenarios/static-objects/textFonts");var chordLettersFonts=require("./parser/scenarios/static-objects/chordLettersFonts");var autoCompletesForStyles=function autoCompletesForStyles(style){var autocompletes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];autocompletes.push("".concat(style," is "));var styleWords=style.split(" ");var styleWordsWithoutFirstWord=styleWords.slice(1);if(styleWordsWithoutFirstWord.length>0){autoCompletesForStyles(styleWordsWithoutFirstWord.join(" "),autocompletes)}return autocompletes};var autoCompletesForPageMeta=function autoCompletesForPageMeta(pageMeta){var autocompletes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];autocompletes.push("".concat(pageMeta,' is ""'));var pageMetaWords=pageMeta.split(" ");var pageMetaWordsWithoutFirstWord=pageMetaWords.slice(1);if(pageMetaWordsWithoutFirstWord.length>0){autoCompletesForPageMeta(pageMetaWordsWithoutFirstWord.join(" "),autocompletes)}return autocompletes};var autoCompletesForKeySignatureNames=function autoCompletesForKeySignatureNames(keySignatureName){var autocompletes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];autocompletes.push(keySignatureName);var keySignatureNameWords=keySignatureName.split(" ");var keySignatureNameWordsWithoutFirstWord=keySignatureNameWords.slice(1);if(keySignatureNameWordsWithoutFirstWord.length>0){autoCompletesForKeySignatureNames(keySignatureNameWordsWithoutFirstWord.join(" "),autocompletes)}return autocompletes};var autoCompletesForKeySignatureNamesBefore=function autoCompletesForKeySignatureNamesBefore(keySignatureName){var autocompletes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];autocompletes.push("".concat(keySignatureName," before"));var keySignatureNameWords=keySignatureName.split(" ");var keySignatureNameWordsWithoutFirstWord=keySignatureNameWords.slice(1);if(keySignatureNameWordsWithoutFirstWord.length>0){autoCompletesForKeySignatureNames(keySignatureNameWordsWithoutFirstWord.join(" "),autocompletes)}return autocompletes};module.exports={general:["compress units by 1.5 times","compress units by 2.0 times","compress units by 3.0 times","compress units by 4.0 times","compress units by 5.0 times","stretch units by 1.5 times","stretch units by 2.0 times","stretch units by 3.0 times","stretch units by 4.0 times","stretch units by 5.0 times",'comment: ""','side note: ""','note: ""',"new line","line","measures","measure","stave","voice","chord","rest"].concat(_toConsumableArray(clefNames.map(function(clefName){return"stave with ".concat(clefName," clef")})),_toConsumableArray(clefNames.map(function(clefName){return"".concat(clefName," clef")})),["clef"],_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"key signature is ".concat(keySignatureName)})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"signature is ".concat(keySignatureName)})),["major","minor","lyrics is under","is under","under","measure numbers for all measures","measure numbers for first measures","measure numbers for last measures","measure numbers for first and last measures"],_toConsumableArray(pageMetaNames.map(function(pageMetaName){return"".concat(pageMetaName,' is ""')})),_toConsumableArray(pageMetaNames.map(function(pageMetaName){return autoCompletesForPageMeta(pageMetaName)}).flat()),_toConsumableArray(configurableStyleNames.map(function(style){return autoCompletesForStyles(style)}).flat()),["hide the last measure","the last measure","last measure","slur","glissando","tuplet","octave up","octave higher","octave down","octave lower","two octaves up","two octaves higher","two octaves down","two octaves lower","crescendo","diminuendo","simile","volta","tempo","metronome",'instrument title is ""',"brace","bracket","measure rest"],_toConsumableArray(mainTimeSignatureValues.map(function(value){return"time signature is ".concat(value)})),mainTimeSignatureValues,["time signature is "],mainRepetitionNotes),"style name is":[].concat(_toConsumableArray(cssColors),_toConsumableArray(musicFonts),_toConsumableArray(textFonts),_toConsumableArray(chordLettersFonts)),stave:["new line","measure","voice","stave"].concat(_toConsumableArray(clefNames.map(function(clefName){return"with ".concat(clefName," clef")})),_toConsumableArray(clefNames.map(function(clefName){return"".concat(clefName," clef")})),["clef","chord"]),voice:["new line","measure","stave","voice","chord"],chord:["new line","measure","stave","voice","chord","on next stave","next stave","on previous stave","previous stave","on prev. stave","prev. stave","on prev stave","prev stave","on current stave","current stave","with parentheses","parentheses","is ghost","is not ghost","not ghost","ghost","is arpeggiated","arpeggiated","is arpeggio","arpeggio",'with chord ""','with text ""','text ""'].concat(_toConsumableArray(articulationNames.map(function(articulationName){return"with ".concat(articulationName)})),_toConsumableArray(articulationNames),["with turn","with mordent","with trill","turn","mordent","trill","is dotted","dotted","with one dot","with two dots","with three dots","one dot","two dots","three dots","dot","dots","with stem up","with stem down","stem up","stem down","is beamed with next","beamed with next","is not beamed with next","not beamed with next","not beamed","is tied with next","tied with next","is tied before","tied before","is tied after","tied after","with glissando after","glissando after","with glissando before","glissando before","is grace","is crushed grace","crushed grace","grace","with crush line","crush line","is rest","rest","is centralized","centralized","with breath mark before","breath mark before","mark before","with breath mark as comma before","breath mark as comma before","mark as comma before","as comma before","comma before","with breath mark as double slashes before","breath mark as double slashes before","mark as double slashes before","as double slashes before","double slashes before","slashes before"],_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"with key signature ".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"key signature ".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"signature ".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return autoCompletesForKeySignatureNamesBefore(keySignatureName)}).flat()),_toConsumableArray(clefNames.map(function(clefName){return"with ".concat(clefName," clef before")})),_toConsumableArray(clefNames.map(function(clefName){return"".concat(clefName," clef before")})),["clef before","chord","is octave up","is octave down","octave up","octave down","is two octaves up","is two octaves down","two octaves up","two octaves down","octaves up","octaves down","is octave higher","is octave lower","octave higher","octave lower","is two octaves higher","is two octaves lower","two octaves higher","two octaves lower","octaves higher","octaves lower","with tremolo","with tremolo with next","tremolo with next","tremolo","strokes","stroke","repeat","simile",'with dynamic ""','dynamic ""','with lyrics ""','with lyric ""','lyrics ""','lyric ""',"with pedal","pedal","with variable peak","variable peak","peak","with release","release","stave","is ","up","down","is left by ","left by ","is right by ","right by ","higher","lower","with next","next","before","after","line"]),"chord with parentheses":["from ","to ","note "],"chord is arpeggiated":["with chord below","chord below","below","with arrow up","with arrow down","arrow up","arrow down","up","down"],"chord with text":["is ","up","down","beside","above","above stave","below","below stave","stave"],"chord beamed":["with only primary line","with only one line","only primary line","only one line","primary line","one line","line"],"chord is tied before":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"chord is tied after":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"chord is tied with next":["is ","up","down","above","below","over","under","with roundness ","roundness "],"chord with glissando after":["measure ","up","down"],"chord with glissando before":["measure ","up","down"],"chord with breath mark before":["up","down"],"chord with articulation":["is ","up","down","above","above stave","below","below stave","stave"],"chord with ornament":["is ","up","down","above","above stave","below","below stave","stave","followed after","inverted","with wave after","wave after","after"].concat(_toConsumableArray(ornamentKeyNames.map(function(ornamentKeyName){return"with ".concat(ornamentKeyName)}))),"chord with dynamic":["is ","up","down","above","above stave","below","below stave","stave"],"chord with chord letter":["is ","up","down","above","above measure","below","below measure","measure"],"chord with lyrics":["followed by dash","by dash","dash","with underscore starts","where underscore starts","underscore starts","starts","with underscore begins","where underscore begins","underscore begins","begins","with underscore finishes","where underscore finishes","underscore finishes","finishes","with underscore ends","where underscore ends","underscore ends","ends"],"chord with pedal":["under stave ","stave ","opens with bracket","with bracket","bracket","before","after"],"chord with variable peak":["before","after"],"chord with release":["before","after","after measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","bracket"],coda:["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","measure","up","down"],sign:["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","measure","up","down"],"crescendo|diminuendo":[].concat(positionCoordinates,['starts with "" from ','with "" from ',"starts from ","starts at ",'finishes with "" at ','with "" at ',"finishes at ","from ","at ","to ","above stave","below stave","up","down"]),"bracket or brace":["for ","from  ","to ","for each line","each line","line","for lines below","lines below","below","stave "],glissando:[].concat(positionCoordinates,["starts before ","finishes after ","starts at ","finishes at ","before ","after ","at ","is ","up","down","as line","as wave"]),"instrument title":["for ","between","and ","for each line","each line","line","stave ","for lines below","lines below"],"key signature":[].concat(_toConsumableArray(splittedKeySignatureNames),["for each line","each line","line","for lines below","lines below","below"]),"lyrics position":["stave "],measure:["new line","measure","stave","voice","chord","without start barline","start barline","with no start barline","no start barline"].concat(_toConsumableArray(openingBarLineNames.map(function(bar){return"opens with ".concat(bar)})),_toConsumableArray(openingBarLineNames.map(function(bar){return"starts with ".concat(bar)})),_toConsumableArray(openingBarLineNames.map(function(bar){return"with ".concat(bar)})),_toConsumableArray(openingBarLineNames),_toConsumableArray(closingBarLineNames.map(function(bar){return"closes with ".concat(bar)})),_toConsumableArray(closingBarLineNames.map(function(bar){return"ends with ".concat(bar)})),_toConsumableArray(closingBarLineNames.map(function(bar){return"finishes with ".concat(bar)})),_toConsumableArray(closingBarLineNames.map(function(bar){return"with ".concat(bar)})),_toConsumableArray(closingBarLineNames),["barLine","with repeat sign at the start and at the end","repeat sign at the start and at the end","sign at the start and at the end","at the start and at the end","the start and at the end","start and at the end","and at the end","with repeat sign at the start","repeat sign at the start","sign at the start","with repeat sign at the end","repeat sign at the end","sign at the end","at the start","the start","start","at the end","the end","end","rest","times","tempo","metronome",'instrument title is ""',"brace","bracket","with simile of previous measure","simile of previous measure","of previous measure","previous measure","measure rest","with simile of two previous measures","simile of two previous measures","of previous two measures","previous measures","ends with fermata","with fermata","fermata"],_toConsumableArray(mainTimeSignatureValues.map(function(value){return"time signature is ".concat(value)})),mainTimeSignatureValues,["time signature is ","signature is "],mainRepetitionNotes),"measure numbers":["for first measures","first measures","measures","for last measures","last measures","for first and last measures","first and last measures","for first and last measures","and last measures","below","above"],note:["new line","measure","stave","voice","chord","on next stave","next stave","on previous stave","previous stave","on prev. stave","prev. stave","on prev stave","prev stave","with parentheses","parentheses","is ghost","is not ghost","not ghost","ghost",'with text ""','text ""',"is dotted","dotted","with one dot","with two dots","with three dots","one dot","two dots","three dots","dot","dots","with stem up","with stem down","stem up","stem down","is beamed with next","beamed with next","is not beamed with next","not beamed with next","beamed","not beamed","is tied with next","tied with next","is tied before","tied before","is tied after","tied after","with glissando after","glissando after","with glissando before","glissando before","is grace","is crushed grace","crushed grace","grace","with crush line","crush line","is rest","rest","is centralized","centralized","with breath mark before","breath mark before","mark before","with breath mark as comma before","breath mark as comma before","mark as comma before","as comma before","comma before","with breath mark as double slashes before","breath mark as double slashes before","mark as double slashes before","as double slashes before","double slashes before","slashes before"].concat(_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"with key signature ".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"key signature ".concat(keySignatureName," before")})),_toConsumableArray(splittedKeySignatureNames.map(function(keySignatureName){return"signature ".concat(keySignatureName," before")})),["major","minor"],_toConsumableArray(clefNames.map(function(clefName){return"with ".concat(clefName," clef before")})),_toConsumableArray(clefNames.map(function(clefName){return"".concat(clefName," clef before")})),["clef before"],_toConsumableArray(articulationNames.map(function(articulationName){return"with ".concat(articulationName)})),_toConsumableArray(articulationNames),["with turn","with mordent","with trill","turn","mordent","trill",'with chord ""',"is octave up","is octave down","octave up","octave down","is two octaves up","is two octaves down","two octaves up","two octaves down","octaves up","octaves down","is octave higher","is octave lower","octave higher","octave lower","is two octaves higher","is two octaves lower","two octaves higher","two octaves lower","octaves higher","octaves lower","with tremolo","with tremolo with next","tremolo with next","tremolo","strokes","stroke","repeat","simile",'with dynamic ""','dynamic ""','with lyrics ""','with lyric ""','lyrics ""','lyric ""',"with pedal","pedal","with variable peak","variable peak","peak","with release","release"],_toConsumableArray(noteKeyNames.map(function(keyName){return"with ".concat(keyName," key")})),["key"],mainNoteKeyNames,["stave","is ","up","down","is left by ","left by ","is right by ","right by ","higher","lower","with next","next","before","after","line"]),"note with parentheses":["from","to","note"],"note with text":["is ","up","down","beside","above","above stave","below","below stave","stave"],"note beamed":["with only primary line","with only one line","only primary line","only one line","primary line","one line","line"],"note is tied before":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"note is tied after":["measure","is ","up","down","above","below","over","under","with roundness ","roundness "],"note is tied with next":["is ","up","down","above","below","over","under","with roundness ","roundness "],"note with glissando after":["measure","up","down"],"note with glissando before":["measure","up","down"],"note with breath mark before":["up","down"],"note with articulation":["is ","up","down","above","above stave","below","below stave","stave"],"note with turn":["is ","up","down","above","above stave","below","below stave","stave","inverted","after"].concat(_toConsumableArray(ornamentKeyNames.map(function(ornamentKeyName){return"with ".concat(ornamentKeyName)}))),"note with mordent":["is ","up","down","above","above stave","below","below stave","stave","inverted","after"].concat(_toConsumableArray(ornamentKeyNames.map(function(ornamentKeyName){return"with ".concat(ornamentKeyName)}))),"note with trill":["is ","up","down","above","above stave","below","below stave","stave","with wave after","wave after","after"],"note with dynamic":["is ","up","down","above","above stave","below","below stave","stave"],"note with chord letter":["is ","up","down","above","above measure","below","below measure","measure"],"note with lyrics":["followed by dash","by dash","dash","with underscore starts","where underscore starts","underscore starts","starts","with underscore begins","where underscore begins","underscore begins","begins","with underscore finishes","where underscore finishes","underscore finishes","finishes","with underscore ends","where underscore ends","underscore ends","ends"],"note with pedal":["under stave ","stave ","opens with bracket","with bracket","bracket","before","after"],"note with variable peak":["before","after"],"note with release":["before","after","after measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","bracket"],"octave sign":["from ","to ","up","down","and finishes at "],"repeat simile":[].concat(positionCoordinates,["of previous beat","previous beat","of prev. beat","prev. beat","of prev beat","prev beat","beat","of previous beats","previous beats","of prev. beats","prev. beats","of prev beats","prev beats","beats","times","is ","up","down","from ","to ","starts at ","finishes at","at "]),"repetition note":["at the start of the measure","the start of the measure","start of the measure","at the end of the measure","the end of the measure","end of the measure","of the measure","the measure","measure","up","down"],slur:[].concat(positionCoordinates,["starts before ","starts at ","starts before below ","starts before above ","starts above ","starts below ","finishes after ","finishes at ","finishes after below ","finishes after above ","finishes above ","finishes below ","before ","after ","below","above","at ","is ","up","down","with roundness ","roundness ","goes through ","through","goes through below ","goes through above ","with left point ","left point","with right point","right point","point","with s-shape","from","to"]),"slur right point":["attached to middle of stem","to middle of stem","middle of stem","of stem","stem","attached to note head","to note head","note head","head"],"tempo mark":["up","down"],"time signature":["for each line","each line","line","for lines below","lines below","below"],tuplet:[].concat(mainTupletValues,positionCoordinates,["starts before ","starts at ","finishes after ","finishes at ","before ","after ","is ","up","down","above","below","above stave","below stave","with brackets","brackets"]),volta:["starts before ","finishes after ","starts at ","finishes at ","up","down","before ","after ","at ",'with text ""'],"compress units by n times":["in line ","line "],"stretch units by n times":["in line ","line "]}},{"./parser/scenarios/static-objects/articulationNames":105,"./parser/scenarios/static-objects/chordLettersFonts":109,"./parser/scenarios/static-objects/clefNames":110,"./parser/scenarios/static-objects/closingBarLineNames":112,"./parser/scenarios/static-objects/configurableStyleNames":114,"./parser/scenarios/static-objects/cssColors":116,"./parser/scenarios/static-objects/keySignatureNames":117,"./parser/scenarios/static-objects/musicFonts":118,"./parser/scenarios/static-objects/noteKeyNames":121,"./parser/scenarios/static-objects/openingBarLineNames":124,"./parser/scenarios/static-objects/ornamentKeyNames":126,"./parser/scenarios/static-objects/pageMetaNames":129,"./parser/scenarios/static-objects/textFonts":135}],21:[function(require,module,exports){"use strict";var createdDivUnderneathTextarea=require("./createdDivUnderneathTextarea");var createdLineNumbersColumn=require("./createdLineNumbersColumn");var createdAutocompleteListView=require("./createdAutocompleteListView");var synchronizeScrollOfDivUnderneathTextareaAndLineNumbersColumnByScrollChangeOfTextarea=require("./synchronizeScrollOfDivUnderneathTextareaAndLineNumbersColumnByScrollChangeOfTextarea");var scrollToStartOfLineInTextareaWhenEnterIsPressed=require("./scrollToStartOfLineInTextareaWhenEnterIsPressed");var scrollToBottomOfTextareaWhenEnterIsPressedAtTheBottomOfTextarea=require("./scrollToBottomOfTextareaWhenEnterIsPressedAtTheBottomOfTextarea");var makeScrollToFollowCaretInTextareaIfItIsDisappearedFromView=require("./makeScrollToFollowCaretInTextareaIfItIsDisappearedFromView");var detectingThatWeAreTypingInTextarea=require("./detectingThatWeAreTypingInTextarea");var makeDivUnderneathTextareaChangeItsTextValueWhenValueOfTextareaChanges=require("./makeDivUnderneathTextareaChangeItsTextValueWhenValueOfTextareaChanges");var makeFontVisibleInTextareaWhenItsValueIsEmptySoThatWeCanSeePlaceholderInItInAllBrowsers=require("./makeFontVisibleInTextareaWhenItsValueIsEmptySoThatWeCanSeePlaceholderInItInAllBrowsers");var highlightTextareaValueInDivUnderneathItWithoutRefIds=require("./highlightTextareaValueInDivUnderneathItWithoutRefIds");var fillLineNumbersColumnWhenTextareaChangesItsInput=require("./fillLineNumbersColumnWhenTextareaChangesItsInput");var fillLineNumbersColumn=require("./fillLineNumbersColumn");var highlightLineNumberWhenCaretIsOnIt=require("./highlightLineNumberWhenCaretIsOnIt");var showAutocompleteListViewOnTypingIfNeeded=require("./showAutocompleteListViewOnTypingIfNeeded");var makeWordsInEditorReferableToElementsInSVGImage=require("./makeWordsInEditorReferableToElementsInSVGImage");var makeElementsInSVGImageReferableToWordsInEditor=require("./makeElementsInSVGImageReferableToWordsInEditor");window.initializeUnisonTextarea=function(textarea,renderPreviewButton,editTabButton){var fontFamily="FiraCode";var textareaInitialParentElement=textarea.parentElement;var shadowRoot=textarea.parentElement.attachShadow({mode:"open"});textarea.initialParentElement=textareaInitialParentElement;textarea.initialParentElement.style.position="relative";textarea.initialParentElement.style.overflow="visible";var style=document.createElement("style");style.textContent="\n    textarea {\n      font-family: '".concat(fontFamily,"';\n      position: absolute;\n      font-size: 1em;\n      padding: 0px;\n      top: 10px;\n      left: 10px;\n      height: calc(100% - 1.2em);\n      line-height: 1.4em;\n      outline: none;\n      resize: none;\n      border: none;\n      background-color: transparent;\n      color: rgba(0, 0, 0, 0.0);\n      caret-color: #080808;\n      font-weight: normal;\n      overflow: auto;\n      cursor: text;\n      scrollbar-width: none;\n      z-index: 1;\n    }\n\n    textarea::-webkit-scrollbar {\n      display: none;\n    }\n\n    .div-underneath-unitextarea {\n      background-color: transparent;\n      font-family: '").concat(fontFamily,"';\n      position: absolute;\n      font-size: 1em;\n      line-height: 1.4em;\n      left: 10px;\n      top: 10px;\n      height: calc(100% - 1.2em);\n      color: #1F2D3A;\n      overflow: hidden;\n      white-space: pre;\n      cursor: text;\n      z-index: 0;\n      scrollbar-width: none;\n    }\n\n    .div-underneath-unitextarea::-webkit-scrollbar {\n      display: none;\n    }\n\n    .div-underneath-unitextarea-text-container {\n      white-space: pre; \n    }\n\n    pre {\n      width: max-content;\n    }\n\n    .line-numbers-column {\n      position: absolute;\n      font-family: '").concat(fontFamily,"';\n      top: 10px;\n      left: 10px;\n      height: calc(100% - 1.2em);\n      scrollbar-width: none;\n      overflow: hidden;\n      white-space: pre;\n      box-sizing: border-box;\n      text-align: right;\n      line-height: 1.4em;\n    }\n\n    .line-numbers-column::-webkit-scrollbar { \n      display: none;\n    }\n\n    .line-number-block {\n      text-align: right;\n      color: #343434;\n    }\n\n    .line-highlighted-number {\n      color: #FF7F50;\n      font-weight: bold;\n    }\n\n    .autocomplete-list-view {\n      font-family: '").concat(fontFamily,"';\n      font-size: 1em;\n      background: #FCFCFC;\n      min-width: 260px;\n      width: fit-content;\n      height: auto;\n      max-height: 300px;\n      overflow: auto;\n      position: absolute;\n      z-index: 100;\n      border-radius: 5px;\n      box-shadow: rgba(9, 30, 66, 0.45) 0px 1px 1px, rgba(9, 30, 66, 0.25) 0px 0px 1px 1px;\n      scrollbar-width: none;  /* Hide scroll bar for Firefox */\n    }\n\n    .autocomplete-list-view::-webkit-scrollbar { \n      display: none;  /* Hide scroll bar for Safari and Chrome */\n    }\n\n    .autocomplete-list-view-option {\n      line-height: 30px;\n      background: var(--editor-background-color);\n      width: 100%;\n      padding-right: 10px;\n      padding-left: 10px; /* It must be equal to the `distanceToMoveAutocompleteListViewSoWeCanAddPaddingToItAndTheTextWouldAlignCorrectly` variable in editor/js/createAutocompleteListViewOnTypingIfNeeded.js */\n      cursor: pointer;\n      white-space: nowrap;\n    }\n\n    .autocomplete-list-view-option.selected {\n      background: #FAF0E6;\n      color: #1F2D3A;\n    }\n\n    .uncomplete-word-highlight-in-list-of-options-in-autocomplete-list-view {\n      color: #EB8100;\n    }\n\n    @keyframes fading-message { \n      0% {\n        opacity: 80%;\n        filter: opacity(80%);\n      }\n\n      100% {\n        opacity: 0%;\n        filter: opacity(0%);\n      }\n    }\n\n    .central-absolute-hint-message {\n      position: absolute; \n      font-family: '").concat(fontFamily,"';\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      width: 300px;\n      height: fit-content;\n      background: #323232;\n      color: #FFFFFF;\n      font-size: 1em;\n      opacity: 80%;\n      margin-left: auto; \n      margin-right: auto; \n      border-radius: 6px;\n      padding: 10px;\n      text-align: center;\n      animation: fading-message 2.5s;\n      animation-fill-mode: forwards;\n      animation-delay: 2.5s;\n      z-index: 1000;\n      display: none;\n    }\n\n    /*/////////////////////////////////// HIGHLIHGHT CLASSES ///////////////////////////////*/\n    /* By using shortcut class names, we optimise method innerHTML for highlighting */\n\n    /* comment-highlight */\n    .ch {\n      color: #4C5866;\n    }\n\n    /* style-highlight */\n    .sh {\n      color: #A01A4C;\n    }\n\n    /* style-value-highlight */\n    .svh {\n      color: #A01A4C;\n    }\n\n    /* text-highlight */\n    .th {\n      color: var(--editor-font-color);\n    }\n\n    /* element-highlight */\n    .eh {\n      color: #0087BD;\n    }\n\n    /* string-highlight */\n    .sth {\n      color: #00744E;\n    }\n\n    /* contains-number-highlight */\n    .cnh {\n      color: #8F0125;\n    }\n\n    /* \n      text-highlight,\n      contains-line-position-preposition-highlight,\n      contains-measure-position-preposition-highlight,\n      contains-stave-position-preposition-highlight,\n      contains-voice-position-preposition-highlight,\n      contains-unit-position-preposition-highlight\n    */\n    .th,\n    .clpph,\n    .cmpph,\n    .cspph,\n    .cvpph,\n    .cupph {\n      color: var(--editor-font-color);\n    }\n\n    /* contains-line-position-highlight */\n    .clph {\n      color: #009F6B;\n    }\n\n    /* contains-measure-position-highlight */\n    .cmph {\n      color: #832E61;\n    }\n\n    /* contains-stave-position-highlight */\n    .csph {\n      color: #E26B1A;\n    }\n\n    /* contains-voice-position-highlight */\n    .cvph  {\n      color: #008FA2;\n    }\n\n    /* contains-unit-position-highlight */\n    .cuph {\n      color: #C40233;\n    }\n\n    /* not-recognizable-command-highlight */\n    .nrch {\n      text-decoration: underline;\n      text-decoration-color: #DD4444;\n      text-decoration-skip: spaces;\n      color: var(--editor-font-color);\n    }\n\n    /*/////////////////////////////END OF HIGHLIHGHT CLASSES ///////////////////////////////*/\n  ");shadowRoot.appendChild(style);textarea.setAttribute("wrap","off");textarea.setAttribute("autocomplete","off");textarea.setAttribute("spellcheck","false");textarea.classList.add("unitextarea");shadowRoot.appendChild(textarea);var divUnderneathTextarea=createdDivUnderneathTextarea(textarea,fontFamily);var lineNumbersColumn=createdLineNumbersColumn(divUnderneathTextarea,fontFamily);var autocompleteListView=createdAutocompleteListView(textarea);textarea.addEventListener("input",function(){textarea.isRenderedWithLatestUnilangInputText=false;textarea.isModified=true});synchronizeScrollOfDivUnderneathTextareaAndLineNumbersColumnByScrollChangeOfTextarea(divUnderneathTextarea,lineNumbersColumn,textarea);scrollToStartOfLineInTextareaWhenEnterIsPressed(textarea);scrollToBottomOfTextareaWhenEnterIsPressedAtTheBottomOfTextarea(textarea);makeScrollToFollowCaretInTextareaIfItIsDisappearedFromView(textarea,fontFamily);detectingThatWeAreTypingInTextarea(textarea);makeDivUnderneathTextareaChangeItsTextValueWhenValueOfTextareaChanges(divUnderneathTextarea,textarea);makeFontVisibleInTextareaWhenItsValueIsEmptySoThatWeCanSeePlaceholderInItInAllBrowsers(textarea);highlightTextareaValueInDivUnderneathItWithoutRefIds(divUnderneathTextarea,textarea,true);fillLineNumbersColumnWhenTextareaChangesItsInput(lineNumbersColumn,textarea,divUnderneathTextarea);fillLineNumbersColumn(lineNumbersColumn,textarea,divUnderneathTextarea);highlightLineNumberWhenCaretIsOnIt(shadowRoot,textarea,lineNumbersColumn);showAutocompleteListViewOnTypingIfNeeded(autocompleteListView,textarea,divUnderneathTextarea,fontFamily);makeWordsInEditorReferableToElementsInSVGImage(divUnderneathTextarea,textarea,renderPreviewButton);makeElementsInSVGImageReferableToWordsInEditor(divUnderneathTextarea,textarea,lineNumbersColumn,editTabButton)}},{"./createdAutocompleteListView":4,"./createdDivUnderneathTextarea":5,"./createdLineNumbersColumn":7,"./detectingThatWeAreTypingInTextarea":9,"./fillLineNumbersColumn":13,"./fillLineNumbersColumnWhenTextareaChangesItsInput":14,"./highlightLineNumberWhenCaretIsOnIt":16,"./highlightTextareaValueInDivUnderneathItWithoutRefIds":17,"./makeDivUnderneathTextareaChangeItsTextValueWhenValueOfTextareaChanges":22,"./makeElementsInSVGImageReferableToWordsInEditor":23,"./makeFontVisibleInTextareaWhenItsValueIsEmptySoThatWeCanSeePlaceholderInItInAllBrowsers":24,"./makeScrollToFollowCaretInTextareaIfItIsDisappearedFromView":25,"./makeWordsInEditorReferableToElementsInSVGImage":26,"./scrollToBottomOfTextareaWhenEnterIsPressedAtTheBottomOfTextarea":168,"./scrollToStartOfLineInTextareaWhenEnterIsPressed":170,"./showAutocompleteListViewOnTypingIfNeeded":171,"./synchronizeScrollOfDivUnderneathTextareaAndLineNumbersColumnByScrollChangeOfTextarea":172}],22:[function(require,module,exports){"use strict";var highlightTextareaValueInDivUnderneathItWithoutRefIds=require("./highlightTextareaValueInDivUnderneathItWithoutRefIds");var NEW_LINE="\n";module.exports=function(divUnderneathTextarea,textarea){window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios={};textarea.addEventListener("beforeinput",function(){if(textarea.textareaTextLengthBeforeNextChange===undefined){textarea.textareaTextLengthBeforeNextChange=textarea.value.length}if(textarea.numberOfLinesInTextareaBeforeNextChange===undefined){textarea.numberOfLinesInTextareaBeforeNextChange=textarea.value.split(NEW_LINE).length}});textarea.addEventListener("input",function(){var updatedTextareaTextLength=textarea.value.length;var textareaTextLengthHasChangedOnOneChar=Math.abs(textarea.value.length-textarea.textareaTextLengthBeforeNextChange)===1;highlightTextareaValueInDivUnderneathItWithoutRefIds(divUnderneathTextarea,textarea,!textareaTextLengthHasChangedOnOneChar||textarea.isRenderedWithLatestUnilangInputText);textarea.isRenderedWithLatestUnilangInputText=false;textarea.isModified=true;textarea.textareaTextLengthBeforeNextChange=updatedTextareaTextLength})}},{"./highlightTextareaValueInDivUnderneathItWithoutRefIds":17}],23:[function(require,module,exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var createdRefRectHoveringRefElement=require("./createdRefRectHoveringRefElement");var notifyUserToUpdateSVGImage=require("./notifyUserToUpdateSVGImage");var isMacOS=navigator.platform.indexOf("Mac")!==-1;module.exports=function(divUnderneathTextarea,textarea,lineNumbersColumn,editTabButton){var svgPlaceholder=textarea.initialParentElement;var weAlreadyMadeSVGElementsReferableByCreatingRefRectsHoveringThem=false;var processNodeWithItsChildNodes=function processNodeWithItsChildNodes(node){if(!node.observed){node.observed=true;var svgElement=svgPlaceholder.getElementsByTagName("svg")[0];if(typeof node.hasAttribute==="function"&&node.hasAttribute("ref-ids")){var refRectHoveringRefElement;var refRectHoveringRefElementClickEvent=function refRectHoveringRefElementClickEvent(){editTabButton.click();divUnderneathTextarea.style.zIndex="+2";var refIdValues=node.getAttribute("ref-ids").split(",");var firstRefIdValue;var firstSpanWithRefIdInEditor;for(var refIdIndex=0;refIdIndex<refIdValues.length;refIdIndex++){firstRefIdValue=refIdValues[refIdIndex];firstSpanWithRefIdInEditor=divUnderneathTextarea.querySelector('[ref-id="'.concat(firstRefIdValue,'"]'));if(firstSpanWithRefIdInEditor){break}}if(firstSpanWithRefIdInEditor){firstSpanWithRefIdInEditor.scrollIntoView({block:"center",inline:"center"});textarea.scrollTop=divUnderneathTextarea.scrollTop;textarea.scrollLeft=divUnderneathTextarea.scrollLeft;lineNumbersColumn.scrollTop=divUnderneathTextarea.scrollTop;lineNumbersColumn.scrollLeft=divUnderneathTextarea.scrollLeft;for(var _refIdIndex=0;_refIdIndex<refIdValues.length;_refIdIndex++){var spansWithRefIdInEditor=divUnderneathTextarea.querySelectorAll('[ref-id="'.concat(refIdValues[_refIdIndex],'"]'));var _loop=function _loop(spanIndex){var spanWithRefIdInEditor=spansWithRefIdInEditor[spanIndex];refRectHoveringRefElement.classList.remove("ref-rect-hover-no-animated");refRectHoveringRefElement.classList.add("ref-rect-hover-not-visible");if(spanWithRefIdInEditor.classList.contains("ref-span-background")){spanWithRefIdInEditor.classList.remove("ref-span-background");void spanWithRefIdInEditor.offsetWidth;spanWithRefIdInEditor.classList.add("ref-span-background")}else{spanWithRefIdInEditor.classList.add("ref-span-background")}setTimeout(function(){spanWithRefIdInEditor.classList.remove("ref-span-background")},2800)};for(var spanIndex=0;spanIndex<spansWithRefIdInEditor.length;spanIndex++){_loop(spanIndex)}}}else{notifyUserToUpdateSVGImage(svgPlaceholder)}svgElement.removeChild(refRectHoveringRefElement);refRectHoveringRefElement=undefined;weAlreadyMadeSVGElementsReferableByCreatingRefRectsHoveringThem=false};var makeSVGElementsReferableByCreatingRefRectsHoveringThem=function makeSVGElementsReferableByCreatingRefRectsHoveringThem(event){if(isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey){if(!weAlreadyMadeSVGElementsReferableByCreatingRefRectsHoveringThem){var refIdValues=node.getAttribute("ref-ids").split(",");var firstRefIdValue;var firstSpanWithRefIdInEditor;for(var refIdIndex=0;refIdIndex<refIdValues.length;refIdIndex++){firstRefIdValue=refIdValues[refIdIndex];firstSpanWithRefIdInEditor=divUnderneathTextarea.querySelector('[ref-id="'.concat(firstRefIdValue,'"]'));if(firstSpanWithRefIdInEditor){break}}if(firstSpanWithRefIdInEditor){weAlreadyMadeSVGElementsReferableByCreatingRefRectsHoveringThem=true;refRectHoveringRefElement=createdRefRectHoveringRefElement(node,svgElement,"ref-rect-hover-no-animated");svgElement.appendChild(refRectHoveringRefElement);refRectHoveringRefElement.addEventListener("click",refRectHoveringRefElementClickEvent);textarea.blur();var removeRefRectHoveringElement=function removeRefRectHoveringElement(){if(refRectHoveringRefElement){refRectHoveringRefElement.removeEventListener("click",refRectHoveringRefElementClickEvent);svgElement.removeChild(refRectHoveringRefElement);refRectHoveringRefElement=undefined;weAlreadyMadeSVGElementsReferableByCreatingRefRectsHoveringThem=false;window.removeEventListener("keyup",removeRefRectHoveringElement)}};refRectHoveringRefElement.addEventListener("mouseleave",removeRefRectHoveringElement);window.addEventListener("keyup",removeRefRectHoveringElement);event.stopPropagation()}}}};node.addEventListener("mouseover",makeSVGElementsReferableByCreatingRefRectsHoveringThem);node.addEventListener("mousemove",makeSVGElementsReferableByCreatingRefRectsHoveringThem)}var childNodes=node.childNodes;for(var childNoteIndex=0;childNoteIndex<childNodes.length;childNoteIndex++){processNodeWithItsChildNodes(childNodes[childNoteIndex])}}};var observer=new MutationObserver(function(mutationsList,observer){var _iterator=_createForOfIteratorHelper(mutationsList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var mutation=_step.value;if(mutation.type==="childList"){for(var i=0;i<mutation.addedNodes.length;i++){var node=mutation.addedNodes[i];if(node.tagName==="svg"){processNodeWithItsChildNodes(node)}}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}});observer.observe(svgPlaceholder,{childList:true,subtree:true});window.addEventListener("keydown",function(event){if(isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey){var refRectHoveringRefElementCreatedByClickingOnWordInEditor=document.querySelector("#ref-rect-hover-from-editor");if(refRectHoveringRefElementCreatedByClickingOnWordInEditor){var svgElement=svgPlaceholder.getElementsByTagName("svg")[0];svgElement.removeChild(refRectHoveringRefElementCreatedByClickingOnWordInEditor)}}})}},{"./createdRefRectHoveringRefElement":8,"./notifyUserToUpdateSVGImage":27}],24:[function(require,module,exports){"use strict";var makePlaceholderVisibleOrNotVisibleDependingOnTextareaValue=function makePlaceholderVisibleOrNotVisibleDependingOnTextareaValue(textarea){if(textarea.value.length===0){textarea.classList.add("with-visible-placeholder-in-all-browsers")}else{textarea.classList.remove("with-visible-placeholder-in-all-browsers")}};module.exports=function(textarea){makePlaceholderVisibleOrNotVisibleDependingOnTextareaValue(textarea);textarea.addEventListener("input",function(){makePlaceholderVisibleOrNotVisibleDependingOnTextareaValue(textarea)})}},{}],25:[function(require,module,exports){"use strict";var scrollToSelectionInTextarea=require("./scrollToSelectionInTextarea");module.exports=function(textarea,fontFamily){var textareaComputedStyle=window.getComputedStyle(textarea);var textareaLineHeight=textareaComputedStyle.getPropertyValue("line-height").split("px")[0]*1;textarea.addEventListener("input",function(){scrollToSelectionInTextarea(textarea,textareaLineHeight,fontFamily)})}},{"./scrollToSelectionInTextarea":169}],26:[function(require,module,exports){"use strict";var createdRefRectHoveringRefElement=require("./createdRefRectHoveringRefElement");var notifyUserToUpdateSVGImage=require("./notifyUserToUpdateSVGImage");var isMacOS=navigator.platform.indexOf("Mac")!==-1;var showHintMessageThatUserShouldRerenderPreviewInOrderToNavigateBetweenTextInDivUnderneathTeextareaToElementsInSvg=function showHintMessageThatUserShouldRerenderPreviewInOrderToNavigateBetweenTextInDivUnderneathTeextareaToElementsInSvg(textarea){var hintMessageToBeRemoved=textarea.initialParentElement.shadowRoot.querySelector(".central-absolute-hint-message");if(hintMessageToBeRemoved){textarea.initialParentElement.shadowRoot.removeChild(hintMessageToBeRemoved);hintMessageToBeRemoved.isRemoved=true}var hintMessage=document.createElement("div");hintMessage.classList.add("central-absolute-hint-message");hintMessage.innerText="You have to re-render preview to match the changes in the text to be able to navigate.";textarea.initialParentElement.shadowRoot.appendChild(hintMessage);if(hintMessage.style.display==="none"||hintMessage.style.display===""){hintMessage.style.display="block";setTimeout(function(){if(!hintMessage.isRemoved){hintMessage.style.display="none";textarea.initialParentElement.shadowRoot.removeChild(hintMessage)}},5e3)}};module.exports=function(divUnderneathTextarea,textarea,renderPreviewTabButton){var svgPlaceholder=textarea.initialParentElement;var refClickEventInEditor=function refClickEventInEditor(event){if(event.target.hasAttribute("ref-id")){event.target.style.textDecoration="none";window.refSpanThatHovered=undefined;var refIdValue=event.target.getAttribute("ref-id");var allRefElementsInSvgPlaceholder=svgPlaceholder.querySelectorAll("[ref-ids]");var refElementsInSvgPlaceholderWithSpecifiedRefId=[];for(var refElementIndex=0;refElementIndex<allRefElementsInSvgPlaceholder.length;refElementIndex++){var refIdsOfRefElement=allRefElementsInSvgPlaceholder[refElementIndex].getAttribute("ref-ids").split(",");if(refIdsOfRefElement.indexOf(refIdValue)!==-1){refElementsInSvgPlaceholderWithSpecifiedRefId.push(allRefElementsInSvgPlaceholder[refElementIndex])}}var firstRefElementInSvgPlaceholder=refElementsInSvgPlaceholderWithSpecifiedRefId[0];if(firstRefElementInSvgPlaceholder){(function(){renderPreviewTabButton.click();var svgElement=svgPlaceholder.getElementsByTagName("svg")[0];var _loop=function _loop(_refElementIndex){var refElementInSVGPlaceholder=refElementsInSvgPlaceholderWithSpecifiedRefId[_refElementIndex];var refRectHoveringRefElement=createdRefRectHoveringRefElement(refElementInSVGPlaceholder,svgElement,"ref-rect-hover","ref-rect-hover-from-editor");svgElement.appendChild(refRectHoveringRefElement);refRectHoveringRefElement.scrollIntoView({block:"center",inline:"center"});setTimeout(function(){if(svgElement.contains(refRectHoveringRefElement)){svgElement.removeChild(refRectHoveringRefElement)}},2500)};for(var _refElementIndex=0;_refElementIndex<refElementsInSvgPlaceholderWithSpecifiedRefId.length;_refElementIndex++){_loop(_refElementIndex)}})()}else{console.log(textarea,svgPlaceholder);notifyUserToUpdateSVGImage(svgPlaceholder);textarea.blur()}}};var eventsWereAttachedToDivUnderneathTextarea=false;divUnderneathTextarea.addEventListener("mousemove",function(event){if(isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey){if(textarea.selectionStart===textarea.selectionEnd){divUnderneathTextarea.style.zIndex="2";if(event.target.tagName.toLowerCase()==="span"){if(!textarea.isRenderedWithLatestUnilangInputText){showHintMessageThatUserShouldRerenderPreviewInOrderToNavigateBetweenTextInDivUnderneathTeextareaToElementsInSvg(textarea)}}if(event.target.hasAttribute("ref-id")){event.target.addEventListener("click",refClickEventInEditor);if(window.refSpanThatHovered){window.refSpanThatHovered.style.textDecoration="none";window.refSpanThatHovered=event.target;window.refSpanThatHovered.style.textDecoration="underline"}else{window.refSpanThatHovered=event.target;window.refSpanThatHovered.style.textDecoration="underline"}eventsWereAttachedToDivUnderneathTextarea=true}else{if(window.refSpanThatHovered){if(eventsWereAttachedToDivUnderneathTextarea){window.refSpanThatHovered.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}window.refSpanThatHovered.style.textDecoration="none";window.refSpanThatHovered=undefined}}}else{divUnderneathTextarea.style.zIndex="0";divUnderneathTextarea.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}}else{divUnderneathTextarea.style.zIndex="0";divUnderneathTextarea.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}});window.addEventListener("keydown",function(event){if(isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey){if(textarea.selectionStart===textarea.selectionEnd){divUnderneathTextarea.style.zIndex="2"}else{divUnderneathTextarea.style.zIndex="0";if(window.refSpanThatHovered){if(eventsWereAttachedToDivUnderneathTextarea){window.refSpanThatHovered.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}window.refSpanThatHovered.style.textDecoration="none";window.refSpanThatHovered=undefined}}}else{divUnderneathTextarea.style.zIndex="0";if(window.refSpanThatHovered){if(eventsWereAttachedToDivUnderneathTextarea){window.refSpanThatHovered.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}window.refSpanThatHovered.style.textDecoration="none";window.refSpanThatHovered=undefined}}});window.addEventListener("keyup",function(){divUnderneathTextarea.style.zIndex="0";if(window.refSpanThatHovered){if(eventsWereAttachedToDivUnderneathTextarea){window.refSpanThatHovered.removeEventListener("click",refClickEventInEditor);eventsWereAttachedToDivUnderneathTextarea=false}window.refSpanThatHovered.style.textDecoration="none";window.refSpanThatHovered=undefined}})}},{"./createdRefRectHoveringRefElement":8,"./notifyUserToUpdateSVGImage":27}],27:[function(require,module,exports){"use strict";var createdElementWithStylesAndAttributes=require("./createdElementWithStylesAndAttributes");module.exports=function(svgPlaceholder){var label=createdElementWithStylesAndAttributes("div",{},{class:"press-draw-label"});label.textContent="No references was found, try to press button DRAW";if(svgPlaceholder.firstChild){svgPlaceholder.insertBefore(label,svgPlaceholder.firstChild)}else{svgPlaceholder.appendChild(label)}setTimeout(function(){if(svgPlaceholder.contains(label)){svgPlaceholder.removeChild(label)}},5e3)}},{"./createdElementWithStylesAndAttributes":6}],28:[function(require,module,exports){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var parserScenarios=require("./scenarios/parserScenarios");var mapWithScenariosAndScenariosWhereItIsRequired=require("./scenarios/mapWithScenariosAndScenariosWhereItIsRequired");var constructedParserScenarios=parserScenarios();var constructedMapWithScenariosAndScenariosWhereItIsRequired=mapWithScenariosAndScenariosWhereItIsRequired(constructedParserScenarios);var withoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem=require("./scenarios/token/withoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem");var tokenValuesFromTokens=require("./scenarios/token/tokenValuesFromTokens");var joinedTokensWithRealDelimiters=require("./scenarios/token/joinedTokensWithRealDelimiters");var NEW_LINE_REGEXP=/[\r\n|\r|\n]/;var SPACE_REGEXP=/[\s]/;var EMPTY_STRING="";var REGULAR="regular";var ON_EMPTY_LINE="on empty line";var LAST_CHAR="last char";var LAST_LEVEL="last level";var runParserScenarios=function runParserScenarios(parserScenarios,typeOfScenarios,numberOfActivatedScenarios,progressionOfCommandsFromScenarios,lastScenarioLineNumber,unitext,lineNumber,itIsLastChar,currentToken,tokenAccumulator,delimitersBeforeFirstTokenOnTheLine,delimetersAfterEachToken,parserState,queueOfActionsOnProgressionOfCommandsChange){var tokenValues=tokenValuesFromTokens(tokenAccumulator);var tokenValuesWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem=withoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem(tokenAccumulator);var joinedTokenValuesWithRealDelimiters=joinedTokensWithRealDelimiters(tokenAccumulator,delimitersBeforeFirstTokenOnTheLine,delimetersAfterEachToken);var scenarioNamesThatFollowProgressionOfCommand=[];if(progressionOfCommandsFromScenarios.length>0){for(var scenarioNameIndex=0;scenarioNameIndex<progressionOfCommandsFromScenarios.length;scenarioNameIndex++){var scenarioName=progressionOfCommandsFromScenarios[scenarioNameIndex];if(constructedMapWithScenariosAndScenariosWhereItIsRequired[scenarioName]&&constructedMapWithScenariosAndScenariosWhereItIsRequired[scenarioName].length>0){scenarioNamesThatFollowProgressionOfCommand.push.apply(scenarioNamesThatFollowProgressionOfCommand,_toConsumableArray(constructedMapWithScenariosAndScenariosWhereItIsRequired[scenarioName]))}}}scenarioNamesThatFollowProgressionOfCommand.push.apply(scenarioNamesThatFollowProgressionOfCommand,_toConsumableArray(constructedMapWithScenariosAndScenariosWhereItIsRequired.common));for(var _scenarioNameIndex=0;_scenarioNameIndex<scenarioNamesThatFollowProgressionOfCommand.length;_scenarioNameIndex++){var _scenarioName=scenarioNamesThatFollowProgressionOfCommand[_scenarioNameIndex];var scenario=parserScenarios[_scenarioName];var isScenarioOnTheSameLineAsPreviousScenarioOrItDoesnMatter=scenario.onTheSameLineAsPrevScenario?lineNumber===lastScenarioLineNumber.value:true;if(!isScenarioOnTheSameLineAsPreviousScenarioOrItDoesnMatter){continue}var isScenarioStartsOnNewLineOrItDoesntMatter=scenario.startsOnNewLine?lineNumber>lastScenarioLineNumber.value||numberOfActivatedScenarios.value===0:true;if(!isScenarioStartsOnNewLineOrItDoesntMatter){continue}var areThereAnyProhibitedScenariosThatAreInProgressOrItDoesntMatter=false;if(scenario.prohibitedCommandProgressions){for(var index=0;index<scenario.prohibitedCommandProgressions.length;index++){if(progressionOfCommandsFromScenarios.indexOf(scenario.prohibitedCommandProgressions[index])!==-1){areThereAnyProhibitedScenariosThatAreInProgressOrItDoesntMatter=true;break}}}if(areThereAnyProhibitedScenariosThatAreInProgressOrItDoesntMatter){continue}var finalTokenValues=scenario.considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem?tokenValuesWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:tokenValues;scenario.type=scenario.type||REGULAR;if(currentToken){currentToken.isOnNewLine=lineNumber>lastScenarioLineNumber.value||numberOfActivatedScenarios.value===0}if(scenario.type===typeOfScenarios){var scenarioConditionIsMet=scenario.condition(unitext,lineNumber,currentToken,finalTokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState);if(scenarioConditionIsMet){if(scenario.itIsNewCommandProgressionFromLevel!==undefined){if(scenario.itIsNewCommandProgressionFromLevel!==LAST_LEVEL){progressionOfCommandsFromScenarios.splice(scenario.itIsNewCommandProgressionFromLevel)}progressionOfCommandsFromScenarios.push(_scenarioName);if(!parserState.applyOnlyHighlightingWithoutRefIds){for(var actionIndex=0;actionIndex<queueOfActionsOnProgressionOfCommandsChange.length;actionIndex++){var currentActionOnProgressionOfCommandsChange=queueOfActionsOnProgressionOfCommandsChange[actionIndex];if(progressionOfCommandsFromScenarios.indexOf(currentActionOnProgressionOfCommandsChange.scenarioName)===-1||progressionOfCommandsFromScenarios.indexOf(currentActionOnProgressionOfCommandsChange.scenarioName)===progressionOfCommandsFromScenarios.length-1){var scenarioNameThatChangedCommandsProgression=_scenarioName;currentActionOnProgressionOfCommandsChange.action(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,currentActionOnProgressionOfCommandsChange.argumentsFromMainAction);queueOfActionsOnProgressionOfCommandsChange.splice(actionIndex,1);actionIndex--}}if(scenario.actionWhenProgressionOfCommandsChanges){queueOfActionsOnProgressionOfCommandsChange.unshift({scenarioName:_scenarioName,scenarioType:scenario.type,levelOfCommandProgression:scenario.itIsNewCommandProgressionFromLevel,action:scenario.actionWhenProgressionOfCommandsChanges,activateOnLastToken:scenario.activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore,argumentsFromMainAction:{unitext:unitext,lineNumber:lineNumber,currentToken:currentToken,tokenValues:finalTokenValues,joinedTokenValuesWithRealDelimiters:joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios:progressionOfCommandsFromScenarios}})}}}if(parserState.applyHighlighting&&parserState.applyOnlyHighlightingWithoutRefIds){scenario.actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,finalTokenValues)}else{scenario.action(unitext,lineNumber,currentToken,finalTokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState)}tokenAccumulator.length=0;lastScenarioLineNumber.value=lineNumber;numberOfActivatedScenarios.value+=1;break}}}};module.exports=function(unitext){var progressionOfCommandsFromScenarios=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var applyHighlighting=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var applyOnlyHighlightingWithoutRefIds=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var mapOfCharIndexesWithProgressionOfCommandsFromScenarios={};var numberOfActivatedScenarios={value:0};var queueOfActionsOnProgressionOfCommandsChange=[];var parserState={pageSchema:{},highlightsHtmlBuffer:[],applyHighlighting:applyHighlighting,applyOnlyHighlightingWithoutRefIds:applyOnlyHighlightingWithoutRefIds,indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders:[],indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection:[],indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord:[],lastMentionedStyleKey:undefined,lastMentionedUnitPosition:undefined,lastMentionedPageLinePosition:undefined,lastMentionedMeasurePosition:undefined,lastMentionedStavePosition:undefined,lastMentionedVoicePosition:undefined,calculatedUnitPageLineIndexByLastMentionedPositions:undefined,calculatedUnitMeasureIndexByLastMentionedPositions:undefined,calculatedUnitStaveIndexByLastMentionedPositions:undefined,calculatedUnitVoiceIndexByLastMentionedPositions:undefined,calculatedUnitIndexByLastMentionedPositions:undefined,lastMentionedConnectionPageLinePosition:undefined,lastMentionedConnectionMeasurePosition:undefined,lastMentionedConnectionStavePosition:undefined,lastMentionedConnectionVoicePosition:undefined,lastMentionedNoteIndex:undefined,lastMentionedUnitsCompression:undefined,lastMentionedUnitsCompressionWasForSpecificLine:false,lastMentionedUnitsStretching:undefined,lastMentionedUnitsStretchingWasForAllLines:false,numberOfChordsBeforeFinishingDeclaringNewOne:0,newlineAlreadyIntroducedNewMeasure:false,customStyles:{},errors:[],comments:[],emptyLineNumbers:[],numberOfPageLines:0,lastClef:{},lastChordDuration:{},lastStemDirection:{},lastStavePosition:{},lastBeamStatus:{},keysOfLastNote:[],lastNoteTextValue:undefined,lastNoteTextPositionApplicationToNote:undefined,lastGhostStatus:{},chordIsActivatedInPreviousCommand:false,chordScopeIsActive:false,lastCrossStaveConnectionsParamsForEachLine:undefined,lastCrossStaveConnectionsParamsForEachLineId:1,lastInstrumentTitlesParams:undefined,lastInstrumentTitlesParamsForEachLineId:1,lastKeySignatureName:undefined,lastKeySignatureNameForEachLineId:0,lastClefNames:[],lastTimeSignatureParams:undefined,lastTimeSignatureValueForEachLineId:1,numberOfGlissandos:0,numberOfSlurs:0,slurMarkChords:{},lastSlurDirection:undefined,lastSShapeSlurPartDirection:undefined,lastSlurRoundness:undefined,lastSlurLeftYCorrection:undefined,lastSlurRightYCorrection:undefined,lastSlurWithSShape:undefined,lastSlurRightPointPlacement:undefined,lastGlissandoDirection:undefined,lastGlissandoForm:undefined,lastDeclaredGlissando:undefined,lastGlissandoBeforeMeasure:undefined,lastGlissandoAfterMeasure:undefined,numberOfTuplets:0,lastTupletValue:undefined,lastChordParamsWithFinishedTupletMarkThatStartedBefore:undefined,lastChordParamsWithStartedTupletMark:undefined,lastTupletDirection:undefined,lastTupletIsAboveOrBelowStaveLines:undefined,lastTupletWithBrackets:undefined,lastTupletVerticalCorrection:undefined,lastChordLetterDirection:undefined,numberOfOctaveSignMarks:0,numberOfDynamicMarks:0,numberOfSimileMarks:0,numberOfVoltaMarks:0,numberOfPedalMarks:0};var currentTokenChars=[];var currentLineChars=[];var allPrevTokens=[];var prevTokensOnTheLine=[];var tokenAccumulator=[];var delimitersBeforeFirstTokenOnTheLine=[];var delimetersAfterEachToken=[];var firstTokenIsBehindOnTheLine=false;var lineNumber=1;var tokenNumber=0;var lastScenarioLineNumber={value:lineNumber};for(var charIndex=0;charIndex<unitext.length;charIndex++){var currentChar=unitext[charIndex];var nextChar=unitext[charIndex+1];var itIsLastChar=!nextChar;var itIsNewLineChar=NEW_LINE_REGEXP.test(currentChar);var itIsDelimeterBetweenTokens=SPACE_REGEXP.test(currentChar);var nextIsDelimeterBetweenTokens=nextChar&&SPACE_REGEXP.test(nextChar);if(!itIsDelimeterBetweenTokens){var sinceItIsNonDelimeterCharWeCanAssumeThatWeDontNeedToCollectDelimeterCharsBeforeForstToken=true;firstTokenIsBehindOnTheLine=sinceItIsNonDelimeterCharWeCanAssumeThatWeDontNeedToCollectDelimeterCharsBeforeForstToken;currentTokenChars.push(currentChar);currentLineChars.push(currentChar);if(!itIsLastChar){mapOfCharIndexesWithProgressionOfCommandsFromScenarios[charIndex]=progressionOfCommandsFromScenarios.slice();continue}}else{if(!firstTokenIsBehindOnTheLine){delimitersBeforeFirstTokenOnTheLine.push(currentChar)}}if(currentTokenChars.length>0){var noProcessedTokensOnTheLine=prevTokensOnTheLine.length===0;var firstTokenInProcessing=tokenNumber===0;var prevTokenOnTheLine=prevTokensOnTheLine[prevTokensOnTheLine.length-1];var prevToken=allPrevTokens[allPrevTokens.length-1];var currentToken=prevTokenOnTheLine&&prevTokenOnTheLine.tokenNumber===tokenNumber?prevTokenOnTheLine:{value:currentTokenChars.join(EMPTY_STRING),tokenNumber:tokenNumber};currentToken.firstOnTheLine=firstTokenInProcessing||prevToken&&prevToken.lastOnTheLine;currentToken.lastOnTheLine=itIsNewLineChar||itIsLastChar;delimetersAfterEachToken[tokenNumber]=delimetersAfterEachToken[tokenNumber]||[];if(itIsDelimeterBetweenTokens){delimetersAfterEachToken[tokenNumber].push(currentChar)}if(!nextIsDelimeterBetweenTokens||currentToken.lastOnTheLine){currentToken.firstCharIndexOfNextToken=charIndex+1;tokenAccumulator.push(currentToken);runParserScenarios(constructedParserScenarios,REGULAR,numberOfActivatedScenarios,progressionOfCommandsFromScenarios,lastScenarioLineNumber,unitext,lineNumber,itIsLastChar,currentToken,tokenAccumulator,delimitersBeforeFirstTokenOnTheLine,delimetersAfterEachToken,parserState,queueOfActionsOnProgressionOfCommandsChange);var tokenIsNew=noProcessedTokensOnTheLine?true:prevTokenOnTheLine.tokenNumber!==tokenNumber;if(tokenIsNew){prevTokensOnTheLine.push(currentToken);allPrevTokens.push(currentToken)}var nextTokenToBeConsideredOnNextIteration=itIsNewLineChar||!nextIsDelimeterBetweenTokens||itIsLastChar;if(nextTokenToBeConsideredOnNextIteration){tokenNumber+=1;currentTokenChars.length=0}var currentTokenIsLastOnTheLineThereforeWeNeedToStartCollectingDelimeterCharsBeforeNextFirstTokenOnTheLine=currentToken.lastOnTheLine;if(currentTokenIsLastOnTheLineThereforeWeNeedToStartCollectingDelimeterCharsBeforeNextFirstTokenOnTheLine){firstTokenIsBehindOnTheLine=false;delimitersBeforeFirstTokenOnTheLine.length=0}}}else{if(parserState.applyHighlighting&&itIsLastChar&&itIsDelimeterBetweenTokens&&parserState.highlightsHtmlBuffer!==undefined){parserState.highlightsHtmlBuffer.push(delimitersBeforeFirstTokenOnTheLine.join(EMPTY_STRING))}}if(itIsNewLineChar){if(currentLineChars.join(EMPTY_STRING).length===0&&parserState.emptyLineNumbers!==undefined){parserState.emptyLineNumbers.push(lineNumber);runParserScenarios(constructedParserScenarios,ON_EMPTY_LINE,numberOfActivatedScenarios,progressionOfCommandsFromScenarios,lastScenarioLineNumber,unitext,lineNumber,itIsLastChar,undefined,tokenAccumulator,delimitersBeforeFirstTokenOnTheLine,delimetersAfterEachToken,parserState,queueOfActionsOnProgressionOfCommandsChange)}lineNumber+=1;prevTokensOnTheLine.length=0;currentLineChars.length=0;tokenAccumulator.length=0}mapOfCharIndexesWithProgressionOfCommandsFromScenarios[charIndex]=progressionOfCommandsFromScenarios.slice()}if(!applyOnlyHighlightingWithoutRefIds){for(var actionIndex=0;actionIndex<queueOfActionsOnProgressionOfCommandsChange.length;actionIndex++){var currentActionOnProgressionOfCommandsChange=queueOfActionsOnProgressionOfCommandsChange[actionIndex];if(currentActionOnProgressionOfCommandsChange.activateOnLastToken){var scenarioNameThatChangedCommandsProgression=LAST_CHAR;currentActionOnProgressionOfCommandsChange.action(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,currentActionOnProgressionOfCommandsChange.argumentsFromMainAction)}}}if(!parserState.applyHighlighting){if(parserState.highlightsHtmlBuffer.length!==0){throw new Error("parserState.highlightsHtmlBuffer.length is 0, although !parserState.applyHighlighting")}parserState.highlightsHtmlBuffer=[unitext]}var parsedObject={pageSchema:parserState.pageSchema,highlightsHtmlBuffer:parserState.highlightsHtmlBuffer,customStyles:parserState.customStyles,errors:parserState.errors,comments:parserState.comments,mapOfCharIndexesWithProgressionOfCommandsFromScenarios:mapOfCharIndexesWithProgressionOfCommandsFromScenarios};return parsedObject}},{"./scenarios/mapWithScenariosAndScenariosWhereItIsRequired":69,"./scenarios/parserScenarios":102,"./scenarios/token/joinedTokensWithRealDelimiters":154,"./scenarios/token/tokenValuesFromTokens":162,"./scenarios/token/withoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem":165}],29:[function(require,module,exports){"use strict";var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var openingBarLines=require("./static-objects/openingBarLines");var closingBarLines=require("./static-objects/closingBarLines");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["no start bar line"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.noStartBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"withoutStartBarLine",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.withoutStartBarLine=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noStartBarLineHighlight,function(match){return'<span class="th" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noStartBarLine,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0};scenarios["opening bar line"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.openingBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"openingBarLineName",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var openingBarLineName=regexps.openingBarLine.match(tokenValues)[0];var openingBarLine=openingBarLines[openingBarLineName];lastMeasureParamsValue.openingBarLineName=openingBarLine;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.openingBarLineHighlight,function(match){return'<span class="eh" ref-id="opening-barline-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="opening-barline-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.openingBarLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["closing bar line"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.closingBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"closingBarLineName",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var closingBarLineName=regexps.closingBarLine.match(tokenValues)[0];var closingBarLine=closingBarLines[closingBarLineName];lastMeasureParamsValue.closingBarLineName=closingBarLine;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.closingBarLineHighlight,function(match){return'<span class="eh" ref-id="closing-barline-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="closing-barline-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.closingBarLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/closingBarLines":113,"./static-objects/openingBarLines":125,"./static-objects/regexps":130}],30:[function(require,module,exports){"use strict";var theSameScenarioButWithDifferentRequiredCommandProgression=require("./theSameScenarioButWithDifferentRequiredCommandProgression");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll=require("./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll");var initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty=require("./page-schema/initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastStaveParams=require("./page-schema/lastStaveParams");var lastVoiceParams=require("./page-schema/lastVoiceParams");var lastNonSimileChordParams=require("./page-schema/lastNonSimileChordParams");var lastParentheses=require("./page-schema/lastParentheses");var regexps=require("./static-objects/regexps");var stavePositions=require("./static-objects/stavePositions");var isNoteIndex=require("./token/isNoteIndex");var noteIndexByTokens=require("./token/noteIndexByTokens");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var isDirection=require("./token/isDirection");var direction=require("./token/direction");var noteDurations=require("./static-objects/noteDurations");var defaultChordDuration=1/4;module.exports=function(scenarios){scenarios["chord"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.chordWithDuration.test(tokenValues)&&!regexps.letters.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll(lastMeasureParamsValue,"voicesParams",parserState);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty(lastStaveParamsValue,"notes");var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var unitDuration=noteDurations[regexps.chordWithDuration.match(tokenValues)[0]];lastVoiceParamsValue.push({notes:[]});var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;parserState.numberOfUnitsBeforeFinishingDeclaringNewOne=currentNumberOfUnits;if(unitDuration){lastChordParamsValue.unitDuration=unitDuration;if(!parserState.lastChordDuration[currentNumberOfStaves-1]){parserState.lastChordDuration[currentNumberOfStaves-1]={}}parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]=unitDuration}else if(parserState.lastChordDuration[currentNumberOfStaves-1]&&parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]){lastChordParamsValue.unitDuration=parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]}else{lastChordParamsValue.unitDuration=defaultChordDuration}parserState.chordScopeIsActive=true;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withChordWithDurationHighlight,function(match){return'<span class="cuph" ref-id="unit-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="unit-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withChordWithDurationHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(scenarioNameThatChangedCommandsProgression!=="note"){parserState.chordScopeIsActive=false}var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(!parserState.lastBeamStatus[currentNumberOfStaves-1]){parserState.lastBeamStatus[currentNumberOfStaves-1]={}}if(!parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]={plain:false,grace:false}}if(lastChordParamsValue.unitDuration>=1/4){lastChordParamsValue.beamedWithNext=false}if(lastChordParamsValue.beamedWithNext===false&&parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]=false}if(lastChordParamsValue.beamedWithNext===false&&parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=false}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=false}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]&&!lastChordParamsValue.isGrace){lastChordParamsValue.beamedWithNext=true}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&lastChordParamsValue.isGrace){lastChordParamsValue.beamedWithNext=true}if(lastChordParamsValue.beamedWithNext===true&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]=true}if(lastChordParamsValue.beamedWithNext===true&&lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord stave position"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.stavePosition.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var stavePositionName=regexps.stavePosition.match(tokenValues)[0];var stavePosition=stavePositions[stavePositionName];var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(!parserState.lastStavePosition[currentNumberOfStaves-1]){parserState.lastStavePosition[currentNumberOfStaves-1]={}}parserState.lastStavePosition[currentNumberOfStaves-1][currentNumberOfVoices-1]=stavePosition;var stavePositionInRefId=currentNumberOfStaves;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stavePositionHighlight,function(match){if(stavePositionName==="next"){stavePositionInRefId=currentNumberOfStaves+1}else if(stavePositionName==="prev"){stavePositionInRefId=currentNumberOfStaves-1}return'<span class="csph" ref-id="stave-'.concat(currentNumberOfMeasures,"-").concat(stavePositionInRefId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(currentNumberOfMeasures,"-").concat(stavePositionInRefId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stavePositionHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["chord with parentheses"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withParentheses.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.parentheses=lastChordParamsValue.parentheses||[];lastChordParamsValue.parentheses.push({appliedToWholeUnit:true});var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;var currentNumberOfParentheses=lastChordParamsValue.parentheses.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh" ref-id="unit-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfParentheses,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="unit-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfParentheses,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord with parentheses from"]={requiredCommandProgression:"chord with parentheses",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.from.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){if(parserState.lastMentionedNoteIndex!==undefined){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2].replace('ref-id=""','ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'"'))}parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord with parentheses from note index"]={requiredCommandProgression:"chord with parentheses from",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isNoteIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastChordParenthesesValue=lastParentheses(lastChordParamsValue);var noteIndex=noteIndexByTokens(tokenValues,true);if(noteIndex!==undefined){lastChordParenthesesValue.appliedToWholeUnit=false;lastChordParenthesesValue.fromNoteIndex=noteIndex;parserState.lastMentionedNoteIndex=noteIndex}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noteIndexHighlight,function(match){return'<span class="cuph" ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noteIndexHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:3};scenarios["chord with parentheses to"]={requiredCommandProgression:"chord with parentheses",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.to.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){if(parserState.lastMentionedNoteIndex!==undefined){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2].replace('ref-id=""','ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'"'))}parserState.highlightsHtmlBuffer.push("</span>")}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord with parentheses to note index"]={requiredCommandProgression:"chord with parentheses to",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isNoteIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastChordParenthesesValue=lastParentheses(lastChordParamsValue);var noteIndex=noteIndexByTokens(tokenValues,true);if(noteIndex!==undefined){lastChordParenthesesValue.appliedToWholeUnit=false;lastChordParenthesesValue.toNoteIndex=noteIndex;parserState.lastMentionedNoteIndex=noteIndex}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noteIndexHighlight,function(match){return'<span class="cuph" ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-with-index-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(parserState.lastMentionedNoteIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.noteIndexHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:3};scenarios["chord is ghost"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isGhost.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(!parserState.lastGhostStatus[currentNumberOfStaves-1]){parserState.lastGhostStatus[currentNumberOfStaves-1]={}}parserState.lastGhostStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["chord is not ghost"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isNotGhost.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(!parserState.lastGhostStatus[currentNumberOfStaves-1]){parserState.lastGhostStatus[currentNumberOfStaves-1]={}}parserState.lastGhostStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]=false;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["chord is arpeggiated"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.arpeggiated.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.arpeggiated={};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.arpeggiatedHighlight,function(match){return'<span class="eh" ref-id="arpeggiated-wave-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="arpeggiated-wave-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.arpeggiatedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord is arpeggiated with chord below"]={requiredCommandProgression:"chord is arpeggiated",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withChordBelow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.arpeggiated.isConnectedWithNextChord=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.chordHighlight,function(match){return'<span class="cuph" ref-id="unit-arpeggiated-below-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="unit-arpeggiated-below-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.chordHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["chord is arpeggiated with arrow"]={requiredCommandProgression:"chord is arpeggiated",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withArrow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.arpeggiated.arrow="up";var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.arrowHighlight,function(match){return'<span class="eh" ref-id="arpeggiated-arrow-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="arpeggiated-arrow-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.arrowHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["chord is arpeggiated with arrow direction"]={requiredCommandProgression:"chord is arpeggiated with arrow",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.arpeggiated.arrow=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:3};scenarios["chord with text"]={requiredCommandProgression:"chord",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var textValue=regexps.withText.match(tokenValues)[0];parserState.lastNoteTextValue=textValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.withTextHighlight,function(match){return'<span class="eh" ref-id="">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.withTextHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastNoteTextPositionApplicationToNote===undefined){parserState.lastNoteTextPositionApplicationToNote=true;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulationParams={name:"noteLetter",direction:"up",textValue:parserState.lastNoteTextValue};lastChordParamsValue.articulationParams.push(newArticulationParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'"'))}parserState.lastNoteTextPositionApplicationToNote=undefined}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["chord with text up or down"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text up or down"],"chord with text");scenarios["chord with text above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text above or below"],"chord with text");scenarios["chord with text above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text above or below stave"],"chord with text");scenarios["chord with text up or down vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text up or down vertical correction"],"chord with text up or down");scenarios["chord with text above or below vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text above or below vertical correction"],"chord with text above or below");scenarios["chord with text above or below stave vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text above or below stave vertical correction"],"chord with text above or below stave");scenarios["chord with number of dots"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with number of dots"],"chord");scenarios["dotted chord"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["dotted note"],"chord");scenarios["chord stem direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note stem direction"],"chord");scenarios["chord beamed"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note beamed"],"chord");scenarios["chord not beamed"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note not beamed"],"chord");scenarios["chord beamed with next"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note beamed with next"],"chord beamed");scenarios["chord not beamed with next"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note not beamed with next"],"chord not beamed");scenarios["chord beamed with only primary line"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note beamed with only primary line"],"chord beamed");scenarios["chord is tied with next"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is tied with next"],"chord");scenarios["chord is tied before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is tied before"],"chord");scenarios["chord is tied before measure number"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is tied before measure number"],"chord is tied before");scenarios["chord is tied after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is tied after"],"chord");scenarios["chord is tied after measure number"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is tied after measure number"],"chord is tied after");scenarios["chord tied with next direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied with next direction"],"chord is tied with next");scenarios["chord tied with next above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied with next above or below"],"chord is tied with next");scenarios["chord tied before direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied before direction"],"chord is tied before");scenarios["chord tied before above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied before above or below"],"chord is tied before");scenarios["chord tied after direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied after direction"],"chord is tied after");scenarios["chord tied after above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied after above or below"],"chord is tied after");scenarios["chord tied with next roundness"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied with next roundness"],"chord is tied with next");scenarios["chord tied before roundness"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied before roundness"],"chord is tied before");scenarios["chord tied after roundness"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note tied after roundness"],"chord is tied after");scenarios["chord with glissando"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando"],"chord");scenarios["chord with glissando direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando direction"],"chord with glissando");scenarios["chord with glissando after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando after"],"chord with glissando");scenarios["chord with glissando before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando before"],"chord with glissando");scenarios["chord with glissando after measure number"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando after measure number"],"chord with glissando after");scenarios["chord with glissando before measure number"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with glissando after measure number"],"chord with glissando before");scenarios["chord is grace"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is grace"],"chord");scenarios["chord with crushed grace"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with crushed grace"],"chord is grace");scenarios["chord is rest"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is rest"],"chord");scenarios["chord is centralized"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note is centralized"],"chord");scenarios["chord with breath mark before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with breath mark before"],"chord");scenarios["chord with breath mark before vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with breath mark before vertical correction"],"chord with breath mark before");scenarios["chord with key signature before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with key signature before"],"chord");scenarios["chord with clef before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with clef before"],"chord");scenarios["chord with clef and key signature before"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with clef before"],"chord");scenarios["chord with articulation"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation"],"chord");scenarios["chord with turn"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn"],"chord");scenarios["chord with mordent"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent"],"chord");scenarios["chord with trill"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill"],"chord");scenarios["chord with articulation direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation direction"],"chord with articulation");scenarios["chord with turn direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn direction"],"chord with turn");scenarios["chord with mordent direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent direction"],"chord with mordent");scenarios["chord with trill direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill direction"],"chord with trill");scenarios["chord with articulation above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below"],"chord with articulation");scenarios["chord with turn above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn above or below"],"chord with turn");scenarios["chord with mordent above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent above or below"],"chord with mordent");scenarios["chord with trill above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill above or below"],"chord with trill");scenarios["chord with articulation above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below stave"],"chord with articulation");scenarios["chord with turn above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn above or below stave"],"chord with turn");scenarios["chord with mordent above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent above or below stave"],"chord with mordent");scenarios["chord with trill above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill above or below stave"],"chord with trill");scenarios["chord with turn key above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn key above or below"],"chord with turn");scenarios["chord with mordent key above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent key above or below"],"chord with mordent");scenarios["chord with trill key above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill key above or below"],"chord with trill");scenarios["chord with turn after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn after"],"chord with turn");scenarios["chord with turn inverted"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn inverted"],"chord with turn");scenarios["chord with trill with wave after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill with wave after"],"chord with trill");scenarios["chord with articulation vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation vertical correction"],"chord with articulation");scenarios["chord with turn vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn vertical correction"],"chord with turn");scenarios["chord with mordent vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with mordent vertical correction"],"chord with mordent");scenarios["chord with trill vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with trill vertical correction"],"chord with trill");scenarios["chord with chord letter"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with chord letter"],"chord");scenarios["chord with chord letter direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with chord letter direction"],"chord with chord letter");scenarios["chord with chord letter above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with chord letter above or below"],"chord with chord letter");scenarios["chord with chord letter above or below measure"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with chord letter above or below measure"],"chord with chord letter above or below");scenarios["chord with chord letter vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with chord letter vertical correction"],"chord with chord letter");scenarios["chord with octave sign"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with octave sign"],"chord");scenarios["chord with octave sign vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with octave sign vertical correction"],"chord with octave sign");scenarios["chord with tremolo"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with tremolo"],"chord");scenarios["chord with tremolo with next"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with tremolo with next"],"chord with tremolo");scenarios["chord with tremolo number of strokes"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with tremolo number of strokes"],"chord with tremolo");scenarios["repeat chord"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["repeat note"],"chord");scenarios["repeat chord via simile"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["repeat note via simile"],"repeat chord");scenarios["repeat chord number of times"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["repeat note number of times"],"repeat chord");scenarios["repeat chord vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["repeat note vertical correction"],"repeat chord");scenarios["chord with dynamic"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with dynamic"],"chord");scenarios["chord with dynamic direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with dynamic direction"],"chord with dynamic");scenarios["chord with dynamic above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with dynamic above or below"],"chord with dynamic");scenarios["chord with dynamic above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with dynamic above or below stave"],"chord with dynamic");scenarios["chord dynamic vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note dynamic vertical correction"],"chord with dynamic");scenarios["chord with lyrics"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics"],"chord");scenarios["chord with lyrics text value"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics text value"],"chord with lyrics");scenarios["chord with lyrics followed by dash"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics followed by dash"],"chord with lyrics");scenarios["chord with lyrics where underscore starts"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics where underscore starts"],"chord with lyrics");scenarios["chord with lyrics where underscore finishes"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics where underscore finishes"],"chord with lyrics");scenarios["chord with lyrics with vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with lyrics with vertical correction"],"chord with lyrics");scenarios["chord with pedal"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal"],"chord");scenarios["chord with pedal under"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal under"],"chord with pedal");scenarios["chord with pedal under stave index"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal under stave index"],"chord with pedal under");scenarios["chord with pedal vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal vertical correction"],"chord with pedal");scenarios["chord with pedal text"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal text"],"chord with pedal");scenarios["chord with pedal opens with bracket"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal opens with bracket"],"chord with pedal");scenarios["chord with pedal before|after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with pedal before|after"],"chord with pedal");scenarios["chord with variable peak"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with variable peak"],"chord");scenarios["chord with variable peak before|after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with variable peak before|after"],"chord with variable peak");scenarios["chord with variable peak text"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with variable peak text"],"chord with variable peak");scenarios["chord with release"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with release"],"chord");scenarios["chord with release before|after"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with release before|after"],"chord with release");scenarios["chord with release bracket"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with release bracket"],"chord with release");scenarios["chord with release at the end of measure"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with release at the end of measure"],"chord with release");scenarios["chord with release after measure"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with release after measure"],"chord with release");scenarios["chord with horizontal correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with horizontal correction"],"chord")}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll":80,"./page-schema/initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty":81,"./page-schema/lastMeasureParams":89,"./page-schema/lastNonSimileChordParams":90,"./page-schema/lastParentheses":92,"./page-schema/lastStaveParams":93,"./page-schema/lastVoiceParams":94,"./static-objects/noteDurations":120,"./static-objects/regexps":130,"./static-objects/stavePositions":132,"./theSameScenarioButWithDifferentRequiredCommandProgression":136,"./token/direction":137,"./token/foundNextTokenValueOnTheLine":140,"./token/isDirection":145,"./token/isNoteIndex":148,"./token/noteIndexByTokens":156}],31:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll=require("./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastStaveParams=require("./page-schema/lastStaveParams");var clefs=require("./static-objects/clefs");module.exports=function(scenarios){scenarios["clef"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.clef.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll(lastMeasureParamsValue,"clef",parserState);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var clefName=regexps.clef.match(tokenValues)[0];lastStaveParamsValue.clef=clefs[clefName];parserState.lastClef[currentNumberOfStaves-1]=lastStaveParamsValue.clef;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh" ref-id="clef-'.concat(numberOfMeasures,"-").concat(currentNumberOfStaves,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="clef-'.concat(numberOfMeasures,"-").concat(currentNumberOfStaves,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll":80,"./page-schema/lastMeasureParams":89,"./page-schema/lastStaveParams":93,"./static-objects/clefs":111,"./static-objects/regexps":130}],32:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");module.exports=function(scenarios){scenarios["coda"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.coda.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"coda",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.coda={measurePosition:"start"};var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.codaHighlight,function(match){return'<span class="eh" ref-id="coda-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="coda-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.codaHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["coda at the start of the measure"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheStartOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.coda.measurePosition="start";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="coda-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["coda at the end of the measure"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEndOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.coda.measurePosition="end";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="coda-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["coda vertical correction"]={requiredCommandProgression:"coda",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.coda.yCorrection=verticalCorrection(tokenValues);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="coda-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="coda-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)}}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],33:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var theSameScenarioButWithDifferentRequiredCommandProgression=require("./theSameScenarioButWithDifferentRequiredCommandProgression");var lastComment=function lastComment(parserState){return parserState.comments[parserState.comments.length-1]};var NEW_LINE="\n";module.exports=function(scenarios){scenarios["comment starts and ends with text"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentStartsAndEndsWithText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.commentStartsAndEndsWithText.match(tokenValues);var startQuote=match[0];var text=match[1];parserState.comments.push({text:text,startLineNumber:lineNumber,endLineNumber:lineNumber,currentLineNumber:lineNumber,startQuote:startQuote});if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment starts with text"]={considerJoinedTokenAccumulatorWithoutCommandDelimiters:true,prohibitedCommandProgressions:["comment starts with text","comment text starts","comment text"],condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentStartsWithText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.commentStartsWithText.match(tokenValues);var startQuote=match[0];var text=match[1];parserState.comments.push({text:text,startLineNumber:lineNumber,currentLineNumber:lineNumber,startQuote:startQuote});if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment text ends (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentTextEnds.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var text=regexps.commentTextEnds.match(tokenValues)[0];var lastCommentValue=lastComment(parserState);if(lastCommentValue.currentLineNumber!==lineNumber){lastCommentValue.text+="\n".concat(text)}else{lastCommentValue.text+=" ".concat(text)}lastCommentValue.endLineNumber=lineNumber;lastCommentValue.currentLineNumber=lineNumber;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["quote ends comment (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentQuote.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastCommentValue=lastComment(parserState);lastCommentValue.endLineNumber=lineNumber;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment text (comment starts with text)"]={requiredCommandProgression:"comment starts with text",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.anything.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var text=regexps.anything.match(tokenValues)[0];var lastCommentValue=lastComment(parserState);if(lastCommentValue.currentLineNumber!==lineNumber){lastCommentValue.text+="\n".concat(text)}else{lastCommentValue.text+=" ".concat(text)}lastCommentValue.currentLineNumber=lineNumber;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:1};scenarios["comment"]={considerJoinedTokenAccumulatorWithoutCommandDelimiters:true,prohibitedCommandProgressions:["comment starts with text","comment text starts","comment text"],condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.comment.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment followed by column or is"]={requiredCommandProgression:"comment",onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.column.test(tokenValues)||regexps.is.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})}};scenarios["comment text starts and ends"]={requiredCommandProgression:"comment",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentTextStartsAndEnds.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.commentTextStartsAndEnds.match(tokenValues);var startQuote=match[0];var text=match[1];parserState.comments.push({text:text,startLineNumber:lineNumber,endLineNumber:lineNumber,currentLineNumber:lineNumber,startQuote:startQuote});if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment text starts"]={requiredCommandProgression:"comment",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.commentTextStarts.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.commentTextStarts.match(tokenValues);var startQuote=match[0];var text=match[1];parserState.comments.push({text:text,startLineNumber:lineNumber,currentLineNumber:lineNumber,startQuote:startQuote});if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="ch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:0};scenarios["comment text ends (comment text starts)"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["comment text ends (comment starts with text)"],"comment text starts");scenarios["quote ends comment (comment text starts)"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["quote ends comment (comment starts with text)"],"comment text starts");scenarios["comment text (comment text starts)"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["comment text (comment starts with text)"],"comment text starts")}},{"./static-objects/regexps":130,"./theSameScenarioButWithDifferentRequiredCommandProgression":136}],34:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["compress units by n times"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.compressUnitsByNTimes.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastMentionedUnitsCompression=regexps.compressUnitsByNTimes.match(withNumbersInsteadOfWords(tokenValues))[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.unitsHighlight,function(match){return'<span class="cuph" ref-id="all-units">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-units">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.unitsHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitsCompressionWasForSpecificLine){parserState.lastMentionedUnitsCompressionWasForSpecificLine=false;parserState.lastMentionedUnitsCompression=undefined}else{parserState.pageSchema.compressUnitsByNTimes=parserState.lastMentionedUnitsCompression;parserState.lastMentionedUnitsCompression=undefined}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["compress units by n times in line position"]={requiredCommandProgression:"compress units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.unitLinePosition.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.unitLinePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.pageSchema.compressUnitsByNTimesInLines=parserState.pageSchema.compressUnitsByNTimesInLines||[];parserState.pageSchema.compressUnitsByNTimesInLines[unitLinePosition]=parserState.lastMentionedUnitsCompression;parserState.lastMentionedUnitsCompressionWasForSpecificLine=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll("all-units","all-units-on-line-".concat(unitLinePosition+1));var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="line-').concat(unitLinePosition+1,'">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="'.concat(unitLinePosition,'">').concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length),"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:1};scenarios["compress units by n times in position of line"]={requiredCommandProgression:"compress units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.linePositionOfUnit.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.linePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.pageSchema.compressUnitsByNTimesInLines=parserState.pageSchema.compressUnitsByNTimesInLines||[];parserState.pageSchema.compressUnitsByNTimesInLines[unitLinePosition]=parserState.lastMentionedUnitsCompression;parserState.lastMentionedUnitsCompressionWasForSpecificLine=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll("all-units","all-units-on-line-".concat(unitLinePosition+1));var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="line-').concat(unitLinePosition+1,'">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="'.concat(unitLinePosition,'">').concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length),"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:1};scenarios["stretch units by n times"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.stretchUnitsByNTimes.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastMentionedUnitsStretching=regexps.stretchUnitsByNTimes.match(withNumbersInsteadOfWords(tokenValues))[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.unitsHighlight,function(match){return'<span class="cuph" ref-id="all-units">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-units">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.unitsHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitsStretchingWasForSpecificLine){parserState.lastMentionedUnitsStretchingWasForSpecificLine=false;parserState.lastMentionedUnitsStretching=undefined}else{parserState.pageSchema.stretchUnitsByNTimes=parserState.lastMentionedUnitsStretching;parserState.lastMentionedUnitsStretching=undefined}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["stretch units by n times in line"]={requiredCommandProgression:"stretch units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.unitLinePosition.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.unitLinePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.pageSchema.stretchUnitsByNTimesInLines=parserState.pageSchema.stretchUnitsByNTimesInLines||[];parserState.pageSchema.stretchUnitsByNTimesInLines[unitLinePosition]=parserState.lastMentionedUnitsStretching;parserState.lastMentionedUnitsStretchingWasForSpecificLine=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll("all-units","all-units-on-line-".concat(unitLinePosition+1));var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="line-').concat(unitLinePosition+1,'">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="line-'.concat(unitLinePosition+1,'">').concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length),"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:1};scenarios["stretch units by n times in position of line"]={requiredCommandProgression:"stretch units by n times",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.linePositionOfUnit.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.linePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.pageSchema.stretchUnitsByNTimesInLines=parserState.pageSchema.stretchUnitsByNTimesInLines||[];parserState.pageSchema.stretchUnitsByNTimesInLines[unitLinePosition]=parserState.lastMentionedUnitsStretching;parserState.lastMentionedUnitsStretchingWasForSpecificLine=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll("all-units","all-units-on-line-".concat(unitLinePosition+1));var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="line-').concat(unitLinePosition+1,'">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="line-'.concat(unitLinePosition+1,'">').concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length),"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:1}}},{"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],35:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var isAboveBelowOverUnderStaveLines=require("./token/isAboveBelowOverUnderStaveLines");var isDirection=require("./token/isDirection");var direction=require("./token/direction");var directionByAboveBelowOverUnderStaveLines=require("./token/directionByAboveBelowOverUnderStaveLines");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios){scenarios["crescendo|diminuendo"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.crescendoOrDiminuendo.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);var match=regexps.crescendoOrDiminuendo.match(tokenValues);var crescendoOrDiminuendoValue=match[0];parserState.numberOfDynamicMarks+=1;parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)]={key:"crescendo-or-diminuendo-".concat(parserState.numberOfDynamicMarks),type:crescendoOrDiminuendoValue,direction:"up",yCorrection:0};parserState["lastFinishDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)]={key:"crescendo-or-diminuendo-".concat(parserState.numberOfDynamicMarks),finish:true};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crescendoOrDiminuendoHighlight,function(match){return'<span class="eh" ref-id="crescendo-or-diminuendo-'.concat(parserState.numberOfDynamicMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="crescendo-or-diminuendo-'.concat(parserState.numberOfDynamicMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},itIsNewCommandProgressionFromLevel:0,actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crescendoOrDiminuendoHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["crescendo|diminuendo starts"]={requiredCommandProgression:"crescendo|diminuendo",prohibitedCommandProgressions:["crescendo|diminuendo starts"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var nextTokenIsNotFrom=!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)]);var nextTokenIsNotWith=!regexps.with.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)]);return regexps.startsWithTextValue.test(tokenValues)&&nextTokenIsNotFrom||regexps.startsWithTextValueFrom.test(tokenValues)||(regexps.starts.test(tokenValues)&&nextTokenIsNotFrom||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues))&&nextTokenIsNotWith},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(regexps.startsWithTextValue.test(tokenValues)){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].valueBefore=regexps.startsWithTextValue.match(tokenValues)[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="crescendo-or-diminuendo-value-before-'.concat(parserState.numberOfDynamicMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="crescendo-or-diminuendo-value-before-'.concat(parserState.numberOfDynamicMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}}else if(regexps.startsWithTextValueFrom.test(tokenValues)){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].valueBefore=regexps.startsWithTextValueFrom.match(tokenValues)[0];if(parserState.applyHighlighting){var _joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="crescendo-or-diminuendo-value-before-'.concat(parserState.numberOfDynamicMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(_joinedTokenValuesWithRealDelimitersWithHighlightedString));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}else{if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.dynamicChangeMark=parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)]}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"crescendo|diminuendo starts",2,{measure:true});scenarios["crescendo|diminuendo finishes"]={requiredCommandProgression:"crescendo|diminuendo",prohibitedCommandProgressions:["crescendo|diminuendo finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishesWithTextValue.test(tokenValues)||regexps.finishes.test(tokenValues)&&!regexps.with.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.to.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(regexps.finishesWithTextValue.test(tokenValues)){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].valueAfter=regexps.finishesWithTextValue.match(tokenValues)[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="crescendo-or-diminuendo-value-after-'.concat(parserState.numberOfDynamicMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="crescendo-or-diminuendo-value-after-'.concat(parserState.numberOfDynamicMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString))}}else{if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.dynamicChangeMark=parserState["lastFinishDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)]}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"crescendo|diminuendo finishes",2,{measure:true});scenarios["crescendo|diminuendo direction"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].direction=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["crescendo|diminuendo above or below stave"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnderStaveLines(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].direction=directionByAboveBelowOverUnderStaveLines(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["crescendo|diminuendo vertical correction"]={requiredCommandProgression:"crescendo|diminuendo",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartDynamicChangeMark-".concat(parserState.numberOfDynamicMarks)].yCorrection=verticalCorrection(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="crescendo-or-diminuendo-'.concat(parserState.numberOfDynamicMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="crescendo-or-diminuendo-'.concat(parserState.numberOfDynamicMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};addLineMeasureStaveVoicePositionScenarios(scenarios,"crescendo|diminuendo",["crescendo|diminuendo starts","crescendo|diminuendo finishes"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/direction":137,"./token/directionByAboveBelowOverUnderStaveLines":139,"./token/foundNextTokenValueOnTheLine":140,"./token/isAboveBelowOverUnderStaveLines":144,"./token/isDirection":145,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],36:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastCrossStaveConnectionParam=require("./page-schema/lastCrossStaveConnectionParam");var staveIndexByTokens=require("./token/staveIndexByTokens");var isStaveIndex=require("./token/isStaveIndex");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var theSameScenarioButWithDifferentRequiredCommandProgression=require("./theSameScenarioButWithDifferentRequiredCommandProgression");module.exports=function(scenarios){scenarios["bracket or brace"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.firstOnTheLine&&regexps.crossStaveConnection.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"connectionsParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.connectionsParams=lastMeasureParamsValue.connectionsParams||[];parserState.lastCrossStaveConnectionsParamsForEachLine=parserState.lastCrossStaveConnectionsParamsForEachLine||[];var connectionName=currentToken.value;lastMeasureParamsValue.connectionsParams.push({name:connectionName,staveStartNumber:0,staveEndNumber:0});var numberOfMeasures=parserState.pageSchema.measuresParams.length;var numberOfConnections=lastMeasureParamsValue.connectionsParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crossStaveConnectionHighlight,function(match){return'<span class="eh" ref-id="cross-stave-connection-'.concat(numberOfMeasures,"-").concat(numberOfConnections,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="cross-stave-connection-'.concat(numberOfMeasures,"-").concat(numberOfConnections,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crossStaveConnectionHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection for"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.for.test(tokenValues)&&!regexps.forEach.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])&&!regexps.forLines.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection from"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.from.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection for stave index"]={requiredCommandProgression:"connection for",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var staveIndex=staveIndexByTokens(tokenValues,true);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastCrossStaveConnectionParamValue=lastCrossStaveConnectionParam(lastMeasureParamsValue);var indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex=lastMeasureParamsValue.connectionsParams.findIndex(function(param){return param.staveStartNumber===staveIndex||param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex!==-1&&indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex!==lastMeasureParamsValue.connectionsParams.length-1){lastMeasureParamsValue.connectionsParams.splice(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex,1)}var indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex=parserState.lastCrossStaveConnectionsParamsForEachLine.findIndex(function(param){return param.staveStartNumber===staveIndex||param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex!==-1){parserState.lastCrossStaveConnectionsParamsForEachLine.splice(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex,1)}lastCrossStaveConnectionParamValue.staveStartNumber=staveIndex;lastCrossStaveConnectionParamValue.staveEndNumber=staveIndex;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replace('ref-id=""','ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection from stave index"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["connection for stave index"],"connection from");scenarios["connection to"]={requiredCommandProgression:"bracket or brace",prohibitedCommandProgressions:["connection for each line","connection for lines below"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.to.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection to stave index"]={requiredCommandProgression:"connection to",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var staveIndex=staveIndexByTokens(tokenValues,true);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastCrossStaveConnectionParamValue=lastCrossStaveConnectionParam(lastMeasureParamsValue);var indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex=lastMeasureParamsValue.connectionsParams.findIndex(function(param){return param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex!==-1&&indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex!==lastMeasureParamsValue.connectionsParams.length-1){lastMeasureParamsValue.connectionsParams.splice(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastMeasureForThisStaveIndex,1)}var indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex=parserState.lastCrossStaveConnectionsParamsForEachLine.findIndex(function(param){return param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex!==-1){parserState.lastCrossStaveConnectionsParamsForEachLine.splice(indexOfIfThereIsAlreadyCrossStaveConnectionParamValueInLastCrossStaveConnectionsParamsForEachLineForThisStaveIndex,1)}lastCrossStaveConnectionParamValue.staveEndNumber=staveIndex;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replace('ref-id=""','ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["connection for each line"]={requiredCommandProgression:"bracket or brace",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forEachLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastCrossStaveConnectionsParamValue=lastCrossStaveConnectionParam(lastMeasureParamsValue);lastCrossStaveConnectionsParamValue.forEachLineId=parserState.lastCrossStaveConnectionsParamsForEachLineId;parserState.lastCrossStaveConnectionsParamsForEachLine.push(lastCrossStaveConnectionsParamValue);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph" ref-id="cross-stave-connection-for-each-line-'.concat(parserState.lastCrossStaveConnectionsParamsForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="cross-stave-connection-for-each-line-'.concat(parserState.lastCrossStaveConnectionsParamsForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastCrossStaveConnectionsParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["connection for lines below"]={requiredCommandProgression:"bracket or brace",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forLinesBelow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastCrossStaveConnectionsParamValue=lastCrossStaveConnectionParam(lastMeasureParamsValue);lastCrossStaveConnectionsParamValue.forEachLineId=parserState.lastCrossStaveConnectionsParamsForEachLineId;parserState.lastCrossStaveConnectionsParamsForEachLine.push(lastCrossStaveConnectionsParamValue);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph" ref-id="cross-stave-connection-for-each-line-'.concat(parserState.lastCrossStaveConnectionsParamsForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="cross-stave-connection-for-each-line-'.concat(parserState.lastCrossStaveConnectionsParamsForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastCrossStaveConnectionsParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastCrossStaveConnectionParam":84,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./theSameScenarioButWithDifferentRequiredCommandProgression":136,"./token/foundNextTokenValueOnTheLine":140,"./token/isStaveIndex":152,"./token/staveIndexByTokens":160}],37:[function(require,module,exports){"use strict";module.exports=function(scenarios){scenarios["empty line in general"]={prohibitedCommandProgressions:["comment starts and ends with text","comment starts with text","comment text (comment starts with text)","comment text starts","comment text (comment text starts)","note"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,type:"on empty line",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return true},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:0}}},{}],38:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var isDirection=require("./token/isDirection");var direction=require("./token/direction");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios){scenarios["glissando"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.glissando.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);parserState.numberOfGlissandos+=1;parserState.lastDeclaredGlissando=undefined;parserState.lastGlissandoDirection=undefined;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.glissandoHighlight,function(match){return'<span class="eh" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.glissandoHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["glissando starts before unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando starts before unit","glissando starts at unit","glissando finishes at unit","glissando finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.startsBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(scenarios["glissando starts before unit"].lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(scenarios["glissando starts before unit"].lineNumber))}else{if(parserState.lastDeclaredGlissando!==undefined){parserState.numberOfGlissandos+=1;parserState.lastDeclaredGlissando=undefined;parserState.lastGlissandoDirection=undefined;parserState.lastGlissandoForm=undefined}var glissandoMarkKey="glissando-".concat(parserState.numberOfGlissandos);chordParamsValue.glissandoMarks=chordParamsValue.glissandoMarks||[];var glissandoMark={key:glissandoMarkKey,before:true};if(parserState.lastGlissandoDirection){glissandoMark.direction=parserState.lastGlissandoDirection}if(parserState.lastGlissandoForm){glissandoMark.form=parserState.lastGlissandoForm}chordParamsValue.glissandoMarks.push(glissandoMark);parserState.lastDeclaredGlissando=glissandoMark}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"glissando starts before unit",2,{measure:true,stave:true});scenarios["glissando finishes after unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando finishes after unit","glissando finishes at unit","glissando starts at unit","glissando starts before unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishesAfter.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.glissandoMarks=chordParamsValue.glissandoMarks||[];var glissandoMarkKey="glissando-".concat(parserState.numberOfGlissandos);var glissandoMark={key:glissandoMarkKey,after:true};if(parserState.lastGlissandoDirection){glissandoMark.direction=parserState.lastGlissandoDirection}if(parserState.lastGlissandoForm){glissandoMark.form=parserState.lastGlissandoForm}chordParamsValue.glissandoMarks.push(glissandoMark);parserState.lastDeclaredGlissando=glissandoMark}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"glissando finishes after unit",2,{measure:true,stave:true});scenarios["glissando starts at unit"]={requiredCommandProgression:"glissando",prohibitedCommandProgressions:["glissando starts at unit","glissando before at unit","glissando finishes at unit","glissando finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues))&&!regexps.startsBefore.test(tokenValues)&&!regexps.before.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.glissandoMarks=chordParamsValue.glissandoMarks||[];var glissandoMarkKey="glissando-".concat(parserState.numberOfGlissandos);var glissandoMark={key:glissandoMarkKey};if(parserState.lastGlissandoDirection){glissandoMark.direction=parserState.lastGlissandoDirection}if(parserState.lastGlissandoForm){glissandoMark.form=parserState.lastGlissandoForm}chordParamsValue.glissandoMarks.push(glissandoMark);parserState.lastDeclaredGlissando=glissandoMark}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"glissando starts at unit",2,{measure:true,stave:true});scenarios["glissando finishes at unit"]={requiredCommandProgression:"glissando starts at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.finishes.test(tokenValues)||regexps.to.test(tokenValues))&&!regexps.finishesAfter.test(tokenValues)&&!regexps.after.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.glissandoMarks=chordParamsValue.glissandoMarks||[];var glissandoMarkKey="glissando-".concat(parserState.numberOfGlissandos);var glissandoMark={key:glissandoMarkKey};if(parserState.lastGlissandoDirection){glissandoMark.direction=parserState.lastGlissandoDirection}if(parserState.lastGlissandoForm){glissandoMark.form=parserState.lastGlissandoForm}chordParamsValue.glissandoMarks.push(glissandoMark);parserState.lastDeclaredGlissando=glissandoMark}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"glissando finishes at unit",2,{measure:true,stave:true});scenarios["glissando direction"]={requiredCommandProgression:"glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var glissandoDirection=direction(tokenValues);if(parserState.lastDeclaredGlissando){parserState.lastDeclaredGlissando.direction=glissandoDirection}parserState.lastGlissandoDirection=glissandoDirection;parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["glissando form"]={requiredCommandProgression:"glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.asWaveLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var glissandoForm=regexps.asWaveLine.match(tokenValues)[0];if(parserState.lastDeclaredGlissando){parserState.lastDeclaredGlissando.form=glissandoForm}parserState.lastGlissandoForm=glissandoForm;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.asWaveLineHighlight,function(match){return'<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.asWaveLineHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};addLineMeasureStaveVoicePositionScenarios(scenarios,"glissando",["glissando starts before unit","glissando finishes after unit","glissando starts at unit","glissando finishes at unit"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/direction":137,"./token/foundNextTokenValueOnTheLine":140,"./token/isDirection":145}],39:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["hide the last measure on a page"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.hideLastMeasure.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.pageSchema.hideLastMeasure=true;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lastMeasureHighlight,function(match){return'<span class="cmph" ref-id="last-measure-on-page">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="last-measure-on-page">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lastMeasureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0}}},{"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],40:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastInstrumentTitleParam=require("./page-schema/lastInstrumentTitleParam");var staveIndexByTokens=require("./token/staveIndexByTokens");var isStaveIndex=require("./token/isStaveIndex");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var foundNextTokenValuesOnTheLine=require("./token/foundNextTokenValuesOnTheLine");var theSameScenarioButWithDifferentRequiredCommandProgression=require("./theSameScenarioButWithDifferentRequiredCommandProgression");module.exports=function(scenarios){scenarios["instrument title"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.instrumentTitle.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"instrumentTitlesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.instrumentTitlesParams=lastMeasureParamsValue.instrumentTitlesParams||[];parserState.lastInstrumentTitlesParamsForEachLine=parserState.lastInstrumentTitlesParamsForEachLine||[];var instrumentTitle=regexps.instrumentTitle.match(tokenValues)[0];lastMeasureParamsValue.instrumentTitlesParams.push({value:instrumentTitle,staveNumber:0,staveStartNumber:0,staveEndNumber:0});var numberOfMeasures=parserState.pageSchema.measuresParams.length;var numberOfInstrumentTitles=lastMeasureParamsValue.instrumentTitlesParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="instrument-title-'.concat(numberOfMeasures,"-").concat(numberOfInstrumentTitles,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.instrumentTitleHighlight,function(match){return'<span class="eh" ref-id="instrument-title-'.concat(numberOfMeasures,"-").concat(numberOfInstrumentTitles,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="instrument-title-'.concat(numberOfMeasures,"-").concat(numberOfInstrumentTitles,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.instrumentTitleHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title for"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:true,prohibitedCommandProgressions:["instrument title for each line","instrument title for lines below"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.for.test(tokenValues)&&!regexps.forEach.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])&&!regexps.forLines.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])&&!regexps.forLinesBelow.test([currentToken.value,foundNextTokenValuesOnTheLine(unitext,currentToken.firstCharIndexOfNextToken,2)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title between"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:true,prohibitedCommandProgressions:["instrument title for each line","instrument title for lines below"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.between.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},itIsNewCommandProgressionFromLevel:1,actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title for stave index"]={requiredCommandProgression:"instrument title for",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var staveIndex=staveIndexByTokens(tokenValues,true);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastInstrumentTitleParamValue=lastInstrumentTitleParam(lastMeasureParamsValue);var indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex=lastMeasureParamsValue.instrumentTitlesParams.findIndex(function(param){return param.staveStartNumber===staveIndex||param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex!==-1&&indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex!==lastMeasureParamsValue.instrumentTitlesParams.length-1){lastMeasureParamsValue.instrumentTitlesParams.splice(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex,1)}var indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex=parserState.lastInstrumentTitlesParamsForEachLine.findIndex(function(param){return param.staveStartNumber===staveIndex||param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex!==-1){parserState.lastInstrumentTitlesParamsForEachLine.splice(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex,1)}lastInstrumentTitleParamValue.staveNumber=staveIndex;lastInstrumentTitleParamValue.staveStartNumber=staveIndex;lastInstrumentTitleParamValue.staveEndNumber=staveIndex;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replace('ref-id=""','ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title between stave index 1"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["instrument title for stave index"],"instrument title between");scenarios["instrument title between stave index 1 followed by and"]={requiredCommandProgression:"instrument title between stave index 1",onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.and.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title between stave index 2"]={requiredCommandProgression:"instrument title between stave index 1 followed by and",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var staveIndex=staveIndexByTokens(tokenValues,true);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastInstrumentTitleParamValue=lastInstrumentTitleParam(lastMeasureParamsValue);var indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex=lastMeasureParamsValue.instrumentTitlesParams.findIndex(function(param){return param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex!==-1&&indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex!==lastMeasureParamsValue.instrumentTitlesParams.length-1){lastMeasureParamsValue.instrumentTitlesParams.splice(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastMeasureForThisStaveIndex,1)}var indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex=parserState.lastInstrumentTitlesParamsForEachLine.findIndex(function(param){return param.staveEndNumber===staveIndex});if(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex!==-1){parserState.lastInstrumentTitlesParamsForEachLine.splice(indexOfIfThereIsAlreadyInstrumentTitlesParamValueInLastInstrumentTitlesParamsForEachLineForThisStaveIndex,1)}lastInstrumentTitleParamValue.staveEndNumber=staveIndex;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2].replace('ref-id=""','ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'"'));parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replace('ref-id=""','ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["instrument title for each line"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forEachLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastInstrumentTitlesParamValue=lastInstrumentTitleParam(lastMeasureParamsValue);lastInstrumentTitlesParamValue.forEachLineId=parserState.lastInstrumentTitlesParamsForEachLineId;parserState.lastInstrumentTitlesParamsForEachLine.push(lastInstrumentTitlesParamValue);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph" ref-id="instrument-title-for-each-line-'.concat(parserState.lastInstrumentTitlesParamsForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="instrument-title-for-each-line-'.concat(parserState.lastInstrumentTitlesParamsForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastInstrumentTitlesParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["instrument title for lines below"]={requiredCommandProgression:"instrument title",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forLinesBelow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastInstrumentTitlesParamValue=lastInstrumentTitleParam(lastMeasureParamsValue);lastInstrumentTitlesParamValue.forEachLineId=parserState.lastInstrumentTitlesParamsForEachLineId;parserState.lastInstrumentTitlesParamsForEachLine.push(lastInstrumentTitlesParamValue);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph" ref-id="instrument-title-for-each-line-'.concat(parserState.lastInstrumentTitlesParamsForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="instrument-title-for-each-line-'.concat(parserState.lastInstrumentTitlesParamsForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastInstrumentTitlesParamsForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastInstrumentTitleParam":86,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./theSameScenarioButWithDifferentRequiredCommandProgression":136,"./token/foundNextTokenValueOnTheLine":140,"./token/foundNextTokenValuesOnTheLine":141,"./token/isStaveIndex":152,"./token/staveIndexByTokens":160}],41:[function(require,module,exports){"use strict";var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var keySignatureThatUserMeant=require("./page-schema/keySignatureThatUserMeant");module.exports=function(scenarios){scenarios["key signature"]={condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.keySignature.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"keySignatureName",parserState);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh" ref-id="key-signature-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0};scenarios["key signature name"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.keySignatureName.test(tokenValues)&&!regexps.to.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var keySignatureName=regexps.keySignatureName.match(tokenValues)[0];if(parserState.lastKeySignatureName){lastMeasureParamsValue.keySignatureNameForEachLineId=undefined;parserState.lastKeySignatureName=undefined;parserState.lastKeySignatureNameForEachLineId+=1}lastMeasureParamsValue.keySignatureName=keySignatureThatUserMeant(keySignatureName);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth" ref-id="key-signature-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["key signature for each line"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forEachLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);parserState.lastKeySignatureName=lastMeasureParamsValue.keySignatureName;lastMeasureParamsValue.keySignatureNameForEachLineId=parserState.lastKeySignatureNameForEachLineId;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph" ref-id="key-signature-for-each-line-'.concat(parserState.lastKeySignatureNameForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-for-each-line-'.concat(parserState.lastKeySignatureNameForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["key signature for lines below"]={requiredCommandProgression:"key signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forLinesBelow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);parserState.lastKeySignatureName=lastMeasureParamsValue.keySignatureName;lastMeasureParamsValue.keySignatureNameForEachLineId=parserState.lastKeySignatureNameForEachLineId;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph" ref-id="key-signature-for-each-line-'.concat(parserState.lastKeySignatureNameForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-for-each-line-'.concat(parserState.lastKeySignatureNameForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/keySignatureThatUserMeant":82,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140}],42:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");module.exports=function(scenarios,requiredCommandProgression){var prohibitedCommandProgressions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var commandProgressionLevel=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2;var forConnection=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var allowedCoordinates=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{line:true,measure:true,stave:true,voice:true};if(allowedCoordinates.line){scenarios["line position (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.unitLinePosition.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.unitLinePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionPageLinePosition=unitLinePosition}parserState.lastMentionedPageLinePosition=unitLinePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};scenarios["position of line (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.linePositionOfUnit.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitLinePosition=regexps.linePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionPageLinePosition=unitLinePosition}parserState.lastMentionedPageLinePosition=unitLinePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="clpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="clph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel}}if(allowedCoordinates.measure){scenarios["measure position (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.unitMeasurePosition.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitMeasurePosition=regexps.unitMeasurePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionMeasurePosition=unitMeasurePosition}parserState.lastMentionedMeasurePosition=unitMeasurePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cmph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cmpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cmph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};scenarios["position of measure (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.measurePositionOfUnit.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitMeasurePosition=regexps.measurePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionMeasurePosition=unitMeasurePosition}parserState.lastMentionedMeasurePosition=unitMeasurePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cmph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cmpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cmph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel}}if(allowedCoordinates.stave){scenarios["stave position (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.unitStavePosition.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitStavePosition=regexps.unitStavePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionStavePosition=unitStavePosition}parserState.lastMentionedStavePosition=unitStavePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="csph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cspph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="csph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};scenarios["position of stave (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.stavePositionOfUnit.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitStavePosition=regexps.stavePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionStavePosition=unitStavePosition}parserState.lastMentionedStavePosition=unitStavePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="csph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cspph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="csph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel}}if(allowedCoordinates.voice){scenarios["voice position (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.unitVoicePosition.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitVoicePosition=regexps.unitVoicePosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionVoicePosition=unitVoicePosition}parserState.lastMentionedVoicePosition=unitVoicePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cvph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cvpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cvph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};scenarios["position of voice (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,prohibitedCommandProgressions:prohibitedCommandProgressions,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(forConnection&&parserState.lastMentionedUnitPosition!==undefined){return false}var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.voicePositionOfUnit.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitVoicePosition=regexps.voicePositionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;if(forConnection){parserState.lastMentionedConnectionVoicePosition=unitVoicePosition}parserState.lastMentionedVoicePosition=unitVoicePosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cvph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cvpph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));if(forConnection){parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection.push(parserState.highlightsHtmlBuffer.length-1)}else{parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cvph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel}}}},{"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],43:[function(require,module,exports){"use strict";var staveIndexByTokens=require("./token/staveIndexByTokens");var isStaveIndex=require("./token/isStaveIndex");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["lyrics position"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.lyricsPosition.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lyricsHighlight,function(match){return'<span class="eh" ref-id="lyrics">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lyricsHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["lyrics position stave index"]={requiredCommandProgression:"lyrics position",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var staveIndex=staveIndexByTokens(tokenValues);parserState.pageSchema.lyricsUnderStaveIndex=staveIndexByTokens(tokenValues,true);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(staveIndex,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(staveIndex,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./static-objects/regexps":130,"./token/isStaveIndex":152,"./token/staveIndexByTokens":160}],44:[function(require,module,exports){"use strict";var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["measure fermata"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.fermata.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"endsWithFermata",parserState);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.fermataHighlight,function(match){return'<span class="eh" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.fermataHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.endsWithFermata=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure fermata at the end"]={requiredCommandProgression:"measure fermata",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEnd.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130}],45:[function(require,module,exports){"use strict";var isDirection=require("./token/isDirection");var direction=require("./token/direction");var isAboveBelowOverUnder=require("./token/isAboveBelowOverUnder");var directionByAboveBelowOverUnder=require("./token/directionByAboveBelowOverUnder");var regexps=require("./static-objects/regexps");var applicationOfMeasureNumbers=require("./static-objects/applicationOfMeasureNumbers");module.exports=function(scenarios){scenarios["measure numbers"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measureNumbers.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.pageSchema.showMeasureNumbers="all";parserState.pageSchema.directionOfMeasureNumbers="up";if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureNumbersHighlight,function(match){return'<span class="eh" ref-id="measure-numbers">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-numbers">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureNumbersHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["direction of measure numbers"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.pageSchema.directionOfMeasureNumbers=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["measure numbers above or below"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.pageSchema.directionOfMeasureNumbers=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="every-measure">'.concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure numbers above or below measures"]={requiredCommandProgression:"measure numbers above or below",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measures.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measuresHighlight,function(match){return'<span class="cmph" ref-id="every-measure">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="every-measure">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measuresHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["application of measure numbers"]={requiredCommandProgression:"measure numbers",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.applicationOfMeasureNumbers.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var measureNumbersApplicationName=regexps.applicationOfMeasureNumbers.match(tokenValues)[0];var measureNumbersApplication=applicationOfMeasureNumbers[measureNumbersApplicationName];parserState.pageSchema.showMeasureNumbers=measureNumbersApplication;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement;if(measureNumbersApplication==="first&last"){joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.applicationOfMeasureNumbersHighlight,function(match){return'<span class="cmph" ref-id="first-or-last-measure">'.concat(match,"</span>")})}else if(measureNumbersApplication==="first"){joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.applicationOfMeasureNumbersHighlight,function(match){return'<span class="cmph" ref-id="first-measure">'.concat(match,"</span>")})}else if(measureNumbersApplication==="last"){joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.applicationOfMeasureNumbersHighlight,function(match){return'<span class="cmph" ref-id="last-measure">'.concat(match,"</span>")})}else{joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.applicationOfMeasureNumbersHighlight,function(match){return'<span class="cmph" ref-id="every-measure">'.concat(match,"</span>")})}parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-numbers">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.applicationOfMeasureNumbersHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./static-objects/applicationOfMeasureNumbers":103,"./static-objects/regexps":130,"./token/direction":137,"./token/directionByAboveBelowOverUnder":138,"./token/isAboveBelowOverUnder":143,"./token/isDirection":145}],46:[function(require,module,exports){"use strict";var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["measure rest"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measureRest.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"isMeasureRest",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.isMeasureRest=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureRestHighlight,function(match){return'<span class="eh" ref-id="measure-rest-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-rest-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureRestHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["multi measure rest count"]={requiredCommandProgression:"measure rest",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var optionsForMeasureRest=withNumbersInsteadOfWords(tokenValues);return regexps.multiMeasureRestCount.test(optionsForMeasureRest)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var optionsForMeasureRest=withNumbersInsteadOfWords(tokenValues);var multiMeasureRestCount=regexps.multiMeasureRestCount.match(optionsForMeasureRest)[0];lastMeasureParams(parserState.pageSchema).multiMeasureRestCount="".concat(multiMeasureRestCount);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="measure-rest-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-rest-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],47:[function(require,module,exports){"use strict";var initMeasureParams=require("./page-schema/initMeasureParams");var lastMeasureParams=require("./page-schema/lastMeasureParams");var openingBarLines=require("./static-objects/openingBarLines");var closingBarLines=require("./static-objects/closingBarLines");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["measure"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var nextTokenValueOnTheLine=foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken);return currentToken.firstOnTheLine&&regexps.measure.test(tokenValues)&&!regexps.measureNumbers.test([currentToken.value,nextTokenValueOnTheLine])&&!regexps.rest.test([nextTokenValueOnTheLine])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initMeasureParams(parserState.pageSchema,parserState);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}}};scenarios["measure without start bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withoutStartBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).withoutStartBarLine=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withoutStartBarLineHighlight,function(match){return'<span class="th" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withoutStartBarLineHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["measure opens with bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.opensWithBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var openingBarLineName=regexps.opensWithBarLine.match(tokenValues)[0];var openingBarLine=openingBarLines[openingBarLineName];lastMeasureParams(parserState.pageSchema).openingBarLineName=openingBarLine;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.openingBarLineHighlight,function(match){return'<span class="eh" ref-id="opening-barline-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="opening-barline-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.openingBarLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["measure closes with bar line"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.closesWithBarLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var closingBarLineName=regexps.closesWithBarLine.match(tokenValues)[0];var closingBarLine=closingBarLines[closingBarLineName];lastMeasureParams(parserState.pageSchema).closingBarLineName=closingBarLine;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.closingBarLineHighlight,function(match){return'<span class="eh" ref-id="closing-barline-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="closing-barline-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.closingBarLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["measure with repeat sign"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withRepeatSign.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withRepeatSignHighlight,function(match){return'<span class="eh" ref-id="repeat-sign-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repeat-sign-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withRepeatSignHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);if(!lastMeasureParamsValue.repeatDotsMarkAtTheStart&&!lastMeasureParamsValue.repeatDotsMarkAtTheEnd){lastMeasureParamsValue.repeatDotsMarkAtTheStart=true;lastMeasureParamsValue.repeatDotsMarkAtTheEnd=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure with repeat sign at the start"]={requiredCommandProgression:"measure with repeat sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheStart.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).repeatDotsMarkAtTheStart=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheStartHighlight,function(match){return'<span class="th" ref-id="repeat-sign-at-the-start-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repeat-sign-at-the-start-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheStartHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["measure with repeat sign at the end"]={requiredCommandProgression:"measure with repeat sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEnd.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).repeatDotsMarkAtTheEnd=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th" ref-id="repeat-sign-at-the-end-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repeat-sign-at-the-end-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["measure with measure rest"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withMeasureRest.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).isMeasureRest=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureRestHighlight,function(match){return'<span class="eh" ref-id="measure-rest-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-rest-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureRestHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure with multi measure rest count"]={requiredCommandProgression:"measure with measure rest",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var optionsForMeasureRest=withNumbersInsteadOfWords(tokenValues);return regexps.multiMeasureRestCount.test(optionsForMeasureRest)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var optionsForMeasureRest=withNumbersInsteadOfWords(tokenValues);var multiMeasureRestCount=regexps.multiMeasureRestCount.match(optionsForMeasureRest)[0];lastMeasureParams(parserState.pageSchema).multiMeasureRestCount="".concat(multiMeasureRestCount);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="measure-rest-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-rest-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["measure with simile of previous measure"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measureWithSimileOfPreviousMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).similePreviousMeasureCount="1";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh" ref-id="simile-'.concat(numberOfMeasures,'">').concat(match,"</span>")}).replace(regexps.previousMeasureHighlight,function(match){return'<span class="cmph" ref-id="simile-prev-measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.previousMeasureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure with simile of two previous measures"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measureWithSimileOfTwoPreviousMeasures.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).simileTwoPreviousMeasuresCount="1";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh" ref-id="simile-'.concat(numberOfMeasures,'">').concat(match,"</span>")}).replace(regexps.twoPreviousMeasuresHighlight,function(match){return'<span class="cmph" ref-id="simile-two-prev-measures-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.twoPreviousMeasuresHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["measure with simile count for previous measure"]={requiredCommandProgression:"measure with simile of previous measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileCount.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var simileCount=regexps.simileCount.match(withNumbersInsteadOfWords(tokenValues))[0];lastMeasureParams(parserState.pageSchema).similePreviousMeasureCount=simileCount;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["measure with simile count for two previous measures"]={requiredCommandProgression:"measure with simile of two previous measures",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileCount.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var simileCount=regexps.simileCount.match(withNumbersInsteadOfWords(tokenValues))[0];lastMeasureParams(parserState.pageSchema).simileTwoPreviousMeasuresCount=simileCount;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["measure ends with fermata"]={requiredCommandProgression:"measure",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.endsWithFermata.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){lastMeasureParams(parserState.pageSchema).endsWithFermata=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.fermataHighlight,function(match){return'<span class="eh" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-fermata-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.fermataHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initMeasureParams":78,"./page-schema/lastMeasureParams":89,"./static-objects/closingBarLines":113,"./static-objects/openingBarLines":125,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140,"./token/withNumbersInsteadOfWords":164}],48:[function(require,module,exports){"use strict";var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["simile of previous measure"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileOfPreviousMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"similePreviousMeasureCount",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.similePreviousMeasureCount="1";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh" ref-id="simile-'.concat(numberOfMeasures,'">').concat(match,"</span>")}).replace(regexps.previousMeasureHighlight,function(match){return'<span class="cmph" ref-id="simile-prev-measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.previousMeasureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["simile of two previous measures"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileOfTwoPreviousMeasures.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"simileTwoPreviousMeasuresCount",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.simileTwoPreviousMeasuresCount="1";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh" ref-id="simile-'.concat(numberOfMeasures,'">').concat(match,"</span>")}).replace(regexps.twoPreviousMeasuresHighlight,function(match){return'<span class="cmph" ref-id="simile-two-prev-measures-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.simileHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.twoPreviousMeasuresHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["simile count for previous measure"]={requiredCommandProgression:"simile of previous measure",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileCount.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var simileCount=regexps.simileCount.match(withNumbersInsteadOfWords(tokenValues))[0];var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.similePreviousMeasureCount=simileCount;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)}};scenarios["simile count for two previous measures"]={requiredCommandProgression:"simile of two previous measures",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileCount.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var simileCount=regexps.simileCount.match(withNumbersInsteadOfWords(tokenValues))[0];var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.simileTwoPreviousMeasuresCount=simileCount;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-count-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.numberHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)}}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],49:[function(require,module,exports){"use strict";var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var regexps=require("./static-objects/regexps");var lastMeasureParams=require("./page-schema/lastMeasureParams");module.exports=function(scenarios){scenarios["new"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.firstOnTheLine&&regexps.new.test(tokenValues)&&regexps.line.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.newHighlight,function(match){return'<span class="clph" ref-id="">'.concat(match)});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.newHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["new line"]={requiredCommandProgression:"new",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.lastOnTheLine&&regexps.line.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.pageSchema.measuresParams=parserState.pageSchema.measuresParams||[];parserState.numberOfPageLines+=1;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);if(lastMeasureParamsValue){lastMeasureParamsValue.isLastMeasureOnPageLine=true}parserState.pageSchema.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:parserState.numberOfPageLines});parserState.newlineAlreadyIntroducedNewMeasure=true;var updatedLastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);if(parserState.lastCrossStaveConnectionsParamsForEachLine){updatedLastMeasureParamsValue.connectionsParams=JSON.parse(JSON.stringify(parserState.lastCrossStaveConnectionsParamsForEachLine))}if(parserState.lastInstrumentTitlesParamsForEachLine){updatedLastMeasureParamsValue.instrumentTitlesParams=JSON.parse(JSON.stringify(parserState.lastInstrumentTitlesParamsForEachLine))}if(parserState.lastKeySignatureName){updatedLastMeasureParamsValue.keySignatureName=parserState.lastKeySignatureName;updatedLastMeasureParamsValue.keySignatureNameForEachLineId=parserState.lastKeySignatureNameForEachLineId}if(parserState.lastTimeSignatureParams){updatedLastMeasureParamsValue.timeSignatureParams=parserState.lastTimeSignatureParams}parserState.lastBeamStatus={};if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="line-'.concat(parserState.numberOfPageLines,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lineHighlight,function(match){return"".concat(match,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lineHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140}],50:[function(require,module,exports){"use strict";var NEW_LINE="\n";module.exports=function(scenarios){scenarios["command is not recognizable"]={condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.lastOnTheLine&&tokenValues.length>0},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.errors.push("command '".concat(joinedTokenValuesWithRealDelimiters,"' is not recognizable or applicable on the line ").concat(lineNumber));if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="nrch">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersSplittedInLines=joinedTokenValuesWithRealDelimiters.split(NEW_LINE);joinedTokenValuesWithRealDelimitersSplittedInLines.forEach(function(value,index){parserState.highlightsHtmlBuffer.push('<span class="nrch">'.concat(value,"</span>"));if(index<joinedTokenValuesWithRealDelimitersSplittedInLines.length-1){parserState.highlightsHtmlBuffer.push(NEW_LINE)}})},itIsNewCommandProgressionFromLevel:"last level"}}},{}],51:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var foundNextTokenValuesOnTheLine=require("./token/foundNextTokenValuesOnTheLine");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var isHorizontalCorrection=require("./token/isHorizontalCorrection");var horizontalCorrection=require("./token/horizontalCorrection");var isDirection=require("./token/isDirection");var isStaveIndex=require("./token/isStaveIndex");var direction=require("./token/direction");var staveIndexByTokens=require("./token/staveIndexByTokens");var isRoundness=require("./token/isRoundness");var roundness=require("./token/roundness");var isAboveBelowOverUnderStaveLines=require("./token/isAboveBelowOverUnderStaveLines");var isAboveBelowOverUnder=require("./token/isAboveBelowOverUnder");var directionByAboveBelowOverUnderStaveLines=require("./token/directionByAboveBelowOverUnderStaveLines");var directionByAboveBelowOverUnder=require("./token/directionByAboveBelowOverUnder");var isMeasureNumber=require("./token/isMeasureNumber");var measureNumber=require("./token/measureNumber");var isNumberOfStrokes=require("./token/isNumberOfStrokes");var numberOfStrokes=require("./token/numberOfStrokes");var isNumberOfTimes=require("./token/isNumberOfTimes");var numberOfTimes=require("./token/numberOfTimes");var restPositionNumberByRestPositionName=require("./page-schema/restPositionNumberByRestPositionName");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll=require("./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll");var initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty=require("./page-schema/initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastStaveParams=require("./page-schema/lastStaveParams");var lastVoiceParams=require("./page-schema/lastVoiceParams");var lastNonSimileChordParams=require("./page-schema/lastNonSimileChordParams");var lastNoteParams=require("./page-schema/lastNoteParams");var lastKeyParams=require("./page-schema/lastKeyParams");var lastArticulationParams=require("./page-schema/lastArticulationParams");var lastGlissandoMark=require("./page-schema/lastGlissandoMark");var lastLyric=require("./page-schema/lastLyric");var keySignatureThatUserMeant=require("./page-schema/keySignatureThatUserMeant");var noteDurations=require("./static-objects/noteDurations");var stavePositions=require("./static-objects/stavePositions");var noteKeys=require("./static-objects/noteKeys");var breathMarks=require("./static-objects/breathMarks");var clefs=require("./static-objects/clefs");var articulations=require("./static-objects/articulations");var ornamentKeys=require("./static-objects/ornamentKeys");var theSameScenarioButWithDifferentRequiredCommandProgression=require("./theSameScenarioButWithDifferentRequiredCommandProgression");var defaultChordDuration=1/4;var addSimileUnitsToPageSchema=function addSimileUnitsToPageSchema(parserState,simileMark,currentNumberOfMeasures,currentNumberOfStaves,currentNumberOfVoices,currentNumberOfUnits){for(var simileIndex=0;simileIndex<simileMark.count;simileIndex++){parserState.pageSchema.measuresParams[currentNumberOfMeasures-1].stavesParams[currentNumberOfStaves-1].voicesParams[currentNumberOfVoices-1].splice(currentNumberOfUnits-1+simileIndex+1,0,{notes:[{positionNumber:(simileMark.yCorrection||0)+2}],isSimile:true,simileRefId:"simile-mark-".concat(parserState.numberOfSimileMarks),simileCountDown:simileMark.count-simileIndex,simileYCorrection:simileMark.yCorrection})}};var CLEF="clef";var NOTE="note";module.exports=function(scenarios){scenarios["note"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var itIsNote=(regexps.noteWithDurationAndOctave.test(tokenValues)||regexps.rest.test(tokenValues)&&currentToken.firstOnTheLine||regexps.topMidBottomRest.test(tokenValues))&&foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)!==CLEF&&(progressionOfCommandsFromScenarios.indexOf(NOTE)!==-1||currentToken.isOnNewLine);return itIsNote},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll(lastMeasureParamsValue,"voicesParams",parserState);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty(lastStaveParamsValue,"notes");var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var chordScopeIsNotActive=!parserState.chordScopeIsActive;if(chordScopeIsNotActive){lastVoiceParamsValue.push({});var _currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var _currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(parserState.lastStavePosition[_currentNumberOfStaves-1]&&parserState.lastStavePosition[_currentNumberOfStaves-1][_currentNumberOfVoices-1]){parserState.lastStavePosition[_currentNumberOfStaves-1][_currentNumberOfVoices-1]=undefined}}var itIsNote=regexps.noteWithDurationAndOctave.test(tokenValues);var itIsRest=regexps.rest.test(tokenValues)&&currentToken.firstOnTheLine||regexps.topMidBottomRest.test(tokenValues);var noteDuration;var noteName;var octaveNumber;var positionNumber;if(itIsNote){var match=regexps.noteWithDurationAndOctave.match(tokenValues);if(match[0]){noteDuration=noteDurations[match[0]]}if(match[1]){noteName=match[1]}if(match[2]){octaveNumber=match[2]}}else if(itIsRest){var _lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(_lastChordParamsValue.notes&&_lastChordParamsValue.notes.length>0){parserState.chordScopeIsActive=false;lastVoiceParamsValue.push({})}var _match=regexps.topMidBottomRest.match(tokenValues);noteDuration=noteDurations[_match[0]];positionNumber=restPositionNumberByRestPositionName(_match[1])}var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;parserState.numberOfUnitsBeforeFinishingDeclaringNewOne=currentNumberOfUnits;var noteParams={noteName:noteName,octaveNumber:octaveNumber,positionNumber:positionNumber};var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.notes=lastChordParamsValue.notes||[];lastChordParamsValue.notes.push(noteParams);var currentNumberOfNotes=lastChordParamsValue.notes.length;noteParams.id=currentNumberOfNotes-1;var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);if(itIsRest){lastChordParamsValue.isRest=true}if(noteDuration){lastChordParamsValue.unitDuration=noteDuration;if(!parserState.lastChordDuration[currentNumberOfStaves-1]){parserState.lastChordDuration[currentNumberOfStaves-1]={}}parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]=noteDuration}else if(parserState.lastChordDuration[currentNumberOfStaves-1]&&parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]){lastChordParamsValue.unitDuration=parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]}else{lastChordParamsValue.unitDuration=defaultChordDuration;if(!parserState.lastChordDuration[currentNumberOfStaves-1]){parserState.lastChordDuration[currentNumberOfStaves-1]={}}parserState.lastChordDuration[currentNumberOfStaves-1][currentNumberOfVoices-1]=noteDuration}parserState.keysOfLastNote=[];if(parserState.lastStemDirection[currentNumberOfStaves-1]&&parserState.lastStemDirection[currentNumberOfStaves-1][currentNumberOfVoices-1]){lastChordParamsValue.stemDirection=parserState.lastStemDirection[currentNumberOfStaves-1][currentNumberOfVoices-1]}else{if(currentNumberOfVoices===1){lastChordParamsValue.stemDirection="up"}else{lastChordParamsValue.stemDirection="down"}}if(parserState.lastStavePosition[currentNumberOfStaves-1]&&parserState.lastStavePosition[currentNumberOfStaves-1][currentNumberOfVoices-1]){lastNoteParamsValue.stave=parserState.lastStavePosition[currentNumberOfStaves-1][currentNumberOfVoices-1]}if(parserState.lastGhostStatus[currentNumberOfStaves-1]&&parserState.lastGhostStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]){lastNoteParamsValue.isGhost=true}if(parserState.applyHighlighting){var elementHighlightRegexp;if(regexps.noteWithDurationAndOctave.test(tokenValues)){elementHighlightRegexp=regexps.noteWithDurationAndOctaveHighlight}else if(regexps.topMidBottomRest.test(tokenValues)){elementHighlightRegexp=regexps.topMidBottomRestHighlight}var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(elementHighlightRegexp,function(match){return'<span class="cuph" ref-id="">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement));parserState.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var elementHighlightRegexp;if(regexps.noteWithDurationAndOctave.test(tokenValues)){elementHighlightRegexp=regexps.noteWithDurationAndOctaveHighlight}else if(regexps.topMidBottomRest.test(tokenValues)){elementHighlightRegexp=regexps.topMidBottomRestHighlight}var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(elementHighlightRegexp,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfNotes=lastChordParamsValue.notes.length;var indexInHighlightsHtmlBufferWithLastNoteDecalration=parserState.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord[parserState.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length-1];if(lastChordParamsValue.isRest){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[indexInHighlightsHtmlBufferWithLastNoteDecalration]=parserState.highlightsHtmlBuffer[indexInHighlightsHtmlBufferWithLastNoteDecalration].replaceAll('ref-id=""','ref-id="rest-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'"'))}}else{if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[indexInHighlightsHtmlBufferWithLastNoteDecalration]=parserState.highlightsHtmlBuffer[indexInHighlightsHtmlBufferWithLastNoteDecalration].replaceAll('ref-id=""','ref-id="note-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNotes,'"'))}}if(!parserState.lastBeamStatus[currentNumberOfStaves-1]){parserState.lastBeamStatus[currentNumberOfStaves-1]={}}if(!parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]={plain:false,grace:false}}if(lastChordParamsValue.unitDuration>=1/4){lastChordParamsValue.beamedWithNext=false}if(lastChordParamsValue.beamedWithNext===false&&parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]=false;parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=false}if(lastChordParamsValue.beamedWithNext===false&&parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=false}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=false}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]&&!lastChordParamsValue.isGrace){lastChordParamsValue.beamedWithNext=true}if(parserState.lastBeamStatus[currentNumberOfStaves-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]&&parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]&&lastChordParamsValue.isGrace){lastChordParamsValue.beamedWithNext=true}if(lastChordParamsValue.beamedWithNext===true&&!lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["plain"]=true}if(lastChordParamsValue.beamedWithNext===true&&lastChordParamsValue.isGrace){parserState.lastBeamStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]["grace"]=true}parserState.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length=0;parserState.indexesInHighlightsHtmlBufferWithNotesDeclarationsOfLastChord.length=0;if(scenarioNameThatChangedCommandsProgression!==NOTE){parserState.chordScopeIsActive=false}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["empty line after note"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,type:"on empty line",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return true},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.chordScopeIsActive=false;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;if(parserState.lastStavePosition[currentNumberOfStaves-1]&&parserState.lastStavePosition[currentNumberOfStaves-1][currentNumberOfVoices-1]){parserState.lastStavePosition[currentNumberOfStaves-1][currentNumberOfVoices-1]=undefined}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:0};scenarios["note stem direction"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.stemDirection.test(tokenValues)||regexps.directionOfStem.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var firstCommandVariation=regexps.stemDirection.match(tokenValues);var secondCommandVariation=regexps.directionOfStem.match(tokenValues);var stemDirection=(firstCommandVariation||secondCommandVariation)[0];var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.stemDirection=stemDirection;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=lastVoiceParamsValue.length;if(!parserState.lastStemDirection[currentNumberOfStaves-1]){parserState.lastStemDirection[currentNumberOfStaves-1]={}}parserState.lastStemDirection[currentNumberOfStaves-1][currentNumberOfVoices-1]=stemDirection;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stemHighlight,function(match){return'<span class="eh" ref-id="stem-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stem-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stemHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note stave position"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.stavePosition.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var stavePositionName=regexps.stavePosition.match(tokenValues)[0];var stavePosition=stavePositions[stavePositionName];var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);lastNoteParamsValue.stave=stavePosition;parserState.keysOfLastNote.forEach(function(keyParams){keyParams.stave=stavePosition});var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var stavePositionInRefId=currentNumberOfStaves;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stavePositionHighlight,function(match){if(stavePositionName==="next"){stavePositionInRefId=currentNumberOfStaves+1}else if(stavePositionName==="prev"){stavePositionInRefId=currentNumberOfStaves-1}return'<span class="csph" ref-id="stave-'.concat(currentNumberOfMeasures,"-").concat(stavePositionInRefId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(currentNumberOfMeasures,"-").concat(stavePositionInRefId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stavePositionHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note with number of dots"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withNumberOfDots.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var numberOfDots=regexps.withNumberOfDots.match(withNumbersInsteadOfWords(tokenValues))[0]*1;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.numberOfDots=numberOfDots;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNumberOfDotsHighlight,function(match,p1,p2){return"".concat(p1,'<span class="eh" ref-id="dots-').concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(p2,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="dots-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNumberOfDotsHighlight,function(match,p1,p2){return"".concat(p1,'<span class="eh">').concat(p2,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["dotted note"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.dotted.test(tokenValues)||regexps.withDot.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.numberOfDots=1;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=regexps.dotted.test(tokenValues)?joinedTokenValuesWithRealDelimiters.replace(regexps.dottedHighlight,function(match){return'<span class="eh" ref-id="dots-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")}):joinedTokenValuesWithRealDelimiters.replace(regexps.withDotHighlight,function(match){return'<span class="eh" ref-id="dots-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="dots-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=regexps.dotted.test(tokenValues)?joinedTokenValuesWithRealDelimiters.replace(regexps.dottedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}):joinedTokenValuesWithRealDelimiters.replace(regexps.withDotHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note beamed"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.beamed.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;lastChordParamsValue.beamedWithNext=true;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.beamedHighlight,function(match){return'<span class="eh" ref-id="beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.beamedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note not beamed"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.notBeamed.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.beamedWithNext=false;parserState.groupScoreIsActive=false;parserState.graceGroupScoreIsActive=false;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note beamed with next"]={requiredCommandProgression:"note beamed",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withNext.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph" ref-id="next-to-unit-connected-with-beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="next-to-unit-connected-with-beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note not beamed with next"]={requiredCommandProgression:"note not beamed",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withNext.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph" ref-id="next-to-unit-not-connected-with-beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="next-to-unit-not-connected-with-beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note beamed with only primary line"]={requiredCommandProgression:"note beamed",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withOnlyPrimaryLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.beamedWithNextWithJustOneBeam=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withOnlyPrimaryLineHighlight,function(match){return'<span class="eh" ref-id="beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="beam-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withOnlyPrimaryLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with key"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["note with turn","note with mordent","note with trill"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withNoteKey.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);var noteName=lastNoteParamsValue.noteName,octaveNumber=lastNoteParamsValue.octaveNumber,positionNumber=lastNoteParamsValue.positionNumber,stave=lastNoteParamsValue.stave;lastChordParamsValue.keysParams=lastChordParamsValue.keysParams||[];var keyTypeName=regexps.withNoteKey.match(tokenValues);var keyType=noteKeys[keyTypeName];var newKeyParams={noteName:noteName,octaveNumber:octaveNumber,positionNumber:positionNumber,stave:stave,keyType:keyType};lastChordParamsValue.keysParams.push(newKeyParams);parserState.keysOfLastNote.push(newKeyParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfNoteKeys=lastChordParamsValue.keysParams.length;newKeyParams.id=currentNumberOfNoteKeys-1;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNoteKeyHighlight,function(match){return'<span class="eh" ref-id="note-key-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNoteKeys,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-key-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNoteKeys,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNoteKeyHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with key with parentheses"]={requiredCommandProgression:"note with key",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withParentheses.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastKeyParamsValue=lastKeyParams(lastChordParamsValue);lastKeyParamsValue.withParentheses=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfNoteKeys=lastChordParamsValue.keysParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh" ref-id="note-key-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNoteKeys,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-key-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNoteKeys,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note with parentheses"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["note with key"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withParentheses.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var numberOfNotes=lastChordParamsValue.notes.length;lastChordParamsValue.parentheses=lastChordParamsValue.parentheses||[];lastChordParamsValue.parentheses.push({fromNoteIndex:numberOfNotes-1,toNoteIndex:numberOfNotes-1,id:numberOfNotes-1});var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfNotes=lastChordParamsValue.notes.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh" ref-id="note-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNotes,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-parentheses-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfNotes,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withParenthesesHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note with text"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var textValue=regexps.withText.match(tokenValues)[0];parserState.lastNoteTextValue=textValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.withTextHighlight,function(match){return'<span class="eh" ref-id="">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimitersWithHighlightedString.replace(regexps.withTextHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastNoteTextPositionApplicationToNote===undefined){parserState.lastNoteTextPositionApplicationToNote=true;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);var noteName=lastNoteParamsValue.noteName,octaveNumber=lastNoteParamsValue.octaveNumber,positionNumber=lastNoteParamsValue.positionNumber,stave=lastNoteParamsValue.stave;lastChordParamsValue.keysParams=lastChordParamsValue.keysParams||[];var keyType="noteLetter";var textValue=parserState.lastNoteTextValue;var newKeyParams={noteName:noteName,octaveNumber:octaveNumber,positionNumber:positionNumber,stave:stave,keyType:keyType,textValue:textValue};lastChordParamsValue.keysParams.push(newKeyParams);newKeyParams.id=lastChordParamsValue.keysParams.length-1;parserState.keysOfLastNote.push(newKeyParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="note-key-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(newKeyParams.id+1,'"'))}}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}parserState.lastNoteTextValue=undefined;parserState.lastNoteTextPositionApplicationToNote=undefined},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with text beside"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.beside.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastNoteTextPositionApplicationToNote="beside";var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);var noteName=lastNoteParamsValue.noteName,octaveNumber=lastNoteParamsValue.octaveNumber,positionNumber=lastNoteParamsValue.positionNumber,stave=lastNoteParamsValue.stave;lastChordParamsValue.keysParams=lastChordParamsValue.keysParams||[];var keyType="noteLetter";var textValue=parserState.lastNoteTextValue;var newKeyParams={noteName:noteName,octaveNumber:octaveNumber,positionNumber:positionNumber,stave:stave,keyType:keyType,textValue:textValue};lastChordParamsValue.keysParams.push(newKeyParams);newKeyParams.id=lastChordParamsValue.keysParams.length-1;parserState.keysOfLastNote.push(newKeyParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="note-key-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(newKeyParams.id+1,'"'));parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="note-key-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(newKeyParams.id+1,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with text up or down"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastNoteTextPositionApplicationToNote="up|down";var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulationParams={name:"noteLetter",direction:direction(tokenValues),textValue:parserState.lastNoteTextValue};lastChordParamsValue.articulationParams.push(newArticulationParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'"'));parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with text above or below"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)&&!regexps.staveWithAndWithoutDelimeter.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastNoteTextPositionApplicationToNote="up|down";var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulationParams={name:"noteLetter",direction:directionByAboveBelowOverUnder(tokenValues),textValue:parserState.lastNoteTextValue};lastChordParamsValue.articulationParams.push(newArticulationParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'"'));parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with text above or below stave"]={requiredCommandProgression:"note with text",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnderStaveLines(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastNoteTextPositionApplicationToNote="up|down";var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulationParams={name:"noteLetter",direction:directionByAboveBelowOverUnderStaveLines(tokenValues),textValue:parserState.lastNoteTextValue,aboveBelowOverUnderStaveLines:true};lastChordParamsValue.articulationParams.push(newArticulationParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'"'));var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with text up or down vertical correction"]={requiredCommandProgression:"note with text up or down",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:3};scenarios["note with text above or below vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text up or down vertical correction"],"note with text above or below");scenarios["note with text above or below stave vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with text up or down vertical correction"],"note with text above or below stave");scenarios["note is tied with next"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tiedWithNext.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedWithNext={};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh" ref-id="tie-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")}).replace(regexps.withNextHighlight,function(match){return'<span class="cuph" ref-id="next-to-unit-under-tie-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.withNextHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note is tied before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tiedBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedBefore={};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh" ref-id="tie-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note is tied before measure number"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isMeasureNumber(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var measureNumberValue=measureNumber(tokenValues);lastChordParamsValue.tiedBeforeMeasure=Object.assign({index:measureNumberValue},lastChordParamsValue.tiedBefore);lastChordParamsValue.tiedBefore=undefined;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note is tied after"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tiedAfter.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedAfter={};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh" ref-id="tie-after-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-after-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tiedHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note is tied after measure number"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isMeasureNumber(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var measureNumberValue=measureNumber(tokenValues);lastChordParamsValue.tiedAfterMeasure=Object.assign({index:measureNumberValue},lastChordParamsValue.tiedAfter);lastChordParamsValue.tiedAfter=undefined;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied with next direction"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedWithNext.direction=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied with next above or below"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedWithNext.direction=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied before direction"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedBefore){lastChordParamsValue.tiedBefore.direction=direction(tokenValues)}else if(lastChordParamsValue.tiedBeforeMeasure){lastChordParamsValue.tiedBeforeMeasure.direction=direction(tokenValues)}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied before above or below"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedBefore){lastChordParamsValue.tiedBefore.direction=directionByAboveBelowOverUnder(tokenValues)}else if(lastChordParamsValue.tiedBeforeMeasure){lastChordParamsValue.tiedBeforeMeasure.direction=directionByAboveBelowOverUnder(tokenValues)}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied after direction"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedAfter){lastChordParamsValue.tiedAfter.direction=direction(tokenValues)}else if(lastChordParamsValue.tiedAfterMeasure){lastChordParamsValue.tiedAfterMeasure.direction=direction(tokenValues)}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied after above or below"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedAfter){lastChordParamsValue.tiedAfter.direction=directionByAboveBelowOverUnder(tokenValues)}else if(lastChordParamsValue.tiedAfterMeasure){lastChordParamsValue.tiedAfterMeasure.direction=directionByAboveBelowOverUnder(tokenValues)}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied with next roundness"]={requiredCommandProgression:"note is tied with next",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isRoundness(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tiedWithNext.roundCoefficientFactor=roundness(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th" ref-id="tie-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied before roundness"]={requiredCommandProgression:"note is tied before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isRoundness(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedBefore){lastChordParamsValue.tiedBefore.roundCoefficientFactor=roundness(tokenValues)}else if(lastChordParamsValue.tiedBeforeMeasure){lastChordParamsValue.tiedBeforeMeasure.roundCoefficientFactor=roundness(tokenValues)}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th" ref-id="tie-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note tied after roundness"]={requiredCommandProgression:"note is tied after",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isRoundness(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(lastChordParamsValue.tiedAfter){lastChordParamsValue.tiedAfter.roundCoefficientFactor=roundness(tokenValues)}else if(lastChordParamsValue.tiedAfterMeasure){lastChordParamsValue.tiedAfterMeasure.roundCoefficientFactor=roundness(tokenValues)}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th" ref-id="tie-after-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tie-after-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with glissando"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withGlissando.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.numberOfGlissandos+=1;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var key="glissando-".concat(parserState.numberOfGlissandos);lastChordParamsValue.glissandoMarks=lastChordParamsValue.glissandoMarks||[];lastChordParamsValue.glissandoMarks.push({key:key});if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.glissandoHighlight,function(match){return'<span class="eh" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.glissandoHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);if(lastGlissandoMarkValue&&!lastGlissandoMarkValue.after&&lastGlissandoMarkValue.afterMeasure===undefined&&!lastGlissandoMarkValue.before&&lastGlissandoMarkValue.beforeMeasure===undefined){lastGlissandoMarkValue.after=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with glissando direction"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);lastGlissandoMarkValue.direction=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with glissando after"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.after.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);lastGlissandoMarkValue.after=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with glissando before"]={requiredCommandProgression:"note with glissando",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.before.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);lastGlissandoMarkValue.before=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with glissando after measure number"]={requiredCommandProgression:"note with glissando after",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isMeasureNumber(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);var measureNumberValue=measureNumber(tokenValues);lastGlissandoMarkValue.afterMeasure=measureNumberValue;lastGlissandoMarkValue.after=false;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with glissando before measure number"]={requiredCommandProgression:"note with glissando before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isMeasureNumber(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastGlissandoMarkValue=lastGlissandoMark(lastChordParamsValue);var measureNumberValue=measureNumber(tokenValues);lastGlissandoMarkValue.beforeMeasure=measureNumberValue;lastGlissandoMarkValue.after=false;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(parserState.numberOfPageLines,"-").concat(measureNumberValue,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="glissando-'.concat(parserState.numberOfGlissandos,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureIndexHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note is rest"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isRest.test(tokenValues)&&!currentToken.firstOnTheLine},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.isRest=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.restHighlight,function(match){return'<span class="eh" ref-id="rest-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="rest-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.restHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note is ghost"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isGhost.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var chordScopeIsNotActive=!parserState.chordScopeIsActive;if(chordScopeIsNotActive){if(!parserState.lastGhostStatus[currentNumberOfStaves-1]){parserState.lastGhostStatus[currentNumberOfStaves-1]={}}parserState.lastGhostStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]=true}lastNoteParamsValue.isGhost=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["note is not ghost"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isNotGhost.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastNoteParamsValue=lastNoteParams(lastChordParamsValue);var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var chordScopeIsNotActive=!parserState.chordScopeIsActive;if(chordScopeIsNotActive){if(!parserState.lastGhostStatus[currentNumberOfStaves-1]){parserState.lastGhostStatus[currentNumberOfStaves-1]={}}parserState.lastGhostStatus[currentNumberOfStaves-1][currentNumberOfVoices-1]=false}lastNoteParamsValue.isGhost=false;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["note is grace"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isGrace.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.isGrace=true;if(regexps.isGrace.match(tokenValues)[0]){lastChordParamsValue.hasGraceCrushLine=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["note with crushed grace"]={requiredCommandProgression:"note is grace",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withCrushLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.hasGraceCrushLine=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crushLineHighlight,function(match){return'<span class="eh" ref-id="grace-crush-line-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="grace-crush-line-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.crushLineHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note is centralized"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isCentralized.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.isFullMeasure=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["note with breath mark before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withBreathMarkBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var breathMarkTypeName=regexps.withBreathMarkBefore.match(tokenValues)[0];var breathMarkType=breathMarks[breathMarkTypeName];lastChordParamsValue.breathMarkBefore={type:breathMarkType};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withBreathMarkBeforeHighlight,function(match){return'<span class="eh" ref-id="breath-mark-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="breath-mark-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withBreathMarkBeforeHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with breath mark before vertical correction"]={requiredCommandProgression:"note with breath mark before",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.breathMarkBefore.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="breath-mark-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="breath-mark-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["note with key signature before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withKeySignatureBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var keySignatureName=regexps.withKeySignatureBefore.match(tokenValues)[0];lastChordParamsValue.keySignatureBefore=keySignatureThatUserMeant(keySignatureName);if(parserState.lastKeySignatureName){parserState.lastKeySignatureName=lastChordParamsValue.keySignatureBefore;parserState.lastKeySignatureNameForEachLineId+=1}if(!lastChordParamsValue.clefBefore){lastChordParamsValue.clefBefore=parserState.lastClef[currentNumberOfStaves-1]||"treble"}if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimitersWithHighlightedElement.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimitersWithHighlightedElement.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString)},itIsNewCommandProgressionFromLevel:1};scenarios["note with clef before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withClefBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var clefName=regexps.withClefBefore.match(tokenValues)[0];var clef=clefs[clefName];lastChordParamsValue.clefBefore=clef;parserState.lastClef[currentNumberOfStaves-1]=clef;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh" ref-id="clef-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="clef-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["note with clef and key signature before"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withClefAndKeySignatureBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var match=regexps.withClefAndKeySignatureBefore.match(tokenValues);var clefName=match[0];var clef=clefs[clefName];var keySignatureName=match[1];var keySignature=keySignatureThatUserMeant(keySignatureName);lastChordParamsValue.clefBefore=clef;lastChordParamsValue.keySignatureBefore=keySignature;parserState.lastClef[currentNumberOfStaves-1]=clef;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")}).replace(regexps.clefHighlight,function(match){return'<span class="eh" ref-id="clef-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimitersWithHighlightedElement.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="key-signature-before-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.keySignatureHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.clefHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimitersWithHighlightedElement.replace(regexps.keySignatureNameHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString)},itIsNewCommandProgressionFromLevel:1};scenarios["note with articulation"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withArticulation.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var match=regexps.withArticulation.match(tokenValues);var articulationName=articulations[match[0]];lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulation={name:articulationName};lastChordParamsValue.articulationParams.push(newArticulation);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withArticulationHighlight,function(match){return'<span class="eh" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withArticulationHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with turn"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withTurn.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var articulationName="turn";lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulation={name:articulationName};lastChordParamsValue.articulationParams.push(newArticulation);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTurnHighlight,function(match){return'<span class="eh" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTurnHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with mordent"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withMordent.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var articulationName="mordent";lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulation={name:articulationName};lastChordParamsValue.articulationParams.push(newArticulation);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withMordentHighlight,function(match){return'<span class="eh" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withMordentHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with trill"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withTrill.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var articulationName="trill";lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulation={name:articulationName};lastChordParamsValue.articulationParams.push(newArticulation);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTrillHighlight,function(match){return'<span class="eh" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTrillHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with articulation direction"]={requiredCommandProgression:"note with articulation",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with turn direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation direction"],"note with turn");scenarios["note with mordent direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation direction"],"note with mordent");scenarios["note with trill direction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation direction"],"note with trill");scenarios["note with articulation above or below"]={requiredCommandProgression:"note with articulation",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)&&!regexps.staveWithAndWithoutDelimeter.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with turn above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below"],"note with turn");scenarios["note with mordent above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below"],"note with mordent");scenarios["note with trill above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below"],"note with trill");scenarios["note with articulation above or below stave"]={requiredCommandProgression:"note with articulation",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnderStaveLines(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=directionByAboveBelowOverUnderStaveLines(tokenValues);lastArticulationParamsValue.aboveBelowOverUnderStaveLines=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with turn above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below stave"],"note with turn");scenarios["note with mordent above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below stave"],"note with mordent");scenarios["note with trill above or below stave"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation above or below stave"],"note with trill");scenarios["note with turn key above or below"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withOrnamentKeyAboveBelowOverUnder.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);var match=regexps.withOrnamentKeyAboveBelowOverUnder.match(tokenValues);var ornamentKeyName=ornamentKeys[match[0]];var ornamentKeyPosition=match[1];var ornamentKeyPositionValue;if(ornamentKeyPosition==="above"||ornamentKeyPosition==="over"){lastArticulationParamsValue.keyAbove=ornamentKeyName;ornamentKeyPositionValue="above"}else if(ornamentKeyPosition==="below"||ornamentKeyPosition==="under"){lastArticulationParamsValue.keyBelow=ornamentKeyName;ornamentKeyPositionValue="below"}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.ornamentKeyHighlight,function(match){return'<span class="eh" ref-id="articulation-key-'.concat(ornamentKeyPositionValue,"-").concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-key-'.concat(ornamentKeyPositionValue,"-").concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.ornamentKeyHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with mordent key above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn key above or below"],"note with mordent");scenarios["note with trill key above or below"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn key above or below"],"note with trill");scenarios["note with turn after"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.after.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.followedAfter=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with turn inverted"]={requiredCommandProgression:"note with turn",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isInverted.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.inverted=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with mordent inverted"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with turn inverted"],"note with mordent");scenarios["note with trill with wave after"]={requiredCommandProgression:"note with trill",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withWaveAfter.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.withWave=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.waveHighlight,function(match){return'<span class="eh" ref-id="articulation-wave-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-wave-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.waveHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with articulation vertical correction"]={requiredCommandProgression:"note with articulation",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with turn vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation vertical correction"],"note with turn");scenarios["note with mordent vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation vertical correction"],"note with mordent");scenarios["note with trill vertical correction"]=theSameScenarioButWithDifferentRequiredCommandProgression(scenarios["note with articulation vertical correction"],"note with trill");scenarios["note with chord letter"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withChord.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var chordLetter=regexps.withChord.match(tokenValues)[0];lastChordParamsValue.relatedChordLetter={textValue:chordLetter};if(parserState.lastChordLetterDirection){lastChordParamsValue.relatedChordLetter.direction=parserState.lastChordLetterDirection}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.withChordHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh" ref-id="chord-letter-').concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">chord</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="chord-letter-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="chord-letter-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.withChordHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh">chord</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with chord letter direction"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.relatedChordLetter.direction=direction(tokenValues);parserState.lastChordLetterDirection=lastChordParamsValue.relatedChordLetter.direction;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with chord letter above or below"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;lastChordParamsValue.relatedChordLetter.direction=directionByAboveBelowOverUnder(tokenValues);parserState.lastChordLetterDirection=lastChordParamsValue.relatedChordLetter.direction;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="chord-letter-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with chord letter above or below measure"]={requiredCommandProgression:"note with chord letter above or below",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.measure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with chord letter vertical correction"]={requiredCommandProgression:"note with chord letter",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.relatedChordLetter.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="chord-letter-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="chord-letter-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with octave sign"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var nextTwoTokens=foundNextTokenValuesOnTheLine(unitext,currentToken.firstCharIndexOfNextToken,2);return regexps.isOctaveOrTwoOctavesHigherOrLower.test(tokenValues)&&nextTwoTokens.indexOf("from")===-1&&nextTwoTokens.indexOf("starts")===-1&&nextTwoTokens.indexOf("clef")===-1},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var match=regexps.isOctaveOrTwoOctavesHigherOrLower.match(tokenValues);var isTwoOctaves=match[0];var octaveSignMainValue=isTwoOctaves?"15":"8";var octaveSignUpperValue=isTwoOctaves?"ma":"va";var octaveSignDirection=match[1]==="up"||match[1]==="higher"?"up":"down";lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulation={name:"octaveSign",aboveBelowOverUnderStaveLines:true,direction:octaveSignDirection,textValue:octaveSignMainValue,subTextValue:octaveSignUpperValue};lastChordParamsValue.articulationParams.push(newArticulation);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.isOctaveOrTwoOctavesHigherOrLowerHighlight,function(match){return'<span class="eh" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.isOctaveOrTwoOctavesHigherOrLowerHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with octave sign vertical correction"]={requiredCommandProgression:"note with octave sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with tremolo"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withTremolo.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tremoloParams={type:"single"};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTremoloHighlight,function(match){return'<span class="eh" ref-id="tremolo-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tremolo-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withTremoloHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with tremolo with next"]={requiredCommandProgression:"note with tremolo",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withNext.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tremoloParams.type="withNext";var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph" ref-id="unit-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="unit-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNextHighlight,function(match){return'<span class="cuph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with tremolo number of strokes"]={requiredCommandProgression:"note with tremolo",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isNumberOfStrokes(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.tremoloParams.customNumberOfTremoloStrokes=numberOfStrokes(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNumberOfStrokesHighlight,function(match){return'<span class="eh" ref-id="tremolo-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tremolo-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withNumberOfStrokesHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["repeat note"]={requiredCommandProgression:"note",prohibitedCommandProgressions:["empty line after note"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.repeat.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);parserState.numberOfSimileMarks+=1;lastChordParamsValue.simileMark={refId:"simile-mark-".concat(parserState.numberOfSimileMarks),count:1,finish:true};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.repeatHighlight,function(match){return'<span class="eh" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.repeatHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;addSimileUnitsToPageSchema(parserState,lastChordParamsValue.simileMark,currentNumberOfMeasures,currentNumberOfStaves,currentNumberOfVoices,currentNumberOfUnits);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["repeat note via simile"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.viaSimile.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["repeat note number of times"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isNumberOfTimes(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.simileMark.count=numberOfTimes(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.simileCountHighlight,function(match){return'<span class="cnh" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.simileCountHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["repeat note vertical correction"]={requiredCommandProgression:"repeat note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.simileMark.yCorrection=verticalCorrection(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.simileCountHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["note with dynamic"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withDynamic.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var dynamicTextValue=regexps.withDynamic.match(tokenValues)[0];lastChordParamsValue.articulationParams=lastChordParamsValue.articulationParams||[];var newArticulationParams={name:"dynamicMark",textValue:dynamicTextValue};lastChordParamsValue.articulationParams.push(newArticulationParams);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.withDynamicHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh" ref-id="articulation-').concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">dynamic</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.withDynamicHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh">dynamic</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with dynamic above or below"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)&&!regexps.staveWithAndWithoutDelimeter.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with dynamic above or below stave"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnderStaveLines(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=directionByAboveBelowOverUnderStaveLines(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with dynamic direction"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.direction=direction(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note dynamic vertical correction"]={requiredCommandProgression:"note with dynamic",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastArticulationParamsValue=lastArticulationParams(lastChordParamsValue);lastArticulationParamsValue.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfArticulations=lastChordParamsValue.articulationParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfArticulations,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with lyrics"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withLyrics.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.relatedLyrics=lastChordParamsValue.relatedLyrics||[];lastChordParamsValue.relatedLyrics.push({});var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lyricsHighlight,function(match){return'<span class="eh" ref-id="lyrics-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.lyricsHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with lyrics text value"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.textValue.test(tokenValues,false,true)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastLyricValue=lastLyric(lastChordParamsValue);var textValue=regexps.textValue.match(tokenValues)[0];lastLyricValue.textValue=textValue;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="lyrics-text-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-text-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)}};scenarios["note with lyrics followed by dash"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.followedByDash.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastLyricValue=lastLyric(lastChordParamsValue);lastLyricValue.dashAfter=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.dashHighlight,function(match){return'<span class="eh" ref-id="lyrics-dash-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-dash-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.dashHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};scenarios["note with lyrics where underscore starts"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.underscoreStarts.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastLyricValue=lastLyric(lastChordParamsValue);lastLyricValue.underscoreStarts=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.underscoreHighlight,function(match){return'<span class="eh" ref-id="lyrics-underscore-starts-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-underscore-starts-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.underscoreHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};scenarios["note with lyrics where underscore finishes"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.underscoreFinishes.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastLyricValue=lastLyric(lastChordParamsValue);lastLyricValue.underscoreFinishes=true;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.underscoreHighlight,function(match){return'<span class="eh" ref-id="lyrics-underscore-finishes-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-underscore-finishes-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.underscoreHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};scenarios["note with lyrics with vertical correction"]={requiredCommandProgression:"note with lyrics",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var lastLyricValue=lastLyric(lastChordParamsValue);lastLyricValue.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;var currentNumberOfLyrics=lastChordParamsValue.relatedLyrics.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="lyrics-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="lyrics-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,"-").concat(currentNumberOfLyrics,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)}};scenarios["note with pedal"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withPedal.test(tokenValues)&&!regexps.release.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.numberOfPedalMarks+=1;var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark={key:"pedal-".concat(parserState.numberOfPedalMarks),textValue:"Ped.",start:true,finish:true};parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)]=lastChordParamsValue.pedalMark;if(regexps.withSustain.test(tokenValues)){lastChordParamsValue.pedalMark.withBrackets=true;lastChordParamsValue.pedalMark.finish=false}if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withPedalHighlight,function(match){return'<span class="eh" ref-id="pedal-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")}).replace(regexps.withSustainHighlight,function(match){return'<span class="eh" ref-id="pedal-line-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="pedal-'.concat(parserState.numberOfPedalMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withPedalHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")}).replace(regexps.withSustainHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with pedal under"]={requiredCommandProgression:"note with pedal",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.belowUnder.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with pedal under stave index"]={requiredCommandProgression:"note with pedal under",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isStaveIndex(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var staveIndex=staveIndexByTokens(tokenValues,true);lastChordParamsValue.pedalMark.underStaveIndex=staveIndex;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-'.concat(numberOfMeasures,"-").concat(staveIndex+1,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveIndexHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:3};scenarios["note with pedal vertical correction"]={requiredCommandProgression:"note with pedal",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.yCorrection=verticalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="pedal-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="pedal-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:2};scenarios["note with pedal text"]={requiredCommandProgression:"note with pedal",prohibitedCommandProgressions:["note with pedal opens with bracket","note with pedal before|after"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.text.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.textValue=regexps.text.match(tokenValues)[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="pedal-text-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="pedal-text-'.concat(parserState.numberOfPedalMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2};scenarios["note with pedal opens with bracket"]={requiredCommandProgression:"note with pedal",prohibitedCommandProgressions:["note with pedal text","note with pedal before|after"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.opensWithBracket.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.textValue=undefined;lastChordParamsValue.pedalMark.withBrackets=true;lastChordParamsValue.pedalMark.finish=false;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketHighlight,function(match){return'<span class="eh" ref-id="pedal-line-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="pedal-line-'.concat(parserState.numberOfPedalMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2};scenarios["note with pedal before|after"]={requiredCommandProgression:"note with pedal",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.afterBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var pedalPositionToTheChord=regexps.afterBefore.match(tokenValues)[0];if(pedalPositionToTheChord==="after"){lastChordParamsValue.pedalMark.afterUnit=true}else if(pedalPositionToTheChord==="before"){lastChordParamsValue.pedalMark.beforeUnit=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with variable peak"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withVariablePeak.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)]){parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)].finish=false;parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)].withBrackets=true}lastChordParamsValue.pedalMark={key:"pedal-".concat(parserState.numberOfPedalMarks),variablePeak:true};var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withVariablePeakHighlight,function(match){return'<span class="eh" ref-id="variable-peak-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="variable-peak-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withVariablePeakHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with variable peak before|after"]={requiredCommandProgression:"note with variable peak",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.afterBefore.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var variablePeakPositionToTheChord=regexps.afterBefore.match(tokenValues)[0];if(variablePeakPositionToTheChord==="after"){lastChordParamsValue.pedalMark.afterUnit=true}else if(variablePeakPositionToTheChord==="before"){lastChordParamsValue.pedalMark.beforeUnit=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with variable peak text"]={requiredCommandProgression:"note with variable peak",prohibitedCommandProgressions:["note with variable peak before|after"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.text.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.textValue=regexps.text.match(tokenValues)[0];var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="variable-peak-text-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="variable-peak-text-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2};scenarios["note with release"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withRelease.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);if(parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)]){parserState["lastStartPedalMark-".concat(parserState.numberOfPedalMarks)].finish=false}lastChordParamsValue.pedalMark={key:"pedal-".concat(parserState.numberOfPedalMarks),release:true,finish:true};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.withReleaseHighlight,function(match){return'<span class="eh" ref-id="release-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="release-'.concat(parserState.numberOfPedalMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.withReleaseHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["note with release before|after"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.afterBefore.test(tokenValues)&&!regexps.afterMeasure.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);var releasePositionToTheChord=regexps.afterBefore.match(tokenValues)[0];if(releasePositionToTheChord==="after"){lastChordParamsValue.pedalMark.afterUnit=true}else if(releasePositionToTheChord==="before"){lastChordParamsValue.pedalMark.beforeUnit=true}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["note with release bracket"]={requiredCommandProgression:"note with release",prohibitedCommandProgressions:["note with release before|after"],onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.bracket.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.withBrackets=true;lastChordParamsValue.pedalMark.withBracketClosure=true;lastChordParamsValue.pedalMark.release=false;lastChordParamsValue.pedalMark.finish=true;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketHighlight,function(match){return'<span class="eh" ref-id="pedal-line-'.concat(parserState.numberOfPedalMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="pedal-line-'.concat(parserState.numberOfPedalMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2};scenarios["note with release at the end of measure"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEndOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.atEndOfMeasure=true;lastChordParamsValue.pedalMark.finish=true;if(lastChordParamsValue.pedalMark.withBrackets){lastChordParamsValue.pedalMark.withBracketClosure=true;lastChordParamsValue.pedalMark.tillEndOfMeasure=true}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2};scenarios["note with release after measure"]={requiredCommandProgression:"note with release",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.afterMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.pedalMark.atEndOfMeasure=true;lastChordParamsValue.pedalMark.tillEndOfMeasure=true;lastChordParamsValue.pedalMark.release=false;lastChordParamsValue.pedalMark.withBrackets=true;lastChordParamsValue.pedalMark.withBracketClosure=false;lastChordParamsValue.pedalMark.finish=false;var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:2},scenarios["note with horizontal correction"]={requiredCommandProgression:"note",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isHorizontalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var lastVoiceParamsValue=lastVoiceParams(lastStaveParamsValue);var lastChordParamsValue=lastNonSimileChordParams(lastVoiceParamsValue);lastChordParamsValue.relatedXCorrection=horizontalCorrection(tokenValues);var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;var currentNumberOfVoices=lastStaveParamsValue.voicesParams.length;var currentNumberOfUnits=parserState.numberOfUnitsBeforeFinishingDeclaringNewOne;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.horizontalCorrectionHighlight,function(match){return'<span class="th" ref-id="unit-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="articulation-'.concat(currentNumberOfMeasures,"-").concat(currentNumberOfStaves,"-").concat(currentNumberOfVoices,"-").concat(currentNumberOfUnits,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.horizontalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll":80,"./page-schema/initNewVoiceParamsIfThereIsNoVoicesAtAllAndInitNewChordParamsIfThereIsAlreadySuchChordProperty":81,"./page-schema/keySignatureThatUserMeant":82,"./page-schema/lastArticulationParams":83,"./page-schema/lastGlissandoMark":85,"./page-schema/lastKeyParams":87,"./page-schema/lastLyric":88,"./page-schema/lastMeasureParams":89,"./page-schema/lastNonSimileChordParams":90,"./page-schema/lastNoteParams":91,"./page-schema/lastStaveParams":93,"./page-schema/lastVoiceParams":94,"./page-schema/restPositionNumberByRestPositionName":97,"./static-objects/articulations":106,"./static-objects/breathMarks":108,"./static-objects/clefs":111,"./static-objects/noteDurations":120,"./static-objects/noteKeys":122,"./static-objects/ornamentKeys":127,"./static-objects/regexps":130,"./static-objects/stavePositions":132,"./theSameScenarioButWithDifferentRequiredCommandProgression":136,"./token/direction":137,"./token/directionByAboveBelowOverUnder":138,"./token/directionByAboveBelowOverUnderStaveLines":139,"./token/foundNextTokenValueOnTheLine":140,"./token/foundNextTokenValuesOnTheLine":141,"./token/horizontalCorrection":142,"./token/isAboveBelowOverUnder":143,"./token/isAboveBelowOverUnderStaveLines":144,"./token/isDirection":145,"./token/isHorizontalCorrection":146,"./token/isMeasureNumber":147,"./token/isNumberOfStrokes":149,"./token/isNumberOfTimes":150,"./token/isRoundness":151,"./token/isStaveIndex":152,"./token/isVerticalCorrection":153,"./token/measureNumber":155,"./token/numberOfStrokes":157,"./token/numberOfTimes":158,"./token/roundness":159,"./token/staveIndexByTokens":160,"./token/verticalCorrection":163,"./token/withNumbersInsteadOfWords":164}],52:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var foundNextTokenValuesOnTheLine=require("./token/foundNextTokenValuesOnTheLine");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios){scenarios["octave sign"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var nextTwoTokens=foundNextTokenValuesOnTheLine(unitext,currentToken.firstCharIndexOfNextToken,2);return regexps.octaveOrTwoOctavesHigherOrLower.test(tokenValues)&&nextTwoTokens.indexOf("clef")===-1},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);var match=regexps.octaveOrTwoOctavesHigherOrLower.match(tokenValues);var isTwoOctaves=match[0];var octaveSignMainValue=isTwoOctaves?"15":"8";var octaveSignUpperValue=isTwoOctaves?"ma":"va";var octaveSignDirection=match[1]==="up"||match[1]==="higher"?"up":"down";parserState.numberOfOctaveSignMarks+=1;parserState["lastStartOctaveSignMark-".concat(parserState.numberOfOctaveSignMarks)]={key:"octave-sign-".concat(parserState.numberOfOctaveSignMarks),octaveNumber:octaveSignMainValue,octavePostfix:octaveSignUpperValue,yCorrection:0,direction:octaveSignDirection};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.isOctaveOrTwoOctavesHigherOrLowerHighlight,function(match){return'<span class="eh" ref-id="octave-sign-'.concat(parserState.numberOfOctaveSignMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="octave-sign-'.concat(parserState.numberOfOctaveSignMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.isOctaveOrTwoOctavesHigherOrLowerHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["octave sign from unit"]={requiredCommandProgression:"octave sign",prohibitedCommandProgressions:["octave sign from unit","octave sign to unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.octaveSignMark=parserState["lastStartOctaveSignMark-".concat(parserState.numberOfOctaveSignMarks)]}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"octave sign from unit",2,{measure:true});scenarios["octave sign to unit"]={requiredCommandProgression:"octave sign",prohibitedCommandProgressions:["octave sign to unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishes.test(tokenValues)||regexps.to.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.octaveSignMark={key:"octave-sign-".concat(parserState.numberOfOctaveSignMarks),finish:true}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"octave sign to unit",2,{measure:true});scenarios["octave sign vertical correction"]={requiredCommandProgression:"octave sign",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartOctaveSignMark-".concat(parserState.numberOfOctaveSignMarks)].yCorrection=verticalCorrection(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="octave-sign-'.concat(parserState.numberOfOctaveSignMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tuplet-'.concat(parserState.numberOfOctaveSignMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};addLineMeasureStaveVoicePositionScenarios(scenarios,"octave sign",["octave sign from unit","octave sign to unit"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140,"./token/foundNextTokenValuesOnTheLine":141,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],53:[function(require,module,exports){"use strict";var pageMeta=require("./static-objects/pageMeta");var regexps=require("./static-objects/regexps");var IS="is";var EMPTY_STRING="";var NEW_LINE="\n";module.exports=function(scenarios){scenarios["page meta"]={startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.pageMeta.test(tokenValues)&&currentToken.lastOnTheLine},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.pageMeta.match(tokenValues);var pageMetaName=match[0];var pageMetaKey=pageMeta[pageMetaName];var pageMetaValue=match[1];parserState.pageSchema[pageMetaKey]=pageMetaValue;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters.replace(regexps.somethingIsSomethingWithDelimetersHighlight,function(match,p1,p2,p3){if(p3.startsWith(IS)){p3=p3.replace(IS,EMPTY_STRING)}var p1WithTrimmedEnd=p1.trimEnd();var p3WithTrimmedStart=p3.trimStart();return'<span class="th" ref-id="'.concat(pageMetaKey,'"><span class="eh" ref-id="').concat(pageMetaKey,'">').concat(p1WithTrimmedEnd,"</span>").concat(p1.slice(p1WithTrimmedEnd.length)).concat(p2).concat(p3.slice(0,p3.length-p3WithTrimmedStart.length),'<span class="sth" ref-id="').concat(pageMetaKey,'">').concat(p3WithTrimmedStart,"</span></span>")}))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var wordIsFirstCharIndex=joinedTokenValuesWithRealDelimiters.indexOf(IS);var pageMetaNameAndValue=[joinedTokenValuesWithRealDelimiters.slice(0,wordIsFirstCharIndex),joinedTokenValuesWithRealDelimiters.slice(wordIsFirstCharIndex+2)];var lastNewLineCharIndexInPageMetaName=pageMetaNameAndValue[0].lastIndexOf(NEW_LINE);var firstNewLineCharIndexInPageMetaValue=pageMetaNameAndValue[1].indexOf(NEW_LINE);if(lastNewLineCharIndexInPageMetaName===-1){parserState.highlightsHtmlBuffer.push('<span class="eh">'.concat(pageMetaNameAndValue[0],"</span>").concat(IS))}else{parserState.highlightsHtmlBuffer.push("".concat(pageMetaNameAndValue[0].slice(0,lastNewLineCharIndexInPageMetaName+1),'<span class="eh">').concat(pageMetaNameAndValue[0].slice(lastNewLineCharIndexInPageMetaName+1),"</span>").concat(IS))}if(firstNewLineCharIndexInPageMetaValue===-1){parserState.highlightsHtmlBuffer.push('<span class="sth">'.concat(pageMetaNameAndValue[1],"</span>"))}else{parserState.highlightsHtmlBuffer.push('<span class="sth">'.concat(pageMetaNameAndValue[1].slice(0,firstNewLineCharIndexInPageMetaValue),"</span>").concat(pageMetaNameAndValue[1].slice(firstNewLineCharIndexInPageMetaValue)))}},itIsNewCommandProgressionFromLevel:0}}},{"./static-objects/pageMeta":128,"./static-objects/regexps":130}],54:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["punctuation"]={condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.lastOnTheLine&&regexps.punctuation.test(tokenValues)&&joinedTokenValuesWithRealDelimiters.length>0},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}}}},{"./static-objects/regexps":130}],55:[function(require,module,exports){"use strict";var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var regexps=require("./static-objects/regexps");module.exports=function(scenarios){scenarios["repeat sign"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.repeatSign.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withRepeatSignHighlight,function(match){return'<span class="eh" ref-id="">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.withRepeatSignHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);if(!lastMeasureParamsValue.repeatDotsMarkAtTheStart&&!lastMeasureParamsValue.repeatDotsMarkAtTheEnd){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"repeatDotsMarkAtTheStart",parserState);var _lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);_lastMeasureParamsValue.repeatDotsMarkAtTheStart=true;_lastMeasureParamsValue.repeatDotsMarkAtTheEnd=true}var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-2].replaceAll('ref-id=""','ref-id="repeat-sign-'.concat(numberOfMeasures,'"'));parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1]=parserState.highlightsHtmlBuffer[parserState.highlightsHtmlBuffer.length-1].replaceAll('ref-id=""','ref-id="repeat-sign-'.concat(numberOfMeasures,'"'));parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["repeat sign at the start"]={requiredCommandProgression:"repeat sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheStart.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"repeatDotsMarkAtTheStart",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.repeatDotsMarkAtTheStart=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheStartHighlight,function(match){return'<span class="th" ref-id="repeat-sign-at-the-start-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repeat-sign-at-the-start-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheStartHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["repeat sign at the end"]={requiredCommandProgression:"repeat sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEnd.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"repeatDotsMarkAtTheEnd",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.repeatDotsMarkAtTheEnd=true;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th" ref-id="repeat-sign-at-the-end-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repeat-sign-at-the-end-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.atTheEndHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130}],56:[function(require,module,exports){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var regexps=require("./static-objects/regexps");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var foundNextTokenValuesOnTheLine=require("./token/foundNextTokenValuesOnTheLine");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");var updateNoteAndRestRefIdsInHighlightsHtmlBufferThatFollowAfterSimileUnit=function updateNoteAndRestRefIdsInHighlightsHtmlBufferThatFollowAfterSimileUnit(parserState,measureIndex,staveIndex,voiceIndex,singleChordIndex,simileCount){parserState.highlightsHtmlBuffer.forEach(function(html,index){parserState.highlightsHtmlBuffer[index]=html.replaceAll(/rest-(\d+)-(\d+)-(\d+)-(\d+)/g,function(match,g1,g2,g3,g4){g1*=1;g2*=1;g3*=1;g4*=1;if(g1===measureIndex+1&&g2===staveIndex+1&&g3===voiceIndex+1&&g4>singleChordIndex+1){return"rest-".concat(g1,"-").concat(g2,"-").concat(g3,"-").concat(g4+simileCount)}return match}).replaceAll(/unit-(\d+)-(\d+)-(\d+)-(\d+)/g,function(match,g1,g2,g3,g4){g1*=1;g2*=1;g3*=1;g4*=1;if(g1===measureIndex+1&&g2===staveIndex+1&&g3===voiceIndex+1&&g4>singleChordIndex+1){return"unit-".concat(g1,"-").concat(g2,"-").concat(g3,"-").concat(g4+simileCount)}return match}).replaceAll(/note-(\d+)-(\d+)-(\d+)-(\d+)-(\d+)/g,function(match,g1,g2,g3,g4,g5){g1*=1;g2*=1;g3*=1;g4*=1;if(g1===measureIndex+1&&g2===staveIndex+1&&g3===voiceIndex+1&&g4>singleChordIndex+1){return"note-".concat(g1,"-").concat(g2,"-").concat(g3,"-").concat(g4+simileCount,"-").concat(g5)}return match})})};var addSimileUnitsToPageSchema=function addSimileUnitsToPageSchema(parserState){if(parserState.calculatedUnitMeasureIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitStaveIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitVoiceIndexByLastMentionedPositions!==undefined&&parserState["lastSimileMarkUnitIndex-".concat(parserState.numberOfSimileMarks)]!==undefined){var measureIndex=parserState.calculatedUnitMeasureIndexByLastMentionedPositions;var staveIndex=parserState.calculatedUnitStaveIndexByLastMentionedPositions;var voiceIndex=parserState.calculatedUnitVoiceIndexByLastMentionedPositions;var singleChordIndex=parserState["lastSimileMarkUnitIndex-".concat(parserState.numberOfSimileMarks)];var simileCount=parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].count;var simileYCorrection=parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].yCorrection;if(!parserState.pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex][singleChordIndex].isSimile&&(!parserState.pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex][singleChordIndex+1]||parserState.pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex][singleChordIndex+1]&&!parserState.pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex][singleChordIndex+1].isSimile)){for(var simileIndex=0;simileIndex<simileCount;simileIndex++){parserState.pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex].splice(singleChordIndex+simileIndex+1,0,{notes:[{positionNumber:(simileYCorrection||0)+2}],isSimile:true,simileRefId:"simile-mark-".concat(parserState.numberOfSimileMarks),simileCountDown:simileCount-simileIndex,simileYCorrection:simileYCorrection})}}updateNoteAndRestRefIdsInHighlightsHtmlBufferThatFollowAfterSimileUnit(parserState,measureIndex,staveIndex,voiceIndex,singleChordIndex,simileCount)}};module.exports=function(scenarios){scenarios["repeat simile"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var nextTokenValueOnTheLine=foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken);var nextThreeTokensOnTheLine=foundNextTokenValuesOnTheLine(unitext,currentToken.firstCharIndexOfNextToken,3);var nextFourTokensOnTheLine=foundNextTokenValuesOnTheLine(unitext,currentToken.firstCharIndexOfNextToken,4);return regexps.repeatSimile.test(tokenValues)&&!regexps.sign.test([nextTokenValueOnTheLine])&&!regexps.simileOfPreviousMeasure.test([currentToken.value].concat(_toConsumableArray(nextThreeTokensOnTheLine)))&&!regexps.simileOfTwoPreviousMeasures.test([currentToken.value].concat(_toConsumableArray(nextFourTokensOnTheLine)))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.numberOfSimileMarks+=1;parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)]={refId:"simile-mark-".concat(parserState.numberOfSimileMarks),count:1,numberOfBeats:1,yCorrection:0,finish:true};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.repeatSimileHighlight,function(match){return'<span class="eh" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.repeatSimileHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){addSimileUnitsToPageSchema(parserState);if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineAllMentionedPositions(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["repeat simile previous beat"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.ofPreviousBeat.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].numberOfBeats=1;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["repeat simile previous beats"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.ofPreviousBeats.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].numberOfBeats=2;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["repeat simile count"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.simileCount.test(withNumbersInsteadOfWords(tokenValues))},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var simileCount=regexps.simileCount.match(withNumbersInsteadOfWords(tokenValues))[0]*1;parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].count=simileCount;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.simileCountHighlight,function(match){return'<span class="cnh" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.simileCountHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:1};scenarios["repeat simile starts"]={requiredCommandProgression:"repeat simile",prohibitedCommandProgressions:["repeat simile starts","repeat simile finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues)||regexps.for.test(tokenValues)&&!regexps.forEach.test([currentToken.value,foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{if(!chordParamsValue.simileMark){chordParamsValue.simileMark=parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)]}parserState["lastSimileMarkUnitIndex-".concat(parserState.numberOfSimileMarks)]=parserState.calculatedUnitIndexByLastMentionedPositions}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"repeat simile starts",2,{});scenarios["repeat simile finishes"]={requiredCommandProgression:"repeat simile",prohibitedCommandProgressions:["repeat simile finishes"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishes.test(tokenValues)||regexps.till.test(tokenValues)||regexps.to.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push('<span class="th">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{if(!chordParamsValue.simileMark){chordParamsValue.simileMark={refId:"simile-mark-".concat(parserState.numberOfSimileMarks),finish:true}}parserState["lastSimileMarkUnitIndex-".concat(parserState.numberOfSimileMarks)]=parserState.calculatedUnitIndexByLastMentionedPositions}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"repeat simile finishes",2,{});scenarios["repeat simile vertical correction"]={requiredCommandProgression:"repeat simile",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartSimileMark-".concat(parserState.numberOfSimileMarks)].yCorrection=verticalCorrection(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="cnh" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="simile-mark-'.concat(parserState.numberOfSimileMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};addLineMeasureStaveVoicePositionScenarios(scenarios,"repeat simile",["repeat simile starts","repeat simile finishes"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140,"./token/foundNextTokenValuesOnTheLine":141,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163,"./token/withNumbersInsteadOfWords":164}],57:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");module.exports=function(scenarios){scenarios["repetition note"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.repetitionNote.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"repetitionNote",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var repetitionNoteValue=regexps.repetitionNote.match(tokenValues)[0];lastMeasureParamsValue.repetitionNote={value:repetitionNoteValue,measurePosition:"start"};var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(match,"</span>")}).replace(regexps.repetitionNoteHighlight,function(match){return'<span class="eh" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")}).replace(regexps.repetitionNoteHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedStringAndElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["repetition note at the start of the measure"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheStartOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.repetitionNote.measurePosition="start";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["repetition note at the end of the measure"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEndOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.repetitionNote.measurePosition="end";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["repetition note vertical correction"]={requiredCommandProgression:"repetition note",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.repetitionNote.yCorrection=verticalCorrection(tokenValues);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="repetition-note-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],58:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");module.exports=function(scenarios){scenarios["sign"]={startsOnNewLine:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.sign.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"sign",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.sign={measurePosition:"start"};var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.signHighlight,function(match){return'<span class="eh" ref-id="sign-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="sign-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.signHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["sign at the start of the measure"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheStartOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.sign.measurePosition="start";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="sign-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["sign at the end of the measure"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.atTheEndOfTheMeasure.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.sign.measurePosition="end";var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph" ref-id="measure-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="sign-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedMeasure=joinedTokenValuesWithRealDelimiters.replace(regexps.measureHighlight,function(match){return'<span class="cmph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedMeasure)}};scenarios["sign vertical correction"]={requiredCommandProgression:"sign",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.sign.yCorrection=verticalCorrection(tokenValues);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="sign-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="sign-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)}}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],59:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var isDirection=require("./token/isDirection");var direction=require("./token/direction");var isRoundness=require("./token/isRoundness");var roundness=require("./token/roundness");var isAboveBelowOverUnder=require("./token/isAboveBelowOverUnder");var directionByAboveBelowOverUnder=require("./token/directionByAboveBelowOverUnder");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var removeSlurMarksThatFinishFromChordsParamsByKeyAndSlurMarksFromCurrentChordParamsThatDontFinishByKey=require("./page-schema/removeSlurMarksThatFinishFromChordsParamsByKeyAndSlurMarksFromCurrentChordParamsThatDontFinishByKey");var addDirectionToSlurMarkByKey=require("./page-schema/addDirectionToSlurMarkByKey");var addRoundnessToSlurMarkByKey=require("./page-schema/addRoundnessToSlurMarkByKey");var addSShapeToSlurMarkByKey=require("./page-schema/addSShapeToSlurMarkByKey");var addLeftYCorrectionToSlurMarkByKey=require("./page-schema/addLeftYCorrectionToSlurMarkByKey");var addRightYCorrectionToSlurMarkByKey=require("./page-schema/addRightYCorrectionToSlurMarkByKey");var addRightPointPlacementToSlurMarkByKey=require("./page-schema/addRightPointPlacementToSlurMarkByKey");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");var addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions=function addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey){if(parserState.lastSlurDirection){addDirectionToSlurMarkByKey(parserState,slurMarkKey,parserState.lastSlurDirection);parserState.lastSlurDirection=undefined}if(parserState.lastSlurRoundness){addRoundnessToSlurMarkByKey(parserState,slurMarkKey,parserState.lastSlurRoundness);parserState.lastSlurRoundness=undefined}if(parserState.lastSlurLeftYCorrection){addLeftYCorrectionToSlurMarkByKey(parserState,slurMarkKey,parserState.lastSlurLeftYCorrection);parserState.lastSlurLeftYCorrection=undefined}if(parserState.lastSlurRightYCorrection){addRightYCorrectionToSlurMarkByKey(parserState,slurMarkKey,parserState.lastSlurRightYCorrection);parserState.lastSlurRightYCorrection=undefined}if(parserState.lastSlurRightPointPlacement){addRightPointPlacementToSlurMarkByKey(parserState,slurMarkKey,parserState.lastSlurRightPointPlacement);parserState.lastSlurRightPointPlacement=undefined}if(parserState.lastSlurWithSShape){addSShapeToSlurMarkByKey(parserState,slurMarkKey);parserState.lastSlurWithSShape=undefined}};module.exports=function(scenarios){scenarios["slur"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.slur.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);parserState.lastSlurDirection=undefined;parserState.lastSShapeSlurPartDirection=undefined;parserState.lastSlurRoundness=undefined;parserState.lastSlurLeftYCorrection=undefined;parserState.lastSlurRightYCorrection=undefined;parserState.lastSlurRightPointPlacement=undefined;parserState.lastSlurWithSShape=undefined;parserState.numberOfSlurs+=1;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.slurHighlight,function(match){return'<span class="eh" ref-id="slur-'.concat(parserState.numberOfSlurs,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="eh" ref-id="slur-'.concat(parserState.numberOfSlurs,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.slurHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["slur starts before unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit","slur finishes after unit","slur starts at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.startsBefore.test(tokenValues)||regexps.before.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.slurMarks=chordParamsValue.slurMarks||[];var slurMarkKey="slur-".concat(parserState.numberOfSlurs);chordParamsValue.slurMarks.push({key:slurMarkKey,before:true});chordParamsValue.slurMarks.push({key:slurMarkKey,finish:true});parserState.slurMarkChords[slurMarkKey]=parserState.slurMarkChords[slurMarkKey]||[];parserState.slurMarkChords[slurMarkKey].push(chordParamsValue);addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey)}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"slur starts before unit",2,{measure:true,stave:true});scenarios["slur starts before above|below unit"]={requiredCommandProgression:"slur starts before unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastSlurDirection=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["slur finishes after unit"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishesAfter.test(tokenValues)||regexps.after.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.slurMarks=chordParamsValue.slurMarks||[];var slurMarkKey="slur-".concat(parserState.numberOfSlurs);removeSlurMarksThatFinishFromChordsParamsByKeyAndSlurMarksFromCurrentChordParamsThatDontFinishByKey(parserState,slurMarkKey,chordParamsValue);parserState.slurMarkChords[slurMarkKey]=parserState.slurMarkChords[slurMarkKey]||[];if(parserState.slurMarkChords[slurMarkKey].length===0){chordParamsValue.slurMarks.push({key:slurMarkKey});parserState.slurMarkChords[slurMarkKey].push(chordParamsValue)}var slurMark={key:slurMarkKey,finish:true,after:true};if(parserState.lastSShapeSlurPartDirection){slurMark.direction=parserState.lastSShapeSlurPartDirection;parserState.lastSShapeSlurPartDirection=undefined}chordParamsValue.slurMarks.push(slurMark);parserState.slurMarkChords[slurMarkKey].push(chordParamsValue);addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey)}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>");undefineOnlyLastMentionedUnitPosition(parserState)}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"slur finishes after unit",2,{measure:true,stave:true});scenarios["slur finishes after above|below unit"]={requiredCommandProgression:"slur finishes after unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var slurDirection=directionByAboveBelowOverUnder(tokenValues);addDirectionToSlurMarkByKey(parserState,slurMarkKey,slurDirection);parserState.lastSShapeSlurPartDirection=slurDirection;parserState.lastSlurDirection=slurDirection;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["slur starts at unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit","slur finishes after unit","slur starts after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues))&&!regexps.before.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.slurMarks=chordParamsValue.slurMarks||[];var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var slurMark={key:slurMarkKey};chordParamsValue.slurMarks.push(slurMark);parserState.slurMarkChords[slurMarkKey]=parserState.slurMarkChords[slurMarkKey]||[];parserState.slurMarkChords[slurMarkKey].push(chordParamsValue);addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey)}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"slur starts at unit",2,{measure:true,stave:true});scenarios["slur starts above|below unit"]={requiredCommandProgression:"slur starts at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastSlurDirection=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["slur finishes at unit"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.finishes.test(tokenValues)||regexps.to.test(tokenValues))&&!regexps.after.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.slurMarks=chordParamsValue.slurMarks||[];var slurMarkKey="slur-".concat(parserState.numberOfSlurs);removeSlurMarksThatFinishFromChordsParamsByKeyAndSlurMarksFromCurrentChordParamsThatDontFinishByKey(parserState,slurMarkKey,chordParamsValue);parserState.slurMarkChords[slurMarkKey]=parserState.slurMarkChords[slurMarkKey]||[];if(parserState.slurMarkChords[slurMarkKey].length>0){var slurMark={key:slurMarkKey,finish:true};if(parserState.lastSShapeSlurPartDirection){slurMark.direction=parserState.lastSShapeSlurPartDirection;parserState.lastSShapeSlurPartDirection=undefined}chordParamsValue.slurMarks.push(slurMark);parserState.slurMarkChords[slurMarkKey].push(chordParamsValue);addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey)}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"slur finishes at unit",2,{measure:true,stave:true});scenarios["slur finishes above|below unit"]={requiredCommandProgression:"slur finishes at unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastSShapeSlurPartDirection=directionByAboveBelowOverUnder(tokenValues);parserState.lastSlurDirection=parserState.lastSShapeSlurPartDirection;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["slur direction"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var slurDirection=direction(tokenValues);addDirectionToSlurMarkByKey(parserState,slurMarkKey,slurDirection);parserState.lastSlurDirection=slurDirection;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["slur above or below"]={requiredCommandProgression:"slur",prohibitedCommandProgressions:["slur starts before unit","slur finishes after unit","slur starts at unit","slur finishes at unit","slur goes through unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var slurDirection=directionByAboveBelowOverUnder(tokenValues);addDirectionToSlurMarkByKey(parserState,slurMarkKey,slurDirection);parserState.lastSlurDirection=slurDirection;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["slur roundness"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isRoundness(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var roundnessValue=roundness(tokenValues);addRoundnessToSlurMarkByKey(parserState,slurMarkKey,roundnessValue);parserState.lastSlurRoundness=roundnessValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.roundnessHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:1};scenarios["slur goes through unit"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.changesStaveOrGoesThrough.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.slurMarks=chordParamsValue.slurMarks||[];var slurMarkKey="slur-".concat(parserState.numberOfSlurs);parserState.slurMarkChords[slurMarkKey]=parserState.slurMarkChords[slurMarkKey]||[];var slurMark={key:slurMarkKey};if(parserState.lastSShapeSlurPartDirection){slurMark.direction=parserState.lastSShapeSlurPartDirection;parserState.lastSShapeSlurPartDirection=undefined}chordParamsValue.slurMarks.push(slurMark);parserState.slurMarkChords[slurMarkKey].push(chordParamsValue);addSlurFeaturesIfTheyAreSpecifiedBeforeItsUnitPositions(parserState,slurMarkKey)}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["slur goes through above|below unit"]={requiredCommandProgression:"slur goes through unit",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastSShapeSlurPartDirection=directionByAboveBelowOverUnder(tokenValues);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};addUnitPositionScenarios(scenarios,"slur goes through unit",2,{measure:true,stave:true});scenarios["slur left point"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.leftPoint.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters))}},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["slur left point vertical correction"]={requiredCommandProgression:"slur left point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var verticalCorrectionValue=verticalCorrection(tokenValues);addLeftYCorrectionToSlurMarkByKey(parserState,slurMarkKey,verticalCorrectionValue);parserState.lastSlurLeftYCorrection=verticalCorrectionValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["slur right point"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.rightPoint.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["slur right point vertical correction"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var verticalCorrectionValue=verticalCorrection(tokenValues);addRightYCorrectionToSlurMarkByKey(parserState,slurMarkKey,verticalCorrectionValue);parserState.lastSlurRightYCorrection=verticalCorrectionValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:2};scenarios["slur right point attached to middle of stem"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.attachedToMiddleOfStem.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var placementValue="middleStem";addRightPointPlacementToSlurMarkByKey(parserState,slurMarkKey,placementValue);parserState.lastSlurRightPointPlacement=placementValue;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["slur right point attached to note body"]={requiredCommandProgression:"slur right point",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.attachedToNoteBody.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);var placementValue="noteBody";addRightPointPlacementToSlurMarkByKey(parserState,slurMarkKey,placementValue);parserState.lastSlurRightPointPlacement=placementValue;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:2};scenarios["slur with s shape"]={requiredCommandProgression:"slur",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withSShape.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var slurMarkKey="slur-".concat(parserState.numberOfSlurs);addSShapeToSlurMarkByKey(parserState,slurMarkKey);parserState.lastSlurWithSShape=true;if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="'.concat(slurMarkKey,'">').concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};addLineMeasureStaveVoicePositionScenarios(scenarios,"slur",["slur starts before unit","slur finishes after unit","slur starts at unit","slur finishes at unit","slur goes through unit","slur left point","slur right point"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/addDirectionToSlurMarkByKey":70,"./page-schema/addLeftYCorrectionToSlurMarkByKey":71,"./page-schema/addRightPointPlacementToSlurMarkByKey":72,"./page-schema/addRightYCorrectionToSlurMarkByKey":73,"./page-schema/addRoundnessToSlurMarkByKey":74,"./page-schema/addSShapeToSlurMarkByKey":75,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/removeSlurMarksThatFinishFromChordsParamsByKeyAndSlurMarksFromCurrentChordParamsThatDontFinishByKey":96,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/direction":137,"./token/directionByAboveBelowOverUnder":138,"./token/foundNextTokenValueOnTheLine":140,"./token/isAboveBelowOverUnder":143,"./token/isDirection":145,"./token/isRoundness":151,"./token/isVerticalCorrection":153,"./token/roundness":159,"./token/verticalCorrection":163}],60:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastStaveParams=require("./page-schema/lastStaveParams");var clefs=require("./static-objects/clefs");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");module.exports=function(scenarios){scenarios["stave"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.firstOnTheLine&&regexps.stave.test([currentToken.value])&&!regexps.lines.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.stavesParams=lastMeasureParamsValue.stavesParams||[];lastMeasureParamsValue.stavesParams.push({});var numberOfMeasures=parserState.pageSchema.measuresParams.length;var numberOfStaves=lastMeasureParamsValue.stavesParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="stave-lines-'.concat(numberOfMeasures,"-").concat(numberOfStaves,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="stave-lines-'.concat(numberOfMeasures,"-").concat(numberOfStaves,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}}};scenarios["stave with clef"]={requiredCommandProgression:"stave",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withClef.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);var clefName=regexps.withClef.match(tokenValues)[0];lastStaveParamsValue.clef=clefs[clefName];var currentNumberOfStaves=lastMeasureParamsValue.stavesParams.length;parserState.lastClef[currentNumberOfStaves-1]=lastStaveParamsValue.clef;var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh" ref-id="clef-'.concat(numberOfMeasures,"-").concat(currentNumberOfStaves,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="clef-'.concat(numberOfMeasures,"-").concat(currentNumberOfStaves,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.clefHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./page-schema/lastStaveParams":93,"./static-objects/clefs":111,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140}],61:[function(require,module,exports){"use strict";var configurableStyles=require("./static-objects/configurableStyles");var regexps=require("./static-objects/regexps");var NEW_LINE="\n";module.exports=function(scenarios){scenarios["style name"]={startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.styleName.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var match=regexps.styleName.match(tokenValues);var styleName=match[0];parserState.lastMentionedStyleKey=configurableStyles[styleName];if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="sh">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var match=regexps.styleName.match(tokenValues);var styleName=match[0];parserState.lastMentionedStyleKey=configurableStyles[styleName];var lastNewLineIndex=joinedTokenValuesWithRealDelimiters.lastIndexOf(NEW_LINE);if(lastNewLineIndex===-1){parserState.highlightsHtmlBuffer.push('<span class="sh">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}else{parserState.highlightsHtmlBuffer.push("".concat(joinedTokenValuesWithRealDelimiters.slice(0,lastNewLineIndex+1),'<span class="sh">').concat(joinedTokenValuesWithRealDelimiters.slice(lastNewLineIndex+1),"</span>"))}},itIsNewCommandProgressionFromLevel:0};scenarios["style name is"]={onTheSameLineAsPrevScenario:true,requiredCommandProgression:"style name",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.isIs.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1};scenarios["style value"]={onTheSameLineAsPrevScenario:true,requiredCommandProgression:"style name is",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.styleValue.test(tokenValues,parserState.lastMentionedStyleKey)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.customStyles[parserState.lastMentionedStyleKey]=regexps.styleValue.match(tokenValues)[0];if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="svh">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var firstNewLineIndex=joinedTokenValuesWithRealDelimiters.indexOf(NEW_LINE);if(firstNewLineIndex===-1){parserState.highlightsHtmlBuffer.push('<span class="svh">'.concat(joinedTokenValuesWithRealDelimiters,"</span>"))}else{parserState.highlightsHtmlBuffer.push('<span class="svh">'.concat(joinedTokenValuesWithRealDelimiters.slice(0,firstNewLineIndex),"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(firstNewLineIndex)))}},itIsNewCommandProgressionFromLevel:1}}},{"./static-objects/configurableStyles":115,"./static-objects/regexps":130}],62:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var tempoValueParts=require("./token/tempoValueParts");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");module.exports=function(scenarios){scenarios["tempo mark"]={condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tempoOrMetronome.test(tokenValues)&&!regexps.markOrNote.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.tempoMarkOrTempoNote.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"tempoMark",parserState);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tempoMarkHighlight,function(match){return'<span class="eh" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.tempoMarkHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push("</span>")}},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["tempo mark text"]={requiredCommandProgression:"tempo mark",onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tempoMarkText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var tempoValue=regexps.tempoMarkText.match(tokenValues)[0];lastMeasureParamsValue.tempoMark={textValueParts:tempoValueParts(tempoValue)};var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(matchWithHighlighedString){var matchIndexWithTempoDurationPart=0;var lastMatchIsNote=false;var matchWithHighlighedNotes=matchWithHighlighedString.replace(regexps.tempoDurationPartHighlight,function(matchWithTempoDurationPart,p1,offset,string){if(regexps.tempoDurationPartIsDot.test(matchWithTempoDurationPart)){if(lastMatchIsNote){lastMatchIsNote=false;return'<span class="eh" ref-id="tempo-duration-part-'.concat(numberOfMeasures,"-").concat(++matchIndexWithTempoDurationPart,'">').concat(matchWithTempoDurationPart,"</span>")}else{return'<span class="sth" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(matchWithTempoDurationPart,"</span>")}}else{lastMatchIsNote=true;var textThatFollowsAfterMatchWithTempoDurationPart=string.slice(offset+matchWithTempoDurationPart.length);if(!regexps.tempoMarkWithDotHighlight.test(textThatFollowsAfterMatchWithTempoDurationPart)&&!regexps.tempoMarkDottedHighlight.test(textThatFollowsAfterMatchWithTempoDurationPart)){lastMatchIsNote=false;return'<span class="cuph" ref-id="tempo-duration-part-'.concat(numberOfMeasures,"-").concat(++matchIndexWithTempoDurationPart,'">').concat(matchWithTempoDurationPart,"</span>")}return'<span class="cuph" ref-id="tempo-duration-part-'.concat(numberOfMeasures,"-").concat(++matchIndexWithTempoDurationPart,'">').concat(matchWithTempoDurationPart,"</span>")}});return'<span class="sth" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(matchWithHighlighedNotes,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(matchWithHighlighedString){var lastMatchIsNote=false;var matchWithHighlighedNotes=matchWithHighlighedString.replace(regexps.tempoDurationPartHighlight,function(matchWithTempoDurationPart,p1,offset,string){if(regexps.tempoDurationPartIsDot.test(matchWithTempoDurationPart)){if(lastMatchIsNote){lastMatchIsNote=false;return'<span class="eh">'.concat(matchWithTempoDurationPart,"</span>")}else{return'<span class="sth">'.concat(matchWithTempoDurationPart,"</span>")}}else{lastMatchIsNote=true;var textThatFollowsAfterMatchWithTempoDurationPart=string.slice(offset+matchWithTempoDurationPart.length);if(!regexps.tempoMarkWithDotHighlight.test(textThatFollowsAfterMatchWithTempoDurationPart)&&!regexps.tempoMarkDottedHighlight.test(textThatFollowsAfterMatchWithTempoDurationPart)){lastMatchIsNote=false;return'<span class="cuph">'.concat(matchWithTempoDurationPart,"</span>")}return'<span class="cuph">'.concat(matchWithTempoDurationPart,"</span>")}});return'<span class="sth">'.concat(matchWithHighlighedNotes,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElementAndString)},itIsNewCommandProgressionFromLevel:1};scenarios["tempo mark vertical correction"]={requiredCommandProgression:"tempo mark",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);lastMeasureParamsValue.tempoMark.yCorrection=verticalCorrection(tokenValues);var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tempo-mark-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedNumber,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedNumber=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedNumber)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140,"./token/isVerticalCorrection":153,"./token/tempoValueParts":161,"./token/verticalCorrection":163}],63:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");module.exports=function(scenarios){scenarios["time signature"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.timeSignature.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"timeSignatureParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);if(parserState.lastTimeSignatureParams){lastMeasureParamsValue.lastTimeSignatureParams=undefined;parserState.lastTimeSignatureParams=undefined}lastMeasureParamsValue.timeSignatureParams={};var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.timeSignatureHighlight,function(match){return'<span class="eh" ref-id="time-signature-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="eh" ref-id="time-signature-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.timeSignatureHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0};scenarios["time signature value"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.timeSignatureValue.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);var timeSignature=regexps.timeSignatureValue.match(tokenValues);if(timeSignature[0]==="c"){lastMeasureParamsValue.timeSignatureParams.numerator="4";lastMeasureParamsValue.timeSignatureParams.denominator="4";lastMeasureParamsValue.timeSignatureParams.cMode=true}else if(timeSignature[0]==="crossed c"){lastMeasureParamsValue.timeSignatureParams.numerator="2";lastMeasureParamsValue.timeSignatureParams.denominator="2";lastMeasureParamsValue.timeSignatureParams.cMode=true}else{var numerator=timeSignature[0];var denominator=timeSignature[1];lastMeasureParamsValue.timeSignatureParams.numerator=numerator;lastMeasureParamsValue.timeSignatureParams.denominator=denominator}var numberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.timeSignatureValueHighlight,function(match){return'<span class="cnh" ref-id="time-signature-'.concat(numberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="time-signature-'.concat(numberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.timeSignatureValueHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["time signature for each line"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forEachLine.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastTimeSignatureParamsValue=lastMeasureParams(parserState.pageSchema).timeSignatureParams;lastTimeSignatureParamsValue.forEachLineId=parserState.lastTimeSignatureValueForEachLineId;parserState.lastTimeSignatureParams=lastTimeSignatureParamsValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph" ref-id="time-signature-for-each-line-'.concat(parserState.lastTimeSignatureValueForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="time-signature-for-each-line-'.concat(parserState.lastTimeSignatureValueForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastTimeSignatureValueForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.forEachLineHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};scenarios["time signature for lines below"]={requiredCommandProgression:"time signature",onTheSameLineAsPrevScenario:true,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.forLinesBelow.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var lastTimeSignatureParamsValue=lastMeasureParams(parserState.pageSchema).timeSignatureParams;lastTimeSignatureParamsValue.forEachLineId=parserState.lastTimeSignatureValueForEachLineId;parserState.lastTimeSignatureParams=lastTimeSignatureParamsValue;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph" ref-id="time-signature-for-each-line-'.concat(parserState.lastTimeSignatureValueForEachLineId,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="time-signature-for-each-line-'.concat(parserState.lastTimeSignatureValueForEachLineId,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}parserState.lastTimeSignatureValueForEachLineId+=1},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.linesHighlight,function(match){return'<span class="clph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/lastMeasureParams":89,"./static-objects/regexps":130}],64:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var isDirection=require("./token/isDirection");var direction=require("./token/direction");var isAboveBelowOverUnder=require("./token/isAboveBelowOverUnder");var directionByAboveBelowOverUnder=require("./token/directionByAboveBelowOverUnder");var isAboveBelowOverUnderStaveLines=require("./token/isAboveBelowOverUnderStaveLines");var directionByAboveBelowOverUnderStaveLines=require("./token/directionByAboveBelowOverUnderStaveLines");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var chordParamsByLastMentionedUnitPositions=require("./page-schema/chordParamsByLastMentionedUnitPositions");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedUnitPosition=require("./page-schema/undefineOnlyLastMentionedUnitPosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addUnitPositionScenarios=require("./addUnitPositionScenarios");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios){scenarios["tuplet"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.tupletWithValue.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);parserState.lastChordParamsWithFinishedTupletMarkThatStarted=undefined;parserState.lastChordParamsWithStartedTupletMark=undefined;parserState.lastTupletDirection=undefined;parserState.lastTupletIsAboveOrBelowStaveLines=undefined;parserState.lastTupletWithBrackets=undefined;parserState.lastTupletVerticalCorrection=undefined;parserState.numberOfTuplets+=1;parserState.lastTupletValue=regexps.tupletWithValue.match(tokenValues)[0];if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.tupletHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh" ref-id="tuplet-').concat(parserState.numberOfTuplets,'">tuplet</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.tupletValueHighlight,function(match){return'<span class="cnh" ref-id="tuplet-value-'.concat(parserState.numberOfTuplets,'">').concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tuplet-'.concat(parserState.numberOfTuplets,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithSplittedParts=joinedTokenValuesWithRealDelimiters.split(regexps.tupletHighlight);var joinedTokenValuesWithRealDelimitersFirstPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[0];var joinedTokenValuesWithRealDelimitersSecondPart=joinedTokenValuesWithRealDelimitersWithSplittedParts[1];var joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPart,'<span class="eh">tuplet</span>');var joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement=joinedTokenValuesWithRealDelimitersSecondPart.replace(regexps.tupletValueHighlight,function(match){return'<span class="cnh">'.concat(match,"</span>")});var joinedTokenValuesWithRealDelimitersWithHighlightedElement="".concat(joinedTokenValuesWithRealDelimitersFirstPartWithHighlightedElement).concat(joinedTokenValuesWithRealDelimitersSecondPartWithHighlightedElement);parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["tuplet starts before unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet starts before unit","tuplet starts at unit","tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.startsBefore.test(tokenValues)||regexps.before.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.tupletMarks=chordParamsValue.tupletMarks||[];var firstChordParamsInCurrentVoiceOnCurrentStave=parserState.pageSchema.measuresParams[parserState.calculatedUnitMeasureIndexByLastMentionedPositions].stavesParams[parserState.calculatedUnitStaveIndexByLastMentionedPositions].voicesParams[parserState.calculatedUnitVoiceIndexByLastMentionedPositions][0];firstChordParamsInCurrentVoiceOnCurrentStave.tupletMarks=firstChordParamsInCurrentVoiceOnCurrentStave.tupletMarks||[];var tupletMarkKey="tuplet-".concat(parserState.numberOfTuplets);var startTupletMark={key:tupletMarkKey,value:parserState.lastTupletValue,before:true};if(parserState.lastTupletDirection){startTupletMark.direction=parserState.lastTupletDirection}if(parserState.lastTupletIsAboveOrBelowStaveLines){startTupletMark.direction=parserState.lastTupletDirection;startTupletMark.aboveBelowOverUnderStaveLines=true}if(parserState.lastTupletWithBrackets){startTupletMark.withBrackets=true}if(parserState.lastTupletVerticalCorrection!==undefined){startTupletMark.yCorrection=parserState.lastTupletVerticalCorrection}firstChordParamsInCurrentVoiceOnCurrentStave.tupletMarks.push(startTupletMark);parserState.lastChordParamsWithStartedTupletMark={chordParams:firstChordParamsInCurrentVoiceOnCurrentStave,tupletMarkIndex:firstChordParamsInCurrentVoiceOnCurrentStave.tupletMarks.length-1};chordParamsValue.tupletMarks.push({key:tupletMarkKey,finish:true});parserState.lastChordParamsWithFinishedTupletMarkThatStarted={chordParams:chordParamsValue,tupletMarkIndex:chordParamsValue.tupletMarks.length-1}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"tuplet starts before unit",2,{measure:true});scenarios["tuplet finishes after unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishesAfter.test(tokenValues)||regexps.after.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.tupletMarks=chordParamsValue.tupletMarks||[];var tupletMarkKey="tuplet-".concat(parserState.numberOfTuplets);if(parserState.lastChordParamsWithFinishedTupletMarkThatStarted!==undefined){parserState.lastChordParamsWithFinishedTupletMarkThatStarted.chordParams.tupletMarks.splice(parserState.lastChordParamsWithFinishedTupletMarkThatStarted.tupletMarkIndex,1);parserState.lastChordParamsWithFinishedTupletMarkThatStarted=undefined}else if(parserState.lastChordParamsWithStartedTupletMark===undefined){var startTupletMark={key:tupletMarkKey,value:parserState.lastTupletValue};if(parserState.lastTupletDirection){startTupletMark.direction=parserState.lastTupletDirection}chordParamsValue.tupletMarks.push(startTupletMark);parserState.lastChordParamsWithStartedTupletMark={chordParams:chordParamsValue,tupletMarkIndex:chordParamsValue.tupletMarks.length-1}}var finishTupletMark={value:parserState.lastTupletValue,key:tupletMarkKey,finish:true,after:true};chordParamsValue.tupletMarks.push(finishTupletMark)}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"tuplet finishes after unit",2,{measure:true});scenarios["tuplet starts at unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet starts at unit","tuplet starts before unit","tuplet finishes after unit","tuplet finishes at unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues))&&!regexps.before.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var tupletMarkKey="tuplet-".concat(parserState.numberOfTuplets);var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.tupletMarks=chordParamsValue.tupletMarks||[];var startTupletMark={key:tupletMarkKey,value:parserState.lastTupletValue};if(parserState.lastTupletDirection){startTupletMark.direction=parserState.lastTupletDirection}if(parserState.lastTupletIsAboveOrBelowStaveLines){startTupletMark.direction=parserState.lastTupletDirection;startTupletMark.aboveBelowOverUnderStaveLines=true}if(parserState.lastTupletWithBrackets){startTupletMark.withBrackets=true}if(parserState.lastTupletVerticalCorrection!==undefined){startTupletMark.yCorrection=parserState.lastTupletVerticalCorrection}chordParamsValue.tupletMarks.push(startTupletMark);parserState.lastChordParamsWithStartedTupletMark={chordParams:chordParamsValue,tupletMarkIndex:chordParamsValue.tupletMarks.length-1};chordParamsValue.tupletMarks.push({key:tupletMarkKey,finish:true,after:true});parserState.lastChordParamsWithFinishedTupletMarkThatStarted={chordParams:chordParamsValue,tupletMarkIndex:chordParamsValue.tupletMarks.length-1}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"tuplet starts at unit",2,{measure:true});scenarios["tuplet finishes at unit"]={requiredCommandProgression:"tuplet",prohibitedCommandProgressions:["tuplet finishes at unit","tuplet finishes after unit"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.finishes.test(tokenValues)||regexps.to.test(tokenValues))&&!regexps.after.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedUnitPosition===undefined){parserState.errors.push("unit position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var chordParamsValue=chordParamsByLastMentionedUnitPositions(parserState);var tupletMarkKey="tuplet-".concat(parserState.numberOfTuplets);if(!chordParamsValue){parserState.errors.push("unit after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{chordParamsValue.tupletMarks=chordParamsValue.tupletMarks||[];if(parserState.lastChordParamsWithFinishedTupletMarkThatStarted!==undefined){parserState.lastChordParamsWithFinishedTupletMarkThatStarted.chordParams.tupletMarks.splice(parserState.lastChordParamsWithFinishedTupletMarkThatStarted.tupletMarkIndex,1);parserState.lastChordParamsWithFinishedTupletMarkThatStarted=undefined}chordParamsValue.tupletMarks.push({key:tupletMarkKey,finish:true});parserState.lastChordParamsWithStartedTupletMark=undefined}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedUnitPosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addUnitPositionScenarios(scenarios,"tuplet finishes at unit",2,{measure:true});scenarios["tuplet with direction"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isDirection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastTupletDirection=direction(tokenValues);if(parserState.lastChordParamsWithStartedTupletMark){parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=parserState.lastTupletDirection}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["tuplet above or below"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnder(tokenValues)&&!regexps.staveWithAndWithoutDelimeter.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastTupletDirection=directionByAboveBelowOverUnder(tokenValues);if(parserState.lastChordParamsWithStartedTupletMark){parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=parserState.lastTupletDirection}if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)}};scenarios["tuplet is above or below stave lines"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isAboveBelowOverUnderStaveLines(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastTupletDirection=directionByAboveBelowOverUnderStaveLines(tokenValues);parserState.lastTupletIsAboveOrBelowStaveLines=true;if(parserState.lastChordParamsWithStartedTupletMark){parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].direction=parserState.lastTupletDirection;parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].aboveBelowOverUnderStaveLines=true}var currentNumberOfMeasures=parserState.pageSchema.measuresParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="all-staves-in-measure-'.concat(currentNumberOfMeasures,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.staveHighlight,function(match){return'<span class="csph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};scenarios["tuplet with brackets"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withBrackets.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastTupletWithBrackets=true;if(parserState.lastChordParamsWithStartedTupletMark){parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].withBrackets=parserState.lastTupletWithBrackets}if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketsHighlight,function(match){return'<span class="th" ref-id="tuplet-brackets-'.concat(parserState.numberOfTuplets,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tuplet-brackets-'.concat(parserState.numberOfTuplets,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.bracketsHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};scenarios["tuplet with vertical correction"]={requiredCommandProgression:"tuplet",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState.lastTupletVerticalCorrection=verticalCorrection(tokenValues);if(parserState.lastChordParamsWithStartedTupletMark){parserState.lastChordParamsWithStartedTupletMark.chordParams.tupletMarks[parserState.lastChordParamsWithStartedTupletMark.tupletMarkIndex].yCorrection=parserState.lastTupletVerticalCorrection}if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="tuplet-'.concat(parserState.numberOfTuplets,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="tuplet-'.concat(parserState.numberOfTuplets,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)}};addLineMeasureStaveVoicePositionScenarios(scenarios,"tuplet",["tuplet starts before unit","tuplet finishes after unit","tuplet starts at unit","tuplet finishes at unit"],1,true,{line:true,measure:true,stave:true,voice:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./addUnitPositionScenarios":65,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/chordParamsByLastMentionedUnitPositions":76,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedUnitPosition":101,"./static-objects/regexps":130,"./token/direction":137,"./token/directionByAboveBelowOverUnder":138,"./token/directionByAboveBelowOverUnderStaveLines":139,"./token/foundNextTokenValueOnTheLine":140,"./token/isAboveBelowOverUnder":143,"./token/isAboveBelowOverUnderStaveLines":144,"./token/isDirection":145,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],65:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var withNumbersInsteadOfWords=require("./token/withNumbersInsteadOfWords");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios,requiredCommandProgression){var commandProgressionLevel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var allowedCoordinates=arguments.length>3?arguments[3]:undefined;scenarios["unit position (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.unitPosition.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitPosition=regexps.unitPosition.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.lastMentionedUnitPosition=unitPosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cuph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cupph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cuph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};scenarios["position of unit (".concat(requiredCommandProgression,")")]={requiredCommandProgression:requiredCommandProgression,considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,onTheSameLineAsPrevScenario:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.positionOfUnit.test(tokensWithNumbersInsteadOfWords)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var unitPosition=regexps.positionOfUnit.match(tokensWithNumbersInsteadOfWords)[0]*1-1;parserState.lastMentionedUnitPosition=unitPosition;if(parserState.applyHighlighting){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cuph" ref-id="">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="cupph" ref-id="">'.concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition,"</span>").concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var tokensWithNumbersInsteadOfWordsWithTrimmedEnd=joinedTokenValuesWithRealDelimiters.trimEnd();var tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition=tokensWithNumbersInsteadOfWordsWithTrimmedEnd.replace(regexps.positionPreposition,function(match,p1,p2,p3,p4){return"".concat(p1||"",'<span class="cuph">').concat(p4,"</span>")});parserState.highlightsHtmlBuffer.push("".concat(tokensWithNumbersInsteadOfWordsWithTrimmedEndWithHighlightedPosition).concat(joinedTokenValuesWithRealDelimiters.slice(tokensWithNumbersInsteadOfWordsWithTrimmedEnd.length)))},itIsNewCommandProgressionFromLevel:commandProgressionLevel};addLineMeasureStaveVoicePositionScenarios(scenarios,requiredCommandProgression,[],commandProgressionLevel,false,allowedCoordinates)}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./static-objects/regexps":130,"./token/withNumbersInsteadOfWords":164}],66:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll=require("./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll");var initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll=require("./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll");var lastMeasureParams=require("./page-schema/lastMeasureParams");var lastStaveParams=require("./page-schema/lastStaveParams");module.exports=function(scenarios){scenarios["voice"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return currentToken.firstOnTheLine&&regexps.voice.test([currentToken.value])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll(parserState.pageSchema,"stavesParams",parserState);var lastMeasureParamsValue=lastMeasureParams(parserState.pageSchema);initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll(lastMeasureParamsValue,"voicesParams",parserState);var lastStaveParamsValue=lastStaveParams(lastMeasureParamsValue);lastStaveParamsValue.voicesParams=lastStaveParamsValue.voicesParams||[];lastStaveParamsValue.voicesParams.push([]);var numberOfMeasures=parserState.pageSchema.measuresParams.length;var numberOfStaves=lastMeasureParamsValue.stavesParams.length;var numberOfVoices=lastStaveParamsValue.voicesParams.length;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.voiceHighlight,function(match){return'<span class="cvph" ref-id="voice-'.concat(numberOfMeasures,"-").concat(numberOfStaves,"-").concat(numberOfVoices,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="voice-'.concat(numberOfMeasures,"-").concat(numberOfStaves,"-").concat(numberOfVoices,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.voiceHighlight,function(match){return'<span class="cvph">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0}}},{"./page-schema/initNewMeasureParamsIfThereIsAlreadySuchMeasurePropertyOrNoMeasuresAtAll":79,"./page-schema/initNewStaveParamsIfThereIsAlreadySuchStavePropertyOrNoStavesAtAll":80,"./page-schema/lastMeasureParams":89,"./page-schema/lastStaveParams":93,"./static-objects/regexps":130}],67:[function(require,module,exports){"use strict";var regexps=require("./static-objects/regexps");var isVerticalCorrection=require("./token/isVerticalCorrection");var verticalCorrection=require("./token/verticalCorrection");var foundNextTokenValueOnTheLine=require("./token/foundNextTokenValueOnTheLine");var measureParamsByLastMentionedMeasurePosition=require("./page-schema/measureParamsByLastMentionedMeasurePosition");var undefineAllMentionedPositions=require("./page-schema/undefineAllMentionedPositions");var undefineOnlyLastMentionedMeasurePosition=require("./page-schema/undefineOnlyLastMentionedMeasurePosition");var fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded=require("./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded");var addLineMeasureStaveVoicePositionScenarios=require("./addLineMeasureStaveVoicePositionScenarios");module.exports=function(scenarios){scenarios["volta"]={considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,startsOnNewLine:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.volta.test(tokenValues)&&!regexps.brackets.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.voltaBrackets.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){undefineAllMentionedPositions(parserState);parserState.numberOfVoltaMarks+=1;parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)]={key:"volta-mark-".concat(parserState.numberOfVoltaMarks)};parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)]={key:"volta-mark-".concat(parserState.numberOfVoltaMarks)};if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.voltaBracketsHighlight,function(match){return'<span class="eh" ref-id="volta-mark-'.concat(parserState.numberOfVoltaMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="volta-mark-'.concat(parserState.numberOfVoltaMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.voltaBracketsHighlight,function(match){return'<span class="eh">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:0,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState,true);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedMeasurePosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};scenarios["volta with text"]={requiredCommandProgression:"volta",condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.withText.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){var voltaText=regexps.withText.match(tokenValues)[0];parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].value=voltaText;if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth" ref-id="volta-mark-text-'.concat(parserState.numberOfVoltaMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="volta-mark-text-'.concat(parserState.numberOfVoltaMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedString,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedString=joinedTokenValuesWithRealDelimiters.replace(regexps.stringHighlight,function(match){return'<span class="sth">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedString)},itIsNewCommandProgressionFromLevel:1};scenarios["volta starts before"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at","volta finishes after","volta starts at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.startsBefore.test(tokenValues)||regexps.before.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedMeasurePosition===undefined){parserState.errors.push("measure position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var measureParamsValue=measureParamsByLastMentionedMeasurePosition(parserState);if(!measureParamsValue){parserState.errors.push("measure after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].startsHere=false;parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].startsBefore=true;if(!parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesHere&&!parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesAfter){parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesHere=true}measureParamsValue.voltaMark=parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)]}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedMeasurePosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addLineMeasureStaveVoicePositionScenarios(scenarios,"volta starts before",[],2,false,{measure:true});scenarios["volta finishes after"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return regexps.finishesAfter.test(tokenValues)||regexps.after.test(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedMeasurePosition===undefined){parserState.errors.push("measure position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var measureParamsValue=measureParamsByLastMentionedMeasurePosition(parserState);if(!measureParamsValue){parserState.errors.push("measure after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{if(measureParamsValue.voltaMark){measureParamsValue.voltaMark.finishesHere=false;measureParamsValue.voltaMark.finishesAfter=true}else{parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesHere=false;parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesAfter=true;if(!parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].startsHere){parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)].startsHere=true}measureParamsValue.voltaMark=parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)]}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedMeasurePosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addLineMeasureStaveVoicePositionScenarios(scenarios,"volta finishes after",[],2,false,{measure:true});scenarios["volta starts at"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at","volta finishes after","volta starts after"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.starts.test(tokenValues)&&!regexps.from.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])||regexps.from.test(tokenValues)||regexps.startsFrom.test(tokenValues))&&!regexps.before.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedMeasurePosition===undefined){parserState.errors.push("measure position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var measureParamsValue=measureParamsByLastMentionedMeasurePosition(parserState);if(!measureParamsValue){parserState.errors.push("measure after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].startsHere=true;measureParamsValue.voltaMark=parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)]}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedMeasurePosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addLineMeasureStaveVoicePositionScenarios(scenarios,"volta starts at",[],2,false,{measure:true});scenarios["volta finishes at"]={requiredCommandProgression:"volta",prohibitedCommandProgressions:["volta finishes at"],considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return(regexps.finishes.test(tokenValues)||regexps.to.test(tokenValues))&&!regexps.after.test([foundNextTokenValueOnTheLine(unitext,currentToken.firstCharIndexOfNextToken)])},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){if(parserState.applyHighlighting){parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="">'.concat(joinedTokenValuesWithRealDelimiters));parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.push(parserState.highlightsHtmlBuffer.length-1)}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimiters)},itIsNewCommandProgressionFromLevel:1,actionWhenProgressionOfCommandsChanges:function actionWhenProgressionOfCommandsChanges(parserState,scenarioNameThatChangedCommandsProgression,lineNumber,argumentsFromMainAction){if(parserState.lastMentionedMeasurePosition===undefined){parserState.errors.push("measure position after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not specified on the line number ").concat(argumentsFromMainAction.lineNumber))}else{var measureParamsValue=measureParamsByLastMentionedMeasurePosition(parserState);if(!measureParamsValue){parserState.errors.push("measure after command '".concat(argumentsFromMainAction.joinedTokenValuesWithRealDelimiters,"' is not found on the line ").concat(argumentsFromMainAction.lineNumber))}else{if(measureParamsValue.voltaMark){measureParamsValue.voltaMark.finishesHere=true}else{parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesHere=false;parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)].finishesHere=true;measureParamsValue.voltaMark=parserState["lastFinishVoltaMark-".concat(parserState.numberOfVoltaMarks)]}}}if(parserState.applyHighlighting){fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded(parserState);parserState.highlightsHtmlBuffer.push("</span>")}undefineOnlyLastMentionedMeasurePosition(parserState)},activateActionWhenProgressionOfCommandsChangesIfItIsLastTokenAndActionDidntHappenBefore:true};addLineMeasureStaveVoicePositionScenarios(scenarios,"volta finishes at",[],2,false,{measure:true});scenarios["volta vertical correction"]={requiredCommandProgression:"volta",considerJoinedTokenAccumulatorWithoutCommandDelimitersAsPartOfTokensAndConjunctionsBetweenThem:true,condition:function condition(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){return isVerticalCorrection(tokenValues)},action:function action(unitext,lineNumber,currentToken,tokenValues,joinedTokenValuesWithRealDelimiters,progressionOfCommandsFromScenarios,parserState){parserState["lastStartVoltaMark-".concat(parserState.numberOfVoltaMarks)].yCorrection=verticalCorrection(tokenValues);if(parserState.applyHighlighting){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th" ref-id="volta-mark-'.concat(parserState.numberOfVoltaMarks,'">').concat(match,"</span>")});parserState.highlightsHtmlBuffer.push('<span class="th" ref-id="volta-mark-'.concat(parserState.numberOfVoltaMarks,'">').concat(joinedTokenValuesWithRealDelimitersWithHighlightedElement,"</span>"))}},actionOnlyForHighlightingWithoutRefIds:function actionOnlyForHighlightingWithoutRefIds(parserState,joinedTokenValuesWithRealDelimiters,tokenValues){var joinedTokenValuesWithRealDelimitersWithHighlightedElement=joinedTokenValuesWithRealDelimiters.replace(regexps.verticalCorrectionHighlight,function(match){return'<span class="th">'.concat(match,"</span>")});parserState.highlightsHtmlBuffer.push(joinedTokenValuesWithRealDelimitersWithHighlightedElement)},itIsNewCommandProgressionFromLevel:1};addLineMeasureStaveVoicePositionScenarios(scenarios,"volta",["volta with text","volta starts before","volta starts before","volta finishes after","volta starts at","volta finishes at","volta vertical correction"],1,true,{line:true})}},{"./addLineMeasureStaveVoicePositionScenarios":42,"./highlights-html-buffer/fillAllPlaceholdersInHighlightsHtmlBufferWithMentionedPositionsWhereItsNeeded":68,"./page-schema/measureParamsByLastMentionedMeasurePosition":95,"./page-schema/undefineAllMentionedPositions":99,"./page-schema/undefineOnlyLastMentionedMeasurePosition":100,"./static-objects/regexps":130,"./token/foundNextTokenValueOnTheLine":140,"./token/isVerticalCorrection":153,"./token/verticalCorrection":163}],68:[function(require,module,exports){"use strict";var currentPageLineIndex=require("./../page-schema/currentPageLineIndex");module.exports=function(parserState,forConnection){var indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders=forConnection?parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholdersForConnection:parserState.indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders;if(parserState.calculatedUnitPageLineIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitMeasureIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitStaveIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitVoiceIndexByLastMentionedPositions!==undefined&&parserState.calculatedUnitIndexByLastMentionedPositions!==undefined&&!forConnection){for(var index=0;index<indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.length;index++){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="clph" ref-id=""','class="clph" ref-id="line-'.concat(parserState.calculatedUnitPageLineIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="clpph" ref-id=""','class="clpph" ref-id="line-'.concat(parserState.calculatedUnitPageLineIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cmph" ref-id=""','class="cmph" ref-id="measure-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cmpph" ref-id=""','class="cmpph" ref-id="measure-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="csph" ref-id=""','class="csph" ref-id="stave-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cspph" ref-id=""','class="cspph" ref-id="stave-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cvph" ref-id=""','class="cvph" ref-id="voice-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitVoiceIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cvpph" ref-id=""','class="cvpph" ref-id="voice-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitVoiceIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cuph" ref-id=""','class="cuph" ref-id="unit-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitVoiceIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="cupph" ref-id=""','class="cupph" ref-id="unit-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitVoiceIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitIndexByLastMentionedPositions+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[index]].replace('class="th" ref-id=""','class="th" ref-id="unit-'.concat(parserState.calculatedUnitMeasureIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitStaveIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitVoiceIndexByLastMentionedPositions+1,"-").concat(parserState.calculatedUnitIndexByLastMentionedPositions+1,'"'))}}else{var pageLinePosition=forConnection?parserState.lastMentionedConnectionPageLinePosition:parserState.lastMentionedPageLinePosition;var measurePosition=forConnection?parserState.lastMentionedConnectionMeasurePosition:parserState.lastMentionedMeasurePosition;var stavePosition=forConnection?parserState.lastMentionedConnectionStavePosition:parserState.lastMentionedStavePosition;var voicePosition=forConnection?parserState.lastMentionedConnectionVoicePosition:parserState.lastMentionedVoicePosition;var pageLinePositionIsNotSpecified=pageLinePosition===undefined;var measurePositionIsSpecified=measurePosition!==undefined;var stavePositionIsSpecified=stavePosition!==undefined;var voicePositionIsSpecified=voicePosition!==undefined;if(pageLinePositionIsNotSpecified){pageLinePosition=currentPageLineIndex(parserState);pageLinePositionIsNotSpecified=pageLinePosition===undefined}if(!pageLinePositionIsNotSpecified){for(var _index=0;_index<indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.length;_index++){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="clph" ref-id=""','class="clph" ref-id="line-'.concat(pageLinePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="clpph" ref-id=""','class="clpph" ref-id="line-'.concat(pageLinePosition+1,'"'));if(measurePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cmph" ref-id=""','class="cmph" ref-id="measure-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cmpph" ref-id=""','class="cmpph" ref-id="measure-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,'"'));if(stavePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="csph" ref-id=""','class="csph" ref-id="stave-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(stavePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cspph" ref-id=""','class="cspph" ref-id="stave-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(stavePosition+1,'"'));if(voicePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvph" ref-id=""','class="cvph" ref-id="voice-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(stavePosition+1,"-").concat(voicePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvpph" ref-id=""','class="cvpph" ref-id="voice-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(stavePosition+1,"-").concat(voicePosition+1,'"'))}}else{if(voicePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvph" ref-id=""','class="cvph" ref-id="voice-in-measure-on-all-staves-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(voicePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvpph" ref-id=""','class="cvpph" ref-id="voice-in-measure-on-all-staves-'.concat(pageLinePosition+1,"-").concat(measurePosition+1,"-").concat(voicePosition+1,'"'))}}}else{if(stavePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="csph" ref-id=""','class="csph" ref-id="stave-in-all-measures-on-line-'.concat(pageLinePosition+1,"-").concat(stavePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cspph" ref-id=""','class="cspph" ref-id="stave-in-all-measures-on-line-'.concat(pageLinePosition+1,"-").concat(stavePosition+1,'"'));if(voicePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvph" ref-id=""','class="cvph" ref-id="voice-'.concat(stavePosition+1,"-").concat(voicePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvpph" ref-id=""','class="cvpph" ref-id="voice-'.concat(stavePosition+1,"-").concat(voicePosition+1,'"'))}}else{if(voicePositionIsSpecified){parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvph" ref-id=""','class="cvph" ref-id="voice-in-all-measures-and-on-all-staves-on-line-'.concat(pageLinePosition+1,"-").concat(voicePosition+1,'"'));parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]]=parserState.highlightsHtmlBuffer[indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders[_index]].replace('class="cvpph" ref-id=""','class="cvpph" ref-id="voice-in-all-measures-and-on-all-staves-on-line-'.concat(pageLinePosition+1,"-").concat(voicePosition+1,'"'))}}}}}}indexesInHighlightsHtmlBufferWhereWeShouldFillPositionPlaceholders.length=0}},{"./../page-schema/currentPageLineIndex":77}],69:[function(require,module,exports){"use strict";module.exports=function(parserScenarios){var resultMap={common:[]};for(var scenarioName in parserScenarios){var scenario=parserScenarios[scenarioName];if(scenario.requiredCommandProgression){if(!resultMap[scenario.requiredCommandProgression]){resultMap[scenario.requiredCommandProgression]=[]}resultMap[scenario.requiredCommandProgression].push(scenarioName)}else{resultMap.common.push(scenarioName)}}return resultMap}},{}],70:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey,direction){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.direction=direction}}},{"./slurMarkWithSpecifiedKey":98}],71:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey,yCorrection){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.leftYCorrection=yCorrection}}},{"./slurMarkWithSpecifiedKey":98}],72:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey,placement){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.rightPlacement=placement}}},{"./slurMarkWithSpecifiedKey":98}],73:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey,yCorrection){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.rightYCorrection=yCorrection}}},{"./slurMarkWithSpecifiedKey":98}],74:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey,roundness){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.roundCoefficientFactor=roundness}}},{"./slurMarkWithSpecifiedKey":98}],75:[function(require,module,exports){"use strict";var slurMarkWithSpecifiedKey=require("./slurMarkWithSpecifiedKey");module.exports=function(parserState,slurMarkKey){var foundSlurMarkWithSpecifiedKey=slurMarkWithSpecifiedKey(parserState,slurMarkKey);if(foundSlurMarkWithSpecifiedKey){foundSlurMarkWithSpecifiedKey.sShape=true}}},{"./slurMarkWithSpecifiedKey":98}],76:[function(require,module,exports){"use strict";var currentPageLineIndex=require("./currentPageLineIndex");module.exports=function(parserState){var pageSchema=parserState.pageSchema;var unitPosition=parserState.lastMentionedUnitPosition;var unitPageLinePosition=parserState.lastMentionedPageLinePosition;var unitMeasurePosition=parserState.lastMentionedMeasurePosition;var unitStavePosition=parserState.lastMentionedStavePosition;var unitVoicePosition=parserState.lastMentionedVoicePosition;var unitPositionIsNotSpecified=unitPosition===undefined;var unitPageLinePositionIsNotSpecified=unitPageLinePosition===undefined;var unitMeasurePositionIsNotSpecified=unitMeasurePosition===undefined;var unitStavePositionIsNotSpecified=unitStavePosition===undefined;var unitVoicePositionIsNotSpecified=unitVoicePosition===undefined;if(unitPageLinePositionIsNotSpecified){unitPageLinePosition=currentPageLineIndex(parserState);unitPageLinePositionIsNotSpecified=unitPageLinePosition===undefined;parserState.calculatedUnitPageLineIndexByLastMentionedPositions=unitPageLinePosition}else{parserState.calculatedUnitPageLineIndexByLastMentionedPositions=unitPageLinePosition}if(unitPositionIsNotSpecified){return null}if(!unitMeasurePositionIsNotSpecified){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=undefined}if(!unitStavePositionIsNotSpecified){parserState.calculatedUnitStaveIndexByLastMentionedPositions=undefined}if(!unitVoicePositionIsNotSpecified){parserState.calculatedUnitVoiceIndexByLastMentionedPositions=undefined}if(pageSchema.measuresParams){if(unitPageLinePositionIsNotSpecified){if(unitMeasurePositionIsNotSpecified){if(unitStavePositionIsNotSpecified){if(unitVoicePositionIsNotSpecified){var unitCount=0;for(var measureIndex=0;measureIndex<pageSchema.measuresParams.length;measureIndex++){if(pageSchema.measuresParams[measureIndex].stavesParams){for(var staveIndex=0;staveIndex<pageSchema.measuresParams[measureIndex].stavesParams.length;staveIndex++){if(pageSchema.measuresParams[measureIndex].stavesParams[staveIndex]&&pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams){for(var voiceIndex=0;voiceIndex<pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams.length;voiceIndex++){if(pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex]){for(var unitIndex=0;unitIndex<pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex].length;unitIndex++){if(unitCount===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=measureIndex;parserState.calculatedUnitStaveIndexByLastMentionedPositions=staveIndex;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=voiceIndex;parserState.calculatedUnitIndexByLastMentionedPositions=unitIndex;return pageSchema.measuresParams[measureIndex].stavesParams[staveIndex].voicesParams[voiceIndex][unitIndex]}unitCount+=1}}}}}}}}else{var _unitCount=0;for(var _measureIndex=0;_measureIndex<pageSchema.measuresParams.length;_measureIndex++){if(pageSchema.measuresParams[_measureIndex].stavesParams){for(var _staveIndex=0;_staveIndex<pageSchema.measuresParams[_measureIndex].stavesParams.length;_staveIndex++){if(pageSchema.measuresParams[_measureIndex].stavesParams[_staveIndex]&&pageSchema.measuresParams[_measureIndex].stavesParams[_staveIndex].voicesParams&&pageSchema.measuresParams[_measureIndex].stavesParams[_staveIndex].voicesParams[unitVoicePosition]){for(var _unitIndex=0;_unitIndex<pageSchema.measuresParams[_measureIndex].stavesParams[_staveIndex].voicesParams[unitVoicePosition].length;_unitIndex++){if(_unitCount===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex;return pageSchema.measuresParams[_measureIndex].stavesParams[_staveIndex].voicesParams[unitVoicePosition][_unitIndex]}_unitCount+=1}}}}}}}else{if(unitVoicePositionIsNotSpecified){var _unitCount2=0;for(var _measureIndex2=0;_measureIndex2<pageSchema.measuresParams.length;_measureIndex2++){if(pageSchema.measuresParams[_measureIndex2].stavesParams&&pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition].voicesParams){for(var _voiceIndex=0;_voiceIndex<pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition].voicesParams.length;_voiceIndex++){if(pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition].voicesParams[_voiceIndex]){for(var _unitIndex2=0;_unitIndex2<pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition].voicesParams[_voiceIndex].length;_unitIndex2++){if(_unitCount2===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex2;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex2;return pageSchema.measuresParams[_measureIndex2].stavesParams[unitStavePosition].voicesParams[_voiceIndex][_unitIndex2]}_unitCount2+=1}}}}}}else{var _unitCount3=0;for(var _measureIndex3=0;_measureIndex3<pageSchema.measuresParams.length;_measureIndex3++){if(pageSchema.measuresParams[_measureIndex3].stavesParams&&pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition].voicesParams&&pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition].voicesParams[unitVoicePosition]){if(pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition].voicesParams[unitVoicePosition]){for(var _unitIndex3=0;_unitIndex3<pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition].voicesParams[unitVoicePosition].length;_unitIndex3++){if(_unitCount3===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex3;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex3;return pageSchema.measuresParams[_measureIndex3].stavesParams[unitStavePosition].voicesParams[unitVoicePosition][_unitIndex3]}_unitCount3+=1}}}}}}}else{if(unitStavePositionIsNotSpecified){if(unitVoicePositionIsNotSpecified){var _unitCount4=0;if(pageSchema.measuresParams[unitMeasurePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams){for(var _staveIndex2=0;_staveIndex2<pageSchema.measuresParams[unitMeasurePosition].stavesParams.length;_staveIndex2++){if(pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2].voicesParams){for(var _voiceIndex2=0;_voiceIndex2<pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2].voicesParams.length;_voiceIndex2++){if(pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2].voicesParams[_voiceIndex2]){for(var _unitIndex4=0;_unitIndex4<pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2].voicesParams[_voiceIndex2].length;_unitIndex4++){if(_unitCount4===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=unitMeasurePosition;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex2;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex2;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex4;return pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex2].voicesParams[_voiceIndex2][_unitIndex4]}_unitCount4+=1}}}}}}}else{var _unitCount5=0;if(pageSchema.measuresParams[unitMeasurePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams){for(var _staveIndex3=0;_staveIndex3<pageSchema.measuresParams[unitMeasurePosition].stavesParams.length;_staveIndex3++){if(pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex3].voicesParams&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex3].voicesParams[unitVoicePosition]){for(var _unitIndex5=0;_unitIndex5<pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex3].voicesParams[unitVoicePosition].length;_unitIndex5++){if(_unitCount5===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=unitMeasurePosition;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex3;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex5;return pageSchema.measuresParams[unitMeasurePosition].stavesParams[_staveIndex3].voicesParams[unitVoicePosition][_unitIndex5]}_unitCount5+=1}}}}}}else{if(unitVoicePositionIsNotSpecified){var _unitCount6=0;if(pageSchema.measuresParams[unitMeasurePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams){for(var _voiceIndex3=0;_voiceIndex3<pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams.length;_voiceIndex3++){if(pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[_voiceIndex3]){for(var _unitIndex6=0;_unitIndex6<pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[_voiceIndex3].length;_unitIndex6++){if(_unitCount6===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=unitMeasurePosition;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex3;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex6;return pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[_voiceIndex3][_unitIndex6]}_unitCount6+=1}}}}}else{var _unitCount7=0;if(pageSchema.measuresParams[unitMeasurePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition]&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams&&pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[unitVoicePosition]){for(var _unitIndex7=0;_unitIndex7<pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[unitVoicePosition].length;_unitIndex7++){if(_unitCount7===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=unitMeasurePosition;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex7;return pageSchema.measuresParams[unitMeasurePosition].stavesParams[unitStavePosition].voicesParams[unitVoicePosition][_unitIndex7]}_unitCount7+=1}}}}}}else{if(unitMeasurePositionIsNotSpecified){if(unitStavePositionIsNotSpecified){if(unitVoicePositionIsNotSpecified){var lineCount=0;var unitOnLineCount=0;for(var _measureIndex4=0;_measureIndex4<pageSchema.measuresParams.length;_measureIndex4++){var lastMeasureOnPageLine=pageSchema.measuresParams[_measureIndex4].isLastMeasureOnPageLine||_measureIndex4===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex4].stavesParams){for(var _staveIndex4=0;_staveIndex4<pageSchema.measuresParams[_measureIndex4].stavesParams.length;_staveIndex4++){if(pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4]&&pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4].voicesParams){for(var _voiceIndex4=0;_voiceIndex4<pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4].voicesParams.length;_voiceIndex4++){if(pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4].voicesParams[_voiceIndex4]){for(var _unitIndex8=0;_unitIndex8<pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4].voicesParams[_voiceIndex4].length;_unitIndex8++){if(lineCount===unitPageLinePosition&&unitOnLineCount===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex4;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex4;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex4;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex8;return pageSchema.measuresParams[_measureIndex4].stavesParams[_staveIndex4].voicesParams[_voiceIndex4][_unitIndex8]}unitOnLineCount+=1}}}}}}if(lastMeasureOnPageLine){unitOnLineCount=0;lineCount+=1}}}else{var _lineCount=0;var _unitOnLineCount=0;for(var _measureIndex5=0;_measureIndex5<pageSchema.measuresParams.length;_measureIndex5++){var _lastMeasureOnPageLine=pageSchema.measuresParams[_measureIndex5].isLastMeasureOnPageLine||_measureIndex5===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex5].stavesParams){for(var _staveIndex5=0;_staveIndex5<pageSchema.measuresParams[_measureIndex5].stavesParams.length;_staveIndex5++){if(pageSchema.measuresParams[_measureIndex5].stavesParams[_staveIndex5]&&pageSchema.measuresParams[_measureIndex5].stavesParams[_staveIndex5].voicesParams&&pageSchema.measuresParams[_measureIndex5].stavesParams[_staveIndex5].voicesParams[unitVoicePosition]){for(var _unitIndex9=0;_unitIndex9<pageSchema.measuresParams[_measureIndex5].stavesParams[_staveIndex5].voicesParams[unitVoicePosition].length;_unitIndex9++){if(_lineCount===unitPageLinePosition&&_unitOnLineCount===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex5;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex5;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex9;return pageSchema.measuresParams[_measureIndex5].stavesParams[_staveIndex5].voicesParams[unitVoicePosition][_unitIndex9]}_unitOnLineCount+=1}}}}if(_lastMeasureOnPageLine){_unitOnLineCount=0;_lineCount+=1}}}}else{if(unitVoicePositionIsNotSpecified){var _lineCount2=0;var _unitOnLineCount2=0;for(var _measureIndex6=0;_measureIndex6<pageSchema.measuresParams.length;_measureIndex6++){var _lastMeasureOnPageLine2=pageSchema.measuresParams[_measureIndex6].isLastMeasureOnPageLine||_measureIndex6===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex6].stavesParams){if(pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition].voicesParams){for(var _voiceIndex5=0;_voiceIndex5<pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition].voicesParams.length;_voiceIndex5++){if(pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition].voicesParams[_voiceIndex5]){for(var _unitIndex10=0;_unitIndex10<pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition].voicesParams[_voiceIndex5].length;_unitIndex10++){if(_lineCount2===unitPageLinePosition&&_unitOnLineCount2===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex6;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex5;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex10;return pageSchema.measuresParams[_measureIndex6].stavesParams[unitStavePosition].voicesParams[_voiceIndex5][_unitIndex10]}_unitOnLineCount2+=1}}}}}if(_lastMeasureOnPageLine2){_unitOnLineCount2=0;_lineCount2+=1}}}else{var _lineCount3=0;var _unitOnLineCount3=0;for(var _measureIndex7=0;_measureIndex7<pageSchema.measuresParams.length;_measureIndex7++){var _lastMeasureOnPageLine3=pageSchema.measuresParams[_measureIndex7].isLastMeasureOnPageLine||_measureIndex7===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex7].stavesParams){if(pageSchema.measuresParams[_measureIndex7].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex7].stavesParams[unitStavePosition].voicesParams&&pageSchema.measuresParams[_measureIndex7].stavesParams[unitStavePosition].voicesParams[unitVoicePosition]){for(var _unitIndex11=0;_unitIndex11<pageSchema.measuresParams[_measureIndex7].stavesParams[unitStavePosition].voicesParams[unitVoicePosition].length;_unitIndex11++){if(_lineCount3===unitPageLinePosition&&_unitOnLineCount3===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex7;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex11;return pageSchema.measuresParams[_measureIndex7].stavesParams[unitStavePosition].voicesParams[unitVoicePosition][_unitIndex11]}_unitOnLineCount3+=1}}}if(_lastMeasureOnPageLine3){_unitOnLineCount3=0;_lineCount3+=1}}}}}else{if(unitStavePositionIsNotSpecified){if(unitVoicePositionIsNotSpecified){var _lineCount4=0;var measureOnLineCount=0;for(var _measureIndex8=0;_measureIndex8<pageSchema.measuresParams.length;_measureIndex8++){var _lastMeasureOnPageLine4=pageSchema.measuresParams[_measureIndex8].isLastMeasureOnPageLine||_measureIndex8===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex8].stavesParams){for(var _staveIndex6=0;_staveIndex6<pageSchema.measuresParams[_measureIndex8].stavesParams.length;_staveIndex6++){if(pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6]&&pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6].voicesParams){for(var _voiceIndex6=0;_voiceIndex6<pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6].voicesParams.length;_voiceIndex6++){if(pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6].voicesParams[_voiceIndex6]){for(var _unitIndex12=0;_unitIndex12<pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6].voicesParams[_voiceIndex6].length;_unitIndex12++){if(_lineCount4===unitPageLinePosition&&measureOnLineCount===unitMeasurePosition&&_unitIndex12===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex8;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex6;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex6;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex12;return pageSchema.measuresParams[_measureIndex8].stavesParams[_staveIndex6].voicesParams[_voiceIndex6][_unitIndex12]}}}}}}}if(_lastMeasureOnPageLine4){_lineCount4+=1;measureOnLineCount=0}else{measureOnLineCount+=1}}}else{var _lineCount5=0;var _measureOnLineCount=0;for(var _measureIndex9=0;_measureIndex9<pageSchema.measuresParams.length;_measureIndex9++){var _lastMeasureOnPageLine5=pageSchema.measuresParams[_measureIndex9].isLastMeasureOnPageLine||_measureIndex9===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex9].stavesParams){for(var _staveIndex7=0;_staveIndex7<pageSchema.measuresParams[_measureIndex9].stavesParams.length;_staveIndex7++){if(pageSchema.measuresParams[_measureIndex9].stavesParams[_staveIndex7]&&pageSchema.measuresParams[_measureIndex9].stavesParams[_staveIndex7].voicesParams&&pageSchema.measuresParams[_measureIndex9].stavesParams[_staveIndex7].voicesParams[unitVoicePosition]){for(var _unitIndex13=0;_unitIndex13<pageSchema.measuresParams[_measureIndex9].stavesParams[_staveIndex7].voicesParams[unitVoicePosition].length;_unitIndex13++){if(_lineCount5===unitPageLinePosition&&_measureOnLineCount===unitMeasurePosition&&_unitIndex13===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex9;parserState.calculatedUnitStaveIndexByLastMentionedPositions=_staveIndex7;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex13;return pageSchema.measuresParams[_measureIndex9].stavesParams[_staveIndex7].voicesParams[unitVoicePosition][_unitIndex13]}}}}}if(_lastMeasureOnPageLine5){_lineCount5+=1;_measureOnLineCount=0}else{_measureOnLineCount+=1}}}}else{if(unitVoicePositionIsNotSpecified){var _lineCount6=0;var _measureOnLineCount2=0;for(var _measureIndex10=0;_measureIndex10<pageSchema.measuresParams.length;_measureIndex10++){var _lastMeasureOnPageLine6=pageSchema.measuresParams[_measureIndex10].isLastMeasureOnPageLine||_measureIndex10===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex10].stavesParams){if(pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition].voicesParams){for(var _voiceIndex7=0;_voiceIndex7<pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition].voicesParams.length;_voiceIndex7++){if(pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition].voicesParams[_voiceIndex7]){for(var _unitIndex14=0;_unitIndex14<pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition].voicesParams[_voiceIndex7].length;_unitIndex14++){if(_lineCount6===unitPageLinePosition&&_measureOnLineCount2===unitMeasurePosition&&_unitIndex14===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex10;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=_voiceIndex7;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex14;return pageSchema.measuresParams[_measureIndex10].stavesParams[unitStavePosition].voicesParams[_voiceIndex7][_unitIndex14]}}}}}}if(_lastMeasureOnPageLine6){_lineCount6+=1;_measureOnLineCount2=0}else{_measureOnLineCount2+=1}}}else{var _lineCount7=0;var _measureOnLineCount3=0;for(var _measureIndex11=0;_measureIndex11<pageSchema.measuresParams.length;_measureIndex11++){var _lastMeasureOnPageLine7=pageSchema.measuresParams[_measureIndex11].isLastMeasureOnPageLine||_measureIndex11===pageSchema.measuresParams.length-1;if(pageSchema.measuresParams[_measureIndex11].stavesParams){if(pageSchema.measuresParams[_measureIndex11].stavesParams[unitStavePosition]&&pageSchema.measuresParams[_measureIndex11].stavesParams[unitStavePosition].voicesParams&&pageSchema.measuresParams[_measureIndex11].stavesParams[unitStavePosition].voicesParams[unitVoicePosition]){for(var _unitIndex15=0;_unitIndex15<pageSchema.measuresParams[_measureIndex11].stavesParams[unitStavePosition].voicesParams[unitVoicePosition].length;_unitIndex15++){if(_lineCount7===unitPageLinePosition&&_measureOnLineCount3===unitMeasurePosition&&_unitIndex15===unitPosition){parserState.calculatedUnitMeasureIndexByLastMentionedPositions=_measureIndex11;parserState.calculatedUnitStaveIndexByLastMentionedPositions=unitStavePosition;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=unitVoicePosition;parserState.calculatedUnitIndexByLastMentionedPositions=_unitIndex15;return pageSchema.measuresParams[_measureIndex11].stavesParams[unitStavePosition].voicesParams[unitVoicePosition][_unitIndex15]}}}}if(_lastMeasureOnPageLine7){_lineCount7+=1;_measureOnLineCount3=0}else{_measureOnLineCount3+=1}}}}}}}return null}},{"./currentPageLineIndex":77}],77:[function(require,module,exports){"use strict";module.exports=function(parserState){var currentPageLineIndex;if(parserState.pageSchema.measuresParams){currentPageLineIndex=parserState.numberOfPageLines-1}return currentPageLineIndex}},{}],78:[function(require,module,exports){"use strict";module.exports=function(pageSchema,parserState){pageSchema.measuresParams=pageSchema.measuresParams||[];if(parserState.numberOfPageLines===0){parserState.numberOfPageLines+=1}if(!parserState.newlineAlreadyIntroducedNewMeasure){pageSchema.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:parserState.numberOfPageLines})}parserState.newlineAlreadyIntroducedNewMeasure=false}},{}],79:[function(require,module,exports){"use strict";var lastMeasureParams=require("./lastMeasureParams");module.exports=function(pageSchema,componentName,parserState){pageSchema.measuresParams=pageSchema.measuresParams||[];if(parserState.numberOfPageLines===0){parserState.numberOfPageLines+=1}var componentNameIsNotBarLine=componentName!=="closingBarLineName";if(pageSchema.measuresParams.length===0){if(componentNameIsNotBarLine){pageSchema.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:parserState.numberOfPageLines})}else if(!parserState.newlineAlreadyIntroducedNewMeasure){pageSchema.measuresParams.push({pageLineNumber:parserState.numberOfPageLines})}}if(componentName){if(lastMeasureParams(pageSchema)[componentName]&&!Array.isArray(lastMeasureParams(pageSchema)[componentName])&&componentNameIsNotBarLine&&!parserState.newlineAlreadyIntroducedNewMeasure){pageSchema.measuresParams.push({closingBarLineName:"barLine",pageLineNumber:parserState.numberOfPageLines})}}parserState.newlineAlreadyIntroducedNewMeasure=false;parserState.newlineAlreadyIntroducedNewStave=false}},{"./lastMeasureParams":89}],80:[function(require,module,exports){"use strict";var lastStaveParams=require("./lastStaveParams");module.exports=function(lastMeasureParams,componentName,parserState){if(!lastMeasureParams.stavesParams){lastMeasureParams.stavesParams=[]}if(lastMeasureParams.stavesParams.length===0){lastMeasureParams.stavesParams.push({})}if(componentName){if(lastStaveParams(lastMeasureParams)[componentName]&&!Array.isArray(lastStaveParams(lastMeasureParams)[componentName])){lastMeasureParams.stavesParams.push({})}}}},{"./lastStaveParams":93}],81:[function(require,module,exports){"use strict";var lastNonSimileChordParams=require("./lastNonSimileChordParams");module.exports=function(lastStaveParams,componentName,parserState){if(!lastStaveParams.voicesParams){lastStaveParams.voicesParams=[]}if(lastStaveParams.voicesParams.length===0){lastStaveParams.voicesParams.push([])}if(componentName){var lastChordParamsValue=lastNonSimileChordParams(lastStaveParams);if(lastChordParamsValue&&lastChordParamsValue[componentName]&&!Array.isArray(lastChordParamsValue[componentName])){lastStaveParams.voicesParams.push([])}}}},{"./lastNonSimileChordParams":90}],82:[function(require,module,exports){"use strict";var keySignatureNames=require("./../static-objects/keySignatureNames");module.exports=function(keySignatureNameFromUnitext){return keySignatureNames.find(function(keySignatureName){return keySignatureName.split("|").indexOf(keySignatureNameFromUnitext)!==-1})}},{"./../static-objects/keySignatureNames":117}],83:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.articulationParams[lastChordParams.articulationParams.length-1]}},{}],84:[function(require,module,exports){"use strict";module.exports=function(lastMeasureParams){return lastMeasureParams.connectionsParams[lastMeasureParams.connectionsParams.length-1]}},{}],85:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.glissandoMarks[lastChordParams.glissandoMarks.length-1]}},{}],86:[function(require,module,exports){"use strict";module.exports=function(lastMeasureParams){return lastMeasureParams.instrumentTitlesParams[lastMeasureParams.instrumentTitlesParams.length-1]}},{}],87:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.keysParams[lastChordParams.keysParams.length-1]}},{}],88:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.relatedLyrics[lastChordParams.relatedLyrics.length-1]}},{}],89:[function(require,module,exports){"use strict";module.exports=function(pageSchema){return pageSchema.measuresParams[pageSchema.measuresParams.length-1]}},{}],90:[function(require,module,exports){"use strict";module.exports=function(lastVoiceParams){for(var chordIndex=lastVoiceParams.length-1;chordIndex>=0;chordIndex--){if(!lastVoiceParams[chordIndex].isSimile){return lastVoiceParams[chordIndex]}}return null}},{}],91:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.notes[lastChordParams.notes.length-1]}},{}],92:[function(require,module,exports){"use strict";module.exports=function(lastChordParams){return lastChordParams.parentheses[lastChordParams.parentheses.length-1]}},{}],93:[function(require,module,exports){"use strict";module.exports=function(lastMeasuresParams){return lastMeasuresParams.stavesParams[lastMeasuresParams.stavesParams.length-1]}},{}],94:[function(require,module,exports){"use strict";module.exports=function(lastStaveParams){return lastStaveParams.voicesParams[lastStaveParams.voicesParams.length-1]}},{}],95:[function(require,module,exports){"use strict";var currentPageLineIndex=require("./currentPageLineIndex");module.exports=function(parserState){var pageSchema=parserState.pageSchema;var pageLinePosition=parserState.lastMentionedPageLinePosition;var measurePosition=parserState.lastMentionedMeasurePosition;var pageLinePositionIsNotSpecified=pageLinePosition===undefined;var measurePositionIsNotSpecified=measurePosition===undefined;if(pageLinePositionIsNotSpecified){pageLinePosition=currentPageLineIndex(parserState);pageLinePositionIsNotSpecified=pageLinePosition===undefined}if(!measurePositionIsNotSpecified&&!pageLinePositionIsNotSpecified){var lineCount=0;var measureOnLineCount=0;for(var measureIndex=0;measureIndex<pageSchema.measuresParams.length;measureIndex++){var lastMeasureOnPageLine=pageSchema.measuresParams[measureIndex].isLastMeasureOnPageLine||measureIndex===pageSchema.measuresParams.length-1;if(lineCount===pageLinePosition&&measureOnLineCount===measurePosition){return pageSchema.measuresParams[measureIndex]}if(lastMeasureOnPageLine){measureOnLineCount=0;lineCount+=1}else{measureOnLineCount+=1}}}return null}},{"./currentPageLineIndex":77}],96:[function(require,module,exports){"use strict";module.exports=function(parserState,slurMarkKey,lastChordParamsInSlur){if(parserState.slurMarkChords[slurMarkKey]){parserState.slurMarkChords[slurMarkKey].forEach(function(chordParams,chordParamsIndex){var slurMarkThatFinishesIndex=chordParams.slurMarks.findIndex(function(slurMark){return slurMark.key===slurMarkKey&&slurMark.finish});if(slurMarkThatFinishesIndex!==-1){chordParams.slurMarks.splice(slurMarkThatFinishesIndex,1)}})}lastChordParamsInSlur.slurMarks.forEach(function(slurMark,slurMarkIndex){if(slurMark.key===slurMarkKey&&!slurMark.finish){lastChordParamsInSlur.slurMarks.splice(slurMarkIndex,1)}})}},{}],97:[function(require,module,exports){"use strict";module.exports=function(restPositionName){if(restPositionName==="top"){return.5}if(restPositionName==="mid"||restPositionName==="middle"){return 2}if(restPositionName==="bottom"){return 3.5}return 2}},{}],98:[function(require,module,exports){"use strict";module.exports=function(parserState,slurMarkKey){if(parserState.slurMarkChords[slurMarkKey]&&parserState.slurMarkChords[slurMarkKey][0]&&parserState.slurMarkChords[slurMarkKey][0].slurMarks){var slurMarkWithSpecifiedKey=parserState.slurMarkChords[slurMarkKey][0].slurMarks.find(function(slurMark){return slurMark.key===slurMarkKey});if(slurMarkWithSpecifiedKey){return slurMarkWithSpecifiedKey}}return undefined}},{}],99:[function(require,module,exports){"use strict";module.exports=function(parserState){parserState.lastMentionedPageLinePosition=undefined;parserState.lastMentionedMeasurePosition=undefined;parserState.lastMentionedStavePosition=undefined;parserState.lastMentionedVoicePosition=undefined;parserState.lastMentionedUnitPosition=undefined;parserState.calculatedUnitMeasureIndexByLastMentionedPositions=undefined;parserState.calculatedUnitStaveIndexByLastMentionedPositions=undefined;parserState.calculatedUnitVoiceIndexByLastMentionedPositions=undefined;parserState.calculatedUnitIndexByLastMentionedPositions=undefined;parserState.lastMentionedConnectionPageLinePosition=undefined;parserState.lastMentionedConnectionMeasurePosition=undefined;parserState.lastMentionedConnectionStavePosition=undefined;parserState.lastMentionedConnectionVoicePosition=undefined}},{}],100:[function(require,module,exports){"use strict";module.exports=function(parserState){parserState.lastMentionedMeasurePosition=undefined}},{}],101:[function(require,module,exports){"use strict";module.exports=function(parserState){parserState.lastMentionedUnitPosition=undefined;parserState.calculatedUnitIndexByLastMentionedPositions=undefined}},{}],102:[function(require,module,exports){"use strict";var addNotRecognizableCommandScenario=require("./addNotRecognizableCommandScenario");var addCommentScenario=require("./addCommentScenario");var addStyleScenarios=require("./addStyleScenarios");var addCompressAndStretchUnitsScenarios=require("./addCompressAndStretchUnitsScenarios");var addHideLastMeasureScenario=require("./addHideLastMeasureScenario");var addPageMetaScenarios=require("./addPageMetaScenarios");var addMeasureNumbersScenarios=require("./addMeasureNumbersScenarios");var addLyricsPositionScenarios=require("./addLyricsPositionScenarios");var addMeasureSetupScenarios=require("./addMeasureSetupScenarios");var addBarLineScenarios=require("./addBarLineScenarios");var addRepeatSignScenarios=require("./addRepeatSignScenarios");var addMeasureRestScenarios=require("./addMeasureRestScenarios");var addMeasureSimileScenarios=require("./addMeasureSimileScenarios");var addMeasureFermataScenarios=require("./addMeasureFermataScenarios");var addNewLineScenarios=require("./addNewLineScenarios");var addCrossStaveConnectionsScenarios=require("./addCrossStaveConnectionsScenarios");var addInstrumentTitlesScenarios=require("./addInstrumentTitlesScenarios");var addKeySignatureScenarios=require("./addKeySignatureScenarios");var addTimeSignatureScenarios=require("./addTimeSignatureScenarios");var addRepetitionNoteScenarios=require("./addRepetitionNoteScenarios");var addCodaScenarios=require("./addCodaScenarios");var addSignScenarios=require("./addSignScenarios");var addTempoMarkScenario=require("./addTempoMarkScenario");var addStaveSetupScenarios=require("./addStaveSetupScenarios");var addClefScenarios=require("./addClefScenarios");var addVoiceSetupScenarios=require("./addVoiceSetupScenarios");var addNoteSetupScenarios=require("./addNoteSetupScenarios");var addChordSetupScenarios=require("./addChordSetupScenarios");var addSlurScenarios=require("./addSlurScenarios");var addGlissandoScenarios=require("./addGlissandoScenarios");var addTupletScenarios=require("./addTupletScenarios");var addOctaveSignScenarios=require("./addOctaveSignScenarios");var addCrescendoAndDiminuendoScenarios=require("./addCrescendoAndDiminuendoScenarios");var addRepeatSimileScenarios=require("./addRepeatSimileScenarios");var addVoltaScenarios=require("./addVoltaScenarios");var addPunctuationScenario=require("./addPunctuationScenario");var addGeneralEmptyLineScenario=require("./addGeneralEmptyLineScenario");var addMainScenarious=function addMainScenarious(scenarios){addCommentScenario(scenarios);addStyleScenarios(scenarios);addCompressAndStretchUnitsScenarios(scenarios);addHideLastMeasureScenario(scenarios);addPageMetaScenarios(scenarios);addMeasureNumbersScenarios(scenarios);addLyricsPositionScenarios(scenarios);addMeasureSetupScenarios(scenarios);addBarLineScenarios(scenarios);addRepeatSignScenarios(scenarios);addMeasureRestScenarios(scenarios);addMeasureSimileScenarios(scenarios);addMeasureFermataScenarios(scenarios);addNewLineScenarios(scenarios);addCrossStaveConnectionsScenarios(scenarios);addInstrumentTitlesScenarios(scenarios);addKeySignatureScenarios(scenarios);addTimeSignatureScenarios(scenarios);addRepetitionNoteScenarios(scenarios);addCodaScenarios(scenarios);addSignScenarios(scenarios);addTempoMarkScenario(scenarios);addStaveSetupScenarios(scenarios);addClefScenarios(scenarios);addVoiceSetupScenarios(scenarios);addSlurScenarios(scenarios);addGlissandoScenarios(scenarios);addTupletScenarios(scenarios);addOctaveSignScenarios(scenarios);addCrescendoAndDiminuendoScenarios(scenarios);addRepeatSimileScenarios(scenarios);addVoltaScenarios(scenarios);addNoteSetupScenarios(scenarios);addChordSetupScenarios(scenarios);addPunctuationScenario(scenarios);addGeneralEmptyLineScenario(scenarios)};module.exports=function(){var scenarios={};addMainScenarious(scenarios);addNotRecognizableCommandScenario(scenarios);return scenarios}},{"./addBarLineScenarios":29,"./addChordSetupScenarios":30,"./addClefScenarios":31,"./addCodaScenarios":32,"./addCommentScenario":33,"./addCompressAndStretchUnitsScenarios":34,"./addCrescendoAndDiminuendoScenarios":35,"./addCrossStaveConnectionsScenarios":36,"./addGeneralEmptyLineScenario":37,"./addGlissandoScenarios":38,"./addHideLastMeasureScenario":39,"./addInstrumentTitlesScenarios":40,"./addKeySignatureScenarios":41,"./addLyricsPositionScenarios":43,"./addMeasureFermataScenarios":44,"./addMeasureNumbersScenarios":45,"./addMeasureRestScenarios":46,"./addMeasureSetupScenarios":47,"./addMeasureSimileScenarios":48,"./addNewLineScenarios":49,"./addNotRecognizableCommandScenario":50,"./addNoteSetupScenarios":51,"./addOctaveSignScenarios":52,"./addPageMetaScenarios":53,"./addPunctuationScenario":54,"./addRepeatSignScenarios":55,"./addRepeatSimileScenarios":56,"./addRepetitionNoteScenarios":57,"./addSignScenarios":58,"./addSlurScenarios":59,"./addStaveSetupScenarios":60,"./addStyleScenarios":61,"./addTempoMarkScenario":62,"./addTimeSignatureScenarios":63,"./addTupletScenarios":64,"./addVoiceSetupScenarios":66,"./addVoltaScenarios":67}],103:[function(require,module,exports){"use strict";module.exports={first:"first",last:"last",all:"all","first last":"first&last","first and last":"first&last","first & last":"first&last","first&last":"first&last"}},{}],104:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./applicationOfMeasureNumbers"))},{"./applicationOfMeasureNumbers":103}],105:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./articulations"))},{"./articulations":106}],106:[function(require,module,exports){"use strict";module.exports={staccato:"staccato",spiccato:"spiccato",accent:"accent",tenuto:"tenuto",marcato:"marcato",fermata:"fermata","left hand pizzicato":"leftHandPizzicato","left pizzicato":"leftHandPizzicato","left hand pizz":"leftHandPizzicato","left pizz":"leftHandPizzicato","snap pizzicato":"snapPizzicato","snap pizz":"snapPizzicato","natural harmonic":"naturalHarmonic","natural harm":"naturalHarmonic","up bow":"upBow","down bow":"downBow"}},{}],107:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./breathMarks"))},{"./breathMarks":108}],108:[function(require,module,exports){"use strict";module.exports={comma:"comma","double slashes":"double slash","double slash":"double slash"}},{}],109:[function(require,module,exports){"use strict";module.exports=["gentium plus","gothic a1"]},{}],110:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./clefs"))},{"./clefs":111}],111:[function(require,module,exports){"use strict";module.exports={treble:"treble",g:"treble",bass:"bass",f:"bass",alto:"alto",c:"alto",baritone:"baritone","mezzo soprano":"mezzoSoprano",mezzo:"mezzoSoprano",octave:"octaveEightUp","octave eight up":"octaveEightUp","octave up":"octaveEightUp","octave 8 up":"octaveEightUp","octave eight down":"octaveEightDown","octave down":"octaveEightDown","octave 8 down":"octaveEightDown","octave fifteen up":"octaveFifteenUp","2 octaves up":"octaveFifteenUp","two octaves up":"octaveFifteenUp","octave 15 up":"octaveFifteenUp","octave fifteen down":"octaveFifteenDown","2 octaves down":"octaveFifteenDown","two octaves down":"octaveFifteenDown","octave 15 down":"octaveFifteenDown",soprano:"soprano",tenor:"tenor"}},{}],112:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./closingBarLines"))},{"./closingBarLines":113}],113:[function(require,module,exports){"use strict";module.exports={"bold double barline":"boldDoubleBarLine","double bold barline":"boldDoubleBarLine","double barline":"doubleBarLine","dotted barline":"dottedBarLine",barline:"barLine"}},{}],114:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./configurableStyles"))},{"./configurableStyles":115}],115:[function(require,module,exports){"use strict";module.exports={"background color":"backgroundColor","background colour":"backgroundColor","bg color":"backgroundColor","bg colour":"backgroundColor","music font":"musicFont","text font":"textFont","chord letters font":"chordLettersFont","font color":"fontColor","font colour":"fontColor","page border color":"pageBorderStrokeColor","page border colour":"pageBorderStrokeColor","border color":"pageBorderStrokeColor","border colour":"pageBorderStrokeColor","stave lines color":"staveLinesColor","stave lines colour":"staveLinesColor","staff lines color":"staveLinesColor","staff lines colour":"staveLinesColor","font size":"intervalBetweenStaveLines","interval between stave lines":"intervalBetweenStaveLines","interval between staves":"intervalBetweenStaves","interval between lines":"intervalBetweenPageLines","page left and right paddings":"pageLeftAndRightPadding","page line width":"pageLineMaxWidth","page top padding":"pageTopPadding","page bottom padding":"pageBottomPadding","page lines top offset":"pageLinesTopOffset","page number bottom offset":"pageNumberOffsetFromBottomOfThePage","title top offset":"titleTopOffset","subtitle top offset":"subtitleTopOffset","left and right subtitles top offset":"leftAndRightSubtitlesTopOffset","page border width":"pageBorderStrokeWidth","title font size":"titleFontSize","subtitle font size":"subtitleFontSize","left subtitle font size":"leftSubtitleFontSize","right subtitle font size":"rightSubtitleFontSize","page number font size":"pageNumberFontSize","instrument font size":"instrumentTitleFontSize","instrument title font size":"instrumentTitleFontSize","empty measure width":"emptyMeasureWidth","page format":"pageFormat","page height":"pageHeight"}},{}],116:[function(require,module,exports){"use strict";module.exports=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","goldenrod","gold","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavenderblush","lavender","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]},{}],117:[function(require,module,exports){"use strict";module.exports=["g major to c major|g major to a minor|e minor to c major|e minor to a minor","d major to c major|d major to a minor|b minor to c major|b minor to a minor","a major to c major|a major to a minor|f sharp minor to c major|f sharp minor to a minor","e major to c major|e major to a minor|c sharp minor to c major|c sharp minor to a minor","b major to c major|b major to a minor|g sharp minor to c major|g sharp minor to a minor","f sharp major to c major|f sharp major to a minor|d sharp minor to c major|d sharp minor to a minor","c sharp major to c major|c sharp major to a minor|a sharp minor to c major|a sharp minor to a minor","f major to c major|f major to a minor|d minor to c major|d minor to a minor","b flat major to c major|b flat major to a minor|g minor to c major|g minor to a minor","e flat major to c major|e flat major to a minor|c minor to c major|c minor to a minor","a flat major to c major|a flat major to a minor|f minor to c major|f minor to a minor","d flat major to c major|d flat major to a minor|b flat minor to c major|b flat minor to a minor","g flat major to c major|g flat major to a minor|e flat minor to c major|e flat minor to a minor","c flat major to c major|c flat major to a minor|a flat minor to c major|a flat minor to a minor","c major|a minor","g major|e minor","d major|b minor","a major|f sharp minor","e major|c sharp minor","b major|g sharp minor","f sharp major|d sharp minor","c sharp major|a sharp minor","f major|d minor","b flat major|g minor","e flat major|c minor","a flat major|f minor","d flat major|b flat minor","g flat major|e flat minor","c flat major|a flat minor"]},{}],118:[function(require,module,exports){"use strict";module.exports=["bravura","leland"]},{}],119:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./noteDurations"))},{"./noteDurations":120}],120:[function(require,module,exports){"use strict";module.exports={4:4,2:2,1:1,"1/2":1/2,"1/4":1/4,"1/8":1/8,"1/16":1/16,"1/32":1/32,"1/64":1/64,"1/128":1/128,"1/256":1/256}},{}],121:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./noteKeys"))},{"./noteKeys":122}],122:[function(require,module,exports){"use strict";module.exports={"2fl":"doubleFlatKey","2 flat":"doubleFlatKey","double fl":"doubleFlatKey","double flat":"doubleFlatKey","2#":"doubleSharpKey","2 sharp":"doubleSharpKey","double #":"doubleSharpKey","double sh":"doubleSharpKey","double sharp":"doubleSharpKey",fl:"flatKey",flat:"flatKey",n:"naturalKey",natural:"naturalKey","#":"sharpKey",sh:"sharpKey",sharp:"sharpKey","1/2fl":"demiflatKey","1/2 flat":"demiflatKey",dmfl:"demiflatKey",demiflat:"demiflatKey","demi flat":"demiflatKey","3/2fl":"sesquiflatKey","3/2 flat":"sesquiflatKey",sqfl:"sesquiflatKey","sesqui flat":"sesquiflatKey",sesquiflat:"sesquiflatKey","1/2#":"demisharpKey","1/2 sh":"demisharpKey","1/2 sharp":"demisharpKey","dm#":"demisharpKey","demi#":"demisharpKey",dmsh:"demisharpKey","demi sharp":"demisharpKey",demisharp:"demisharpKey","3/2#":"sesquisharpKey","3/2 sh":"sesquisharpKey","3/2 sharp":"sesquisharpKey",sqsh:"sesquisharpKey","sesqui sharp":"sesquisharpKey",sesquisharp:"sesquisharpKey"}},{}],123:[function(require,module,exports){"use strict";module.exports=["c","d","e","f","g","a","b"]},{}],124:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./openingBarLines"))},{"./openingBarLines":125}],125:[function(require,module,exports){"use strict";module.exports={"bold double barline":"startBoldDoubleBarLine","double bold barline":"startBoldDoubleBarLine",barline:"startBarLine"}},{}],126:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./ornamentKeys"))},{"./ornamentKeys":127}],127:[function(require,module,exports){"use strict";module.exports={fl:"flat",flat:"flat",n:"natural",natural:"natural","#":"sharp",sh:"sharp",sharp:"sharp"}},{}],128:[function(require,module,exports){"use strict";module.exports={title:"title",subtitle:"subtitle",author:"subtitle",description:"subtitle",composer:"leftSubtitle",arrangement:"leftSubtitle","left subtitle":"leftSubtitle","right subtitle":"rightSubtitle","page number":"pageNumber"}},{}],129:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./pageMeta"))},{"./pageMeta":128}],130:[function(require,module,exports){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var configurableStyleNames=require("./configurableStyleNames");var musicFonts=require("./musicFonts");var textFonts=require("./textFonts");var chordLettersFonts=require("./chordLettersFonts");var pageMetaNames=require("./pageMetaNames");var openingBarLineNames=require("./openingBarLineNames");var closingBarLineNames=require("./closingBarLineNames");var applicationOfMeasureNumbersNames=require("./applicationOfMeasureNumbersNames");var keySignatureNames=require("./keySignatureNames");var tempoDurationPartNames=require("./tempoDurationPartNames");var clefNames=require("./clefNames");var noteDurationNames=require("./noteDurationNames");var noteNames=require("./noteNames");var stavePositionNames=require("./stavePositionNames");var noteKeyNames=require("./noteKeyNames");var breathMarkNames=require("./breathMarkNames");var articulationNames=require("./articulationNames");var ornamentKeyNames=require("./ornamentKeyNames");var withoutDoubleSpacesAndTrimmed=require("./../token/withoutDoubleSpacesAndTrimmed");var VERTICAL_LINE="|";var SLASH="/";var EMPTY="";var SPACE=" ";var SPACE_REGEXP="(\\s+)";var COLUMN=":";var SEMI_COLUMN=";";var COMMA=",";var AND="and";var AND_WITH_SEMI_COLUMN_AT_THE_START=";and";var AND_WITH_COMMA_AT_THE_START=",and";var AND_WITH_SEMI_COLUMN_AT_THE_END="and;";var AND_WITH_COMMA_AT_THE_END="and,";var IS="is";var ARE="are";var THE="the";var OF="of";var FOR="for";var TO="to";var FROM="from";var TILL="till";var BETWEEN="between";var IN="in";var ON="on";var AT="at";var UP="up";var DOWN="down";var LEFT="left";var RIGHT="right";var WITH="with";var BY="by";var WITH_NEXT=["with","next"];var NEXT="next";var BEFORE="before";var AFTER="after";var BESIDE="beside";var SINGLE_QUOTE="'";var DOUBLE_QUOTE='"';var MEASURE_NUMBERS=["measure","numbers"];var MEASURES="measures";var MEASURE="measure";var ABOVE="above";var BELOW="below";var OVER="over";var UNDER="under";var IS_UNDER="is under";var LYRICS="lyrics";var STAVE="stave";var STAFF="staff";var COMPRESS="compress";var STRETCH="stretch";var STAVE_WITH_AND_WITHOUT_DELIMITER=[["stave"],["stave;"],["stave,"],["staff"],["staff;"],["staff,"]];var WITHOUT_START_BARLINE=[["without","opening","bar","line"],["without","start","bar","line"],["without","opening","barline"],["without","start","barline"],["starts","without","bar","line"],["opens","without","bar","line"],["starts","without","barline"],["opens","without","barline"],["with","no","opening","bar","line"],["with","no","start","bar","line"],["with","no","opening","barline"],["with","no","start","barline"],["starts","with","no","bar","line"],["opens","with","no","bar","line"],["starts","with","no","barline"],["opens","with","no","barline"]];var NO_START_BARLINE=[["no","opening","bar","line"],["no","start","bar","line"],["no","opening","barline"],["no","start","barline"]];var STARTS_BEGINS_OPENS=["starts","begins","opens"];var CLOSES_FINISHES_ENDS=["closes","finishes","ends"];var OPENING="opening";var START="start";var CLOSING="closing";var WITH_REPEAT_SIGN=[["with","repeat","sign"],["with","colon"]];var REPEAT_SIGN=[["repeat","sign"],["colon"]];var AT_THE_START=[["at","the","start"],["at","start"]];var AT_THE_END=[["at","the","end"],["at","end"]];var AT_THE_START_OF_THE_MEASURE=[["at","the","start","of","the","measure"],["at","the","start","of","measure"],["at","start","of","the","measure"],["at","start","of","measure"]];var AT_THE_END_OF_THE_MEASURE=[["at","the","end","of","the","measure"],["at","the","end","of","measure"],["at","end","of","the","measure"],["at","end","of","measure"]];var WITH_MEASURE_REST=[["with","multi","measure","rest"],["with","measure","rest"]];var MEASURE_REST=[["multi","measure","rest"],["measure","rest"]];var TIME="time";var TIMES="times";var OF_PREVIOUS_BEAT=[["of","prev.","beat"],["of","prev","beat"],["of","previous","beat"]];var OF_PREVIOUS_BEATS=[["of","prev.","beats"],["of","prev","beats"],["of","previous","beats"]];var MEASURE_WITH_SIMILE_OF_PREVIOUS_MEASURE=[["with","simile","of","prev.","measure"],["with","simile","of","prev","measure"],["with","simile","of","previous","measure"],["with","repeat","of","prev.","measure"],["with","repeat","of","prev","measure"],["with","repeat","of","previous","measure"],["with","simile","for","prev.","measure"],["with","simile","for","prev","measure"],["with","simile","for","previous","measure"],["with","repeat","for","prev.","measure"],["with","repeat","for","prev","measure"],["with","repeat","for","previous","measure"]];var MEASURE_WITH_SIMILE_OF_TWO_PREVIOUS_MEASURES=[["with","simile","of","2","prev.","measures"],["with","simile","of","2","prev","measures"],["with","simile","of","2","previous","measures"],["with","repeat","of","2","prev.","measures"],["with","repeat","of","2","prev","measures"],["with","repeat","of","2","previous","measures"],["with","simile","of","two","prev.","measures"],["with","simile","of","two","prev","measures"],["with","simile","of","two","previous","measures"],["with","repeat","of","two","prev.","measures"],["with","repeat","of","two","prev","measures"],["with","repeat","of","two","previous","measures"],["with","simile","for","2","prev.","measures"],["with","simile","for","2","prev","measures"],["with","simile","for","2","previous","measures"],["with","repeat","for","2","prev.","measures"],["with","repeat","for","2","prev","measures"],["with","repeat","for","2","previous","measures"],["with","simile","for","two","prev.","measures"],["with","simile","for","two","prev","measures"],["with","simile","for","two","previous","measures"],["with","repeat","for","two","prev.","measures"],["with","repeat","for","two","prev","measures"],["with","repeat","for","two","previous","measures"]];var SIMILE_OF_PREVIOUS_MEASURE=[["simile","of","prev.","measure"],["simile","of","prev","measure"],["simile","of","previous","measure"],["repeat","of","prev.","measure"],["repeat","of","prev","measure"],["repeat","of","previous","measure"],["simile","for","prev.","measure"],["simile","for","prev","measure"],["simile","for","previous","measure"],["repeat","for","prev.","measure"],["repeat","for","prev","measure"],["repeat","for","previous","measure"]];var SIMILE_OF_TWO_PREVIOUS_MEASURES=[["simile","of","2","prev.","measures"],["simile","of","2","prev","measures"],["simile","of","2","previous","measures"],["repeat","of","2","prev.","measures"],["repeat","of","2","prev","measures"],["repeat","of","2","previous","measures"],["simile","of","two","prev.","measures"],["simile","of","two","prev","measures"],["simile","of","two","previous","measures"],["repeat","of","two","prev.","measures"],["repeat","of","two","prev","measures"],["repeat","of","two","previous","measures"],["simile","for","2","prev.","measures"],["simile","for","2","prev","measures"],["simile","for","2","previous","measures"],["repeat","for","2","prev.","measures"],["repeat","for","2","prev","measures"],["repeat","for","2","previous","measures"],["simile","for","two","prev.","measures"],["simile","for","two","prev","measures"],["simile","for","two","previous","measures"],["repeat","for","two","prev.","measures"],["repeat","for","two","prev","measures"],["repeat","for","two","previous","measures"]];var NEW="new";var LINE="line";var LINES="lines";var CROSS_STAVE_CONNECTIONS=["bracket","brace"];var INSTRUMENT="instrument";var TITLE="title";var KEY_SIGNATURE=["key","signature"];var TIME_SIGNATURE=["time","signature"];var SIGNATURE="signature";var C="c";var CROSSED="crossed";var REPETITION="repetition";var MARK="mark";var NOTE="note";var INSTRUCTION="instruction";var CODA="coda";var SIGN="sign";var SEGNO="segno";var TEMPO="tempo";var METRONOME="metronome";var METRO="metro";var TEMPO_MARK=["tempo","mark"];var TEMPO_NOTE=["tempo","note"];var DOTTED="dotted";var WITH_DOT=["with","dot"];var CLEF="clef";var VOICE="voice";var ONE="1";var TWO="2";var STEM="stem";var ON_IN_AT=["on","in","at"];var DOT="dot";var DOTS="dots";var ONE_AS_WORD="one";var TWO_AS_WORD="two";var IS_BEAMED=["is","beamed"];var IS_NOT_BEAMED=["is","not","beamed"];var NOT_BEAMED=["not","beamed"];var BEAMED="beamed";var WITH_ONLY_ONE_LINE=["with","only","one","line"];var WITH_ONLY_PRIMARY_LINE=["with","only","primary","line"];var KEY="key";var TEXT="text";var WITH_PARENTHESES=["with","parentheses"];var WITH_BRACKETS=["with","brackets"];var ROUNDNESS="roundness";var CONVEX="convex";var ROUND_COEFFICIENT=["1","2","3","4","5","6","7","8","9","10"];var IS_TIED_WITH_NEXT=["is","tied","with","next"];var TIED_WITH_NEXT=["tied","with","next"];var IS_TIED_AFTER=["is","tied","after"];var TIED_AFTER=["tied","after"];var TIED="tied";var IS_TIED_BEFORE=["is","tied","before"];var TIED_BEFORE=["tied","before"];var REST_POSITIONS=["top","middle","mid","bottom"];var IS_REST=["is","rest"];var REST="rest";var IS_GHOST=["is","ghost"];var IS_NOT_GHOST=["is","not","ghost"];var NOT_GHOST=["not","ghost"];var GHOST="ghost";var GRACE="grace";var CRUSHED="crushed";var IS_GRACE=["is","grace"];var IS_CRUSHED_GRACE=["is","crushed","grace"];var CRUSHED_GRACE=["crushed","grace"];var WITH_CRUSH_LINE=["with","crush","line"];var GLISS="gliss";var GLISS_DOT="gliss.";var GLISSANDO="glissando";var WITH_GLISSANDO=[["with","glissando"],["with","gliss."],["with","gliss"]];var IS_IN_THE_CENTER=["is","in","the","center"];var IN_THE_CENTER=["in","the","center"];var IS_CENTRALIZED=["is","centralized"];var CENTRALIZED=["centralized"];var IS_NOT_IN_THE_CENTER=["is","not","in","the","center"];var NOT_IN_THE_CENTER=["not","in","the","center"];var IS_NOT_CENTRALIZED=["is","not","centralized"];var NOT_CENTRALIZED=["not","centralized"];var BREATH="breath";var IS_INVERTED="inverted";var INVERTED="inverted";var WITH_WAVE_AFTER=["with","wave","after"];var CHORD="chord";var LETTERS="letters";var UP_CARET="^";var OCTAVE="octave";var OCTAVES="octaves";var HIGHER="higher";var LOWER="lower";var WITH_TREMOLO=["with","tremolo"];var TREMOLO="tremolo";var REPEAT="repeat";var SIMILE="simile";var VIA_SIMILE=["via","simile"];var DYNAMIC="dynamic";var WITH_NEW_LYRICS=["with","new","lyrics"];var WITH_NEW_LYRIC=["with","new","lyric"];var WITH_LYRICS=["with","lyrics"];var WITH_LYRIC=["with","lyric"];var WITH_TURN=["with","turn"];var TURN="turn";var WITH_MORDENT=["with","mordent"];var MORDENT="mordent";var WITH_TRILL=["with","trill"];var TRILL="trill";var WITH_ONE_STROKE=["with","1","stroke"];var WITH_TWO_STROKES=["with","2","strokes"];var WITH_THREE_STROKES=["with","3","strokes"];var IS_FOLLOWED_BY_DASH=["is","followed","by","dash"];var IS_FOLLOWED_BY_HYPEN=["is","followed","by","hyphen"];var FOLLOWED_BY_DASH=["followed","by","dash"];var FOLLOWED_BY_HYPEN=["followed","by","hyphen"];var WHERE_UNDERSCORE_STARTS=["where","underscore","starts"];var WHERE_UNDERSCORE_BEGINS=["where","underscore","begins"];var WITH_UNDERSCORE_STARTS=["with","underscore","starts"];var WITH_UNDERSCORE_BEGINS=["with","underscore","begins"];var UNDERSCORE_STARTS=["underscore","starts"];var UNDERSCORE_BEGINS=["underscore","begins"];var WHERE_UNDERSCORE_FINISHES=["where","underscore","finishes"];var WHERE_UNDERSCORE_ENDS=["where","underscore","ends"];var WITH_UNDERSCORE_FINISHES=["with","underscore","finishes"];var WITH_UNDERSCORE_ENDS=["with","underscore","ends"];var UNDERSCORE_FINISHES=["underscore","finishes"];var UNDERSCORE_ENDS=["underscore","ends"];var UNDERSCORE="underscore";var FOR_EACH_LINE=["for","each","line"];var FOR_LINES_BELOW=["for","lines","below"];var FOR_LINES=["for","lines"];var FOR_EACH=["for","each"];var COMMENT="comment";var SIDE_NOTE="side note";var SIDE="side";var IS_ARPEGGIATED=[["is","arpeggiated"],["is","arpeggio"],["arpeggiated"],["arpeggio"]];var WITH_CHOR_BELOW=["with","chord","below"];var WITH_ARROW=["with","arrow"];var ARROW="arrow";var SLUR="slur";var STARTS="starts";var BEGINS="begins";var STARTS_FROM=["starts","from"];var BEGINS_FROM=["begins","from"];var FINISHES="finishes";var ENDS="ends";var STARTS_BEFORE=["starts","before"];var BEGINS_BEFORE=["begins","before"];var FINISHES_AFTER=["finishes","after"];var ENDS_AFTER=["ends","after"];var CHANGES_STAVE=["changes","stave"];var CHANGES_STAFF=["changes","staff"];var GOES_THROUGH=["goes","through"];var WITH_S_SHAPE=["with","s","shape"];var WITH_S_DASH_SHAPE=["with","s-shape"];var WITH_SSHAPE=["with","sshape"];var WITH_LEFT_POINT=["with","left","point"];var WITH_RIGHT_POINT=["with","right","point"];var ATTACHED_TO_MIDDLE_OF_STEM=["attached","to","middle","of","stem"];var ATTACHED_TO_THE_MIDDLE_OF_THE_STEM=["attached","to","the","middle","of","the","stem"];var ATTACHED_TO_NOTE_BODY=["attached","to","note","body"];var ATTACHED_TO_THE_NOTE_BODY=["attached","to","the","note","body"];var ATTACHED_TO_NOTE_HEAD=["attached","to","note","head"];var ATTACHED_TO_THE_NOTE_HEAD=["attached","to","the","note","head"];var AS_WAVE=["as","wave"];var AS_WAVES=["as","waves"];var AS_LINE=["as","line"];var AS_LINES=["as","lines"];var WAVE="wave";var TUPLET="tuplet";var CRESCENDO="crescendo";var CRES_DOT="cres.";var CRES="cres";var CRESC_DOT="cresc.";var CRESC="cresc";var DIMINUENDO="diminuendo";var DIM_DOT="dim.";var DIM="dim";var VOLTA="volta";var VOLTA_BRACKET=["volta","bracket"];var VOLTA_BRACKETS=["volta","brackets"];var BRACKET="bracket";var BRACKETS="brackets";var OPENS_WITH_BRACKET=[["opens","with","bracket"],["starts","with","bracket"],["begins","with","bracket"]];var WITH_SUSTAIN_PEDAL=["with","sustain","pedal"];var WITH_PEDAL=["with","pedal"];var PEDAL="pedal";var AFTER_MEASURE=["after","measure"];var RELEASE="release";var WITH_PEDAL_RELEASE=["with","pedal","release"];var WITH_RELEASE=["with","release"];var WITH_VARIABLE_PEAK=["with","variable","peak"];var UNIT="unit";var UNITS="units";var SUSTAIN="sustain";var HIDE_LAST_MEASURE=["hide","the","last","measure"];var ENDS_WITH_FERMATA=["ends","with","fermata"];var FERMATA=["fermata"];var allKeySignatureNamesWithDelimeter=keySignatureNames.join(VERTICAL_LINE);var separateKeySignatureNames=allKeySignatureNamesWithDelimeter.split(VERTICAL_LINE);var pageMetaNamesAsTokens=pageMetaNames.map(function(name){return name.split(SPACE)});var configurableStyleNamesAsTokens=configurableStyleNames.map(function(name){return name.split(SPACE)});var applicationOfMeasureNumbersNamesAsTokens=applicationOfMeasureNumbersNames.map(function(name){return name.split(SPACE)});var openingBarLineNamesAsTokens=openingBarLineNames.map(function(name){return name.split(SPACE)});var openingBarLineNamesAsTokensAsSeparateCommand=openingBarLineNames.map(function(name){return"".concat(START," ").concat(name).split(SPACE)}).concat(openingBarLineNames.map(function(name){return"".concat(OPENING," ").concat(name).split(SPACE)}));var closingBarLineNamesAsTokens=closingBarLineNames.map(function(name){return name.split(SPACE)});var closingBarLineNamesAsTokensAsSeparateCommand=closingBarLineNames.map(function(name){return"".concat(CLOSING," ").concat(name).split(SPACE)});var separateKeySignatureNamesAsTokens=separateKeySignatureNames.map(function(name){return name.split(SPACE)});var clefNamesAsTokens=clefNames.map(function(name){return name.split(SPACE)});var noteKeyNamesAsTokens=noteKeyNames.map(function(name){return name.split(SPACE)});var mainNoteKeyNames=["sharp","flat","natural","double sharp","double flat","demisharp","sesquisharp","demiflat","sesquiflat"];var mainNoteKeyNamesAsTokens=mainNoteKeyNames.map(function(name){return name.split(SPACE)});var breathMarkNamesAsTokens=[].concat(_toConsumableArray(breathMarkNames.map(function(name){return name.split(SPACE)})),_toConsumableArray(breathMarkNames.map(function(name){return["as"].concat(name.split(SPACE))})));var articulationNamesAsTokens=articulationNames.map(function(name){return name.split(SPACE)});var ornamentKeyNamesAsTokens=ornamentKeyNames.map(function(name){return name.split(SPACE)});var cssColors=require("./cssColors");var isColor=function isColor(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return/^#([a-f0-9]{3,4}|[a-f0-9]{4}(?:[a-f0-9]{2}){1,2})\b$/i.test(joinedTokenValues)||/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.test(joinedTokenValues)||/^rgba\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d*(?:\.\d+)?)\)$/.test(joinedTokenValues)||cssColors.indexOf(joinedTokenValues)!==-1};var isSupportedMusicFont=function isSupportedMusicFont(tokenValues){return musicFonts.indexOf(tokenValues.join(SPACE).toLowerCase())!==-1};var isSupportedTextFont=function isSupportedTextFont(tokenValues){return textFonts.indexOf(tokenValues.join(SPACE).toLowerCase())!==-1};var isSupportedChordLettersFont=function isSupportedChordLettersFont(tokenValues){return chordLettersFonts.indexOf(tokenValues.join(SPACE).toLowerCase())!==-1};var pageFormats=["c4","a3","b4","a4"];var isNumeric=function isNumeric(string){return!isNaN(string)};var styleValueTests={backgroundColor:function backgroundColor(tokenValues){return isColor(tokenValues)},musicFont:function musicFont(tokenValues){return isSupportedMusicFont(tokenValues)},textFont:function textFont(tokenValues){return isSupportedTextFont(tokenValues)},chordLettersFont:function chordLettersFont(tokenValues){return isSupportedChordLettersFont(tokenValues)},fontColor:function fontColor(tokenValues){return isColor(tokenValues)},pageBorderStrokeColor:function pageBorderStrokeColor(tokenValues){return isColor(tokenValues)},staveLinesColor:function staveLinesColor(tokenValues){return isColor(tokenValues)},intervalBetweenStaveLines:function intervalBetweenStaveLines(tokenValues){return isNumeric(tokenValues.join(SPACE))},intervalBetweenStaves:function intervalBetweenStaves(tokenValues){return isNumeric(tokenValues.join(SPACE))},intervalBetweenPageLines:function intervalBetweenPageLines(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageLeftAndRightPadding:function pageLeftAndRightPadding(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageLineMaxWidth:function pageLineMaxWidth(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageTopPadding:function pageTopPadding(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageBottomPadding:function pageBottomPadding(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageLinesTopOffset:function pageLinesTopOffset(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageNumberOffsetFromBottomOfThePage:function pageNumberOffsetFromBottomOfThePage(tokenValues){return isNumeric(tokenValues.join(SPACE))},titleTopOffset:function titleTopOffset(tokenValues){return isNumeric(tokenValues.join(SPACE))},subtitleTopOffset:function subtitleTopOffset(tokenValues){return isNumeric(tokenValues.join(SPACE))},leftAndRightSubtitlesTopOffset:function leftAndRightSubtitlesTopOffset(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageBorderStrokeWidth:function pageBorderStrokeWidth(tokenValues){return isNumeric(tokenValues.join(SPACE))},titleFontSize:function titleFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},subtitleFontSize:function subtitleFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},leftSubtitleFontSize:function leftSubtitleFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},rightSubtitleFontSize:function rightSubtitleFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageNumberFontSize:function pageNumberFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},instrumentTitleFontSize:function instrumentTitleFontSize(tokenValues){return isNumeric(tokenValues.join(SPACE))},emptyMeasureWidth:function emptyMeasureWidth(tokenValues){return isNumeric(tokenValues.join(SPACE))},pageFormat:function pageFormat(tokenValues){return tokenValues.length===1&&pageFormats.indexOf(tokenValues[0])!==-1},pageHeight:function pageHeight(tokenValues){return isNumeric(tokenValues.join(SPACE))}};var areTwoArraysEqual=function areTwoArraysEqual(firstArray,secondArray){if(firstArray.length!==secondArray.length){return false}for(var index=0;index<firstArray.length;index++){if(firstArray[index]!==secondArray[index]){return false}}return true};var firstArrayContainsSecondArray=function firstArrayContainsSecondArray(firstArray,secondArray){for(var index=0;index<firstArray.length;index++){if(areTwoArraysEqual(firstArray[index],secondArray)){return true}}return false};var isPositiveInteger=function isPositiveInteger(string){if(typeof string!=="string"){return false}var number=Number(string);if(Number.isInteger(number)&&number>0){return true}return false};var isDirection=function isDirection(string){return string===UP||string===DOWN};var isLeftOrRight=function isLeftOrRight(string){return string===LEFT||string===RIGHT};var isQuote=function isQuote(string){return string===SINGLE_QUOTE||string===DOUBLE_QUOTE};var isCommentQuote=function isCommentQuote(string){return string===DOUBLE_QUOTE};var isWrappedWithQuotes=function isWrappedWithQuotes(tokenValues){var itIsComment=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var canBeFollowedByComma=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(tokenValues.length===0){return false}if(tokenValues.length===1&&tokenValues[0].length===1){return false}var firstToken=tokenValues[0];var lastToken=tokenValues[tokenValues.length-1];var firstCharInFirstToken=firstToken[0];var lastCharInLastToken=lastToken[lastToken.length-1];var prevToLastCharInLastToken=lastToken[lastToken.length-2];if(itIsComment){return isCommentQuote(firstCharInFirstToken)&&isCommentQuote(lastCharInLastToken)&&firstCharInFirstToken===lastCharInLastToken}return isQuote(firstCharInFirstToken)&&isQuote(lastCharInLastToken)&&firstCharInFirstToken===lastCharInLastToken||isQuote(firstCharInFirstToken)&&isQuote(prevToLastCharInLastToken)&&lastCharInLastToken===","&&firstCharInFirstToken===prevToLastCharInLastToken};var unwrappedFromQuotesValue=function unwrappedFromQuotesValue(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);if(joinedTokenValues[joinedTokenValues.length-1]===","){return joinedTokenValues.slice(1,joinedTokenValues.length-2)}return joinedTokenValues.slice(1,joinedTokenValues.length-1)};var isAboveBelowOverUnder=function isAboveBelowOverUnder(string){return string===ABOVE||string===BELOW||string===OVER||string===UNDER};var isBelowUnder=function isBelowUnder(string){return string===BELOW||string===UNDER};var isStave=function isStave(string){return string===STAVE||string===STAFF};var isUpHigherDownLower=function isUpHigherDownLower(string){return string===UP||string===DOWN||string===LOWER||string===HIGHER};module.exports={punctuation:{test:function test(tokenValues){return tokenValues.length===1&&(tokenValues[0]===COMMA||tokenValues[0]===SEMI_COLUMN)}},numbers:{test:function test(tokenValues){return isPositiveInteger(tokenValues[0])&&tokenValues.length===1},match:function match(tokenValues){return[Number(tokenValues[0])]}},stringHighlight:/(['"])(.+)\1/,numberHighlight:/(\d+)/,globalCommandDelimiter:{replaceAllWithEmptyString:function replaceAllWithEmptyString(tokens){var result=[];for(var index=0;index<tokens.length;index++){if(tokens[index].value!==AND_WITH_SEMI_COLUMN_AT_THE_START&&tokens[index].value!==AND_WITH_COMMA_AT_THE_START&&tokens[index].value!==AND_WITH_SEMI_COLUMN_AT_THE_END&&tokens[index].value!==AND_WITH_COMMA_AT_THE_END&&tokens[index].value!==COMMA&&tokens[index].value!==SEMI_COLUMN&&tokens[index].value!==AND){var value=[];for(var textValueIndex=0;textValueIndex<tokens[index].value.length;textValueIndex++){if(tokens[index].value[textValueIndex]!==SEMI_COLUMN&&tokens[index].value[textValueIndex]!==COMMA){value.push(tokens[index].value[textValueIndex])}}if(value.length>0){result.push(value.join(""))}}}return result}},is:{test:function test(tokenValues){return tokenValues[0]===IS&&tokenValues.length===1}},verticalCorrection:{test:function test(tokenValues){if(tokenValues[0]===IS&&isNumeric(tokenValues[1])&&isDirection(tokenValues[2])||isNumeric(tokenValues[0])&&isDirection(tokenValues[1])){return true}return false},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues[1],tokenValues[2]]}return[tokenValues[0],tokenValues[1]]}},verticalCorrectionHighlight:/(\d*\.?\d*)(\s+)(up|down)/,horizontalCorrection:{test:function test(tokenValues){if(tokenValues[0]===IS&&isLeftOrRight(tokenValues[1])&&tokenValues[2]===BY&&isNumeric(tokenValues[3])||isLeftOrRight(tokenValues[0])&&tokenValues[1]===BY&&isNumeric(tokenValues[2])){return true}return false},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues[3],tokenValues[1]]}return[tokenValues[2],tokenValues[0]]}},horizontalCorrectionHighlight:/(left|right)(\s+)(by)(\s+)(\d*\.?\d*)/,styleName:{test:function test(tokenValues){return firstArrayContainsSecondArray(configurableStyleNamesAsTokens,tokenValues)},match:function match(tokenValues){return[tokenValues.join(SPACE)]}},isIs:{test:function test(tokenValues){return tokenValues[0]===IS}},styleValue:{test:function test(tokenValues,styleKey){if(!styleValueTests[styleKey]){return false}return styleValueTests[styleKey](tokenValues)},match:function match(tokenValues){return[tokenValues.join(SPACE)]}},pageMeta:{test:function test(tokenValues){var tokenValueWithIsIndex=tokenValues.indexOf(IS);if(tokenValueWithIsIndex===-1){return false}if(firstArrayContainsSecondArray(pageMetaNamesAsTokens,tokenValues.slice(0,tokenValueWithIsIndex))&&isWrappedWithQuotes(tokenValues.slice(tokenValueWithIsIndex+1))){return true}return false},match:function match(tokenValues){var tokenValueWithIsIndex=tokenValues.indexOf(IS);var pageMetaName=tokenValues.slice(0,tokenValueWithIsIndex).join(SPACE);var pageMetaValue=unwrappedFromQuotesValue(tokenValues.slice(tokenValueWithIsIndex+1));return[pageMetaName,pageMetaValue]}},measureNumbers:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,MEASURE_NUMBERS)}},measureNumbersHighlight:/measure(\s+)numbers/,applicationOfMeasureNumbers:{test:function test(tokenValues){return tokenValues[0]===FOR&&tokenValues[tokenValues.length-1]===MEASURES&&firstArrayContainsSecondArray(applicationOfMeasureNumbersNamesAsTokens,tokenValues.slice(1,tokenValues.length-1))},match:function match(tokenValues){return[tokenValues.slice(1,tokenValues.length-1).join(SPACE)]}},applicationOfMeasureNumbersHighlight:new RegExp("(".concat(applicationOfMeasureNumbersNames.join(VERTICAL_LINE),") measures").replaceAll(SPACE,SPACE_REGEXP)),measure:{test:function test(tokenValues){return tokenValues[0]===MEASURE&&tokenValues.length===1}},measureHighlight:MEASURE,measures:{test:function test(tokenValues){return tokenValues[0]===MEASURES&&tokenValues.length===1}},measuresHighlight:MEASURES,lyricsPosition:{test:function test(tokenValues){if(tokenValues[0]!==LYRICS){return false}if(tokenValues.length===3){return isAboveBelowOverUnder(tokenValues[2])&&(tokenValues[1]===IS||tokenValues[1]===ARE)}if(tokenValues.length===2){return isAboveBelowOverUnder(tokenValues[1])}return false}},staveIndex:{test:function test(tokenValues){if(tokenValues.length===3){return tokenValues[0]===THE&&isStave(tokenValues[1])&&isPositiveInteger(tokenValues[2])}if(tokenValues.length===2){return isStave(tokenValues[0])&&isPositiveInteger(tokenValues[1])}return false},match:function match(tokenValues){if(tokenValues.length===3){return[tokenValues[2]]}if(tokenValues.length===2){return[tokenValues[1]]}}},indexOfStave:{test:function test(tokenValues){if(tokenValues.length===3){return tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&isStave(tokenValues[2])}if(tokenValues.length===2){return isPositiveInteger(tokenValues[0])&&isStave(tokenValues[1])}return false},match:function match(tokenValues){if(tokenValues.length===3){return[tokenValues[1]]}if(tokenValues.length===2){return[tokenValues[0]]}}},staveIndexHighlight:/(((stave|staff)((\w|\s)+\w))|(((\w|\s)+\s)(stave|staff)))/,measureIndexHighlight:/(((measure)((\w|\s)+\w))|(((\w|\s)+\s)(measure)))/,withoutStartBarLine:{test:function test(tokenValues){return firstArrayContainsSecondArray(WITHOUT_START_BARLINE,tokenValues)}},withoutStartBarLineHighlight:/without(\s+)(opening|start)(\s+)(bar(\s+)line|barline)/,noStartBarLine:{test:function test(tokenValues){return firstArrayContainsSecondArray(NO_START_BARLINE,tokenValues)}},noStartBarLineHighlight:/no(\s+)(opening|start)(\s+)(bar(\s+)line|barline)/,opensWithBarLine:{test:function test(tokenValues){return STARTS_BEGINS_OPENS.indexOf(tokenValues[0])!==-1&&tokenValues[1]===WITH&&firstArrayContainsSecondArray(openingBarLineNamesAsTokens,tokenValues.slice(2))},match:function match(tokenValues){return[tokenValues.slice(2).join(SPACE)]}},openingBarLine:{test:function test(tokenValues){return firstArrayContainsSecondArray(openingBarLineNamesAsTokensAsSeparateCommand,tokenValues)},match:function match(tokenValues){return[tokenValues.slice(1).join(SPACE)]}},closesWithBarLine:{test:function test(tokenValues){return CLOSES_FINISHES_ENDS.indexOf(tokenValues[0])!==-1&&tokenValues[1]===WITH&&firstArrayContainsSecondArray(closingBarLineNamesAsTokens,tokenValues.slice(2))},match:function match(tokenValues){return[tokenValues.slice(2).join(SPACE)]}},closingBarLine:{test:function test(tokenValues){return firstArrayContainsSecondArray(closingBarLineNamesAsTokensAsSeparateCommand,tokenValues)},match:function match(tokenValues){return[tokenValues.slice(1).join(SPACE)]}},openingBarLineHighlight:new RegExp("((".concat(START,"|").concat(OPENING,") )?(").concat(openingBarLineNames.join(VERTICAL_LINE),")").replaceAll(SPACE,SPACE_REGEXP)),closingBarLineHighlight:new RegExp("(".concat(CLOSING," )?(").concat(closingBarLineNames.join(VERTICAL_LINE),")").replaceAll(SPACE,SPACE_REGEXP)),withRepeatSign:{test:function test(tokenValues){return firstArrayContainsSecondArray(WITH_REPEAT_SIGN,tokenValues)}},repeatSign:{test:function test(tokenValues){return firstArrayContainsSecondArray(REPEAT_SIGN,tokenValues)}},withRepeatSignHighlight:/((repeat(\s+)sign)|colon)/,atTheStart:{test:function test(tokenValues){return firstArrayContainsSecondArray(AT_THE_START,tokenValues)}},atTheStartHighlight:/(at(\s+))?(the(\s+))?start/,atTheEnd:{test:function test(tokenValues){return firstArrayContainsSecondArray(AT_THE_END,tokenValues)}},atTheEndHighlight:/(at(\s+))?(the(\s+))?end/,atTheStartOfTheMeasure:{test:function test(tokenValues){return firstArrayContainsSecondArray(AT_THE_START_OF_THE_MEASURE,tokenValues)}},atTheStartOfTheMeasureHighlight:/(at(\s+))?(the(\s+))?start((\s+)of)?((\s+)the)?((\s+)measure)?/,atTheEndOfTheMeasure:{test:function test(tokenValues){return firstArrayContainsSecondArray(AT_THE_END_OF_THE_MEASURE,tokenValues)}},atTheEndOfTheMeasureHighlight:/(at(\s+))?(the(\s+))?end((\s+)of)?((\s+)the)?((\s+)measure)?/,withMeasureRest:{test:function test(tokenValues){return firstArrayContainsSecondArray(WITH_MEASURE_REST,tokenValues)}},measureRest:{test:function test(tokenValues){return firstArrayContainsSecondArray(MEASURE_REST,tokenValues)}},measureRestHighlight:/(multi\s+)?measure(\s+)rest/,multiMeasureRestCount:{test:function test(tokenValues){return isPositiveInteger(tokenValues[0])&&tokenValues[1]===TIMES},match:function match(tokenValues){return[tokenValues[0]]}},ofPreviousBeat:{test:function test(tokenValues){return firstArrayContainsSecondArray(OF_PREVIOUS_BEAT,tokenValues)}},ofPreviousBeats:{test:function test(tokenValues){return firstArrayContainsSecondArray(OF_PREVIOUS_BEATS,tokenValues)}},measureWithSimileOfPreviousMeasure:{test:function test(tokenValues){return firstArrayContainsSecondArray(MEASURE_WITH_SIMILE_OF_PREVIOUS_MEASURE,tokenValues)}},measureWithSimileOfTwoPreviousMeasures:{test:function test(tokenValues){return firstArrayContainsSecondArray(MEASURE_WITH_SIMILE_OF_TWO_PREVIOUS_MEASURES,tokenValues)}},simileOfPreviousMeasure:{test:function test(tokenValues){return firstArrayContainsSecondArray(SIMILE_OF_PREVIOUS_MEASURE,tokenValues)}},simileOfTwoPreviousMeasures:{test:function test(tokenValues){return firstArrayContainsSecondArray(SIMILE_OF_TWO_PREVIOUS_MEASURES,tokenValues)}},simileHighlight:/(simile|repeat)/,previousMeasureHighlight:/prev(.|ious)?(\s+)measure/,twoPreviousMeasuresHighlight:/(two|2)(\s+)prev(.|ious)?(\s+)measures/,simileCount:{test:function test(tokenValues){return isPositiveInteger(tokenValues[0])&&tokenValues[1]===TIMES},match:function match(tokenValues){return[tokenValues[0]]}},new:{test:function test(tokenValues){return tokenValues[0]===NEW}},line:{test:function test(tokenValues){return tokenValues[0]===LINE}},newHighlight:/new(\s+)/,lineHighlight:LINE,crossStaveConnection:{test:function test(tokenValues){return CROSS_STAVE_CONNECTIONS.indexOf(tokenValues[0])!==-1}},crossStaveConnectionHighlight:/(bracket|brace)/,to:{test:function test(tokenValues){return tokenValues[0]===TO&&tokenValues.length===1}},from:{test:function test(tokenValues){return tokenValues[0]===FROM&&tokenValues.length===1}},for:{test:function test(tokenValues){return tokenValues[0]===FOR&&tokenValues.length===1}},of:{test:function test(tokenValues){return tokenValues[0]===OF&&tokenValues.length===1}},till:{test:function test(tokenValues){return tokenValues[0]===TILL&&tokenValues.length===1}},stave:{test:function test(tokenValues){return isStave(tokenValues[0])&&tokenValues.length===1}},staveWithAndWithoutDelimeter:{test:function test(tokenValues){return firstArrayContainsSecondArray(STAVE_WITH_AND_WITHOUT_DELIMITER,tokenValues)}},staveHighlight:/stave|staff/,instrumentTitle:{test:function test(tokenValues){return tokenValues[0]===INSTRUMENT&&tokenValues[1]===TITLE&&tokenValues[2]===IS&&isWrappedWithQuotes(tokenValues.slice(3))||tokenValues[0]===INSTRUMENT&&tokenValues[1]===TITLE&&isWrappedWithQuotes(tokenValues.slice(2))||tokenValues[0]===INSTRUMENT&&tokenValues[1]===IS&&isWrappedWithQuotes(tokenValues.slice(2))||tokenValues[0]===INSTRUMENT&&isWrappedWithQuotes(tokenValues.slice(1))},match:function match(tokenValues){if(tokenValues[0]===INSTRUMENT&&tokenValues[1]===TITLE&&tokenValues[2]===IS){var titleWithQuotes=tokenValues.slice(3);var title=unwrappedFromQuotesValue(titleWithQuotes);return[title]}if(tokenValues[0]===INSTRUMENT&&tokenValues[1]===TITLE){var _titleWithQuotes=tokenValues.slice(2);var _title=unwrappedFromQuotesValue(_titleWithQuotes);return[_title]}if(tokenValues[0]===INSTRUMENT&&tokenValues[1]===IS){var _titleWithQuotes2=tokenValues.slice(2);var _title2=unwrappedFromQuotesValue(_titleWithQuotes2);return[_title2]}if(tokenValues[0]===INSTRUMENT){var _titleWithQuotes3=tokenValues.slice(1);var _title3=unwrappedFromQuotesValue(_titleWithQuotes3);return[_title3]}}},instrumentTitleHighlight:/instrument( title)?/,between:{test:function test(tokenValues){return tokenValues[0]===BETWEEN&&tokenValues.length===1}},and:{test:function test(tokenValues){return tokenValues[0]===AND&&tokenValues.length===1}},keySignature:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,KEY_SIGNATURE)}},keySignatureHighlight:/key(\s+)signature/,keySignatureName:{test:function test(tokenValues){if(tokenValues[0]===IS){return firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues.slice(1))}return firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues)},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues.slice(1).join(SPACE)]}var joinedTokenValues=tokenValues.join(SPACE);return[joinedTokenValues]}},keySignatureNameHighlight:new RegExp("(".concat(allKeySignatureNamesWithDelimeter,")").replaceAll(" ","(\\s+)")),timeSignature:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,TIME_SIGNATURE)}},timeSignatureHighlight:/time(\s+)signature/,timeSignatureValue:{test:function test(tokenValues){if(tokenValues[0]===IS){if(tokenValues[1]===C){return true}if(tokenValues[1]===CROSSED&&tokenValues[2]===C){return true}if(tokenValues[1]){var timeFraction=tokenValues[1].split(COLUMN);if(timeFraction.length===2&&isPositiveInteger(timeFraction[0])&&isPositiveInteger(timeFraction[1])){return true}}}if(tokenValues[0]===C){return true}if(tokenValues[0]===CROSSED&&tokenValues[1]===C){return true}if(tokenValues[0]){var _timeFraction=tokenValues[0].split(COLUMN);if(_timeFraction.length===2&&isPositiveInteger(_timeFraction[0])&&isPositiveInteger(_timeFraction[1])){return true}}return false},match:function match(tokenValues){if(tokenValues[0]===IS){if(tokenValues[1]===C){return["c"]}if(tokenValues[1]===CROSSED&&tokenValues[2]===C){return["crossed c"]}var _timeFraction2=tokenValues[1].split(COLUMN);if(_timeFraction2.length===2&&isPositiveInteger(_timeFraction2[0])&&isPositiveInteger(_timeFraction2[1])){return[_timeFraction2[0],_timeFraction2[1]]}}if(tokenValues[0]===C){return["c"]}if(tokenValues[0]===CROSSED&&tokenValues[1]===C){return["crossed c"]}var timeFraction=tokenValues[0].split(COLUMN);if(timeFraction.length===2&&isPositiveInteger(timeFraction[0])&&isPositiveInteger(timeFraction[1])){return[timeFraction[0],timeFraction[1]]}}},timeSignatureValueHighlight:new RegExp("((\\d+:\\d+)|crossed c|c)".replaceAll(SPACE,SPACE_REGEXP)),repetitionNote:{test:function test(tokenValues){if(tokenValues[2]===IS){return tokenValues[0]===REPETITION&&(tokenValues[1]===MARK||tokenValues[1]===NOTE||tokenValues[1]===INSTRUCTION)&&isWrappedWithQuotes(tokenValues.slice(3))}return tokenValues[0]===REPETITION&&(tokenValues[1]===MARK||tokenValues[1]===NOTE||tokenValues[1]===INSTRUCTION)&&isWrappedWithQuotes(tokenValues.slice(2))},match:function match(tokenValues){if(tokenValues[2]===IS){var _repeatNoteValueWithQuotes=tokenValues.slice(3);var _repeatNoteValue=unwrappedFromQuotesValue(_repeatNoteValueWithQuotes);return[_repeatNoteValue]}var repeatNoteValueWithQuotes=tokenValues.slice(2);var repeatNoteValue=unwrappedFromQuotesValue(repeatNoteValueWithQuotes);return[repeatNoteValue]}},repetitionNoteHighlight:/repetition(\s+)(mark|note|instruction)/,coda:{test:function test(tokenValues){return tokenValues[0]===CODA}},codaHighlight:CODA,sign:{test:function test(tokenValues){return tokenValues[0]===SIGN||tokenValues[0]===SEGNO}},signHighlight:/sign|segno/,tempoOrMetronome:{test:function test(tokenValues){return tokenValues[0]===TEMPO||tokenValues[0]===METRONOME||tokenValues[0]===METRO}},markOrNote:{test:function test(tokenValues){return tokenValues[0]===MARK||tokenValues[0]===NOTE}},tempoMarkOrTempoNote:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,TEMPO_MARK)||areTwoArraysEqual(tokenValues,TEMPO_NOTE)}},tempoMarkHighlight:/(tempo(\s+)mark|tempo(\s+)note|tempo|metronome|metro)/,tempoMarkWithDotHighlight:{test:function test(string){var stringWithoutDoubleSpacesAndTrimmed=withoutDoubleSpacesAndTrimmed(string);return stringWithoutDoubleSpacesAndTrimmed===WITH_DOT}},tempoMarkDottedHighlight:{test:function test(string){var stringWithoutDoubleSpacesAndTrimmed=withoutDoubleSpacesAndTrimmed(string);return stringWithoutDoubleSpacesAndTrimmed===DOTTED}},tempoMarkText:{test:function test(tokenValues){if(tokenValues[0]===IS){return isWrappedWithQuotes(tokenValues.slice(1))}return isWrappedWithQuotes(tokenValues)},match:function match(tokenValues){if(tokenValues[0]===IS){return[unwrappedFromQuotesValue(tokenValues.slice(1))]}return[unwrappedFromQuotesValue(tokenValues)]}},tempoDurationPart:new RegExp("(".concat(tempoDurationPartNames.join(VERTICAL_LINE),"|dotted|with dot)")),tempoDurationPartHighlight:new RegExp("(".concat(tempoDurationPartNames.join(VERTICAL_LINE),"|dotted|with dot)"),"g"),tempoDurationPartIsDot:{test:function test(tokenValues){return tokenValues[0]===DOTTED||areTwoArraysEqual(tokenValues,WITH_DOT)}},withClef:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[tokenValues.length-1]===CLEF&&firstArrayContainsSecondArray(clefNamesAsTokens,tokenValues.slice(1,tokenValues.length-1))},match:function match(tokenValues){return[tokenValues.slice(1,tokenValues.length-1).join(SPACE)]}},clef:{test:function test(tokenValues){return tokenValues[tokenValues.length-1]===CLEF&&firstArrayContainsSecondArray(clefNamesAsTokens,tokenValues.slice(0,tokenValues.length-1))},match:function match(tokenValues){return[tokenValues.slice(0,tokenValues.length-1).join(SPACE)]}},clefHighlight:new RegExp("(".concat(clefNames.join(VERTICAL_LINE),") clef").replaceAll(SPACE,SPACE_REGEXP)),voice:{test:function test(tokenValues){return tokenValues[0]===VOICE}},voiceHighlight:VOICE,noteWithDurationAndOctave:{test:function test(tokenValues){if(tokenValues.length===1){return noteNames.indexOf(tokenValues[0][0])!==-1&&(!tokenValues[0][1]||isPositiveInteger(tokenValues[0][1])&&!tokenValues[0][2])}if(tokenValues.length===2){return noteDurationNames.indexOf(tokenValues[0])!==-1&&noteNames.indexOf(tokenValues[1][0])!==-1&&(!tokenValues[1][1]||isPositiveInteger(tokenValues[1][1])&&!tokenValues[1][2])}return false},match:function match(tokenValues){if(tokenValues.length===1){return[null,tokenValues[0][0],tokenValues[0][1]]}if(tokenValues.length===2){return[tokenValues[0],tokenValues[1][0],tokenValues[1][1]]}}},noteWithDurationAndOctaveHighlight:new RegExp("(".concat(noteDurationNames.join(VERTICAL_LINE),")?( *)(").concat(noteNames.join(VERTICAL_LINE),")(\\d)?")),stemDirection:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]===STEM&&isDirection(tokenValues[2])||tokenValues[0]===STEM&&isDirection(tokenValues[1])},match:function match(tokenValues){if(tokenValues[0]===WITH){return[tokenValues[2]]}return[tokenValues[1]]}},directionOfStem:{test:function test(tokenValues){return tokenValues[0]===WITH&&isDirection(tokenValues[1])&&tokenValues[2]===STEM||isDirection(tokenValues[0])&&tokenValues[1]===STEM},match:function match(tokenValues){if(isDirection(tokenValues[1])){return[tokenValues[1]]}if(isDirection(tokenValues[0])){return[tokenValues[0]]}}},stemHighlight:STEM,stavePosition:{test:function test(tokenValues){return tokenValues[0]===IS&&(ON_IN_AT.indexOf(tokenValues[1])!==-1&&tokenValues[2]===THE&&stavePositionNames.indexOf(tokenValues[3])!==-1&&isStave(tokenValues[4])||ON_IN_AT.indexOf(tokenValues[1])!==-1&&stavePositionNames.indexOf(tokenValues[2])!==-1&&isStave(tokenValues[3]))||ON_IN_AT.indexOf(tokenValues[0])!==-1&&tokenValues[1]===THE&&stavePositionNames.indexOf(tokenValues[2])!==-1&&isStave(tokenValues[3])||ON_IN_AT.indexOf(tokenValues[0])!==-1&&stavePositionNames.indexOf(tokenValues[1])!==-1&&isStave(tokenValues[2])},match:function match(tokenValues){if(isStave(tokenValues[3])){return[tokenValues[2]]}if(isStave(tokenValues[2])){return[tokenValues[1]]}}},stavePositionHighlight:new RegExp("(".concat(stavePositionNames.join(VERTICAL_LINE),")(\\s+)(stave|staff)")),withNumberOfDots:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]&&tokenValues[1].length===1&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===DOTS},match:function match(tokenValues){return[tokenValues[1]]}},withNumberOfDotsHighlight:/(with\s+)(((\w|\s)+)(\s+)dots)/,dotted:{test:function test(tokenValues){return tokenValues[0]===IS&&tokenValues[1]===DOTTED||tokenValues[0]===DOTTED}},dottedHighlight:DOTTED,withDot:{test:function test(tokenValues){return tokenValues[0]===WITH&&(tokenValues[1]===ONE||tokenValues[1]===ONE_AS_WORD)&&tokenValues[2]===DOT||tokenValues[0]===WITH&&tokenValues[1]===DOT}},withDotHighlight:/( (1|one))? dot/,beamed:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_BEAMED)||tokenValues[0]===BEAMED}},beamedHighlight:BEAMED,notBeamed:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_NOT_BEAMED)||areTwoArraysEqual(tokenValues,NOT_BEAMED)}},withNext:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_NEXT)}},withNextHighlight:NEXT,withOnlyPrimaryLine:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_ONLY_ONE_LINE)||areTwoArraysEqual(tokenValues,WITH_ONLY_PRIMARY_LINE)}},withOnlyPrimaryLineHighlight:/only(\s+)(primary|one)?(\s+)line/,withNoteKey:{test:function test(tokenValues){return tokenValues[0]===WITH&&firstArrayContainsSecondArray(noteKeyNamesAsTokens,tokenValues.slice(1,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===KEY||firstArrayContainsSecondArray(mainNoteKeyNamesAsTokens,tokenValues)},match:function match(tokenValues){if(firstArrayContainsSecondArray(mainNoteKeyNamesAsTokens,tokenValues)){return[tokenValues.join(SPACE)]}return[tokenValues.slice(1,tokenValues.length-1).join(SPACE)]}},withNoteKeyHighlight:new RegExp("((".concat(noteKeyNames.join(VERTICAL_LINE),")(\\s+)key)|(").concat(mainNoteKeyNames.join(VERTICAL_LINE),")")),withParentheses:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_BRACKETS)||areTwoArraysEqual(tokenValues,WITH_PARENTHESES)}},withParenthesesHighlight:/(parentheses|brackets)/,withText:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]===TEXT&&isWrappedWithQuotes(tokenValues.slice(2))||tokenValues[0]===WITH&&isWrappedWithQuotes(tokenValues.slice(1))},match:function match(tokenValues){if(isWrappedWithQuotes(tokenValues.slice(2))){return[unwrappedFromQuotesValue(tokenValues.slice(2))]}if(isWrappedWithQuotes(tokenValues.slice(1))){return[unwrappedFromQuotesValue(tokenValues.slice(1))]}}},withTextHighlight:TEXT,direction:{test:function test(tokenValues){return tokenValues[0]===IS&&isDirection(tokenValues[1])||isDirection(tokenValues[0])&&tokenValues.length===1},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues[1]]}return[tokenValues[0]]}},beside:{test:function test(tokenValues){return tokenValues[0]===BESIDE&&tokenValues.length===1}},aboveBelowOverUnderStaveLines:{test:function test(tokenValues){return tokenValues[0]===IS&&isAboveBelowOverUnder(tokenValues[1])&&isStave(tokenValues[2])||isAboveBelowOverUnder(tokenValues[0])&&isStave(tokenValues[1])},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues[1]]}return[tokenValues[0]]}},belowUnderStaveLines:{test:function test(tokenValues){return tokenValues[0]===IS&&isBelowUnder(tokenValues[1])&&isStave(tokenValues[2])||isBelowUnder(tokenValues[0])&&isStave(tokenValues[1])}},belowUnder:{test:function test(tokenValues){return tokenValues[0]===IS&&isBelowUnder(tokenValues[1])||isBelowUnder(tokenValues[0])}},withRoundness:{test:function test(tokenValues){return tokenValues[0]===WITH&&(tokenValues[1]===ROUNDNESS||tokenValues[1]===CONVEX)&&ROUND_COEFFICIENT.indexOf(tokenValues[2])!==-1},match:function match(tokenValues){return[tokenValues[2]]}},roundnessHighlight:/(roundness|convex)(\s+)(10|[1-9])/,tiedWithNext:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_TIED_WITH_NEXT)||areTwoArraysEqual(tokenValues,TIED_WITH_NEXT)}},tiedBefore:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_TIED_BEFORE)||areTwoArraysEqual(tokenValues,TIED_BEFORE)}},tiedAfter:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_TIED_AFTER)||areTwoArraysEqual(tokenValues,TIED_AFTER)}},tiedHighlight:TIED,topMidBottomRest:{test:function test(tokenValues){return noteDurationNames.indexOf(tokenValues[0])!==-1&&REST_POSITIONS.indexOf(tokenValues[1])!==-1&&tokenValues[2]===REST||noteDurationNames.indexOf(tokenValues[0])!==-1&&tokenValues[1]===REST||REST_POSITIONS.indexOf(tokenValues[0])!==-1&&tokenValues[1]===REST||tokenValues[0]===REST},match:function match(tokenValues){if(tokenValues[2]===REST){return[tokenValues[0],tokenValues[1]]}if(tokenValues[1]===REST){if(noteDurationNames.indexOf(tokenValues[0])!==-1){return[tokenValues[0]]}if(REST_POSITIONS.indexOf(tokenValues[0])!==-1){return[null,tokenValues[0]]}}return[null,null]}},topMidBottomRestHighlight:new RegExp("(".concat(noteDurationNames.join(VERTICAL_LINE),")?( *)((top|middle|mid|bottom)(\\s+))?rest")),isRest:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_REST)}},rest:{test:function test(tokenValues){return tokenValues[0]===REST&&tokenValues.length===1}},restHighlight:REST,isGhost:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_GHOST)||tokenValues[0]===GHOST}},ghostHighlight:GHOST,isNotGhost:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_NOT_GHOST)||areTwoArraysEqual(tokenValues,NOT_GHOST)}},isGrace:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_CRUSHED_GRACE)||areTwoArraysEqual(tokenValues,CRUSHED_GRACE)||areTwoArraysEqual(tokenValues,IS_GRACE)||tokenValues[0]===GRACE},match:function match(tokenValues){var isCrushed=tokenValues[0]===CRUSHED||tokenValues[1]===CRUSHED;return[isCrushed]}},graceHighlight:GRACE,withCrushLine:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_CRUSH_LINE)}},crushLineHighlight:/crush\s+line/,measureNumber:{test:function test(tokenValues){return tokenValues[0]===MEASURE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){return[tokenValues[1]]}},numberOfMeasure:{test:function test(tokenValues){return isPositiveInteger(tokenValues[0])&&tokenValues[1]===MEASURE},match:function match(tokenValues){return[tokenValues[0]]}},isCentralized:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_IN_THE_CENTER)||areTwoArraysEqual(tokenValues,IN_THE_CENTER)||areTwoArraysEqual(tokenValues,IS_CENTRALIZED)||areTwoArraysEqual(tokenValues,CENTRALIZED)}},isNotCentralized:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_NOT_IN_THE_CENTER)||areTwoArraysEqual(tokenValues,NOT_IN_THE_CENTER)||areTwoArraysEqual(tokenValues,IS_NOT_CENTRALIZED)||areTwoArraysEqual(tokenValues,NOT_CENTRALIZED)}},withBreathMarkBefore:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]===BREATH&&tokenValues[2]===MARK&&firstArrayContainsSecondArray(breathMarkNamesAsTokens,tokenValues.slice(3,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE||tokenValues[0]===WITH&&tokenValues[1]===BREATH&&firstArrayContainsSecondArray(breathMarkNamesAsTokens,tokenValues.slice(2,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE||tokenValues[0]===WITH&&tokenValues[1]===BREATH&&tokenValues[2]===MARK&&tokenValues[3]===BEFORE||tokenValues[0]===WITH&&tokenValues[1]===BREATH&&tokenValues[2]===BEFORE},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);for(var index=0;index<breathMarkNames.length;index++){if(joinedTokenValues.includes(breathMarkNames[index])){return[breathMarkNames[index]]}}return[breathMarkNames[0]]}},withBreathMarkBeforeHighlight:new RegExp("breath( mark)?( (".concat(breathMarkNames.join(VERTICAL_LINE),"))?|(").concat(breathMarkNames.join(VERTICAL_LINE),")").replaceAll(" ",SPACE_REGEXP),"g"),withKeySignatureBefore:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]===KEY&&tokenValues[2]===SIGNATURE&&firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues.slice(3,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE||tokenValues[0]===WITH&&firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues.slice(1,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE},match:function match(tokenValues){var firstOption=tokenValues.slice(3,tokenValues.length-1);if(firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,firstOption)){return[firstOption.join(SPACE)]}var secondOption=tokenValues.slice(1,tokenValues.length-1);if(firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,secondOption)){return[secondOption.join(SPACE)]}}},withClefBefore:{test:function test(tokenValues){return tokenValues[0]===WITH&&firstArrayContainsSecondArray(clefNamesAsTokens,tokenValues.slice(1,tokenValues.length-2))&&tokenValues[tokenValues.length-2]===CLEF&&tokenValues[tokenValues.length-1]===BEFORE},match:function match(tokenValues){return[tokenValues.slice(1,tokenValues.length-2).join(SPACE)]}},withClefAndKeySignatureBefore:{test:function test(tokenValues){var tokenValueWithClefIndex=tokenValues.indexOf(CLEF);if(tokenValueWithClefIndex===-1){return false}return tokenValues[0]===WITH&&firstArrayContainsSecondArray(clefNamesAsTokens,tokenValues.slice(1,tokenValueWithClefIndex))&&tokenValues[tokenValueWithClefIndex+1]===KEY&&tokenValues[tokenValueWithClefIndex+2]===SIGNATURE&&firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues.slice(tokenValueWithClefIndex+3,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE||tokenValues[0]===WITH&&clefNames.indexOf(tokenValues.slice(1,tokenValueWithClefIndex).join(SPACE))!==-1&&firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,tokenValues.slice(tokenValueWithClefIndex+1,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===BEFORE},match:function match(tokenValues){var tokenValueWithClefIndex=tokenValues.indexOf(CLEF);var clefName=tokenValues.slice(1,tokenValueWithClefIndex).join(SPACE);var firstOption=tokenValues.slice(tokenValueWithClefIndex+3,tokenValues.length-1);if(firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,firstOption)){return[clefName,firstOption.join(SPACE)]}var secondOption=tokenValues.slice(tokenValueWithClefIndex+1,tokenValues.length-1);if(firstArrayContainsSecondArray(separateKeySignatureNamesAsTokens,secondOption)){return[clefName,secondOption.join(SPACE)]}}},withArticulation:{test:function test(tokenValues){return tokenValues[0]===WITH&&firstArrayContainsSecondArray(articulationNamesAsTokens,tokenValues.slice(1))},match:function match(tokenValues){return[tokenValues.slice(1).join(SPACE)]}},withArticulationHighlight:new RegExp("(".concat(articulationNames.join(VERTICAL_LINE),")").replaceAll(SPACE,SPACE_REGEXP)),withTurn:{test:function test(tokenValues){return areTwoArraysEqual(WITH_TURN,tokenValues)}},withTurnHighlight:TURN,withMordent:{test:function test(tokenValues){return areTwoArraysEqual(WITH_MORDENT,tokenValues)}},withMordentHighlight:MORDENT,withTrill:{test:function test(tokenValues){return areTwoArraysEqual(WITH_TRILL,tokenValues)}},withTrillHighlight:TRILL,withOrnamentKeyAboveBelowOverUnder:{test:function test(tokenValues){var tokenValueWithKeyIndex=tokenValues.indexOf(KEY);if(tokenValueWithKeyIndex===-1){return false}return tokenValues[0]===WITH&&firstArrayContainsSecondArray(ornamentKeyNamesAsTokens,tokenValues.slice(1,tokenValueWithKeyIndex))&&isAboveBelowOverUnder(tokenValues[tokenValueWithKeyIndex+1])},match:function match(tokenValues){var tokenValueWithKeyIndex=tokenValues.indexOf(KEY);return[tokenValues.slice(1,tokenValueWithKeyIndex).join(SPACE),tokenValues[tokenValueWithKeyIndex+1]]}},ornamentKeyHighlight:new RegExp("(".concat(ornamentKeyNames.join(VERTICAL_LINE),") key").replaceAll(SPACE,SPACE_REGEXP)),isInverted:{test:function test(tokenValues){return tokenValues[0]===INVERTED&&tokenValues.length===1||areTwoArraysEqual(tokenValues,IS_INVERTED)}},withWaveAfter:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_WAVE_AFTER)}},waveHighlight:WAVE,withChord:{test:function test(tokenValues){var wrappedChordValue=tokenValues.slice(2);if(tokenValues[0]===WITH&&tokenValues[1]===CHORD&&isWrappedWithQuotes(wrappedChordValue)){var chordValue=unwrappedFromQuotesValue(wrappedChordValue);var devidedByBackSlash=chordValue.split(SLASH);if(devidedByBackSlash.length===1||devidedByBackSlash.length===2){var devidedByUpCaretFirstPart=devidedByBackSlash[0].split(UP_CARET);if(devidedByUpCaretFirstPart.length===1||devidedByUpCaretFirstPart.length===2){if(devidedByBackSlash.length===2){var devidedByUpCaretSecondPart=devidedByBackSlash[1].split(UP_CARET);if(devidedByUpCaretSecondPart.length===1||devidedByUpCaretSecondPart.length===2){return true}return false}return true}return false}return false}return false},match:function match(tokenValues){var wrappedChordValue=tokenValues.slice(2);return[unwrappedFromQuotesValue(wrappedChordValue)]}},withChordHighlight:CHORD,withChordWithDurationHighlight:new RegExp("(".concat(noteDurationNames.join(VERTICAL_LINE),")?( *)chord")),isOctaveOrTwoOctavesHigherOrLower:{test:function test(tokenValues){return tokenValues[0]===IS&&(tokenValues[1]===TWO||tokenValues[1]===TWO_AS_WORD)&&tokenValues[2]===OCTAVES&&isUpHigherDownLower(tokenValues[3])&&tokenValues.length===4||(tokenValues[0]===TWO||tokenValues[0]===TWO_AS_WORD)&&tokenValues[1]===OCTAVES&&isUpHigherDownLower(tokenValues[2])&&tokenValues.length===3||tokenValues[0]===IS&&tokenValues[1]===OCTAVE&&isUpHigherDownLower(tokenValues[2])&&tokenValues.length===3||tokenValues[0]===OCTAVE&&isUpHigherDownLower(tokenValues[1])&&tokenValues.length===2},match:function match(tokenValues){if(tokenValues[1]===TWO||tokenValues[1]===TWO_AS_WORD){return[tokenValues[1],tokenValues[3]]}if(tokenValues[0]===TWO||tokenValues[0]===TWO_AS_WORD){return[tokenValues[0],tokenValues[2]]}if(isUpHigherDownLower(tokenValues[2])){return[null,tokenValues[2]]}if(isUpHigherDownLower(tokenValues[1])){return[null,tokenValues[1]]}}},isOctaveOrTwoOctavesHigherOrLowerHighlight:/((2|two)(\s+))?octave(s)?/,octaveOrTwoOctavesHigherOrLower:{test:function test(tokenValues){return(tokenValues[0]===TWO||tokenValues[0]===TWO_AS_WORD)&&tokenValues[1]===OCTAVES&&isUpHigherDownLower(tokenValues[2])&&tokenValues.length===3||tokenValues[0]===OCTAVE&&isUpHigherDownLower(tokenValues[1])&&tokenValues.length===2},match:function match(tokenValues){if(tokenValues[0]===TWO||tokenValues[0]===TWO_AS_WORD){return[tokenValues[0],tokenValues[2]]}if(isUpHigherDownLower(tokenValues[1])){return[null,tokenValues[1]]}}},withTremolo:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_TREMOLO)}},withTremoloHighlight:TREMOLO,withNumberOfStrokes:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_ONE_STROKE)||areTwoArraysEqual(tokenValues,WITH_TWO_STROKES)||areTwoArraysEqual(tokenValues,WITH_THREE_STROKES)},match:function match(tokenValues){return[tokenValues[1]]}},withNumberOfStrokesHighlight:/(\w+)(\s+)stroke(s)?/,numberOfTimes:{test:function test(tokenValues){return tokenValues[0]===ONE&&tokenValues[1]===TIME||tokenValues[0]!==ONE&&isPositiveInteger(tokenValues[0])&&tokenValues[1]===TIMES},match:function match(tokenValues){return[tokenValues[0]]}},numberOfTimesHighlight:/^(\d+) time(s)?$/,repeat:{test:function test(tokenValues){return tokenValues[0]===REPEAT}},repeatHighlight:REPEAT,viaSimile:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,VIA_SIMILE)}},withDynamic:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues[1]===DYNAMIC&&isWrappedWithQuotes(tokenValues.slice(2))},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues.slice(2))]}},withDynamicHighlight:DYNAMIC,withLyrics:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_NEW_LYRICS)||areTwoArraysEqual(tokenValues,WITH_NEW_LYRIC)||areTwoArraysEqual(tokenValues,WITH_LYRICS)||areTwoArraysEqual(tokenValues,WITH_LYRIC)}},lyricsHighlight:/lyric(s)?/,textValue:{test:function test(tokenValues){return isWrappedWithQuotes(tokenValues)},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues)]}},followedByDash:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_FOLLOWED_BY_DASH)||areTwoArraysEqual(tokenValues,IS_FOLLOWED_BY_HYPEN)||areTwoArraysEqual(tokenValues,FOLLOWED_BY_DASH)||areTwoArraysEqual(tokenValues,FOLLOWED_BY_HYPEN)}},dashHighlight:/(dash|hyphen)/,underscoreStarts:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WHERE_UNDERSCORE_STARTS)||areTwoArraysEqual(tokenValues,WHERE_UNDERSCORE_BEGINS)||areTwoArraysEqual(tokenValues,WITH_UNDERSCORE_STARTS)||areTwoArraysEqual(tokenValues,WITH_UNDERSCORE_BEGINS)||areTwoArraysEqual(tokenValues,UNDERSCORE_STARTS)||areTwoArraysEqual(tokenValues,UNDERSCORE_BEGINS)}},underscoreFinishes:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WHERE_UNDERSCORE_FINISHES)||areTwoArraysEqual(tokenValues,WHERE_UNDERSCORE_ENDS)||areTwoArraysEqual(tokenValues,WITH_UNDERSCORE_FINISHES)||areTwoArraysEqual(tokenValues,WITH_UNDERSCORE_ENDS)||areTwoArraysEqual(tokenValues,UNDERSCORE_FINISHES)||areTwoArraysEqual(tokenValues,UNDERSCORE_ENDS)}},underscoreHighlight:UNDERSCORE,forEachLine:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,FOR_EACH_LINE)}},forLinesBelow:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,FOR_LINES_BELOW)}},forLines:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,FOR_LINES)}},forEachLineHighlight:/each(\s+)line/,forEach:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,FOR_EACH)}},commentStartsAndEndsWithText:{test:function test(tokenValues){if(!tokenValues){return false}if(!tokenValues[0]){return false}if(!tokenValues[0].startsWith(COMMENT)&&!tokenValues[0].startsWith(SIDE)){return false}var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);return(splittedCommand[0]===COMMENT||splittedCommand[0]===SIDE_NOTE)&&splittedCommand[1]&&isWrappedWithQuotes([splittedCommand[1].slice(1)],true)},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);return[splittedCommand[1][0],unwrappedFromQuotesValue([splittedCommand[1].slice(1)])]}},commentStartsWithText:{test:function test(tokenValues){if(!tokenValues){return false}if(!tokenValues[0]){return false}if(!tokenValues[0].startsWith(COMMENT)&&!tokenValues[0].startsWith(SIDE)){return false}var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);return(splittedCommand[0]===COMMENT||splittedCommand[0]===SIDE_NOTE)&&splittedCommand[1]&&isQuote(splittedCommand[1][0])},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);return[splittedCommand[1][0],splittedCommand[1].slice(1)]}},comment:{test:function test(tokenValues){if(!tokenValues){return false}if(!tokenValues[0]){return false}if(!tokenValues[0].startsWith(COMMENT)&&!tokenValues[0].startsWith(SIDE)){return false}var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);return(splittedCommand[0]===COMMENT||splittedCommand[0]===SIDE_NOTE)&&(splittedCommand[1]===undefined||splittedCommand[1].trimStart()===EMPTY)}},column:{test:function test(tokenValues){return tokenValues[0]===COLUMN}},commentTextStartsAndEnds:{test:function test(tokenValues){return isWrappedWithQuotes(tokenValues,true)},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return[joinedTokenValues[0],joinedTokenValues.slice(1,joinedTokenValues.length-1)]}},commentTextStarts:{test:function test(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);if(splittedCommand.length===1){return isCommentQuote(splittedCommand[0][0])}if(splittedCommand.length>1){return isCommentQuote(splittedCommand[1][0])}return false},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);var splittedCommand=joinedTokenValues.split(COLUMN);if(splittedCommand.length===1){return[splittedCommand[0][0],splittedCommand[0].slice(1)]}if(splittedCommand.length>1){return[splittedCommand[1][0],splittedCommand[1].slice(1)]}}},commentTextEnds:{test:function test(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return isCommentQuote(joinedTokenValues[joinedTokenValues.length-1])},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return[joinedTokenValues.slice(0,joinedTokenValues.length-1),joinedTokenValues[joinedTokenValues.length-1]]}},commentQuote:{test:function test(tokenValues){return isCommentQuote(tokenValues[0])&&tokenValues.length===1}},anything:{test:function test(tokenValues){return tokenValues.length>0},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return[joinedTokenValues]}},chordWithDuration:{test:function test(tokenValues){if(tokenValues[0]===CHORD&&tokenValues.length===1){return true}return noteDurationNames.indexOf(tokenValues[0])!==-1&&tokenValues[1]===CHORD},match:function match(tokenValues){if(tokenValues[0]===CHORD){return[null]}return[tokenValues[0]]}},letters:{test:function test(tokenValues){return tokenValues[0]===LETTERS}},noteIndex:{test:function test(tokenValues){return tokenValues[0]===THE&&tokenValues[1]===NOTE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===NOTE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}}},indexOfNote:{test:function test(tokenValues){return tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===NOTE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===NOTE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}if(isPositiveInteger(tokenValues[0])){return[tokenValues[0]]}}},noteIndexHighlight:/(((note)((\w|\s)+\w))|(((\w|\s)+\s)(note)))/,arpeggiated:{test:function test(tokenValues){return firstArrayContainsSecondArray(IS_ARPEGGIATED,tokenValues)}},arpeggiatedHighlight:/arpeggiated|arpeggio/,withChordBelow:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_CHOR_BELOW)}},chordHighlight:CHORD,withArrow:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_ARROW)}},arrowHighlight:ARROW,positionPreposition:/((in|on|at|with)(\s+))?((\w|\s)+)/g,unitPosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&(tokenValues[2]===UNIT||tokenValues[2]===CHORD||tokenValues[2]===NOTE)&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&(tokenValues[1]===UNIT||tokenValues[1]===CHORD||tokenValues[1]===NOTE)&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&(tokenValues[1]===UNIT||tokenValues[1]===CHORD||tokenValues[1]===NOTE)&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===UNIT||tokenValues[0]===CHORD||tokenValues[0]===NOTE)&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},positionOfUnit:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&(tokenValues[3]===UNIT||tokenValues[3]===CHORD||tokenValues[3]===NOTE)||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&(tokenValues[2]===UNIT||tokenValues[2]===CHORD||tokenValues[2]===NOTE)||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&(tokenValues[2]===UNIT||tokenValues[2]===CHORD||tokenValues[2]===NOTE)||isPositiveInteger(tokenValues[0])&&(tokenValues[1]===UNIT||tokenValues[1]===CHORD||tokenValues[1]===NOTE)},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},unitLinePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&tokenValues[2]===LINE&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&tokenValues[1]===LINE&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===LINE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===LINE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},linePositionOfUnit:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&tokenValues[3]===LINE||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===LINE||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===LINE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===LINE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},unitMeasurePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&tokenValues[2]===MEASURE&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&tokenValues[1]===MEASURE&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===MEASURE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===MEASURE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},measurePositionOfUnit:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&tokenValues[3]===MEASURE||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===MEASURE||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===MEASURE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===MEASURE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},unitStavePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&(tokenValues[2]===STAVE||tokenValues[2]===STAFF)&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&(tokenValues[1]===STAVE||tokenValues[1]===STAFF)&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&(tokenValues[1]===STAVE||tokenValues[1]===STAFF)&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===STAVE||tokenValues[0]===STAFF)&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},stavePositionOfUnit:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&(tokenValues[3]===STAVE||tokenValues[3]===STAFF)||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&(tokenValues[2]===STAVE||tokenValues[2]===STAFF)||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&(tokenValues[2]===STAVE||tokenValues[2]===STAFF)||isPositiveInteger(tokenValues[0])&&(tokenValues[1]===STAVE||tokenValues[1]===STAFF)},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},unitVoicePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&tokenValues[2]===VOICE&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&tokenValues[1]===VOICE&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===VOICE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===VOICE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},voicePositionOfUnit:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&tokenValues[3]===VOICE||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===VOICE||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===VOICE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===VOICE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},pageLinePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&tokenValues[2]===LINE&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&tokenValues[1]===LINE&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===LINE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===LINE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},positionOfPageLine:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&tokenValues[3]===LINE||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===LINE||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===LINE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===LINE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},measurePosition:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&tokenValues[2]===MEASURE&&isPositiveInteger(tokenValues[3])||tokenValues[0]===THE&&tokenValues[1]===MEASURE&&isPositiveInteger(tokenValues[2])||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===MEASURE&&isPositiveInteger(tokenValues[2])||tokenValues[0]===MEASURE&&isPositiveInteger(tokenValues[1])},match:function match(tokenValues){if(isPositiveInteger(tokenValues[3])){return[tokenValues[3]]}if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}return[tokenValues[1]]}},positionOfMeasure:{test:function test(tokenValues){return(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&tokenValues[1]===THE&&isPositiveInteger(tokenValues[2])&&tokenValues[3]===MEASURE||tokenValues[0]===THE&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===MEASURE||(tokenValues[0]===IN||tokenValues[0]===ON||tokenValues[0]===AT||tokenValues[0]===WITH)&&isPositiveInteger(tokenValues[1])&&tokenValues[2]===MEASURE||isPositiveInteger(tokenValues[0])&&tokenValues[1]===MEASURE},match:function match(tokenValues){if(isPositiveInteger(tokenValues[2])){return[tokenValues[2]]}if(isPositiveInteger(tokenValues[1])){return[tokenValues[1]]}return[tokenValues[0]]}},slur:{test:function test(tokenValues){return tokenValues[0]===SLUR}},slurHighlight:SLUR,starts:{test:function test(tokenValues){return(tokenValues[0]===STARTS||tokenValues[0]===BEGINS)&&tokenValues.length===1}},startsFrom:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,STARTS_FROM)||areTwoArraysEqual(tokenValues,BEGINS_FROM)}},finishes:{test:function test(tokenValues){return(tokenValues[0]===FINISHES||tokenValues[0]===ENDS)&&tokenValues.length===1}},startsBefore:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,STARTS_BEFORE)||areTwoArraysEqual(tokenValues,BEGINS_BEFORE)}},before:{test:function test(tokenValues){return tokenValues[0]===BEFORE&&tokenValues.length===1}},finishesAfter:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,FINISHES_AFTER)||areTwoArraysEqual(tokenValues,ENDS_AFTER)}},after:{test:function test(tokenValues){return tokenValues[0]===AFTER&&tokenValues.length===1}},changesStaveOrGoesThrough:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,CHANGES_STAVE)||areTwoArraysEqual(tokenValues,CHANGES_STAFF)||areTwoArraysEqual(tokenValues,GOES_THROUGH)}},withSShape:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_S_SHAPE)||areTwoArraysEqual(tokenValues,WITH_S_DASH_SHAPE)||areTwoArraysEqual(tokenValues,WITH_SSHAPE)}},aboveBelowOverUnder:{test:function test(tokenValues){return tokenValues[0]===IS&&isAboveBelowOverUnder(tokenValues[1])||isAboveBelowOverUnder(tokenValues[0])&&tokenValues.length===1},match:function match(tokenValues){if(tokenValues[0]===IS){return[tokenValues[1]]}return[tokenValues[0]]}},leftPoint:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_LEFT_POINT)}},rightPoint:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_RIGHT_POINT)}},attachedToMiddleOfStem:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,ATTACHED_TO_MIDDLE_OF_STEM)||areTwoArraysEqual(tokenValues,ATTACHED_TO_THE_MIDDLE_OF_THE_STEM)}},attachedToNoteBody:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,ATTACHED_TO_NOTE_BODY)||areTwoArraysEqual(tokenValues,ATTACHED_TO_THE_NOTE_BODY)||areTwoArraysEqual(tokenValues,ATTACHED_TO_NOTE_HEAD)||areTwoArraysEqual(tokenValues,ATTACHED_TO_THE_NOTE_HEAD)}},glissando:{test:function test(tokenValues){return tokenValues[0]===GLISS||tokenValues[0]===GLISS_DOT||tokenValues[0]===GLISSANDO}},withGlissando:{test:function test(tokenValues){return firstArrayContainsSecondArray(WITH_GLISSANDO,tokenValues)}},glissandoHighlight:/(glissando|gliss\.|gliss|glis\.|glis)/,asWaveLine:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,AS_WAVE)||areTwoArraysEqual(tokenValues,AS_WAVES)||areTwoArraysEqual(tokenValues,AS_LINE)||areTwoArraysEqual(tokenValues,AS_LINES)},match:function match(tokenValues){if(areTwoArraysEqual(tokenValues,AS_WAVE)||areTwoArraysEqual(tokenValues,AS_WAVES)){return[WAVE]}return[LINE]}},asWaveLineHighlight:/(line|wave)(s)?/,tupletWithValue:{test:function test(tokenValues){if(tokenValues[0]!==TUPLET||!tokenValues[1]){return false}var tupletValueParts=tokenValues[1].split(COLUMN);if(tupletValueParts.length===1){return isPositiveInteger(tupletValueParts[0])}if(tupletValueParts.length===2){return isPositiveInteger(tupletValueParts[0])&&isPositiveInteger(tupletValueParts[1])}return false},match:function match(tokenValues){return[tokenValues[1]]}},tupletHighlight:TUPLET,tupletValueHighlight:/((\d+)(:(\d+)))|(\d+)/,withBrackets:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_BRACKETS)}},bracketsHighlight:BRACKETS,startsWithTextValue:{test:function test(tokenValues){return(tokenValues[0]===STARTS||tokenValues[0]===BEGINS)&&tokenValues[1]===WITH&&isWrappedWithQuotes(tokenValues.slice(2))},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues.slice(2))]}},startsWithTextValueFrom:{test:function test(tokenValues){return(tokenValues[0]===STARTS||tokenValues[0]===BEGINS)&&tokenValues[1]===WITH&&isWrappedWithQuotes(tokenValues.slice(2,tokenValues.length-1))&&tokenValues[tokenValues.length-1]===FROM},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues.slice(2,tokenValues.length-1))]}},finishesWithTextValue:{test:function test(tokenValues){return(tokenValues[0]===FINISHES||tokenValues[0]===ENDS)&&tokenValues[1]===WITH&&isWrappedWithQuotes(tokenValues.slice(2))},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues.slice(2))]}},crescendoOrDiminuendo:{test:function test(tokenValues){return(tokenValues[0]===CRESCENDO||tokenValues[0]===CRES_DOT||tokenValues[0]===CRES||tokenValues[0]===CRESC_DOT||tokenValues[0]===CRESC||tokenValues[0]===DIMINUENDO||tokenValues[0]===DIM_DOT||tokenValues[0]===DIM)&&tokenValues.length===1},match:function match(tokenValues){if(tokenValues[0]===CRESCENDO||tokenValues[0]===CRES_DOT||tokenValues[0]===CRES||tokenValues[0]===CRESC_DOT||tokenValues[0]===CRESC){return[CRESCENDO]}return[DIMINUENDO]}},crescendoOrDiminuendoHighlight:/(crescendo|cres.|cres|cresc.|cresc|diminuendo|dim.|dim)/,with:{test:function test(tokenValues){return tokenValues[0]===WITH&&tokenValues.length===1}},repeatSimile:{test:function test(tokenValues){return(tokenValues[0]===REPEAT||tokenValues[0]===SIMILE)&&tokenValues.length===1}},repeatSimileHighlight:/(repeat|simile)/,volta:{test:function test(tokenValues){return tokenValues[0]===VOLTA&&tokenValues.length===1}},voltaBrackets:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,VOLTA_BRACKET)||areTwoArraysEqual(tokenValues,VOLTA_BRACKETS)}},voltaBracketsHighlight:/volta( bracket(s)?)?/,brackets:{test:function test(tokenValues){return(tokenValues[0]===BRACKET||tokenValues[0]===BRACKETS)&&tokenValues.length===1}},withPedal:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_SUSTAIN_PEDAL)||areTwoArraysEqual(tokenValues,WITH_PEDAL)}},withSustain:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_SUSTAIN_PEDAL)}},withSustainHighlight:SUSTAIN,withPedalHighlight:PEDAL,under:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,IS_UNDER)||tokenValues[0]===UNDER&&tokenValues.length===1}},afterBefore:{test:function test(tokenValues){return(tokenValues[0]===BEFORE||tokenValues[0]===AFTER)&&tokenValues.length===1},match:function match(tokenValues){var joinedTokenValues=tokenValues.join(SPACE);return[joinedTokenValues]}},text:{test:function test(tokenValues){return isWrappedWithQuotes(tokenValues)},match:function match(tokenValues){return[unwrappedFromQuotesValue(tokenValues)]}},bracket:{test:function test(tokenValues){return tokenValues[0]===BRACKET&&tokenValues.length===1}},opensWithBracket:{test:function test(tokenValues){return firstArrayContainsSecondArray(OPENS_WITH_BRACKET,tokenValues)}},bracketHighlight:BRACKET,afterMeasure:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,AFTER_MEASURE)}},release:{test:function test(tokenValues){return tokenValues[0]===RELEASE&&tokenValues.length===1}},withRelease:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_PEDAL_RELEASE)||areTwoArraysEqual(tokenValues,WITH_RELEASE)}},withReleaseHighlight:/(pedal(\s+))?release/,withVariablePeak:{test:function test(tokenValues){return areTwoArraysEqual(tokenValues,WITH_VARIABLE_PEAK)}},withVariablePeakHighlight:/variable(\s+)peak/,lines:{test:function test(tokenValues){return tokenValues[0]===LINES&&tokenValues.length===1}},linesHighlight:/lines/,somethingIsSomethingWithDelimetersHighlight:/^(.+?)(?=(is))(.+)$/m,compressUnitsByNTimes:{test:function test(tokenValues){var copressionValue=tokenValues[3]*1;return tokenValues[0]===COMPRESS&&tokenValues[1]===UNITS&&tokenValues[2]===BY&&copressionValue>1&&copressionValue<=5&&tokenValues[4]===TIMES&&tokenValues.length===5},match:function match(tokenValues){return[tokenValues[3]*1]}},stretchUnitsByNTimes:{test:function test(tokenValues){var stretchingValue=tokenValues[3];return tokenValues[0]===STRETCH&&tokenValues[1]===UNITS&&tokenValues[2]===BY&&stretchingValue>1&&stretchingValue<=5&&tokenValues[4]===TIMES&&tokenValues.length===5},match:function match(tokenValues){return[tokenValues[3]*1]}},unitsHighlight:UNITS,hideLastMeasure:{test:function test(tokenValues){return areTwoArraysEqual(HIDE_LAST_MEASURE,tokenValues)}},lastMeasureHighlight:/the(\s+)last(\s+)measure/,endsWithFermata:{test:function test(tokenValues){return areTwoArraysEqual(ENDS_WITH_FERMATA,tokenValues)}},fermata:{test:function test(tokenValues){return areTwoArraysEqual(FERMATA,tokenValues)}},fermataHighlight:/fermata/}},{"./../token/withoutDoubleSpacesAndTrimmed":166,"./applicationOfMeasureNumbersNames":104,"./articulationNames":105,"./breathMarkNames":107,"./chordLettersFonts":109,"./clefNames":110,"./closingBarLineNames":112,"./configurableStyleNames":114,"./cssColors":116,"./keySignatureNames":117,"./musicFonts":118,"./noteDurationNames":119,"./noteKeyNames":121,"./noteNames":123,"./openingBarLineNames":124,"./ornamentKeyNames":126,"./pageMetaNames":129,"./stavePositionNames":131,"./tempoDurationPartNames":133,"./textFonts":135}],131:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./stavePositions"))},{"./stavePositions":132}],132:[function(require,module,exports){"use strict";module.exports={previous:"prev",prev:"prev",current:"current",cur:"current",next:"next"}},{}],133:[function(require,module,exports){"use strict";module.exports=Object.keys(require("./tempoDurationParts"))},{"./tempoDurationParts":134}],134:[function(require,module,exports){"use strict";module.exports={whole:"whole",half:"half",quarter:"quarter",eighth:"eighth",sixteenth:"sixteenth","thirty\\s+second":"thirtySecond","sixty\\s+fourth":"sixtyFourth","1(?!\\d|/)":"whole","1/2(?!\\d|/)":"half","1/4(?!\\d|/)":"quarter","1/8(?!\\d|/)":"eighth","1/16(?!\\d|/)":"sixteenth","1/32(?!\\d|/)":"thirtySecond","1/64(?!\\d|/)":"sixtyFourth"}},{}],135:[function(require,module,exports){"use strict";module.exports=["noto-sans","noto-serif"]},{}],136:[function(require,module,exports){"use strict";module.exports=function(scenario,requiredCommandProgression){if(!scenario){throw new Error("scenario does not exist")}var scenarioCopy=Object.assign({},scenario);scenarioCopy.requiredCommandProgression=requiredCommandProgression;return scenarioCopy}},{}],137:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var match=regexps.direction.match(tokenValues);var direction=match[0];return direction}},{"./../static-objects/regexps":130}],138:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var match=regexps.aboveBelowOverUnder.match(tokenValues);var matchedDirection=match[0];var direction=matchedDirection==="above"||matchedDirection==="over"?"up":"down";return direction}},{"./../static-objects/regexps":130}],139:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var match=regexps.aboveBelowOverUnderStaveLines.match(tokenValues);var matchedDirection=match[0];var direction=matchedDirection==="above"||matchedDirection==="over"?"up":"down";return direction}},{"./../static-objects/regexps":130}],140:[function(require,module,exports){"use strict";module.exports=function(unitext,startCharIndex){var nextTokenChars=[];if(startCharIndex!==undefined){if(unitext[startCharIndex-1]!=="\n"){for(var charIndex=startCharIndex;charIndex<unitext.length;charIndex++){var currentChar=unitext[charIndex];var itIsDelimeterBetweenTokens=/\s/.test(currentChar);if(itIsDelimeterBetweenTokens){break}nextTokenChars.push(currentChar)}}}return nextTokenChars.join("")}},{}],141:[function(require,module,exports){"use strict";module.exports=function(unitext,startCharIndex,numberOfTokens){var nextTokenChars=[];var nextTokens=[];if(startCharIndex!==undefined){if(unitext[startCharIndex-1]!=="\n"){var lastCharIndex=unitext.length-1;for(var charIndex=startCharIndex;charIndex<unitext.length;charIndex++){var currentChar=unitext[charIndex];var itIsDelimeterBetweenTokens=/\s/.test(currentChar);if((itIsDelimeterBetweenTokens||charIndex===lastCharIndex)&&nextTokenChars.length>0){if(!itIsDelimeterBetweenTokens&&charIndex===lastCharIndex){nextTokenChars.push(currentChar)}nextTokens.push(nextTokenChars.join(""));nextTokenChars.length=0;if(nextTokens.length===numberOfTokens||currentChar==="\n"){break}}else{nextTokenChars.push(currentChar)}}}}return nextTokens}},{}],142:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var tokenValuesWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var match=regexps.horizontalCorrection.match(tokenValuesWithNumbersInsteadOfWords);var horizontalCorrectionValue=match[0];var directionOfHorizontalCorrection=match[1];var directionSignOfHorizontalCorrection=directionOfHorizontalCorrection==="left"?-1:1;return directionSignOfHorizontalCorrection*horizontalCorrectionValue}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],143:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.aboveBelowOverUnder.test(tokenValues)}},{"./../static-objects/regexps":130}],144:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.aboveBelowOverUnderStaveLines.test(tokenValues)}},{"./../static-objects/regexps":130}],145:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.direction.test(tokenValues)}},{"./../static-objects/regexps":130}],146:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.horizontalCorrection.test(withNumbersInsteadOfWords(tokenValues))}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],147:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.measureNumber.test(tokensWithNumbersInsteadOfWords)||regexps.numberOfMeasure.test(tokensWithNumbersInsteadOfWords)}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],148:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.noteIndex.test(tokensWithNumbersInsteadOfWords)||regexps.indexOfNote.test(tokensWithNumbersInsteadOfWords)}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],149:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){return regexps.withNumberOfStrokes.test(withNumbersInsteadOfWords(tokenValues))}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],150:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){return regexps.numberOfTimes.test(withNumbersInsteadOfWords(tokenValues))}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],151:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.withRoundness.test(tokenValues)}},{"./../static-objects/regexps":130}],152:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var tokenValuesWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);return regexps.staveIndex.test(tokenValuesWithNumbersInsteadOfWords)||regexps.indexOfStave.test(tokenValuesWithNumbersInsteadOfWords)}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],153:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){return regexps.verticalCorrection.test(withNumbersInsteadOfWords(tokenValues))}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],154:[function(require,module,exports){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}module.exports=function(tokens,delimitersBeforeFirstTokenOnTheLine,delimetersAfterEachToken){var resultBuffer=[];if(tokens&&tokens[0]&&tokens[0].firstOnTheLine){resultBuffer.push.apply(resultBuffer,_toConsumableArray(delimitersBeforeFirstTokenOnTheLine))}for(var tokenIndex=0;tokenIndex<tokens.length;tokenIndex++){resultBuffer.push(tokens[tokenIndex].value);resultBuffer.push.apply(resultBuffer,_toConsumableArray(delimetersAfterEachToken[tokens[tokenIndex].tokenNumber]))}return resultBuffer.join("")}},{}],155:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var match;if(regexps.measureNumber.test(tokensWithNumbersInsteadOfWords)){match=regexps.measureNumber.match(tokensWithNumbersInsteadOfWords)}else{match=regexps.numberOfMeasure.match(tokensWithNumbersInsteadOfWords)}var measureNumber=match[0]*1;return measureNumber}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],156:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,startsFromZero){var tokensWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var noteIndexMatches=regexps.noteIndex.match(tokensWithNumbersInsteadOfWords);if(noteIndexMatches&&noteIndexMatches[0]){var noteIndex=noteIndexMatches[0]*1-(startsFromZero?1:0);return noteIndex}var indexOfNoteMatches=regexps.indexOfNote.match(tokensWithNumbersInsteadOfWords);if(indexOfNoteMatches&&indexOfNoteMatches[0]){var _noteIndex=indexOfNoteMatches[0]*1-(startsFromZero?1:0);return _noteIndex}return 0}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],157:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){return regexps.withNumberOfStrokes.match(withNumbersInsteadOfWords(tokenValues))[0]*1}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],158:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");module.exports=function(tokenValues,joinedTokenValues){return regexps.numberOfTimes.match(withNumbersInsteadOfWords(tokenValues))[0]*1}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],159:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var match=regexps.withRoundness.match(tokenValues);var roundness=match[0]*1;return roundness}},{"./../static-objects/regexps":130}],160:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,startsFromZero){var tokenValuesWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);if(regexps.staveIndex.test(tokenValuesWithNumbersInsteadOfWords)){var staveIndexMatches=regexps.staveIndex.match(tokenValuesWithNumbersInsteadOfWords);if(staveIndexMatches!==undefined&&staveIndexMatches[0]!==undefined){var staveIndex=staveIndexMatches[0]*1-(startsFromZero?1:0);return staveIndex}}if(regexps.indexOfStave.test(tokenValuesWithNumbersInsteadOfWords)){var indexOfStaveMatches=regexps.indexOfStave.match(tokenValuesWithNumbersInsteadOfWords);if(indexOfStaveMatches!==undefined&&indexOfStaveMatches[0]!==undefined){var _staveIndex=indexOfStaveMatches[0]*1-(startsFromZero?1:0);return _staveIndex}}return 0}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],161:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");var tempoDurationParts=require("./../static-objects/tempoDurationParts");var numericDurations=["1","1/2","1/4","1/8","1/16","1/32","1/64"];module.exports=function(tempoValue){var rowTempoValueParts=tempoValue.split(regexps.tempoDurationPart);var tempoValueParts=[];for(var index=0;index<rowTempoValueParts.length;index++){var tempoValuePart=rowTempoValueParts[index];var tempoValuePartKey=numericDurations.indexOf(tempoValuePart)!==-1?"".concat(tempoValuePart,"(?!\\d|/)"):tempoValuePart;if(tempoDurationParts[tempoValuePartKey]){if(rowTempoValueParts[index+1]!==undefined&&/^\s{0,1}$/.test(rowTempoValueParts[index+1])&&rowTempoValueParts[index+2]!==undefined&&(rowTempoValueParts[index+2]==="dotted"||rowTempoValueParts[index+2]==="with dot")){index+=2;tempoValueParts.push("".concat(tempoDurationParts[tempoValuePartKey],"Dotted"))}else{tempoValueParts.push(tempoDurationParts[tempoValuePartKey])}}else{tempoValueParts.push(tempoValuePart)}}return tempoValueParts}},{"./../static-objects/regexps":130,"./../static-objects/tempoDurationParts":134}],162:[function(require,module,exports){"use strict";module.exports=function(tokens){return tokens.map(function(token){return token.value})}},{}],163:[function(require,module,exports){"use strict";var withNumbersInsteadOfWords=require("./withNumbersInsteadOfWords");var regexps=require("./../static-objects/regexps");module.exports=function(tokenValues,joinedTokenValues){var tokenValuesWithNumbersInsteadOfWords=withNumbersInsteadOfWords(tokenValues);var match=regexps.verticalCorrection.match(tokenValuesWithNumbersInsteadOfWords);var verticalCorrectionValue=match[0];var directionOfVerticalCorrection=match[1];var directionSignOfVerticalCorrection=directionOfVerticalCorrection==="up"?-1:1;return directionSignOfVerticalCorrection*verticalCorrectionValue}},{"./../static-objects/regexps":130,"./withNumbersInsteadOfWords":164}],164:[function(require,module,exports){"use strict";var NUMBERS_WITH_POSTFIX=["1st","2nd","3rd","4th","5th","6th","7th","8th","9th","0th","11th","12th"];var mapOfWordsAndNumbers={first:"1",second:"2",third:"3",fourth:"4",fifth:"5",sixth:"6",seventh:"7",eighth:"8",ninth:"9",tenth:"10",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};module.exports=function(tokenValues,joinedTokenValues){return tokenValues.map(function(tokenValue){var tokenValueLength=tokenValue.length;if(NUMBERS_WITH_POSTFIX.indexOf("".concat(tokenValue[tokenValueLength-3]).concat(tokenValue[tokenValueLength-2]).concat(tokenValue[tokenValueLength-1]))!==-1){tokenValue=tokenValue.slice(0,tokenValueLength-2)}else if(NUMBERS_WITH_POSTFIX.indexOf("".concat(tokenValue[tokenValueLength-4]).concat(tokenValue[tokenValueLength-3]).concat(tokenValue[tokenValueLength-2]).concat(tokenValue[tokenValueLength-1]))!==-1){tokenValue=tokenValue.slice(0,tokenValueLength-2)}return mapOfWordsAndNumbers[tokenValue]||tokenValue})}},{}],165:[function(require,module,exports){"use strict";var regexps=require("./../static-objects/regexps");module.exports=function(tokens){return regexps.globalCommandDelimiter.replaceAllWithEmptyString(tokens)}},{"./../static-objects/regexps":130}],166:[function(require,module,exports){"use strict";module.exports=function(str){return str.replace(/(\s){2,}/g," ").trim()}},{}],167:[function(require,module,exports){"use strict";module.exports=function(divUnderneathTextarea,html){var oldTextContainer=divUnderneathTextarea.textContainer;var newTextContainer=divUnderneathTextarea.textContainer.cloneNode(false);newTextContainer.innerHTML=html;oldTextContainer.parentNode.replaceChild(newTextContainer,oldTextContainer);divUnderneathTextarea.textContainer=newTextContainer}},{}],168:[function(require,module,exports){"use strict";module.exports=function(textarea){textarea.addEventListener("input",function(){if(textarea.selectionStart===textarea.value.length){textarea.scrollTop=textarea.scrollHeight}})}},{}],169:[function(require,module,exports){"use strict";var textWidthInTextarea=require("./textWidthInTextarea");module.exports=function(textarea,textareaLineHeight,fontFamily){var selectionStartInTextarea=textarea.selectionStart;var textareaValueSplittedInLines=textarea.value.split("\n");var numberOfCharsInEachLineInTextarea=textareaValueSplittedInLines.map(function(value){return value.length});var lineIndexWhereCaretIsOn=textarea.value.substr(0,selectionStartInTextarea).split("\n").length-1;var numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn=numberOfCharsInEachLineInTextarea.slice(0,lineIndexWhereCaretIsOn);var numberOfCharsBeforeFirstCharOnTheLineWhereCaretIsOn=numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn.length>=1?numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn.reduce(function(totalNumberOfChars,numberOfCharsOnTheLineWhereCaretIsOn){return totalNumberOfChars+numberOfCharsOnTheLineWhereCaretIsOn}):0;var totalNumberOfCharsBeforeSelectionStartInTextarea=selectionStartInTextarea;var numberOfNewLineCharsBeforeTheLineWhereCaretIsOn=lineIndexWhereCaretIsOn;var columnNumberWhereCaretIsOn=totalNumberOfCharsBeforeSelectionStartInTextarea-numberOfCharsBeforeFirstCharOnTheLineWhereCaretIsOn-numberOfNewLineCharsBeforeTheLineWhereCaretIsOn;var textareaValueOnTheLineWhereCarretIsOn=textareaValueSplittedInLines[lineIndexWhereCaretIsOn];var textTillCurrentColumnNumberAndTheLineNumberWhereCaretIsOn=textareaValueOnTheLineWhereCarretIsOn.slice(0,columnNumberWhereCaretIsOn);var widthOfTextTillCurrentColumnNumberAndTheLineNumberWhereCaretIsOn=textWidthInTextarea(textarea,textTillCurrentColumnNumberAndTheLineNumberWhereCaretIsOn,fontFamily);var yPositionOfCaretInTextarea=textareaLineHeight*(lineIndexWhereCaretIsOn+1);var xPositionOfCaretInTextarea=widthOfTextTillCurrentColumnNumberAndTheLineNumberWhereCaretIsOn;var caretInTextareaIsOutOfVerticalView=textarea.scrollTop>yPositionOfCaretInTextarea+textareaLineHeight||textarea.scrollTop<yPositionOfCaretInTextarea-textarea.clientHeight;var caretInTextareaIsOutOfHorizontalView=textarea.scrollLeft>xPositionOfCaretInTextarea||textarea.scrollLeft<xPositionOfCaretInTextarea-textarea.clientWidth;if(caretInTextareaIsOutOfVerticalView){var negativeTopPaddingSoThatCaretWillBeSomewhatInTheMiddleOfVerticalView=1/3;textarea.scrollTop=yPositionOfCaretInTextarea-textarea.clientHeight*negativeTopPaddingSoThatCaretWillBeSomewhatInTheMiddleOfVerticalView}if(caretInTextareaIsOutOfHorizontalView){var negativeLeftPaddingSoThatCaretWillBeSomewhatInTheMiddleOfHorizontalView=1/3;textarea.scrollLeft=xPositionOfCaretInTextarea-textarea.clientWidth*negativeLeftPaddingSoThatCaretWillBeSomewhatInTheMiddleOfHorizontalView}}},{"./textWidthInTextarea":173}],170:[function(require,module,exports){"use strict";module.exports=function(textarea){textarea.addEventListener("keydown",function(event){if(event.key==="Enter"){textarea.scrollLeft=0}})}},{}],171:[function(require,module,exports){"use strict";var textWidthInTextarea=require("./textWidthInTextarea");var createdElementWithStylesAndAttributes=require("./createdElementWithStylesAndAttributes");var coordinatesOfElement=require("./coordinatesOfElement");var highlightTextareaValueInDivUnderneathItWithoutRefIds=require("./highlightTextareaValueInDivUnderneathItWithoutRefIds");var listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios=require("./listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios");var isPrintableKeycode=require("./isPrintableKeycode");var isMacOS=navigator.platform.indexOf("Mac")!==-1;var noteNames=["a","b","c","d","e","f","g"];var delimeters=[",",";"];var populateListOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn=function populateListOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn(listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,uncompletedWord,uncopleteWordEqualsToOneOfTheSuggestions){for(var wordIndex=0;wordIndex<listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn.length;wordIndex++){if(listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn[wordIndex].toLowerCase().trim()===uncompletedWord){uncopleteWordEqualsToOneOfTheSuggestions.value=true}if((listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn[wordIndex].toLowerCase().startsWith(uncompletedWord)&&listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn[wordIndex].toLowerCase().trim()!==uncompletedWord||uncompletedWord==="")&&listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn.indexOf(listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn[wordIndex])===-1){listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn.push(listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn[wordIndex])}}};var foundOptionsForUncompletedWord=function foundOptionsForUncompletedWord(charIndexWhereCaretIsOn,listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios,uncompletedWord,caretInOnSpace){var uncopleteWordEqualsToOneOfTheSuggestions={value:false};if(uncompletedWord.length>1||noteNames.indexOf(uncompletedWord)===-1){var listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn=[];if(!caretInOnSpace){var progressionOfCommandsFromScenariosRelatedToPositionWhereCaretIsIn=window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios[charIndexWhereCaretIsOn]||window.mapOfCharIndexesWithProgressionOfCommandsFromScenarios[charIndexWhereCaretIsOn-1];if(progressionOfCommandsFromScenariosRelatedToPositionWhereCaretIsIn){for(var commandName in listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios){if(progressionOfCommandsFromScenariosRelatedToPositionWhereCaretIsIn.indexOf(commandName)!==-1){var listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn=listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios[commandName];populateListOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn(listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,listOfPossibleOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,uncompletedWord,uncopleteWordEqualsToOneOfTheSuggestions)}}}if(listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn.length===0&&!uncopleteWordEqualsToOneOfTheSuggestions.value){var listOfPossibleOptionsFromGeneralSectionToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn=listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios["general"];uncopleteWordEqualsToOneOfTheSuggestions.value=false;populateListOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn(listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,listOfPossibleOptionsFromGeneralSectionToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn,uncompletedWord,uncopleteWordEqualsToOneOfTheSuggestions)}}return listOfActualOptionsToCompleteWordForCommandProgressionRelatedToPositionWhereCaretIsIn.sort(function(optionBefore,optionAfter){return optionBefore.length-optionAfter.length||optionBefore.localeCompare(optionAfter)})}return[]};var fillAutocompleteListViewWithOptionsForUncompletedWord=function fillAutocompleteListViewWithOptionsForUncompletedWord(uncompletedWord,autocompleteListView,optionsForUncompletedWord){autocompleteListView.innerHTML="";autocompleteListView.optionIndex=0;optionsForUncompletedWord.forEach(function(optionTextValue,optionIndex){var optionElement=createdElementWithStylesAndAttributes("div",{},{class:"autocomplete-list-view-option"});var optionTextValueWrappedWithMatchinHighlight=optionTextValue.replace(uncompletedWord,function(match){return'<span class="uncomplete-word-highlight-in-list-of-options-in-autocomplete-list-view">'.concat(match,"</span>")});optionElement.innerHTML=optionTextValueWrappedWithMatchinHighlight;optionElement.index=optionIndex;optionElement.textValue=optionTextValue;autocompleteListView.appendChild(optionElement);if(optionIndex===0){optionElement.classList.add("selected");optionElement.scrollIntoView({block:"nearest"})}})};var completeWord=function completeWord(textarea,divUnderneathTextarea,autocompleteListView,columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn,lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord,numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn){if(autocompleteListView.style.display!=="none"){var selectedOptionElement=autocompleteListView.childNodes[autocompleteListView.optionIndex];if(columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn!==undefined&&lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord!==undefined&&selectedOptionElement){var lastCharInWordThatIsAboutToBeReplacedByAutocompletionIsDelimeter=delimeters.indexOf(textarea.value[numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn+lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord-1])!==-1;var charIndexOfTextvalueThatWeRestoreAfterAutocompletion=numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn+lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord-(lastCharInWordThatIsAboutToBeReplacedByAutocompletionIsDelimeter?1:0);textarea.value=textarea.value.substr(0,numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn+columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn)+selectedOptionElement.textValue+textarea.value.substr(charIndexOfTextvalueThatWeRestoreAfterAutocompletion);textarea.textareaTextLengthBeforeNextChange=textarea.value.length;textarea.isRenderedWithLatestUnilangInputText=false;textarea.isModified=true;var scrollTopOfTextareaBefore=textarea.scrollTop;var scrollLeftOfTextareaBefore=textarea.scrollLeft;textarea.focus();textarea.scrollTop=scrollTopOfTextareaBefore;textarea.scrollLeft=scrollLeftOfTextareaBefore;var caretPositionAfterWordCompletion=numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn+columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn+selectedOptionElement.textValue.length;textarea.setSelectionRange(caretPositionAfterWordCompletion,caretPositionAfterWordCompletion);autocompleteListView.style.display="none";highlightTextareaValueInDivUnderneathItWithoutRefIds(divUnderneathTextarea,textarea,false)}}};var selectedOptionInAutocompleteList=function selectedOptionInAutocompleteList(autocompleteListView,optionIndex){if(autocompleteListView.childNodes[autocompleteListView.optionIndex]){autocompleteListView.childNodes[autocompleteListView.optionIndex].classList.remove("selected")}autocompleteListView.optionIndex=optionIndex;if(autocompleteListView.childNodes[autocompleteListView.optionIndex]){autocompleteListView.childNodes[autocompleteListView.optionIndex].classList.add("selected")}};module.exports=function(autocompleteListView,textarea,divUnderneathTextarea,fontFamily){autocompleteListView.optionIndex=0;var numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn;var columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn;var lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord;var enterOrTabIsUp=true;textarea.addEventListener("keyup",function(event){var itIsSpaceBarPressed=event.keyCode===32;var itIsEnterPressed=event.keyCode===13;var itIsTabPressed=event.keyCode===9;var itIsArrowUpPressed=event.keyCode===38;var itIsArrowDownPressed=event.keyCode===40;var itIsBackSpacePressed=event.keyCode===8;var itIsPrintableKeyPressed=isPrintableKeycode(event.keyCode);var isCmdPressed=isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey;if(itIsBackSpacePressed&&autocompleteListView.style.display==="none"){return}if(!itIsSpaceBarPressed&&!itIsEnterPressed&&!itIsTabPressed&&!isCmdPressed&&itIsPrintableKeyPressed){var textareaValueSplittedInLines=textarea.value.split("\n");var numberOfCharsInEachLineInTextarea=textareaValueSplittedInLines.map(function(value){return value.length});var selectionStartInTextarea=textarea.selectionStart;var totalNumberOfLinesBeforeSelectionStart=textarea.value.substr(0,selectionStartInTextarea).split("\n").length;var lineNumberWhereCaretIsOn=totalNumberOfLinesBeforeSelectionStart-1;var numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn=numberOfCharsInEachLineInTextarea.slice(0,lineNumberWhereCaretIsOn);var numberOfCharsBeforeFirstCharOnTheLineWhereCaretIsOn=numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn.length>=1?numberOfCharsInEachLineBeforeTheLineWhereCaretIsOn.reduce(function(totalNumberOfChars,numberOfCharsOnTheLineWhereCaretIsOn){return totalNumberOfChars+numberOfCharsOnTheLineWhereCaretIsOn}):0;var numberOfNewLineCharsBeforeTheLineWhereCaretIsOn=lineNumberWhereCaretIsOn;numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn=numberOfCharsBeforeFirstCharOnTheLineWhereCaretIsOn+numberOfNewLineCharsBeforeTheLineWhereCaretIsOn;var totalNumberOfCharsBeforeSelectionStartInTextarea=selectionStartInTextarea;var columnNumberWhereCaretIsOn=totalNumberOfCharsBeforeSelectionStartInTextarea-numberOfCharsBeforeFirstCharOnTheLineWhereCaretIsOn-numberOfNewLineCharsBeforeTheLineWhereCaretIsOn;var textareaValueOnTheLineWhereCaretIsOn=textareaValueSplittedInLines[lineNumberWhereCaretIsOn];for(var columnNumber=columnNumberWhereCaretIsOn;columnNumber>=0;columnNumber--){if(textareaValueOnTheLineWhereCaretIsOn[columnNumber-1]&&/\s/.test(textareaValueOnTheLineWhereCaretIsOn[columnNumber-1])||columnNumber===0&&!/\s/.test(textareaValueOnTheLineWhereCaretIsOn[columnNumber])){columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn=columnNumber;break}}var caretInOnSpace=columnNumberWhereCaretIsOn===columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn&&(textareaValueOnTheLineWhereCaretIsOn[columnNumberWhereCaretIsOn]===undefined||/\s/.test(textareaValueOnTheLineWhereCaretIsOn[columnNumberWhereCaretIsOn]))&&textareaValueOnTheLineWhereCaretIsOn[columnNumberWhereCaretIsOn-1]&&/\s/.test(textareaValueOnTheLineWhereCaretIsOn[columnNumberWhereCaretIsOn-1]);if(columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn!==undefined){if(columnNumberWhereCaretIsOn>=columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn+1||caretInOnSpace){var lastColumnNumberOnTheLineWhereCaretInOn=textareaValueOnTheLineWhereCaretIsOn.length;lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord=columnNumberWhereCaretIsOn;if(!/\s/.test(textareaValueOnTheLineWhereCaretIsOn[columnNumberWhereCaretIsOn])){for(var _columnNumber=columnNumberWhereCaretIsOn;_columnNumber<lastColumnNumberOnTheLineWhereCaretInOn;_columnNumber++){if(_columnNumber===textareaValueOnTheLineWhereCaretIsOn.length-1||textareaValueOnTheLineWhereCaretIsOn[_columnNumber+1]&&/\s/.test(textareaValueOnTheLineWhereCaretIsOn[_columnNumber+1])){lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord=_columnNumber+1;break}}}var currentUncompletedWord=textareaValueOnTheLineWhereCaretIsOn.slice(columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn,columnNumberWhereCaretIsOn);var charIndexWhereCaretIsOn=numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn+columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn;var optionsForUncompletedWord=foundOptionsForUncompletedWord(charIndexWhereCaretIsOn,listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios,currentUncompletedWord,caretInOnSpace);if(optionsForUncompletedWord.length>0){if(autocompleteListView.style.display==="none"){autocompleteListView.style.display=""}fillAutocompleteListViewWithOptionsForUncompletedWord(currentUncompletedWord,autocompleteListView,optionsForUncompletedWord);var textTillFirstNonSpaceCharBeforeTheColumnNumberOnTheLineWhereCaretIsOn=textareaValueOnTheLineWhereCaretIsOn.slice(0,columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn);var widthOfTextTillFirstNonSpaceCharBeforeTheColumnNumberOnTheLineWhereCaretIsOn=textWidthInTextarea(textarea,textTillFirstNonSpaceCharBeforeTheColumnNumberOnTheLineWhereCaretIsOn,fontFamily);var textareaComputedStyle=window.getComputedStyle(textarea);var textareaLeft=textareaComputedStyle.getPropertyValue("left").split("px")[0]*1;var textareaTop=textareaComputedStyle.getPropertyValue("top").split("px")[0]*1;var textareaHeight=textareaComputedStyle.getPropertyValue("height").split("px")[0]*1;var textareaBottom=textareaTop+textareaHeight;var distanceToMoveAutocompleteListViewSoWeCanAddPaddingToItAndTheTextWouldAlignCorrectly=10;var leftOfAutocompleteListView=textareaLeft+widthOfTextTillFirstNonSpaceCharBeforeTheColumnNumberOnTheLineWhereCaretIsOn-textarea.scrollLeft-distanceToMoveAutocompleteListViewSoWeCanAddPaddingToItAndTheTextWouldAlignCorrectly;var textareaLineHeight=textareaComputedStyle.getPropertyValue("line-height").split("px")[0]*1;var marginTopOfAutocompleteListView=2.5;var marginBottomOfAutocompleteListView=4;var autocompleteListViewComputedStyle=window.getComputedStyle(autocompleteListView);var autocompleteListViewHeight=autocompleteListViewComputedStyle.getPropertyValue("height").split("px")[0]*1;var topOfAutocompleteListView=textareaTop+textareaLineHeight*(lineNumberWhereCaretIsOn+1)+marginTopOfAutocompleteListView-textarea.scrollTop;if(topOfAutocompleteListView+autocompleteListViewHeight>=textareaBottom){topOfAutocompleteListView=topOfAutocompleteListView-autocompleteListViewHeight-textareaLineHeight*1-marginBottomOfAutocompleteListView}autocompleteListView.style.left="".concat(leftOfAutocompleteListView,"px");autocompleteListView.style.top="".concat(topOfAutocompleteListView,"px")}else{autocompleteListView.style.display="none"}}else{autocompleteListView.style.display="none"}}}else if(!itIsArrowUpPressed&&!itIsArrowDownPressed){autocompleteListView.style.display="none"}});textarea.addEventListener("keydown",function(event){if(autocompleteListView.style.display!=="none"){var itIsArrowUpPressed=event.keyCode===38;var itIsArrowDownPressed=event.keyCode===40;var itIsEnterPressed=event.keyCode===13;var itIsTabPressed=event.keyCode===9;if(itIsTabPressed||itIsEnterPressed){if(enterOrTabIsUp){event.preventDefault();completeWord(textarea,divUnderneathTextarea,autocompleteListView,columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn,lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord,numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn);enterOrTabIsUp=false}}else if(itIsArrowUpPressed||itIsArrowDownPressed){event.preventDefault();autocompleteListView.optionIndex=autocompleteListView.optionIndex||0;if(autocompleteListView.childNodes[autocompleteListView.optionIndex]){autocompleteListView.childNodes[autocompleteListView.optionIndex].classList.remove("selected");var newOptionIndex=autocompleteListView.optionIndex+(itIsArrowUpPressed?-1:1);if(autocompleteListView.childNodes[newOptionIndex]){autocompleteListView.childNodes[newOptionIndex].classList.add("selected");autocompleteListView.childNodes[newOptionIndex].scrollIntoView({block:"nearest"});autocompleteListView.optionIndex=newOptionIndex}else{var _newOptionIndex=itIsArrowUpPressed?autocompleteListView.childNodes.length-1:0;autocompleteListView.childNodes[_newOptionIndex].classList.add("selected");autocompleteListView.childNodes[_newOptionIndex].scrollIntoView({block:"nearest"});autocompleteListView.optionIndex=_newOptionIndex}}}}});textarea.addEventListener("keyup",function(event){var itIsEnterPressed=event.keyCode===13;var itIsTabPressed=event.keyCode===9;if(itIsTabPressed||itIsEnterPressed){enterOrTabIsUp=true}});autocompleteListView.addEventListener("click",function(event){selectedOptionInAutocompleteList(autocompleteListView,event.target.index);completeWord(textarea,divUnderneathTextarea,autocompleteListView,columnNumberOfCharWhichIsFirstNonSpaceCharBeforeTheColumnNumberWhereCaretIsOn,lastColumnNumberOnTheLineWhereCaretIsOnForCurrentUncompletedWord,numberOfCharsIncludingNewLineCharsBeforeFirstCharInTheLineWhereCaretIsOn)});textarea.addEventListener("select",function(){if(autocompleteListView.style.display!=="none"){if(textarea.selectionStart!==textarea.selectionEnd){autocompleteListView.style.display="none"}}});textarea.addEventListener("click",function(){autocompleteListView.style.display="none"});textarea.addEventListener("scroll",function(){if(autocompleteListView.style.display!=="none"&&!window.weAreTypingInTextarea){autocompleteListView.style.display="none"}});var resizeObserver=new ResizeObserver(function(entries){autocompleteListView.style.display="none"});resizeObserver.observe(textarea)}},{"./coordinatesOfElement":3,"./createdElementWithStylesAndAttributes":6,"./highlightTextareaValueInDivUnderneathItWithoutRefIds":17,"./isPrintableKeycode":19,"./listsOfPossibleOptionsToCompleteWordByProgressionOfCommandsFromScenarios":20,"./textWidthInTextarea":173}],172:[function(require,module,exports){"use strict";module.exports=function(divUnderneathTextarea,lineNumbersColumn,textarea){textarea.addEventListener("scroll",function(){divUnderneathTextarea.scrollTop=textarea.scrollTop;divUnderneathTextarea.scrollLeft=textarea.scrollLeft;lineNumbersColumn.scrollTop=textarea.scrollTop},{passive:true})}},{}],173:[function(require,module,exports){"use strict";var canvasFontFromTextarea=require("./canvasFontFromTextarea");module.exports=function(textarea,text,fontFamily){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");context.font=canvasFontFromTextarea(textarea,fontFamily);var metrics=context.measureText(text);return metrics.width}},{"./canvasFontFromTextarea":2}]},{},[21]);